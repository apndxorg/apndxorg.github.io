<html><head><title>Guarantees by Construction (Mechanization)</title><link rel="stylesheet" href="/pub/thesis/styles.css"><script src="/pub/thesis/script.js"></script><link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet"></head><body><header><h1>Guarantees by Construction (Mechanization)</h1><h3>Jules Jacobs</h3></header><div id="container"><div id="tree"><ul><li><a href="/pub/thesis/README.md.html">README.md</a></li><li><span class="directory">cgraphs</span><ul><li><a href="/pub/thesis/cgraphs/bi.v.html">bi.v</a></li><li><a href="/pub/thesis/cgraphs/cgraph.v.html">cgraph.v</a></li><li><a href="/pub/thesis/cgraphs/genericinv.v.html">genericinv.v</a></li><li><a href="/pub/thesis/cgraphs/mapexcl.v.html">mapexcl.v</a></li><li><a href="/pub/thesis/cgraphs/multiset.v.html">multiset.v</a></li><li><a href="/pub/thesis/cgraphs/seplogic.v.html">seplogic.v</a></li><li><a href="/pub/thesis/cgraphs/uforests.v.html">uforests.v</a></li><li><a href="/pub/thesis/cgraphs/upred.v.html">upred.v</a></li><li><a href="/pub/thesis/cgraphs/util.v.html">util.v</a></li></ul></li><li><span class="directory">dlfactris</span><ul><li><span class="directory">algebra</span><ul><li><a href="/pub/thesis/dlfactris/algebra/multiset.v.html">multiset.v</a></li></ul></li><li><span class="directory">base_logic</span><ul><li><a href="/pub/thesis/dlfactris/base_logic/adequacy.v.html">adequacy.v</a></li><li><a href="/pub/thesis/dlfactris/base_logic/aprop.v.html">aprop.v</a></li><li><a href="/pub/thesis/dlfactris/base_logic/cgraph.v.html">cgraph.v</a></li><li><a href="/pub/thesis/dlfactris/base_logic/linpred.v.html">linpred.v</a></li><li><a href="/pub/thesis/dlfactris/base_logic/miniprot.v.html">miniprot.v</a></li><li><a href="/pub/thesis/dlfactris/base_logic/proofmode.v.html">proofmode.v</a></li><li><a href="/pub/thesis/dlfactris/base_logic/uforests.v.html">uforests.v</a></li><li><a href="/pub/thesis/dlfactris/base_logic/wp.v.html">wp.v</a></li><li><a href="/pub/thesis/dlfactris/base_logic/wp_prim.v.html">wp_prim.v</a></li></ul></li><li><span class="directory">examples</span><ul><li><a href="/pub/thesis/dlfactris/examples/assert.v.html">assert.v</a></li><li><a href="/pub/thesis/dlfactris/examples/basics.v.html">basics.v</a></li><li><a href="/pub/thesis/dlfactris/examples/compare.v.html">compare.v</a></li><li><a href="/pub/thesis/dlfactris/examples/list_rev.v.html">list_rev.v</a></li><li><a href="/pub/thesis/dlfactris/examples/llist.v.html">llist.v</a></li><li><a href="/pub/thesis/dlfactris/examples/sort.v.html">sort.v</a></li><li><a href="/pub/thesis/dlfactris/examples/sort_br_del.v.html">sort_br_del.v</a></li><li><a href="/pub/thesis/dlfactris/examples/sort_fg.v.html">sort_fg.v</a></li><li><a href="/pub/thesis/dlfactris/examples/tour.v.html">tour.v</a></li></ul></li><li><span class="directory">lang</span><ul><li><a href="/pub/thesis/dlfactris/lang/lang.v.html">lang.v</a></li><li><a href="/pub/thesis/dlfactris/lang/metatheory.v.html">metatheory.v</a></li><li><a href="/pub/thesis/dlfactris/lang/notation.v.html">notation.v</a></li></ul></li><li><span class="directory">logrel</span><ul><li><a href="/pub/thesis/dlfactris/logrel/contexts.v.html">contexts.v</a></li><li><span class="directory">examples</span><ul><li><a href="/pub/thesis/dlfactris/logrel/examples/compute_service.v.html">compute_service.v</a></li><li><a href="/pub/thesis/dlfactris/logrel/examples/pair.v.html">pair.v</a></li><li><a href="/pub/thesis/dlfactris/logrel/examples/rec_subtyping.v.html">rec_subtyping.v</a></li></ul></li><li><a href="/pub/thesis/dlfactris/logrel/model.v.html">model.v</a></li><li><a href="/pub/thesis/dlfactris/logrel/operators.v.html">operators.v</a></li><li><a href="/pub/thesis/dlfactris/logrel/session_types.v.html">session_types.v</a></li><li><a href="/pub/thesis/dlfactris/logrel/session_typing_rules.v.html">session_typing_rules.v</a></li><li><a href="/pub/thesis/dlfactris/logrel/subtyping.v.html">subtyping.v</a></li><li><a href="/pub/thesis/dlfactris/logrel/subtyping_rules.v.html">subtyping_rules.v</a></li><li><a href="/pub/thesis/dlfactris/logrel/telescopes.v.html">telescopes.v</a></li><li><a href="/pub/thesis/dlfactris/logrel/term_types.v.html">term_types.v</a></li><li><a href="/pub/thesis/dlfactris/logrel/term_typing_judgment.v.html">term_typing_judgment.v</a></li><li><a href="/pub/thesis/dlfactris/logrel/term_typing_rules.v.html">term_typing_rules.v</a></li></ul></li><li><span class="directory">prelude</span><ul><li><a href="/pub/thesis/dlfactris/prelude/prelude.v.html">prelude.v</a></li></ul></li><li><span class="directory">session_logic</span><ul><li><a href="/pub/thesis/dlfactris/session_logic/imp.v.html">imp.v</a></li><li><a href="/pub/thesis/dlfactris/session_logic/proofmode.v.html">proofmode.v</a></li><li><a href="/pub/thesis/dlfactris/session_logic/sessions.v.html">sessions.v</a></li><li><a href="/pub/thesis/dlfactris/session_logic/sub.v.html">sub.v</a></li><li><a href="/pub/thesis/dlfactris/session_logic/tele_imp.v.html">tele_imp.v</a></li></ul></li></ul></li><li><span class="directory">lambdabar</span><ul><li><a href="/pub/thesis/lambdabar/compiler.v.html">compiler.v</a></li><li><a href="/pub/thesis/lambdabar/definitions.v.html">definitions.v</a></li><li><a href="/pub/thesis/lambdabar/invariant.v.html">invariant.v</a></li><li><a href="/pub/thesis/lambdabar/langdef.v.html">langdef.v</a></li><li><a href="/pub/thesis/lambdabar/langtools.v.html">langtools.v</a></li><li><a href="/pub/thesis/lambdabar/letmacro.v.html">letmacro.v</a></li><li><a href="/pub/thesis/lambdabar/rtypesystem.v.html">rtypesystem.v</a></li><li><a href="/pub/thesis/lambdabar/sessions.v.html">sessions.v</a></li><li><a href="/pub/thesis/lambdabar/theorems.v.html">theorems.v</a></li></ul></li><li><span class="directory">locks</span><ul><li><span class="directory">lambdalock</span><ul><li><a href="/pub/thesis/locks/lambdalock/definitions.v.html">definitions.v</a></li><li><a href="/pub/thesis/locks/lambdalock/invariant.v.html">invariant.v</a></li><li><a href="/pub/thesis/locks/lambdalock/langdef.v.html">langdef.v</a></li><li><a href="/pub/thesis/locks/lambdalock/langtools.v.html">langtools.v</a></li><li><a href="/pub/thesis/locks/lambdalock/letmacro.v.html">letmacro.v</a></li><li><a href="/pub/thesis/locks/lambdalock/rtypesystem.v.html">rtypesystem.v</a></li><li><a href="/pub/thesis/locks/lambdalock/theorems.v.html">theorems.v</a></li></ul></li><li><span class="directory">lambdalockpp</span><ul><li><a href="/pub/thesis/locks/lambdalockpp/definitions.v.html">definitions.v</a></li><li class="current"><a href="/pub/thesis/locks/lambdalockpp/invariant.v.html">invariant.v</a></li><li><a href="/pub/thesis/locks/lambdalockpp/langdef.v.html">langdef.v</a></li><li><a href="/pub/thesis/locks/lambdalockpp/langtools.v.html">langtools.v</a></li><li><a href="/pub/thesis/locks/lambdalockpp/letmacro.v.html">letmacro.v</a></li><li><a href="/pub/thesis/locks/lambdalockpp/plan.md.html">plan.md</a></li><li><a href="/pub/thesis/locks/lambdalockpp/rtypesystem.v.html">rtypesystem.v</a></li><li><a href="/pub/thesis/locks/lambdalockpp/theorems.v.html">theorems.v</a></li></ul></li></ul></li><li><span class="directory">miniactris</span><ul><li><a href="/pub/thesis/miniactris/README.md.html">README.md</a></li><li><a href="/pub/thesis/miniactris/base.v.html">base.v</a></li><li><a href="/pub/thesis/miniactris/imp.v.html">imp.v</a></li><li><a href="/pub/thesis/miniactris/send_close.v.html">send_close.v</a></li><li><a href="/pub/thesis/miniactris/session.v.html">session.v</a></li><li><a href="/pub/thesis/miniactris/sub.v.html">sub.v</a></li><li><a href="/pub/thesis/miniactris/sym_close.v.html">sym_close.v</a></li></ul></li><li><span class="directory">multiparty</span><ul><li><a href="/pub/thesis/multiparty/binary.v.html">binary.v</a></li><li><a href="/pub/thesis/multiparty/definitions.v.html">definitions.v</a></li><li><a href="/pub/thesis/multiparty/globaltypes.v.html">globaltypes.v</a></li><li><a href="/pub/thesis/multiparty/invariant.v.html">invariant.v</a></li><li><a href="/pub/thesis/multiparty/langdef.v.html">langdef.v</a></li><li><a href="/pub/thesis/multiparty/mutil.v.html">mutil.v</a></li><li><a href="/pub/thesis/multiparty/progress.v.html">progress.v</a></li><li><a href="/pub/thesis/multiparty/rtypesystem.v.html">rtypesystem.v</a></li><li><a href="/pub/thesis/multiparty/theorems.v.html">theorems.v</a></li><li><a href="/pub/thesis/multiparty/ycombinator.v.html">ycombinator.v</a></li></ul></li><li><span class="directory">sessiontypes</span><ul><li><a href="/pub/thesis/sessiontypes/invariant.v.html">invariant.v</a></li><li><a href="/pub/thesis/sessiontypes/langdef.v.html">langdef.v</a></li><li><a href="/pub/thesis/sessiontypes/progress.v.html">progress.v</a></li><li><a href="/pub/thesis/sessiontypes/rtypesystem.v.html">rtypesystem.v</a></li><li><a href="/pub/thesis/sessiontypes/safety.v.html">safety.v</a></li><li><a href="/pub/thesis/sessiontypes/ycombinator.v.html">ycombinator.v</a></li></ul></li></ul></div><div id="content"><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"><a href="#line-1">   1</a></span>
<span class="normal"><a href="#line-2">   2</a></span>
<span class="normal"><a href="#line-3">   3</a></span>
<span class="normal"><a href="#line-4">   4</a></span>
<span class="normal"><a href="#line-5">   5</a></span>
<span class="normal"><a href="#line-6">   6</a></span>
<span class="normal"><a href="#line-7">   7</a></span>
<span class="normal"><a href="#line-8">   8</a></span>
<span class="normal"><a href="#line-9">   9</a></span>
<span class="normal"><a href="#line-10">  10</a></span>
<span class="normal"><a href="#line-11">  11</a></span>
<span class="normal"><a href="#line-12">  12</a></span>
<span class="normal"><a href="#line-13">  13</a></span>
<span class="normal"><a href="#line-14">  14</a></span>
<span class="normal"><a href="#line-15">  15</a></span>
<span class="normal"><a href="#line-16">  16</a></span>
<span class="normal"><a href="#line-17">  17</a></span>
<span class="normal"><a href="#line-18">  18</a></span>
<span class="normal"><a href="#line-19">  19</a></span>
<span class="normal"><a href="#line-20">  20</a></span>
<span class="normal"><a href="#line-21">  21</a></span>
<span class="normal"><a href="#line-22">  22</a></span>
<span class="normal"><a href="#line-23">  23</a></span>
<span class="normal"><a href="#line-24">  24</a></span>
<span class="normal"><a href="#line-25">  25</a></span>
<span class="normal"><a href="#line-26">  26</a></span>
<span class="normal"><a href="#line-27">  27</a></span>
<span class="normal"><a href="#line-28">  28</a></span>
<span class="normal"><a href="#line-29">  29</a></span>
<span class="normal"><a href="#line-30">  30</a></span>
<span class="normal"><a href="#line-31">  31</a></span>
<span class="normal"><a href="#line-32">  32</a></span>
<span class="normal"><a href="#line-33">  33</a></span>
<span class="normal"><a href="#line-34">  34</a></span>
<span class="normal"><a href="#line-35">  35</a></span>
<span class="normal"><a href="#line-36">  36</a></span>
<span class="normal"><a href="#line-37">  37</a></span>
<span class="normal"><a href="#line-38">  38</a></span>
<span class="normal"><a href="#line-39">  39</a></span>
<span class="normal"><a href="#line-40">  40</a></span>
<span class="normal"><a href="#line-41">  41</a></span>
<span class="normal"><a href="#line-42">  42</a></span>
<span class="normal"><a href="#line-43">  43</a></span>
<span class="normal"><a href="#line-44">  44</a></span>
<span class="normal"><a href="#line-45">  45</a></span>
<span class="normal"><a href="#line-46">  46</a></span>
<span class="normal"><a href="#line-47">  47</a></span>
<span class="normal"><a href="#line-48">  48</a></span>
<span class="normal"><a href="#line-49">  49</a></span>
<span class="normal"><a href="#line-50">  50</a></span>
<span class="normal"><a href="#line-51">  51</a></span>
<span class="normal"><a href="#line-52">  52</a></span>
<span class="normal"><a href="#line-53">  53</a></span>
<span class="normal"><a href="#line-54">  54</a></span>
<span class="normal"><a href="#line-55">  55</a></span>
<span class="normal"><a href="#line-56">  56</a></span>
<span class="normal"><a href="#line-57">  57</a></span>
<span class="normal"><a href="#line-58">  58</a></span>
<span class="normal"><a href="#line-59">  59</a></span>
<span class="normal"><a href="#line-60">  60</a></span>
<span class="normal"><a href="#line-61">  61</a></span>
<span class="normal"><a href="#line-62">  62</a></span>
<span class="normal"><a href="#line-63">  63</a></span>
<span class="normal"><a href="#line-64">  64</a></span>
<span class="normal"><a href="#line-65">  65</a></span>
<span class="normal"><a href="#line-66">  66</a></span>
<span class="normal"><a href="#line-67">  67</a></span>
<span class="normal"><a href="#line-68">  68</a></span>
<span class="normal"><a href="#line-69">  69</a></span>
<span class="normal"><a href="#line-70">  70</a></span>
<span class="normal"><a href="#line-71">  71</a></span>
<span class="normal"><a href="#line-72">  72</a></span>
<span class="normal"><a href="#line-73">  73</a></span>
<span class="normal"><a href="#line-74">  74</a></span>
<span class="normal"><a href="#line-75">  75</a></span>
<span class="normal"><a href="#line-76">  76</a></span>
<span class="normal"><a href="#line-77">  77</a></span>
<span class="normal"><a href="#line-78">  78</a></span>
<span class="normal"><a href="#line-79">  79</a></span>
<span class="normal"><a href="#line-80">  80</a></span>
<span class="normal"><a href="#line-81">  81</a></span>
<span class="normal"><a href="#line-82">  82</a></span>
<span class="normal"><a href="#line-83">  83</a></span>
<span class="normal"><a href="#line-84">  84</a></span>
<span class="normal"><a href="#line-85">  85</a></span>
<span class="normal"><a href="#line-86">  86</a></span>
<span class="normal"><a href="#line-87">  87</a></span>
<span class="normal"><a href="#line-88">  88</a></span>
<span class="normal"><a href="#line-89">  89</a></span>
<span class="normal"><a href="#line-90">  90</a></span>
<span class="normal"><a href="#line-91">  91</a></span>
<span class="normal"><a href="#line-92">  92</a></span>
<span class="normal"><a href="#line-93">  93</a></span>
<span class="normal"><a href="#line-94">  94</a></span>
<span class="normal"><a href="#line-95">  95</a></span>
<span class="normal"><a href="#line-96">  96</a></span>
<span class="normal"><a href="#line-97">  97</a></span>
<span class="normal"><a href="#line-98">  98</a></span>
<span class="normal"><a href="#line-99">  99</a></span>
<span class="normal"><a href="#line-100"> 100</a></span>
<span class="normal"><a href="#line-101"> 101</a></span>
<span class="normal"><a href="#line-102"> 102</a></span>
<span class="normal"><a href="#line-103"> 103</a></span>
<span class="normal"><a href="#line-104"> 104</a></span>
<span class="normal"><a href="#line-105"> 105</a></span>
<span class="normal"><a href="#line-106"> 106</a></span>
<span class="normal"><a href="#line-107"> 107</a></span>
<span class="normal"><a href="#line-108"> 108</a></span>
<span class="normal"><a href="#line-109"> 109</a></span>
<span class="normal"><a href="#line-110"> 110</a></span>
<span class="normal"><a href="#line-111"> 111</a></span>
<span class="normal"><a href="#line-112"> 112</a></span>
<span class="normal"><a href="#line-113"> 113</a></span>
<span class="normal"><a href="#line-114"> 114</a></span>
<span class="normal"><a href="#line-115"> 115</a></span>
<span class="normal"><a href="#line-116"> 116</a></span>
<span class="normal"><a href="#line-117"> 117</a></span>
<span class="normal"><a href="#line-118"> 118</a></span>
<span class="normal"><a href="#line-119"> 119</a></span>
<span class="normal"><a href="#line-120"> 120</a></span>
<span class="normal"><a href="#line-121"> 121</a></span>
<span class="normal"><a href="#line-122"> 122</a></span>
<span class="normal"><a href="#line-123"> 123</a></span>
<span class="normal"><a href="#line-124"> 124</a></span>
<span class="normal"><a href="#line-125"> 125</a></span>
<span class="normal"><a href="#line-126"> 126</a></span>
<span class="normal"><a href="#line-127"> 127</a></span>
<span class="normal"><a href="#line-128"> 128</a></span>
<span class="normal"><a href="#line-129"> 129</a></span>
<span class="normal"><a href="#line-130"> 130</a></span>
<span class="normal"><a href="#line-131"> 131</a></span>
<span class="normal"><a href="#line-132"> 132</a></span>
<span class="normal"><a href="#line-133"> 133</a></span>
<span class="normal"><a href="#line-134"> 134</a></span>
<span class="normal"><a href="#line-135"> 135</a></span>
<span class="normal"><a href="#line-136"> 136</a></span>
<span class="normal"><a href="#line-137"> 137</a></span>
<span class="normal"><a href="#line-138"> 138</a></span>
<span class="normal"><a href="#line-139"> 139</a></span>
<span class="normal"><a href="#line-140"> 140</a></span>
<span class="normal"><a href="#line-141"> 141</a></span>
<span class="normal"><a href="#line-142"> 142</a></span>
<span class="normal"><a href="#line-143"> 143</a></span>
<span class="normal"><a href="#line-144"> 144</a></span>
<span class="normal"><a href="#line-145"> 145</a></span>
<span class="normal"><a href="#line-146"> 146</a></span>
<span class="normal"><a href="#line-147"> 147</a></span>
<span class="normal"><a href="#line-148"> 148</a></span>
<span class="normal"><a href="#line-149"> 149</a></span>
<span class="normal"><a href="#line-150"> 150</a></span>
<span class="normal"><a href="#line-151"> 151</a></span>
<span class="normal"><a href="#line-152"> 152</a></span>
<span class="normal"><a href="#line-153"> 153</a></span>
<span class="normal"><a href="#line-154"> 154</a></span>
<span class="normal"><a href="#line-155"> 155</a></span>
<span class="normal"><a href="#line-156"> 156</a></span>
<span class="normal"><a href="#line-157"> 157</a></span>
<span class="normal"><a href="#line-158"> 158</a></span>
<span class="normal"><a href="#line-159"> 159</a></span>
<span class="normal"><a href="#line-160"> 160</a></span>
<span class="normal"><a href="#line-161"> 161</a></span>
<span class="normal"><a href="#line-162"> 162</a></span>
<span class="normal"><a href="#line-163"> 163</a></span>
<span class="normal"><a href="#line-164"> 164</a></span>
<span class="normal"><a href="#line-165"> 165</a></span>
<span class="normal"><a href="#line-166"> 166</a></span>
<span class="normal"><a href="#line-167"> 167</a></span>
<span class="normal"><a href="#line-168"> 168</a></span>
<span class="normal"><a href="#line-169"> 169</a></span>
<span class="normal"><a href="#line-170"> 170</a></span>
<span class="normal"><a href="#line-171"> 171</a></span>
<span class="normal"><a href="#line-172"> 172</a></span>
<span class="normal"><a href="#line-173"> 173</a></span>
<span class="normal"><a href="#line-174"> 174</a></span>
<span class="normal"><a href="#line-175"> 175</a></span>
<span class="normal"><a href="#line-176"> 176</a></span>
<span class="normal"><a href="#line-177"> 177</a></span>
<span class="normal"><a href="#line-178"> 178</a></span>
<span class="normal"><a href="#line-179"> 179</a></span>
<span class="normal"><a href="#line-180"> 180</a></span>
<span class="normal"><a href="#line-181"> 181</a></span>
<span class="normal"><a href="#line-182"> 182</a></span>
<span class="normal"><a href="#line-183"> 183</a></span>
<span class="normal"><a href="#line-184"> 184</a></span>
<span class="normal"><a href="#line-185"> 185</a></span>
<span class="normal"><a href="#line-186"> 186</a></span>
<span class="normal"><a href="#line-187"> 187</a></span>
<span class="normal"><a href="#line-188"> 188</a></span>
<span class="normal"><a href="#line-189"> 189</a></span>
<span class="normal"><a href="#line-190"> 190</a></span>
<span class="normal"><a href="#line-191"> 191</a></span>
<span class="normal"><a href="#line-192"> 192</a></span>
<span class="normal"><a href="#line-193"> 193</a></span>
<span class="normal"><a href="#line-194"> 194</a></span>
<span class="normal"><a href="#line-195"> 195</a></span>
<span class="normal"><a href="#line-196"> 196</a></span>
<span class="normal"><a href="#line-197"> 197</a></span>
<span class="normal"><a href="#line-198"> 198</a></span>
<span class="normal"><a href="#line-199"> 199</a></span>
<span class="normal"><a href="#line-200"> 200</a></span>
<span class="normal"><a href="#line-201"> 201</a></span>
<span class="normal"><a href="#line-202"> 202</a></span>
<span class="normal"><a href="#line-203"> 203</a></span>
<span class="normal"><a href="#line-204"> 204</a></span>
<span class="normal"><a href="#line-205"> 205</a></span>
<span class="normal"><a href="#line-206"> 206</a></span>
<span class="normal"><a href="#line-207"> 207</a></span>
<span class="normal"><a href="#line-208"> 208</a></span>
<span class="normal"><a href="#line-209"> 209</a></span>
<span class="normal"><a href="#line-210"> 210</a></span>
<span class="normal"><a href="#line-211"> 211</a></span>
<span class="normal"><a href="#line-212"> 212</a></span>
<span class="normal"><a href="#line-213"> 213</a></span>
<span class="normal"><a href="#line-214"> 214</a></span>
<span class="normal"><a href="#line-215"> 215</a></span>
<span class="normal"><a href="#line-216"> 216</a></span>
<span class="normal"><a href="#line-217"> 217</a></span>
<span class="normal"><a href="#line-218"> 218</a></span>
<span class="normal"><a href="#line-219"> 219</a></span>
<span class="normal"><a href="#line-220"> 220</a></span>
<span class="normal"><a href="#line-221"> 221</a></span>
<span class="normal"><a href="#line-222"> 222</a></span>
<span class="normal"><a href="#line-223"> 223</a></span>
<span class="normal"><a href="#line-224"> 224</a></span>
<span class="normal"><a href="#line-225"> 225</a></span>
<span class="normal"><a href="#line-226"> 226</a></span>
<span class="normal"><a href="#line-227"> 227</a></span>
<span class="normal"><a href="#line-228"> 228</a></span>
<span class="normal"><a href="#line-229"> 229</a></span>
<span class="normal"><a href="#line-230"> 230</a></span>
<span class="normal"><a href="#line-231"> 231</a></span>
<span class="normal"><a href="#line-232"> 232</a></span>
<span class="normal"><a href="#line-233"> 233</a></span>
<span class="normal"><a href="#line-234"> 234</a></span>
<span class="normal"><a href="#line-235"> 235</a></span>
<span class="normal"><a href="#line-236"> 236</a></span>
<span class="normal"><a href="#line-237"> 237</a></span>
<span class="normal"><a href="#line-238"> 238</a></span>
<span class="normal"><a href="#line-239"> 239</a></span>
<span class="normal"><a href="#line-240"> 240</a></span>
<span class="normal"><a href="#line-241"> 241</a></span>
<span class="normal"><a href="#line-242"> 242</a></span>
<span class="normal"><a href="#line-243"> 243</a></span>
<span class="normal"><a href="#line-244"> 244</a></span>
<span class="normal"><a href="#line-245"> 245</a></span>
<span class="normal"><a href="#line-246"> 246</a></span>
<span class="normal"><a href="#line-247"> 247</a></span>
<span class="normal"><a href="#line-248"> 248</a></span>
<span class="normal"><a href="#line-249"> 249</a></span>
<span class="normal"><a href="#line-250"> 250</a></span>
<span class="normal"><a href="#line-251"> 251</a></span>
<span class="normal"><a href="#line-252"> 252</a></span>
<span class="normal"><a href="#line-253"> 253</a></span>
<span class="normal"><a href="#line-254"> 254</a></span>
<span class="normal"><a href="#line-255"> 255</a></span>
<span class="normal"><a href="#line-256"> 256</a></span>
<span class="normal"><a href="#line-257"> 257</a></span>
<span class="normal"><a href="#line-258"> 258</a></span>
<span class="normal"><a href="#line-259"> 259</a></span>
<span class="normal"><a href="#line-260"> 260</a></span>
<span class="normal"><a href="#line-261"> 261</a></span>
<span class="normal"><a href="#line-262"> 262</a></span>
<span class="normal"><a href="#line-263"> 263</a></span>
<span class="normal"><a href="#line-264"> 264</a></span>
<span class="normal"><a href="#line-265"> 265</a></span>
<span class="normal"><a href="#line-266"> 266</a></span>
<span class="normal"><a href="#line-267"> 267</a></span>
<span class="normal"><a href="#line-268"> 268</a></span>
<span class="normal"><a href="#line-269"> 269</a></span>
<span class="normal"><a href="#line-270"> 270</a></span>
<span class="normal"><a href="#line-271"> 271</a></span>
<span class="normal"><a href="#line-272"> 272</a></span>
<span class="normal"><a href="#line-273"> 273</a></span>
<span class="normal"><a href="#line-274"> 274</a></span>
<span class="normal"><a href="#line-275"> 275</a></span>
<span class="normal"><a href="#line-276"> 276</a></span>
<span class="normal"><a href="#line-277"> 277</a></span>
<span class="normal"><a href="#line-278"> 278</a></span>
<span class="normal"><a href="#line-279"> 279</a></span>
<span class="normal"><a href="#line-280"> 280</a></span>
<span class="normal"><a href="#line-281"> 281</a></span>
<span class="normal"><a href="#line-282"> 282</a></span>
<span class="normal"><a href="#line-283"> 283</a></span>
<span class="normal"><a href="#line-284"> 284</a></span>
<span class="normal"><a href="#line-285"> 285</a></span>
<span class="normal"><a href="#line-286"> 286</a></span>
<span class="normal"><a href="#line-287"> 287</a></span>
<span class="normal"><a href="#line-288"> 288</a></span>
<span class="normal"><a href="#line-289"> 289</a></span>
<span class="normal"><a href="#line-290"> 290</a></span>
<span class="normal"><a href="#line-291"> 291</a></span>
<span class="normal"><a href="#line-292"> 292</a></span>
<span class="normal"><a href="#line-293"> 293</a></span>
<span class="normal"><a href="#line-294"> 294</a></span>
<span class="normal"><a href="#line-295"> 295</a></span>
<span class="normal"><a href="#line-296"> 296</a></span>
<span class="normal"><a href="#line-297"> 297</a></span>
<span class="normal"><a href="#line-298"> 298</a></span>
<span class="normal"><a href="#line-299"> 299</a></span>
<span class="normal"><a href="#line-300"> 300</a></span>
<span class="normal"><a href="#line-301"> 301</a></span>
<span class="normal"><a href="#line-302"> 302</a></span>
<span class="normal"><a href="#line-303"> 303</a></span>
<span class="normal"><a href="#line-304"> 304</a></span>
<span class="normal"><a href="#line-305"> 305</a></span>
<span class="normal"><a href="#line-306"> 306</a></span>
<span class="normal"><a href="#line-307"> 307</a></span>
<span class="normal"><a href="#line-308"> 308</a></span>
<span class="normal"><a href="#line-309"> 309</a></span>
<span class="normal"><a href="#line-310"> 310</a></span>
<span class="normal"><a href="#line-311"> 311</a></span>
<span class="normal"><a href="#line-312"> 312</a></span>
<span class="normal"><a href="#line-313"> 313</a></span>
<span class="normal"><a href="#line-314"> 314</a></span>
<span class="normal"><a href="#line-315"> 315</a></span>
<span class="normal"><a href="#line-316"> 316</a></span>
<span class="normal"><a href="#line-317"> 317</a></span>
<span class="normal"><a href="#line-318"> 318</a></span>
<span class="normal"><a href="#line-319"> 319</a></span>
<span class="normal"><a href="#line-320"> 320</a></span>
<span class="normal"><a href="#line-321"> 321</a></span>
<span class="normal"><a href="#line-322"> 322</a></span>
<span class="normal"><a href="#line-323"> 323</a></span>
<span class="normal"><a href="#line-324"> 324</a></span>
<span class="normal"><a href="#line-325"> 325</a></span>
<span class="normal"><a href="#line-326"> 326</a></span>
<span class="normal"><a href="#line-327"> 327</a></span>
<span class="normal"><a href="#line-328"> 328</a></span>
<span class="normal"><a href="#line-329"> 329</a></span>
<span class="normal"><a href="#line-330"> 330</a></span>
<span class="normal"><a href="#line-331"> 331</a></span>
<span class="normal"><a href="#line-332"> 332</a></span>
<span class="normal"><a href="#line-333"> 333</a></span>
<span class="normal"><a href="#line-334"> 334</a></span>
<span class="normal"><a href="#line-335"> 335</a></span>
<span class="normal"><a href="#line-336"> 336</a></span>
<span class="normal"><a href="#line-337"> 337</a></span>
<span class="normal"><a href="#line-338"> 338</a></span>
<span class="normal"><a href="#line-339"> 339</a></span>
<span class="normal"><a href="#line-340"> 340</a></span>
<span class="normal"><a href="#line-341"> 341</a></span>
<span class="normal"><a href="#line-342"> 342</a></span>
<span class="normal"><a href="#line-343"> 343</a></span>
<span class="normal"><a href="#line-344"> 344</a></span>
<span class="normal"><a href="#line-345"> 345</a></span>
<span class="normal"><a href="#line-346"> 346</a></span>
<span class="normal"><a href="#line-347"> 347</a></span>
<span class="normal"><a href="#line-348"> 348</a></span>
<span class="normal"><a href="#line-349"> 349</a></span>
<span class="normal"><a href="#line-350"> 350</a></span>
<span class="normal"><a href="#line-351"> 351</a></span>
<span class="normal"><a href="#line-352"> 352</a></span>
<span class="normal"><a href="#line-353"> 353</a></span>
<span class="normal"><a href="#line-354"> 354</a></span>
<span class="normal"><a href="#line-355"> 355</a></span>
<span class="normal"><a href="#line-356"> 356</a></span>
<span class="normal"><a href="#line-357"> 357</a></span>
<span class="normal"><a href="#line-358"> 358</a></span>
<span class="normal"><a href="#line-359"> 359</a></span>
<span class="normal"><a href="#line-360"> 360</a></span>
<span class="normal"><a href="#line-361"> 361</a></span>
<span class="normal"><a href="#line-362"> 362</a></span>
<span class="normal"><a href="#line-363"> 363</a></span>
<span class="normal"><a href="#line-364"> 364</a></span>
<span class="normal"><a href="#line-365"> 365</a></span>
<span class="normal"><a href="#line-366"> 366</a></span>
<span class="normal"><a href="#line-367"> 367</a></span>
<span class="normal"><a href="#line-368"> 368</a></span>
<span class="normal"><a href="#line-369"> 369</a></span>
<span class="normal"><a href="#line-370"> 370</a></span>
<span class="normal"><a href="#line-371"> 371</a></span>
<span class="normal"><a href="#line-372"> 372</a></span>
<span class="normal"><a href="#line-373"> 373</a></span>
<span class="normal"><a href="#line-374"> 374</a></span>
<span class="normal"><a href="#line-375"> 375</a></span>
<span class="normal"><a href="#line-376"> 376</a></span>
<span class="normal"><a href="#line-377"> 377</a></span>
<span class="normal"><a href="#line-378"> 378</a></span>
<span class="normal"><a href="#line-379"> 379</a></span>
<span class="normal"><a href="#line-380"> 380</a></span>
<span class="normal"><a href="#line-381"> 381</a></span>
<span class="normal"><a href="#line-382"> 382</a></span>
<span class="normal"><a href="#line-383"> 383</a></span>
<span class="normal"><a href="#line-384"> 384</a></span>
<span class="normal"><a href="#line-385"> 385</a></span>
<span class="normal"><a href="#line-386"> 386</a></span>
<span class="normal"><a href="#line-387"> 387</a></span>
<span class="normal"><a href="#line-388"> 388</a></span>
<span class="normal"><a href="#line-389"> 389</a></span>
<span class="normal"><a href="#line-390"> 390</a></span>
<span class="normal"><a href="#line-391"> 391</a></span>
<span class="normal"><a href="#line-392"> 392</a></span>
<span class="normal"><a href="#line-393"> 393</a></span>
<span class="normal"><a href="#line-394"> 394</a></span>
<span class="normal"><a href="#line-395"> 395</a></span>
<span class="normal"><a href="#line-396"> 396</a></span>
<span class="normal"><a href="#line-397"> 397</a></span>
<span class="normal"><a href="#line-398"> 398</a></span>
<span class="normal"><a href="#line-399"> 399</a></span>
<span class="normal"><a href="#line-400"> 400</a></span>
<span class="normal"><a href="#line-401"> 401</a></span>
<span class="normal"><a href="#line-402"> 402</a></span>
<span class="normal"><a href="#line-403"> 403</a></span>
<span class="normal"><a href="#line-404"> 404</a></span>
<span class="normal"><a href="#line-405"> 405</a></span>
<span class="normal"><a href="#line-406"> 406</a></span>
<span class="normal"><a href="#line-407"> 407</a></span>
<span class="normal"><a href="#line-408"> 408</a></span>
<span class="normal"><a href="#line-409"> 409</a></span>
<span class="normal"><a href="#line-410"> 410</a></span>
<span class="normal"><a href="#line-411"> 411</a></span>
<span class="normal"><a href="#line-412"> 412</a></span>
<span class="normal"><a href="#line-413"> 413</a></span>
<span class="normal"><a href="#line-414"> 414</a></span>
<span class="normal"><a href="#line-415"> 415</a></span>
<span class="normal"><a href="#line-416"> 416</a></span>
<span class="normal"><a href="#line-417"> 417</a></span>
<span class="normal"><a href="#line-418"> 418</a></span>
<span class="normal"><a href="#line-419"> 419</a></span>
<span class="normal"><a href="#line-420"> 420</a></span>
<span class="normal"><a href="#line-421"> 421</a></span>
<span class="normal"><a href="#line-422"> 422</a></span>
<span class="normal"><a href="#line-423"> 423</a></span>
<span class="normal"><a href="#line-424"> 424</a></span>
<span class="normal"><a href="#line-425"> 425</a></span>
<span class="normal"><a href="#line-426"> 426</a></span>
<span class="normal"><a href="#line-427"> 427</a></span>
<span class="normal"><a href="#line-428"> 428</a></span>
<span class="normal"><a href="#line-429"> 429</a></span>
<span class="normal"><a href="#line-430"> 430</a></span>
<span class="normal"><a href="#line-431"> 431</a></span>
<span class="normal"><a href="#line-432"> 432</a></span>
<span class="normal"><a href="#line-433"> 433</a></span>
<span class="normal"><a href="#line-434"> 434</a></span>
<span class="normal"><a href="#line-435"> 435</a></span>
<span class="normal"><a href="#line-436"> 436</a></span>
<span class="normal"><a href="#line-437"> 437</a></span>
<span class="normal"><a href="#line-438"> 438</a></span>
<span class="normal"><a href="#line-439"> 439</a></span>
<span class="normal"><a href="#line-440"> 440</a></span>
<span class="normal"><a href="#line-441"> 441</a></span>
<span class="normal"><a href="#line-442"> 442</a></span>
<span class="normal"><a href="#line-443"> 443</a></span>
<span class="normal"><a href="#line-444"> 444</a></span>
<span class="normal"><a href="#line-445"> 445</a></span>
<span class="normal"><a href="#line-446"> 446</a></span>
<span class="normal"><a href="#line-447"> 447</a></span>
<span class="normal"><a href="#line-448"> 448</a></span>
<span class="normal"><a href="#line-449"> 449</a></span>
<span class="normal"><a href="#line-450"> 450</a></span>
<span class="normal"><a href="#line-451"> 451</a></span>
<span class="normal"><a href="#line-452"> 452</a></span>
<span class="normal"><a href="#line-453"> 453</a></span>
<span class="normal"><a href="#line-454"> 454</a></span>
<span class="normal"><a href="#line-455"> 455</a></span>
<span class="normal"><a href="#line-456"> 456</a></span>
<span class="normal"><a href="#line-457"> 457</a></span>
<span class="normal"><a href="#line-458"> 458</a></span>
<span class="normal"><a href="#line-459"> 459</a></span>
<span class="normal"><a href="#line-460"> 460</a></span>
<span class="normal"><a href="#line-461"> 461</a></span>
<span class="normal"><a href="#line-462"> 462</a></span>
<span class="normal"><a href="#line-463"> 463</a></span>
<span class="normal"><a href="#line-464"> 464</a></span>
<span class="normal"><a href="#line-465"> 465</a></span>
<span class="normal"><a href="#line-466"> 466</a></span>
<span class="normal"><a href="#line-467"> 467</a></span>
<span class="normal"><a href="#line-468"> 468</a></span>
<span class="normal"><a href="#line-469"> 469</a></span>
<span class="normal"><a href="#line-470"> 470</a></span>
<span class="normal"><a href="#line-471"> 471</a></span>
<span class="normal"><a href="#line-472"> 472</a></span>
<span class="normal"><a href="#line-473"> 473</a></span>
<span class="normal"><a href="#line-474"> 474</a></span>
<span class="normal"><a href="#line-475"> 475</a></span>
<span class="normal"><a href="#line-476"> 476</a></span>
<span class="normal"><a href="#line-477"> 477</a></span>
<span class="normal"><a href="#line-478"> 478</a></span>
<span class="normal"><a href="#line-479"> 479</a></span>
<span class="normal"><a href="#line-480"> 480</a></span>
<span class="normal"><a href="#line-481"> 481</a></span>
<span class="normal"><a href="#line-482"> 482</a></span>
<span class="normal"><a href="#line-483"> 483</a></span>
<span class="normal"><a href="#line-484"> 484</a></span>
<span class="normal"><a href="#line-485"> 485</a></span>
<span class="normal"><a href="#line-486"> 486</a></span>
<span class="normal"><a href="#line-487"> 487</a></span>
<span class="normal"><a href="#line-488"> 488</a></span>
<span class="normal"><a href="#line-489"> 489</a></span>
<span class="normal"><a href="#line-490"> 490</a></span>
<span class="normal"><a href="#line-491"> 491</a></span>
<span class="normal"><a href="#line-492"> 492</a></span>
<span class="normal"><a href="#line-493"> 493</a></span>
<span class="normal"><a href="#line-494"> 494</a></span>
<span class="normal"><a href="#line-495"> 495</a></span>
<span class="normal"><a href="#line-496"> 496</a></span>
<span class="normal"><a href="#line-497"> 497</a></span>
<span class="normal"><a href="#line-498"> 498</a></span>
<span class="normal"><a href="#line-499"> 499</a></span>
<span class="normal"><a href="#line-500"> 500</a></span>
<span class="normal"><a href="#line-501"> 501</a></span>
<span class="normal"><a href="#line-502"> 502</a></span>
<span class="normal"><a href="#line-503"> 503</a></span>
<span class="normal"><a href="#line-504"> 504</a></span>
<span class="normal"><a href="#line-505"> 505</a></span>
<span class="normal"><a href="#line-506"> 506</a></span>
<span class="normal"><a href="#line-507"> 507</a></span>
<span class="normal"><a href="#line-508"> 508</a></span>
<span class="normal"><a href="#line-509"> 509</a></span>
<span class="normal"><a href="#line-510"> 510</a></span>
<span class="normal"><a href="#line-511"> 511</a></span>
<span class="normal"><a href="#line-512"> 512</a></span>
<span class="normal"><a href="#line-513"> 513</a></span>
<span class="normal"><a href="#line-514"> 514</a></span>
<span class="normal"><a href="#line-515"> 515</a></span>
<span class="normal"><a href="#line-516"> 516</a></span>
<span class="normal"><a href="#line-517"> 517</a></span>
<span class="normal"><a href="#line-518"> 518</a></span>
<span class="normal"><a href="#line-519"> 519</a></span>
<span class="normal"><a href="#line-520"> 520</a></span>
<span class="normal"><a href="#line-521"> 521</a></span>
<span class="normal"><a href="#line-522"> 522</a></span>
<span class="normal"><a href="#line-523"> 523</a></span>
<span class="normal"><a href="#line-524"> 524</a></span>
<span class="normal"><a href="#line-525"> 525</a></span>
<span class="normal"><a href="#line-526"> 526</a></span>
<span class="normal"><a href="#line-527"> 527</a></span>
<span class="normal"><a href="#line-528"> 528</a></span>
<span class="normal"><a href="#line-529"> 529</a></span>
<span class="normal"><a href="#line-530"> 530</a></span>
<span class="normal"><a href="#line-531"> 531</a></span>
<span class="normal"><a href="#line-532"> 532</a></span>
<span class="normal"><a href="#line-533"> 533</a></span>
<span class="normal"><a href="#line-534"> 534</a></span>
<span class="normal"><a href="#line-535"> 535</a></span>
<span class="normal"><a href="#line-536"> 536</a></span>
<span class="normal"><a href="#line-537"> 537</a></span>
<span class="normal"><a href="#line-538"> 538</a></span>
<span class="normal"><a href="#line-539"> 539</a></span>
<span class="normal"><a href="#line-540"> 540</a></span>
<span class="normal"><a href="#line-541"> 541</a></span>
<span class="normal"><a href="#line-542"> 542</a></span>
<span class="normal"><a href="#line-543"> 543</a></span>
<span class="normal"><a href="#line-544"> 544</a></span>
<span class="normal"><a href="#line-545"> 545</a></span>
<span class="normal"><a href="#line-546"> 546</a></span>
<span class="normal"><a href="#line-547"> 547</a></span>
<span class="normal"><a href="#line-548"> 548</a></span>
<span class="normal"><a href="#line-549"> 549</a></span>
<span class="normal"><a href="#line-550"> 550</a></span>
<span class="normal"><a href="#line-551"> 551</a></span>
<span class="normal"><a href="#line-552"> 552</a></span>
<span class="normal"><a href="#line-553"> 553</a></span>
<span class="normal"><a href="#line-554"> 554</a></span>
<span class="normal"><a href="#line-555"> 555</a></span>
<span class="normal"><a href="#line-556"> 556</a></span>
<span class="normal"><a href="#line-557"> 557</a></span>
<span class="normal"><a href="#line-558"> 558</a></span>
<span class="normal"><a href="#line-559"> 559</a></span>
<span class="normal"><a href="#line-560"> 560</a></span>
<span class="normal"><a href="#line-561"> 561</a></span>
<span class="normal"><a href="#line-562"> 562</a></span>
<span class="normal"><a href="#line-563"> 563</a></span>
<span class="normal"><a href="#line-564"> 564</a></span>
<span class="normal"><a href="#line-565"> 565</a></span>
<span class="normal"><a href="#line-566"> 566</a></span>
<span class="normal"><a href="#line-567"> 567</a></span>
<span class="normal"><a href="#line-568"> 568</a></span>
<span class="normal"><a href="#line-569"> 569</a></span>
<span class="normal"><a href="#line-570"> 570</a></span>
<span class="normal"><a href="#line-571"> 571</a></span>
<span class="normal"><a href="#line-572"> 572</a></span>
<span class="normal"><a href="#line-573"> 573</a></span>
<span class="normal"><a href="#line-574"> 574</a></span>
<span class="normal"><a href="#line-575"> 575</a></span>
<span class="normal"><a href="#line-576"> 576</a></span>
<span class="normal"><a href="#line-577"> 577</a></span>
<span class="normal"><a href="#line-578"> 578</a></span>
<span class="normal"><a href="#line-579"> 579</a></span>
<span class="normal"><a href="#line-580"> 580</a></span>
<span class="normal"><a href="#line-581"> 581</a></span>
<span class="normal"><a href="#line-582"> 582</a></span>
<span class="normal"><a href="#line-583"> 583</a></span>
<span class="normal"><a href="#line-584"> 584</a></span>
<span class="normal"><a href="#line-585"> 585</a></span>
<span class="normal"><a href="#line-586"> 586</a></span>
<span class="normal"><a href="#line-587"> 587</a></span>
<span class="normal"><a href="#line-588"> 588</a></span>
<span class="normal"><a href="#line-589"> 589</a></span>
<span class="normal"><a href="#line-590"> 590</a></span>
<span class="normal"><a href="#line-591"> 591</a></span>
<span class="normal"><a href="#line-592"> 592</a></span>
<span class="normal"><a href="#line-593"> 593</a></span>
<span class="normal"><a href="#line-594"> 594</a></span>
<span class="normal"><a href="#line-595"> 595</a></span>
<span class="normal"><a href="#line-596"> 596</a></span>
<span class="normal"><a href="#line-597"> 597</a></span>
<span class="normal"><a href="#line-598"> 598</a></span>
<span class="normal"><a href="#line-599"> 599</a></span>
<span class="normal"><a href="#line-600"> 600</a></span>
<span class="normal"><a href="#line-601"> 601</a></span>
<span class="normal"><a href="#line-602"> 602</a></span>
<span class="normal"><a href="#line-603"> 603</a></span>
<span class="normal"><a href="#line-604"> 604</a></span>
<span class="normal"><a href="#line-605"> 605</a></span>
<span class="normal"><a href="#line-606"> 606</a></span>
<span class="normal"><a href="#line-607"> 607</a></span>
<span class="normal"><a href="#line-608"> 608</a></span>
<span class="normal"><a href="#line-609"> 609</a></span>
<span class="normal"><a href="#line-610"> 610</a></span>
<span class="normal"><a href="#line-611"> 611</a></span>
<span class="normal"><a href="#line-612"> 612</a></span>
<span class="normal"><a href="#line-613"> 613</a></span>
<span class="normal"><a href="#line-614"> 614</a></span>
<span class="normal"><a href="#line-615"> 615</a></span>
<span class="normal"><a href="#line-616"> 616</a></span>
<span class="normal"><a href="#line-617"> 617</a></span>
<span class="normal"><a href="#line-618"> 618</a></span>
<span class="normal"><a href="#line-619"> 619</a></span>
<span class="normal"><a href="#line-620"> 620</a></span>
<span class="normal"><a href="#line-621"> 621</a></span>
<span class="normal"><a href="#line-622"> 622</a></span>
<span class="normal"><a href="#line-623"> 623</a></span>
<span class="normal"><a href="#line-624"> 624</a></span>
<span class="normal"><a href="#line-625"> 625</a></span>
<span class="normal"><a href="#line-626"> 626</a></span>
<span class="normal"><a href="#line-627"> 627</a></span>
<span class="normal"><a href="#line-628"> 628</a></span>
<span class="normal"><a href="#line-629"> 629</a></span>
<span class="normal"><a href="#line-630"> 630</a></span>
<span class="normal"><a href="#line-631"> 631</a></span>
<span class="normal"><a href="#line-632"> 632</a></span>
<span class="normal"><a href="#line-633"> 633</a></span>
<span class="normal"><a href="#line-634"> 634</a></span>
<span class="normal"><a href="#line-635"> 635</a></span>
<span class="normal"><a href="#line-636"> 636</a></span>
<span class="normal"><a href="#line-637"> 637</a></span>
<span class="normal"><a href="#line-638"> 638</a></span>
<span class="normal"><a href="#line-639"> 639</a></span>
<span class="normal"><a href="#line-640"> 640</a></span>
<span class="normal"><a href="#line-641"> 641</a></span>
<span class="normal"><a href="#line-642"> 642</a></span>
<span class="normal"><a href="#line-643"> 643</a></span>
<span class="normal"><a href="#line-644"> 644</a></span>
<span class="normal"><a href="#line-645"> 645</a></span>
<span class="normal"><a href="#line-646"> 646</a></span>
<span class="normal"><a href="#line-647"> 647</a></span>
<span class="normal"><a href="#line-648"> 648</a></span>
<span class="normal"><a href="#line-649"> 649</a></span>
<span class="normal"><a href="#line-650"> 650</a></span>
<span class="normal"><a href="#line-651"> 651</a></span>
<span class="normal"><a href="#line-652"> 652</a></span>
<span class="normal"><a href="#line-653"> 653</a></span>
<span class="normal"><a href="#line-654"> 654</a></span>
<span class="normal"><a href="#line-655"> 655</a></span>
<span class="normal"><a href="#line-656"> 656</a></span>
<span class="normal"><a href="#line-657"> 657</a></span>
<span class="normal"><a href="#line-658"> 658</a></span>
<span class="normal"><a href="#line-659"> 659</a></span>
<span class="normal"><a href="#line-660"> 660</a></span>
<span class="normal"><a href="#line-661"> 661</a></span>
<span class="normal"><a href="#line-662"> 662</a></span>
<span class="normal"><a href="#line-663"> 663</a></span>
<span class="normal"><a href="#line-664"> 664</a></span>
<span class="normal"><a href="#line-665"> 665</a></span>
<span class="normal"><a href="#line-666"> 666</a></span>
<span class="normal"><a href="#line-667"> 667</a></span>
<span class="normal"><a href="#line-668"> 668</a></span>
<span class="normal"><a href="#line-669"> 669</a></span>
<span class="normal"><a href="#line-670"> 670</a></span>
<span class="normal"><a href="#line-671"> 671</a></span>
<span class="normal"><a href="#line-672"> 672</a></span>
<span class="normal"><a href="#line-673"> 673</a></span>
<span class="normal"><a href="#line-674"> 674</a></span>
<span class="normal"><a href="#line-675"> 675</a></span>
<span class="normal"><a href="#line-676"> 676</a></span>
<span class="normal"><a href="#line-677"> 677</a></span>
<span class="normal"><a href="#line-678"> 678</a></span>
<span class="normal"><a href="#line-679"> 679</a></span>
<span class="normal"><a href="#line-680"> 680</a></span>
<span class="normal"><a href="#line-681"> 681</a></span>
<span class="normal"><a href="#line-682"> 682</a></span>
<span class="normal"><a href="#line-683"> 683</a></span>
<span class="normal"><a href="#line-684"> 684</a></span>
<span class="normal"><a href="#line-685"> 685</a></span>
<span class="normal"><a href="#line-686"> 686</a></span>
<span class="normal"><a href="#line-687"> 687</a></span>
<span class="normal"><a href="#line-688"> 688</a></span>
<span class="normal"><a href="#line-689"> 689</a></span>
<span class="normal"><a href="#line-690"> 690</a></span>
<span class="normal"><a href="#line-691"> 691</a></span>
<span class="normal"><a href="#line-692"> 692</a></span>
<span class="normal"><a href="#line-693"> 693</a></span>
<span class="normal"><a href="#line-694"> 694</a></span>
<span class="normal"><a href="#line-695"> 695</a></span>
<span class="normal"><a href="#line-696"> 696</a></span>
<span class="normal"><a href="#line-697"> 697</a></span>
<span class="normal"><a href="#line-698"> 698</a></span>
<span class="normal"><a href="#line-699"> 699</a></span>
<span class="normal"><a href="#line-700"> 700</a></span>
<span class="normal"><a href="#line-701"> 701</a></span>
<span class="normal"><a href="#line-702"> 702</a></span>
<span class="normal"><a href="#line-703"> 703</a></span>
<span class="normal"><a href="#line-704"> 704</a></span>
<span class="normal"><a href="#line-705"> 705</a></span>
<span class="normal"><a href="#line-706"> 706</a></span>
<span class="normal"><a href="#line-707"> 707</a></span>
<span class="normal"><a href="#line-708"> 708</a></span>
<span class="normal"><a href="#line-709"> 709</a></span>
<span class="normal"><a href="#line-710"> 710</a></span>
<span class="normal"><a href="#line-711"> 711</a></span>
<span class="normal"><a href="#line-712"> 712</a></span>
<span class="normal"><a href="#line-713"> 713</a></span>
<span class="normal"><a href="#line-714"> 714</a></span>
<span class="normal"><a href="#line-715"> 715</a></span>
<span class="normal"><a href="#line-716"> 716</a></span>
<span class="normal"><a href="#line-717"> 717</a></span>
<span class="normal"><a href="#line-718"> 718</a></span>
<span class="normal"><a href="#line-719"> 719</a></span>
<span class="normal"><a href="#line-720"> 720</a></span>
<span class="normal"><a href="#line-721"> 721</a></span>
<span class="normal"><a href="#line-722"> 722</a></span>
<span class="normal"><a href="#line-723"> 723</a></span>
<span class="normal"><a href="#line-724"> 724</a></span>
<span class="normal"><a href="#line-725"> 725</a></span>
<span class="normal"><a href="#line-726"> 726</a></span>
<span class="normal"><a href="#line-727"> 727</a></span>
<span class="normal"><a href="#line-728"> 728</a></span>
<span class="normal"><a href="#line-729"> 729</a></span>
<span class="normal"><a href="#line-730"> 730</a></span>
<span class="normal"><a href="#line-731"> 731</a></span>
<span class="normal"><a href="#line-732"> 732</a></span>
<span class="normal"><a href="#line-733"> 733</a></span>
<span class="normal"><a href="#line-734"> 734</a></span>
<span class="normal"><a href="#line-735"> 735</a></span>
<span class="normal"><a href="#line-736"> 736</a></span>
<span class="normal"><a href="#line-737"> 737</a></span>
<span class="normal"><a href="#line-738"> 738</a></span>
<span class="normal"><a href="#line-739"> 739</a></span>
<span class="normal"><a href="#line-740"> 740</a></span>
<span class="normal"><a href="#line-741"> 741</a></span>
<span class="normal"><a href="#line-742"> 742</a></span>
<span class="normal"><a href="#line-743"> 743</a></span>
<span class="normal"><a href="#line-744"> 744</a></span>
<span class="normal"><a href="#line-745"> 745</a></span>
<span class="normal"><a href="#line-746"> 746</a></span>
<span class="normal"><a href="#line-747"> 747</a></span>
<span class="normal"><a href="#line-748"> 748</a></span>
<span class="normal"><a href="#line-749"> 749</a></span>
<span class="normal"><a href="#line-750"> 750</a></span>
<span class="normal"><a href="#line-751"> 751</a></span>
<span class="normal"><a href="#line-752"> 752</a></span>
<span class="normal"><a href="#line-753"> 753</a></span>
<span class="normal"><a href="#line-754"> 754</a></span>
<span class="normal"><a href="#line-755"> 755</a></span>
<span class="normal"><a href="#line-756"> 756</a></span>
<span class="normal"><a href="#line-757"> 757</a></span>
<span class="normal"><a href="#line-758"> 758</a></span>
<span class="normal"><a href="#line-759"> 759</a></span>
<span class="normal"><a href="#line-760"> 760</a></span>
<span class="normal"><a href="#line-761"> 761</a></span>
<span class="normal"><a href="#line-762"> 762</a></span>
<span class="normal"><a href="#line-763"> 763</a></span>
<span class="normal"><a href="#line-764"> 764</a></span>
<span class="normal"><a href="#line-765"> 765</a></span>
<span class="normal"><a href="#line-766"> 766</a></span>
<span class="normal"><a href="#line-767"> 767</a></span>
<span class="normal"><a href="#line-768"> 768</a></span>
<span class="normal"><a href="#line-769"> 769</a></span>
<span class="normal"><a href="#line-770"> 770</a></span>
<span class="normal"><a href="#line-771"> 771</a></span>
<span class="normal"><a href="#line-772"> 772</a></span>
<span class="normal"><a href="#line-773"> 773</a></span>
<span class="normal"><a href="#line-774"> 774</a></span>
<span class="normal"><a href="#line-775"> 775</a></span>
<span class="normal"><a href="#line-776"> 776</a></span>
<span class="normal"><a href="#line-777"> 777</a></span>
<span class="normal"><a href="#line-778"> 778</a></span>
<span class="normal"><a href="#line-779"> 779</a></span>
<span class="normal"><a href="#line-780"> 780</a></span>
<span class="normal"><a href="#line-781"> 781</a></span>
<span class="normal"><a href="#line-782"> 782</a></span>
<span class="normal"><a href="#line-783"> 783</a></span>
<span class="normal"><a href="#line-784"> 784</a></span>
<span class="normal"><a href="#line-785"> 785</a></span>
<span class="normal"><a href="#line-786"> 786</a></span>
<span class="normal"><a href="#line-787"> 787</a></span>
<span class="normal"><a href="#line-788"> 788</a></span>
<span class="normal"><a href="#line-789"> 789</a></span>
<span class="normal"><a href="#line-790"> 790</a></span>
<span class="normal"><a href="#line-791"> 791</a></span>
<span class="normal"><a href="#line-792"> 792</a></span>
<span class="normal"><a href="#line-793"> 793</a></span>
<span class="normal"><a href="#line-794"> 794</a></span>
<span class="normal"><a href="#line-795"> 795</a></span>
<span class="normal"><a href="#line-796"> 796</a></span>
<span class="normal"><a href="#line-797"> 797</a></span>
<span class="normal"><a href="#line-798"> 798</a></span>
<span class="normal"><a href="#line-799"> 799</a></span>
<span class="normal"><a href="#line-800"> 800</a></span>
<span class="normal"><a href="#line-801"> 801</a></span>
<span class="normal"><a href="#line-802"> 802</a></span>
<span class="normal"><a href="#line-803"> 803</a></span>
<span class="normal"><a href="#line-804"> 804</a></span>
<span class="normal"><a href="#line-805"> 805</a></span>
<span class="normal"><a href="#line-806"> 806</a></span>
<span class="normal"><a href="#line-807"> 807</a></span>
<span class="normal"><a href="#line-808"> 808</a></span>
<span class="normal"><a href="#line-809"> 809</a></span>
<span class="normal"><a href="#line-810"> 810</a></span>
<span class="normal"><a href="#line-811"> 811</a></span>
<span class="normal"><a href="#line-812"> 812</a></span>
<span class="normal"><a href="#line-813"> 813</a></span>
<span class="normal"><a href="#line-814"> 814</a></span>
<span class="normal"><a href="#line-815"> 815</a></span>
<span class="normal"><a href="#line-816"> 816</a></span>
<span class="normal"><a href="#line-817"> 817</a></span>
<span class="normal"><a href="#line-818"> 818</a></span>
<span class="normal"><a href="#line-819"> 819</a></span>
<span class="normal"><a href="#line-820"> 820</a></span>
<span class="normal"><a href="#line-821"> 821</a></span>
<span class="normal"><a href="#line-822"> 822</a></span>
<span class="normal"><a href="#line-823"> 823</a></span>
<span class="normal"><a href="#line-824"> 824</a></span>
<span class="normal"><a href="#line-825"> 825</a></span>
<span class="normal"><a href="#line-826"> 826</a></span>
<span class="normal"><a href="#line-827"> 827</a></span>
<span class="normal"><a href="#line-828"> 828</a></span>
<span class="normal"><a href="#line-829"> 829</a></span>
<span class="normal"><a href="#line-830"> 830</a></span>
<span class="normal"><a href="#line-831"> 831</a></span>
<span class="normal"><a href="#line-832"> 832</a></span>
<span class="normal"><a href="#line-833"> 833</a></span>
<span class="normal"><a href="#line-834"> 834</a></span>
<span class="normal"><a href="#line-835"> 835</a></span>
<span class="normal"><a href="#line-836"> 836</a></span>
<span class="normal"><a href="#line-837"> 837</a></span>
<span class="normal"><a href="#line-838"> 838</a></span>
<span class="normal"><a href="#line-839"> 839</a></span>
<span class="normal"><a href="#line-840"> 840</a></span>
<span class="normal"><a href="#line-841"> 841</a></span>
<span class="normal"><a href="#line-842"> 842</a></span>
<span class="normal"><a href="#line-843"> 843</a></span>
<span class="normal"><a href="#line-844"> 844</a></span>
<span class="normal"><a href="#line-845"> 845</a></span>
<span class="normal"><a href="#line-846"> 846</a></span>
<span class="normal"><a href="#line-847"> 847</a></span>
<span class="normal"><a href="#line-848"> 848</a></span>
<span class="normal"><a href="#line-849"> 849</a></span>
<span class="normal"><a href="#line-850"> 850</a></span>
<span class="normal"><a href="#line-851"> 851</a></span>
<span class="normal"><a href="#line-852"> 852</a></span>
<span class="normal"><a href="#line-853"> 853</a></span>
<span class="normal"><a href="#line-854"> 854</a></span>
<span class="normal"><a href="#line-855"> 855</a></span>
<span class="normal"><a href="#line-856"> 856</a></span>
<span class="normal"><a href="#line-857"> 857</a></span>
<span class="normal"><a href="#line-858"> 858</a></span>
<span class="normal"><a href="#line-859"> 859</a></span>
<span class="normal"><a href="#line-860"> 860</a></span>
<span class="normal"><a href="#line-861"> 861</a></span>
<span class="normal"><a href="#line-862"> 862</a></span>
<span class="normal"><a href="#line-863"> 863</a></span>
<span class="normal"><a href="#line-864"> 864</a></span>
<span class="normal"><a href="#line-865"> 865</a></span>
<span class="normal"><a href="#line-866"> 866</a></span>
<span class="normal"><a href="#line-867"> 867</a></span>
<span class="normal"><a href="#line-868"> 868</a></span>
<span class="normal"><a href="#line-869"> 869</a></span>
<span class="normal"><a href="#line-870"> 870</a></span>
<span class="normal"><a href="#line-871"> 871</a></span>
<span class="normal"><a href="#line-872"> 872</a></span>
<span class="normal"><a href="#line-873"> 873</a></span>
<span class="normal"><a href="#line-874"> 874</a></span>
<span class="normal"><a href="#line-875"> 875</a></span>
<span class="normal"><a href="#line-876"> 876</a></span>
<span class="normal"><a href="#line-877"> 877</a></span>
<span class="normal"><a href="#line-878"> 878</a></span>
<span class="normal"><a href="#line-879"> 879</a></span>
<span class="normal"><a href="#line-880"> 880</a></span>
<span class="normal"><a href="#line-881"> 881</a></span>
<span class="normal"><a href="#line-882"> 882</a></span>
<span class="normal"><a href="#line-883"> 883</a></span>
<span class="normal"><a href="#line-884"> 884</a></span>
<span class="normal"><a href="#line-885"> 885</a></span>
<span class="normal"><a href="#line-886"> 886</a></span>
<span class="normal"><a href="#line-887"> 887</a></span>
<span class="normal"><a href="#line-888"> 888</a></span>
<span class="normal"><a href="#line-889"> 889</a></span>
<span class="normal"><a href="#line-890"> 890</a></span>
<span class="normal"><a href="#line-891"> 891</a></span>
<span class="normal"><a href="#line-892"> 892</a></span>
<span class="normal"><a href="#line-893"> 893</a></span>
<span class="normal"><a href="#line-894"> 894</a></span>
<span class="normal"><a href="#line-895"> 895</a></span>
<span class="normal"><a href="#line-896"> 896</a></span>
<span class="normal"><a href="#line-897"> 897</a></span>
<span class="normal"><a href="#line-898"> 898</a></span>
<span class="normal"><a href="#line-899"> 899</a></span>
<span class="normal"><a href="#line-900"> 900</a></span>
<span class="normal"><a href="#line-901"> 901</a></span>
<span class="normal"><a href="#line-902"> 902</a></span>
<span class="normal"><a href="#line-903"> 903</a></span>
<span class="normal"><a href="#line-904"> 904</a></span>
<span class="normal"><a href="#line-905"> 905</a></span>
<span class="normal"><a href="#line-906"> 906</a></span>
<span class="normal"><a href="#line-907"> 907</a></span>
<span class="normal"><a href="#line-908"> 908</a></span>
<span class="normal"><a href="#line-909"> 909</a></span>
<span class="normal"><a href="#line-910"> 910</a></span>
<span class="normal"><a href="#line-911"> 911</a></span>
<span class="normal"><a href="#line-912"> 912</a></span>
<span class="normal"><a href="#line-913"> 913</a></span>
<span class="normal"><a href="#line-914"> 914</a></span>
<span class="normal"><a href="#line-915"> 915</a></span>
<span class="normal"><a href="#line-916"> 916</a></span>
<span class="normal"><a href="#line-917"> 917</a></span>
<span class="normal"><a href="#line-918"> 918</a></span>
<span class="normal"><a href="#line-919"> 919</a></span>
<span class="normal"><a href="#line-920"> 920</a></span>
<span class="normal"><a href="#line-921"> 921</a></span>
<span class="normal"><a href="#line-922"> 922</a></span>
<span class="normal"><a href="#line-923"> 923</a></span>
<span class="normal"><a href="#line-924"> 924</a></span>
<span class="normal"><a href="#line-925"> 925</a></span>
<span class="normal"><a href="#line-926"> 926</a></span>
<span class="normal"><a href="#line-927"> 927</a></span>
<span class="normal"><a href="#line-928"> 928</a></span>
<span class="normal"><a href="#line-929"> 929</a></span>
<span class="normal"><a href="#line-930"> 930</a></span>
<span class="normal"><a href="#line-931"> 931</a></span>
<span class="normal"><a href="#line-932"> 932</a></span>
<span class="normal"><a href="#line-933"> 933</a></span>
<span class="normal"><a href="#line-934"> 934</a></span>
<span class="normal"><a href="#line-935"> 935</a></span>
<span class="normal"><a href="#line-936"> 936</a></span>
<span class="normal"><a href="#line-937"> 937</a></span>
<span class="normal"><a href="#line-938"> 938</a></span>
<span class="normal"><a href="#line-939"> 939</a></span>
<span class="normal"><a href="#line-940"> 940</a></span>
<span class="normal"><a href="#line-941"> 941</a></span>
<span class="normal"><a href="#line-942"> 942</a></span>
<span class="normal"><a href="#line-943"> 943</a></span>
<span class="normal"><a href="#line-944"> 944</a></span>
<span class="normal"><a href="#line-945"> 945</a></span>
<span class="normal"><a href="#line-946"> 946</a></span>
<span class="normal"><a href="#line-947"> 947</a></span>
<span class="normal"><a href="#line-948"> 948</a></span>
<span class="normal"><a href="#line-949"> 949</a></span>
<span class="normal"><a href="#line-950"> 950</a></span>
<span class="normal"><a href="#line-951"> 951</a></span>
<span class="normal"><a href="#line-952"> 952</a></span>
<span class="normal"><a href="#line-953"> 953</a></span>
<span class="normal"><a href="#line-954"> 954</a></span>
<span class="normal"><a href="#line-955"> 955</a></span>
<span class="normal"><a href="#line-956"> 956</a></span>
<span class="normal"><a href="#line-957"> 957</a></span>
<span class="normal"><a href="#line-958"> 958</a></span>
<span class="normal"><a href="#line-959"> 959</a></span>
<span class="normal"><a href="#line-960"> 960</a></span>
<span class="normal"><a href="#line-961"> 961</a></span>
<span class="normal"><a href="#line-962"> 962</a></span>
<span class="normal"><a href="#line-963"> 963</a></span>
<span class="normal"><a href="#line-964"> 964</a></span>
<span class="normal"><a href="#line-965"> 965</a></span>
<span class="normal"><a href="#line-966"> 966</a></span>
<span class="normal"><a href="#line-967"> 967</a></span>
<span class="normal"><a href="#line-968"> 968</a></span>
<span class="normal"><a href="#line-969"> 969</a></span>
<span class="normal"><a href="#line-970"> 970</a></span>
<span class="normal"><a href="#line-971"> 971</a></span>
<span class="normal"><a href="#line-972"> 972</a></span>
<span class="normal"><a href="#line-973"> 973</a></span>
<span class="normal"><a href="#line-974"> 974</a></span>
<span class="normal"><a href="#line-975"> 975</a></span>
<span class="normal"><a href="#line-976"> 976</a></span>
<span class="normal"><a href="#line-977"> 977</a></span>
<span class="normal"><a href="#line-978"> 978</a></span>
<span class="normal"><a href="#line-979"> 979</a></span>
<span class="normal"><a href="#line-980"> 980</a></span>
<span class="normal"><a href="#line-981"> 981</a></span>
<span class="normal"><a href="#line-982"> 982</a></span>
<span class="normal"><a href="#line-983"> 983</a></span>
<span class="normal"><a href="#line-984"> 984</a></span>
<span class="normal"><a href="#line-985"> 985</a></span>
<span class="normal"><a href="#line-986"> 986</a></span>
<span class="normal"><a href="#line-987"> 987</a></span>
<span class="normal"><a href="#line-988"> 988</a></span>
<span class="normal"><a href="#line-989"> 989</a></span>
<span class="normal"><a href="#line-990"> 990</a></span>
<span class="normal"><a href="#line-991"> 991</a></span>
<span class="normal"><a href="#line-992"> 992</a></span>
<span class="normal"><a href="#line-993"> 993</a></span>
<span class="normal"><a href="#line-994"> 994</a></span>
<span class="normal"><a href="#line-995"> 995</a></span>
<span class="normal"><a href="#line-996"> 996</a></span>
<span class="normal"><a href="#line-997"> 997</a></span>
<span class="normal"><a href="#line-998"> 998</a></span>
<span class="normal"><a href="#line-999"> 999</a></span>
<span class="normal"><a href="#line-1000">1000</a></span>
<span class="normal"><a href="#line-1001">1001</a></span>
<span class="normal"><a href="#line-1002">1002</a></span>
<span class="normal"><a href="#line-1003">1003</a></span>
<span class="normal"><a href="#line-1004">1004</a></span>
<span class="normal"><a href="#line-1005">1005</a></span>
<span class="normal"><a href="#line-1006">1006</a></span>
<span class="normal"><a href="#line-1007">1007</a></span>
<span class="normal"><a href="#line-1008">1008</a></span>
<span class="normal"><a href="#line-1009">1009</a></span>
<span class="normal"><a href="#line-1010">1010</a></span>
<span class="normal"><a href="#line-1011">1011</a></span>
<span class="normal"><a href="#line-1012">1012</a></span>
<span class="normal"><a href="#line-1013">1013</a></span>
<span class="normal"><a href="#line-1014">1014</a></span>
<span class="normal"><a href="#line-1015">1015</a></span>
<span class="normal"><a href="#line-1016">1016</a></span>
<span class="normal"><a href="#line-1017">1017</a></span>
<span class="normal"><a href="#line-1018">1018</a></span>
<span class="normal"><a href="#line-1019">1019</a></span>
<span class="normal"><a href="#line-1020">1020</a></span>
<span class="normal"><a href="#line-1021">1021</a></span>
<span class="normal"><a href="#line-1022">1022</a></span>
<span class="normal"><a href="#line-1023">1023</a></span>
<span class="normal"><a href="#line-1024">1024</a></span>
<span class="normal"><a href="#line-1025">1025</a></span>
<span class="normal"><a href="#line-1026">1026</a></span>
<span class="normal"><a href="#line-1027">1027</a></span>
<span class="normal"><a href="#line-1028">1028</a></span>
<span class="normal"><a href="#line-1029">1029</a></span>
<span class="normal"><a href="#line-1030">1030</a></span>
<span class="normal"><a href="#line-1031">1031</a></span>
<span class="normal"><a href="#line-1032">1032</a></span>
<span class="normal"><a href="#line-1033">1033</a></span>
<span class="normal"><a href="#line-1034">1034</a></span>
<span class="normal"><a href="#line-1035">1035</a></span>
<span class="normal"><a href="#line-1036">1036</a></span>
<span class="normal"><a href="#line-1037">1037</a></span>
<span class="normal"><a href="#line-1038">1038</a></span>
<span class="normal"><a href="#line-1039">1039</a></span>
<span class="normal"><a href="#line-1040">1040</a></span>
<span class="normal"><a href="#line-1041">1041</a></span>
<span class="normal"><a href="#line-1042">1042</a></span>
<span class="normal"><a href="#line-1043">1043</a></span>
<span class="normal"><a href="#line-1044">1044</a></span>
<span class="normal"><a href="#line-1045">1045</a></span>
<span class="normal"><a href="#line-1046">1046</a></span>
<span class="normal"><a href="#line-1047">1047</a></span>
<span class="normal"><a href="#line-1048">1048</a></span>
<span class="normal"><a href="#line-1049">1049</a></span>
<span class="normal"><a href="#line-1050">1050</a></span>
<span class="normal"><a href="#line-1051">1051</a></span>
<span class="normal"><a href="#line-1052">1052</a></span>
<span class="normal"><a href="#line-1053">1053</a></span>
<span class="normal"><a href="#line-1054">1054</a></span>
<span class="normal"><a href="#line-1055">1055</a></span>
<span class="normal"><a href="#line-1056">1056</a></span>
<span class="normal"><a href="#line-1057">1057</a></span>
<span class="normal"><a href="#line-1058">1058</a></span>
<span class="normal"><a href="#line-1059">1059</a></span>
<span class="normal"><a href="#line-1060">1060</a></span>
<span class="normal"><a href="#line-1061">1061</a></span>
<span class="normal"><a href="#line-1062">1062</a></span>
<span class="normal"><a href="#line-1063">1063</a></span>
<span class="normal"><a href="#line-1064">1064</a></span>
<span class="normal"><a href="#line-1065">1065</a></span>
<span class="normal"><a href="#line-1066">1066</a></span>
<span class="normal"><a href="#line-1067">1067</a></span>
<span class="normal"><a href="#line-1068">1068</a></span>
<span class="normal"><a href="#line-1069">1069</a></span>
<span class="normal"><a href="#line-1070">1070</a></span>
<span class="normal"><a href="#line-1071">1071</a></span>
<span class="normal"><a href="#line-1072">1072</a></span>
<span class="normal"><a href="#line-1073">1073</a></span>
<span class="normal"><a href="#line-1074">1074</a></span>
<span class="normal"><a href="#line-1075">1075</a></span>
<span class="normal"><a href="#line-1076">1076</a></span>
<span class="normal"><a href="#line-1077">1077</a></span>
<span class="normal"><a href="#line-1078">1078</a></span>
<span class="normal"><a href="#line-1079">1079</a></span>
<span class="normal"><a href="#line-1080">1080</a></span>
<span class="normal"><a href="#line-1081">1081</a></span>
<span class="normal"><a href="#line-1082">1082</a></span>
<span class="normal"><a href="#line-1083">1083</a></span>
<span class="normal"><a href="#line-1084">1084</a></span>
<span class="normal"><a href="#line-1085">1085</a></span>
<span class="normal"><a href="#line-1086">1086</a></span>
<span class="normal"><a href="#line-1087">1087</a></span>
<span class="normal"><a href="#line-1088">1088</a></span>
<span class="normal"><a href="#line-1089">1089</a></span>
<span class="normal"><a href="#line-1090">1090</a></span>
<span class="normal"><a href="#line-1091">1091</a></span>
<span class="normal"><a href="#line-1092">1092</a></span>
<span class="normal"><a href="#line-1093">1093</a></span>
<span class="normal"><a href="#line-1094">1094</a></span>
<span class="normal"><a href="#line-1095">1095</a></span>
<span class="normal"><a href="#line-1096">1096</a></span>
<span class="normal"><a href="#line-1097">1097</a></span>
<span class="normal"><a href="#line-1098">1098</a></span>
<span class="normal"><a href="#line-1099">1099</a></span>
<span class="normal"><a href="#line-1100">1100</a></span>
<span class="normal"><a href="#line-1101">1101</a></span>
<span class="normal"><a href="#line-1102">1102</a></span>
<span class="normal"><a href="#line-1103">1103</a></span>
<span class="normal"><a href="#line-1104">1104</a></span>
<span class="normal"><a href="#line-1105">1105</a></span>
<span class="normal"><a href="#line-1106">1106</a></span>
<span class="normal"><a href="#line-1107">1107</a></span>
<span class="normal"><a href="#line-1108">1108</a></span>
<span class="normal"><a href="#line-1109">1109</a></span>
<span class="normal"><a href="#line-1110">1110</a></span>
<span class="normal"><a href="#line-1111">1111</a></span>
<span class="normal"><a href="#line-1112">1112</a></span>
<span class="normal"><a href="#line-1113">1113</a></span>
<span class="normal"><a href="#line-1114">1114</a></span>
<span class="normal"><a href="#line-1115">1115</a></span>
<span class="normal"><a href="#line-1116">1116</a></span>
<span class="normal"><a href="#line-1117">1117</a></span>
<span class="normal"><a href="#line-1118">1118</a></span>
<span class="normal"><a href="#line-1119">1119</a></span>
<span class="normal"><a href="#line-1120">1120</a></span>
<span class="normal"><a href="#line-1121">1121</a></span>
<span class="normal"><a href="#line-1122">1122</a></span>
<span class="normal"><a href="#line-1123">1123</a></span>
<span class="normal"><a href="#line-1124">1124</a></span>
<span class="normal"><a href="#line-1125">1125</a></span>
<span class="normal"><a href="#line-1126">1126</a></span>
<span class="normal"><a href="#line-1127">1127</a></span>
<span class="normal"><a href="#line-1128">1128</a></span>
<span class="normal"><a href="#line-1129">1129</a></span>
<span class="normal"><a href="#line-1130">1130</a></span>
<span class="normal"><a href="#line-1131">1131</a></span>
<span class="normal"><a href="#line-1132">1132</a></span>
<span class="normal"><a href="#line-1133">1133</a></span>
<span class="normal"><a href="#line-1134">1134</a></span>
<span class="normal"><a href="#line-1135">1135</a></span>
<span class="normal"><a href="#line-1136">1136</a></span>
<span class="normal"><a href="#line-1137">1137</a></span>
<span class="normal"><a href="#line-1138">1138</a></span>
<span class="normal"><a href="#line-1139">1139</a></span>
<span class="normal"><a href="#line-1140">1140</a></span>
<span class="normal"><a href="#line-1141">1141</a></span>
<span class="normal"><a href="#line-1142">1142</a></span>
<span class="normal"><a href="#line-1143">1143</a></span>
<span class="normal"><a href="#line-1144">1144</a></span>
<span class="normal"><a href="#line-1145">1145</a></span>
<span class="normal"><a href="#line-1146">1146</a></span>
<span class="normal"><a href="#line-1147">1147</a></span>
<span class="normal"><a href="#line-1148">1148</a></span>
<span class="normal"><a href="#line-1149">1149</a></span>
<span class="normal"><a href="#line-1150">1150</a></span>
<span class="normal"><a href="#line-1151">1151</a></span>
<span class="normal"><a href="#line-1152">1152</a></span>
<span class="normal"><a href="#line-1153">1153</a></span>
<span class="normal"><a href="#line-1154">1154</a></span>
<span class="normal"><a href="#line-1155">1155</a></span>
<span class="normal"><a href="#line-1156">1156</a></span>
<span class="normal"><a href="#line-1157">1157</a></span>
<span class="normal"><a href="#line-1158">1158</a></span>
<span class="normal"><a href="#line-1159">1159</a></span>
<span class="normal"><a href="#line-1160">1160</a></span>
<span class="normal"><a href="#line-1161">1161</a></span>
<span class="normal"><a href="#line-1162">1162</a></span>
<span class="normal"><a href="#line-1163">1163</a></span>
<span class="normal"><a href="#line-1164">1164</a></span>
<span class="normal"><a href="#line-1165">1165</a></span>
<span class="normal"><a href="#line-1166">1166</a></span>
<span class="normal"><a href="#line-1167">1167</a></span>
<span class="normal"><a href="#line-1168">1168</a></span>
<span class="normal"><a href="#line-1169">1169</a></span>
<span class="normal"><a href="#line-1170">1170</a></span>
<span class="normal"><a href="#line-1171">1171</a></span>
<span class="normal"><a href="#line-1172">1172</a></span>
<span class="normal"><a href="#line-1173">1173</a></span>
<span class="normal"><a href="#line-1174">1174</a></span>
<span class="normal"><a href="#line-1175">1175</a></span>
<span class="normal"><a href="#line-1176">1176</a></span>
<span class="normal"><a href="#line-1177">1177</a></span>
<span class="normal"><a href="#line-1178">1178</a></span>
<span class="normal"><a href="#line-1179">1179</a></span>
<span class="normal"><a href="#line-1180">1180</a></span>
<span class="normal"><a href="#line-1181">1181</a></span>
<span class="normal"><a href="#line-1182">1182</a></span>
<span class="normal"><a href="#line-1183">1183</a></span>
<span class="normal"><a href="#line-1184">1184</a></span>
<span class="normal"><a href="#line-1185">1185</a></span>
<span class="normal"><a href="#line-1186">1186</a></span>
<span class="normal"><a href="#line-1187">1187</a></span>
<span class="normal"><a href="#line-1188">1188</a></span>
<span class="normal"><a href="#line-1189">1189</a></span>
<span class="normal"><a href="#line-1190">1190</a></span>
<span class="normal"><a href="#line-1191">1191</a></span>
<span class="normal"><a href="#line-1192">1192</a></span>
<span class="normal"><a href="#line-1193">1193</a></span>
<span class="normal"><a href="#line-1194">1194</a></span>
<span class="normal"><a href="#line-1195">1195</a></span>
<span class="normal"><a href="#line-1196">1196</a></span>
<span class="normal"><a href="#line-1197">1197</a></span>
<span class="normal"><a href="#line-1198">1198</a></span>
<span class="normal"><a href="#line-1199">1199</a></span>
<span class="normal"><a href="#line-1200">1200</a></span>
<span class="normal"><a href="#line-1201">1201</a></span>
<span class="normal"><a href="#line-1202">1202</a></span>
<span class="normal"><a href="#line-1203">1203</a></span>
<span class="normal"><a href="#line-1204">1204</a></span>
<span class="normal"><a href="#line-1205">1205</a></span>
<span class="normal"><a href="#line-1206">1206</a></span>
<span class="normal"><a href="#line-1207">1207</a></span>
<span class="normal"><a href="#line-1208">1208</a></span>
<span class="normal"><a href="#line-1209">1209</a></span>
<span class="normal"><a href="#line-1210">1210</a></span>
<span class="normal"><a href="#line-1211">1211</a></span>
<span class="normal"><a href="#line-1212">1212</a></span>
<span class="normal"><a href="#line-1213">1213</a></span>
<span class="normal"><a href="#line-1214">1214</a></span>
<span class="normal"><a href="#line-1215">1215</a></span>
<span class="normal"><a href="#line-1216">1216</a></span>
<span class="normal"><a href="#line-1217">1217</a></span>
<span class="normal"><a href="#line-1218">1218</a></span>
<span class="normal"><a href="#line-1219">1219</a></span>
<span class="normal"><a href="#line-1220">1220</a></span>
<span class="normal"><a href="#line-1221">1221</a></span>
<span class="normal"><a href="#line-1222">1222</a></span>
<span class="normal"><a href="#line-1223">1223</a></span>
<span class="normal"><a href="#line-1224">1224</a></span>
<span class="normal"><a href="#line-1225">1225</a></span>
<span class="normal"><a href="#line-1226">1226</a></span>
<span class="normal"><a href="#line-1227">1227</a></span>
<span class="normal"><a href="#line-1228">1228</a></span>
<span class="normal"><a href="#line-1229">1229</a></span>
<span class="normal"><a href="#line-1230">1230</a></span>
<span class="normal"><a href="#line-1231">1231</a></span>
<span class="normal"><a href="#line-1232">1232</a></span>
<span class="normal"><a href="#line-1233">1233</a></span>
<span class="normal"><a href="#line-1234">1234</a></span>
<span class="normal"><a href="#line-1235">1235</a></span>
<span class="normal"><a href="#line-1236">1236</a></span>
<span class="normal"><a href="#line-1237">1237</a></span>
<span class="normal"><a href="#line-1238">1238</a></span>
<span class="normal"><a href="#line-1239">1239</a></span>
<span class="normal"><a href="#line-1240">1240</a></span>
<span class="normal"><a href="#line-1241">1241</a></span>
<span class="normal"><a href="#line-1242">1242</a></span>
<span class="normal"><a href="#line-1243">1243</a></span>
<span class="normal"><a href="#line-1244">1244</a></span>
<span class="normal"><a href="#line-1245">1245</a></span>
<span class="normal"><a href="#line-1246">1246</a></span>
<span class="normal"><a href="#line-1247">1247</a></span>
<span class="normal"><a href="#line-1248">1248</a></span>
<span class="normal"><a href="#line-1249">1249</a></span>
<span class="normal"><a href="#line-1250">1250</a></span>
<span class="normal"><a href="#line-1251">1251</a></span>
<span class="normal"><a href="#line-1252">1252</a></span>
<span class="normal"><a href="#line-1253">1253</a></span>
<span class="normal"><a href="#line-1254">1254</a></span>
<span class="normal"><a href="#line-1255">1255</a></span>
<span class="normal"><a href="#line-1256">1256</a></span>
<span class="normal"><a href="#line-1257">1257</a></span>
<span class="normal"><a href="#line-1258">1258</a></span>
<span class="normal"><a href="#line-1259">1259</a></span>
<span class="normal"><a href="#line-1260">1260</a></span>
<span class="normal"><a href="#line-1261">1261</a></span>
<span class="normal"><a href="#line-1262">1262</a></span>
<span class="normal"><a href="#line-1263">1263</a></span>
<span class="normal"><a href="#line-1264">1264</a></span>
<span class="normal"><a href="#line-1265">1265</a></span>
<span class="normal"><a href="#line-1266">1266</a></span>
<span class="normal"><a href="#line-1267">1267</a></span>
<span class="normal"><a href="#line-1268">1268</a></span>
<span class="normal"><a href="#line-1269">1269</a></span>
<span class="normal"><a href="#line-1270">1270</a></span>
<span class="normal"><a href="#line-1271">1271</a></span>
<span class="normal"><a href="#line-1272">1272</a></span>
<span class="normal"><a href="#line-1273">1273</a></span>
<span class="normal"><a href="#line-1274">1274</a></span>
<span class="normal"><a href="#line-1275">1275</a></span>
<span class="normal"><a href="#line-1276">1276</a></span>
<span class="normal"><a href="#line-1277">1277</a></span>
<span class="normal"><a href="#line-1278">1278</a></span>
<span class="normal"><a href="#line-1279">1279</a></span>
<span class="normal"><a href="#line-1280">1280</a></span>
<span class="normal"><a href="#line-1281">1281</a></span>
<span class="normal"><a href="#line-1282">1282</a></span>
<span class="normal"><a href="#line-1283">1283</a></span>
<span class="normal"><a href="#line-1284">1284</a></span>
<span class="normal"><a href="#line-1285">1285</a></span>
<span class="normal"><a href="#line-1286">1286</a></span>
<span class="normal"><a href="#line-1287">1287</a></span>
<span class="normal"><a href="#line-1288">1288</a></span>
<span class="normal"><a href="#line-1289">1289</a></span>
<span class="normal"><a href="#line-1290">1290</a></span>
<span class="normal"><a href="#line-1291">1291</a></span>
<span class="normal"><a href="#line-1292">1292</a></span>
<span class="normal"><a href="#line-1293">1293</a></span>
<span class="normal"><a href="#line-1294">1294</a></span>
<span class="normal"><a href="#line-1295">1295</a></span>
<span class="normal"><a href="#line-1296">1296</a></span>
<span class="normal"><a href="#line-1297">1297</a></span>
<span class="normal"><a href="#line-1298">1298</a></span>
<span class="normal"><a href="#line-1299">1299</a></span>
<span class="normal"><a href="#line-1300">1300</a></span>
<span class="normal"><a href="#line-1301">1301</a></span>
<span class="normal"><a href="#line-1302">1302</a></span>
<span class="normal"><a href="#line-1303">1303</a></span>
<span class="normal"><a href="#line-1304">1304</a></span>
<span class="normal"><a href="#line-1305">1305</a></span>
<span class="normal"><a href="#line-1306">1306</a></span>
<span class="normal"><a href="#line-1307">1307</a></span>
<span class="normal"><a href="#line-1308">1308</a></span>
<span class="normal"><a href="#line-1309">1309</a></span>
<span class="normal"><a href="#line-1310">1310</a></span>
<span class="normal"><a href="#line-1311">1311</a></span>
<span class="normal"><a href="#line-1312">1312</a></span>
<span class="normal"><a href="#line-1313">1313</a></span>
<span class="normal"><a href="#line-1314">1314</a></span>
<span class="normal"><a href="#line-1315">1315</a></span>
<span class="normal"><a href="#line-1316">1316</a></span>
<span class="normal"><a href="#line-1317">1317</a></span>
<span class="normal"><a href="#line-1318">1318</a></span>
<span class="normal"><a href="#line-1319">1319</a></span>
<span class="normal"><a href="#line-1320">1320</a></span>
<span class="normal"><a href="#line-1321">1321</a></span>
<span class="normal"><a href="#line-1322">1322</a></span>
<span class="normal"><a href="#line-1323">1323</a></span>
<span class="normal"><a href="#line-1324">1324</a></span>
<span class="normal"><a href="#line-1325">1325</a></span>
<span class="normal"><a href="#line-1326">1326</a></span>
<span class="normal"><a href="#line-1327">1327</a></span>
<span class="normal"><a href="#line-1328">1328</a></span>
<span class="normal"><a href="#line-1329">1329</a></span>
<span class="normal"><a href="#line-1330">1330</a></span>
<span class="normal"><a href="#line-1331">1331</a></span>
<span class="normal"><a href="#line-1332">1332</a></span>
<span class="normal"><a href="#line-1333">1333</a></span>
<span class="normal"><a href="#line-1334">1334</a></span>
<span class="normal"><a href="#line-1335">1335</a></span>
<span class="normal"><a href="#line-1336">1336</a></span>
<span class="normal"><a href="#line-1337">1337</a></span>
<span class="normal"><a href="#line-1338">1338</a></span>
<span class="normal"><a href="#line-1339">1339</a></span>
<span class="normal"><a href="#line-1340">1340</a></span>
<span class="normal"><a href="#line-1341">1341</a></span>
<span class="normal"><a href="#line-1342">1342</a></span>
<span class="normal"><a href="#line-1343">1343</a></span>
<span class="normal"><a href="#line-1344">1344</a></span>
<span class="normal"><a href="#line-1345">1345</a></span>
<span class="normal"><a href="#line-1346">1346</a></span>
<span class="normal"><a href="#line-1347">1347</a></span>
<span class="normal"><a href="#line-1348">1348</a></span>
<span class="normal"><a href="#line-1349">1349</a></span>
<span class="normal"><a href="#line-1350">1350</a></span>
<span class="normal"><a href="#line-1351">1351</a></span>
<span class="normal"><a href="#line-1352">1352</a></span>
<span class="normal"><a href="#line-1353">1353</a></span>
<span class="normal"><a href="#line-1354">1354</a></span>
<span class="normal"><a href="#line-1355">1355</a></span>
<span class="normal"><a href="#line-1356">1356</a></span>
<span class="normal"><a href="#line-1357">1357</a></span>
<span class="normal"><a href="#line-1358">1358</a></span>
<span class="normal"><a href="#line-1359">1359</a></span>
<span class="normal"><a href="#line-1360">1360</a></span>
<span class="normal"><a href="#line-1361">1361</a></span>
<span class="normal"><a href="#line-1362">1362</a></span>
<span class="normal"><a href="#line-1363">1363</a></span>
<span class="normal"><a href="#line-1364">1364</a></span>
<span class="normal"><a href="#line-1365">1365</a></span>
<span class="normal"><a href="#line-1366">1366</a></span>
<span class="normal"><a href="#line-1367">1367</a></span>
<span class="normal"><a href="#line-1368">1368</a></span>
<span class="normal"><a href="#line-1369">1369</a></span>
<span class="normal"><a href="#line-1370">1370</a></span>
<span class="normal"><a href="#line-1371">1371</a></span>
<span class="normal"><a href="#line-1372">1372</a></span>
<span class="normal"><a href="#line-1373">1373</a></span>
<span class="normal"><a href="#line-1374">1374</a></span>
<span class="normal"><a href="#line-1375">1375</a></span>
<span class="normal"><a href="#line-1376">1376</a></span>
<span class="normal"><a href="#line-1377">1377</a></span>
<span class="normal"><a href="#line-1378">1378</a></span>
<span class="normal"><a href="#line-1379">1379</a></span>
<span class="normal"><a href="#line-1380">1380</a></span>
<span class="normal"><a href="#line-1381">1381</a></span>
<span class="normal"><a href="#line-1382">1382</a></span>
<span class="normal"><a href="#line-1383">1383</a></span>
<span class="normal"><a href="#line-1384">1384</a></span>
<span class="normal"><a href="#line-1385">1385</a></span>
<span class="normal"><a href="#line-1386">1386</a></span>
<span class="normal"><a href="#line-1387">1387</a></span>
<span class="normal"><a href="#line-1388">1388</a></span>
<span class="normal"><a href="#line-1389">1389</a></span>
<span class="normal"><a href="#line-1390">1390</a></span>
<span class="normal"><a href="#line-1391">1391</a></span>
<span class="normal"><a href="#line-1392">1392</a></span>
<span class="normal"><a href="#line-1393">1393</a></span>
<span class="normal"><a href="#line-1394">1394</a></span>
<span class="normal"><a href="#line-1395">1395</a></span>
<span class="normal"><a href="#line-1396">1396</a></span>
<span class="normal"><a href="#line-1397">1397</a></span>
<span class="normal"><a href="#line-1398">1398</a></span>
<span class="normal"><a href="#line-1399">1399</a></span>
<span class="normal"><a href="#line-1400">1400</a></span>
<span class="normal"><a href="#line-1401">1401</a></span>
<span class="normal"><a href="#line-1402">1402</a></span>
<span class="normal"><a href="#line-1403">1403</a></span>
<span class="normal"><a href="#line-1404">1404</a></span>
<span class="normal"><a href="#line-1405">1405</a></span>
<span class="normal"><a href="#line-1406">1406</a></span>
<span class="normal"><a href="#line-1407">1407</a></span>
<span class="normal"><a href="#line-1408">1408</a></span>
<span class="normal"><a href="#line-1409">1409</a></span>
<span class="normal"><a href="#line-1410">1410</a></span>
<span class="normal"><a href="#line-1411">1411</a></span>
<span class="normal"><a href="#line-1412">1412</a></span>
<span class="normal"><a href="#line-1413">1413</a></span>
<span class="normal"><a href="#line-1414">1414</a></span>
<span class="normal"><a href="#line-1415">1415</a></span>
<span class="normal"><a href="#line-1416">1416</a></span>
<span class="normal"><a href="#line-1417">1417</a></span>
<span class="normal"><a href="#line-1418">1418</a></span>
<span class="normal"><a href="#line-1419">1419</a></span>
<span class="normal"><a href="#line-1420">1420</a></span>
<span class="normal"><a href="#line-1421">1421</a></span>
<span class="normal"><a href="#line-1422">1422</a></span>
<span class="normal"><a href="#line-1423">1423</a></span>
<span class="normal"><a href="#line-1424">1424</a></span>
<span class="normal"><a href="#line-1425">1425</a></span>
<span class="normal"><a href="#line-1426">1426</a></span>
<span class="normal"><a href="#line-1427">1427</a></span>
<span class="normal"><a href="#line-1428">1428</a></span>
<span class="normal"><a href="#line-1429">1429</a></span>
<span class="normal"><a href="#line-1430">1430</a></span>
<span class="normal"><a href="#line-1431">1431</a></span>
<span class="normal"><a href="#line-1432">1432</a></span>
<span class="normal"><a href="#line-1433">1433</a></span>
<span class="normal"><a href="#line-1434">1434</a></span>
<span class="normal"><a href="#line-1435">1435</a></span>
<span class="normal"><a href="#line-1436">1436</a></span>
<span class="normal"><a href="#line-1437">1437</a></span>
<span class="normal"><a href="#line-1438">1438</a></span>
<span class="normal"><a href="#line-1439">1439</a></span>
<span class="normal"><a href="#line-1440">1440</a></span>
<span class="normal"><a href="#line-1441">1441</a></span>
<span class="normal"><a href="#line-1442">1442</a></span>
<span class="normal"><a href="#line-1443">1443</a></span>
<span class="normal"><a href="#line-1444">1444</a></span>
<span class="normal"><a href="#line-1445">1445</a></span>
<span class="normal"><a href="#line-1446">1446</a></span>
<span class="normal"><a href="#line-1447">1447</a></span>
<span class="normal"><a href="#line-1448">1448</a></span>
<span class="normal"><a href="#line-1449">1449</a></span>
<span class="normal"><a href="#line-1450">1450</a></span>
<span class="normal"><a href="#line-1451">1451</a></span>
<span class="normal"><a href="#line-1452">1452</a></span>
<span class="normal"><a href="#line-1453">1453</a></span>
<span class="normal"><a href="#line-1454">1454</a></span>
<span class="normal"><a href="#line-1455">1455</a></span>
<span class="normal"><a href="#line-1456">1456</a></span>
<span class="normal"><a href="#line-1457">1457</a></span>
<span class="normal"><a href="#line-1458">1458</a></span>
<span class="normal"><a href="#line-1459">1459</a></span>
<span class="normal"><a href="#line-1460">1460</a></span>
<span class="normal"><a href="#line-1461">1461</a></span>
<span class="normal"><a href="#line-1462">1462</a></span>
<span class="normal"><a href="#line-1463">1463</a></span>
<span class="normal"><a href="#line-1464">1464</a></span>
<span class="normal"><a href="#line-1465">1465</a></span>
<span class="normal"><a href="#line-1466">1466</a></span>
<span class="normal"><a href="#line-1467">1467</a></span>
<span class="normal"><a href="#line-1468">1468</a></span>
<span class="normal"><a href="#line-1469">1469</a></span>
<span class="normal"><a href="#line-1470">1470</a></span>
<span class="normal"><a href="#line-1471">1471</a></span>
<span class="normal"><a href="#line-1472">1472</a></span>
<span class="normal"><a href="#line-1473">1473</a></span>
<span class="normal"><a href="#line-1474">1474</a></span>
<span class="normal"><a href="#line-1475">1475</a></span>
<span class="normal"><a href="#line-1476">1476</a></span>
<span class="normal"><a href="#line-1477">1477</a></span>
<span class="normal"><a href="#line-1478">1478</a></span>
<span class="normal"><a href="#line-1479">1479</a></span>
<span class="normal"><a href="#line-1480">1480</a></span>
<span class="normal"><a href="#line-1481">1481</a></span>
<span class="normal"><a href="#line-1482">1482</a></span>
<span class="normal"><a href="#line-1483">1483</a></span>
<span class="normal"><a href="#line-1484">1484</a></span>
<span class="normal"><a href="#line-1485">1485</a></span>
<span class="normal"><a href="#line-1486">1486</a></span>
<span class="normal"><a href="#line-1487">1487</a></span>
<span class="normal"><a href="#line-1488">1488</a></span>
<span class="normal"><a href="#line-1489">1489</a></span>
<span class="normal"><a href="#line-1490">1490</a></span>
<span class="normal"><a href="#line-1491">1491</a></span>
<span class="normal"><a href="#line-1492">1492</a></span>
<span class="normal"><a href="#line-1493">1493</a></span>
<span class="normal"><a href="#line-1494">1494</a></span>
<span class="normal"><a href="#line-1495">1495</a></span>
<span class="normal"><a href="#line-1496">1496</a></span>
<span class="normal"><a href="#line-1497">1497</a></span>
<span class="normal"><a href="#line-1498">1498</a></span>
<span class="normal"><a href="#line-1499">1499</a></span>
<span class="normal"><a href="#line-1500">1500</a></span>
<span class="normal"><a href="#line-1501">1501</a></span>
<span class="normal"><a href="#line-1502">1502</a></span>
<span class="normal"><a href="#line-1503">1503</a></span>
<span class="normal"><a href="#line-1504">1504</a></span>
<span class="normal"><a href="#line-1505">1505</a></span>
<span class="normal"><a href="#line-1506">1506</a></span>
<span class="normal"><a href="#line-1507">1507</a></span>
<span class="normal"><a href="#line-1508">1508</a></span>
<span class="normal"><a href="#line-1509">1509</a></span>
<span class="normal"><a href="#line-1510">1510</a></span>
<span class="normal"><a href="#line-1511">1511</a></span>
<span class="normal"><a href="#line-1512">1512</a></span>
<span class="normal"><a href="#line-1513">1513</a></span>
<span class="normal"><a href="#line-1514">1514</a></span>
<span class="normal"><a href="#line-1515">1515</a></span>
<span class="normal"><a href="#line-1516">1516</a></span>
<span class="normal"><a href="#line-1517">1517</a></span>
<span class="normal"><a href="#line-1518">1518</a></span>
<span class="normal"><a href="#line-1519">1519</a></span>
<span class="normal"><a href="#line-1520">1520</a></span>
<span class="normal"><a href="#line-1521">1521</a></span>
<span class="normal"><a href="#line-1522">1522</a></span>
<span class="normal"><a href="#line-1523">1523</a></span>
<span class="normal"><a href="#line-1524">1524</a></span>
<span class="normal"><a href="#line-1525">1525</a></span>
<span class="normal"><a href="#line-1526">1526</a></span>
<span class="normal"><a href="#line-1527">1527</a></span>
<span class="normal"><a href="#line-1528">1528</a></span>
<span class="normal"><a href="#line-1529">1529</a></span>
<span class="normal"><a href="#line-1530">1530</a></span>
<span class="normal"><a href="#line-1531">1531</a></span>
<span class="normal"><a href="#line-1532">1532</a></span>
<span class="normal"><a href="#line-1533">1533</a></span>
<span class="normal"><a href="#line-1534">1534</a></span>
<span class="normal"><a href="#line-1535">1535</a></span>
<span class="normal"><a href="#line-1536">1536</a></span>
<span class="normal"><a href="#line-1537">1537</a></span>
<span class="normal"><a href="#line-1538">1538</a></span>
<span class="normal"><a href="#line-1539">1539</a></span>
<span class="normal"><a href="#line-1540">1540</a></span>
<span class="normal"><a href="#line-1541">1541</a></span>
<span class="normal"><a href="#line-1542">1542</a></span>
<span class="normal"><a href="#line-1543">1543</a></span>
<span class="normal"><a href="#line-1544">1544</a></span>
<span class="normal"><a href="#line-1545">1545</a></span>
<span class="normal"><a href="#line-1546">1546</a></span>
<span class="normal"><a href="#line-1547">1547</a></span>
<span class="normal"><a href="#line-1548">1548</a></span>
<span class="normal"><a href="#line-1549">1549</a></span>
<span class="normal"><a href="#line-1550">1550</a></span>
<span class="normal"><a href="#line-1551">1551</a></span>
<span class="normal"><a href="#line-1552">1552</a></span>
<span class="normal"><a href="#line-1553">1553</a></span>
<span class="normal"><a href="#line-1554">1554</a></span>
<span class="normal"><a href="#line-1555">1555</a></span>
<span class="normal"><a href="#line-1556">1556</a></span>
<span class="normal"><a href="#line-1557">1557</a></span>
<span class="normal"><a href="#line-1558">1558</a></span>
<span class="normal"><a href="#line-1559">1559</a></span>
<span class="normal"><a href="#line-1560">1560</a></span>
<span class="normal"><a href="#line-1561">1561</a></span>
<span class="normal"><a href="#line-1562">1562</a></span>
<span class="normal"><a href="#line-1563">1563</a></span>
<span class="normal"><a href="#line-1564">1564</a></span>
<span class="normal"><a href="#line-1565">1565</a></span>
<span class="normal"><a href="#line-1566">1566</a></span>
<span class="normal"><a href="#line-1567">1567</a></span>
<span class="normal"><a href="#line-1568">1568</a></span>
<span class="normal"><a href="#line-1569">1569</a></span>
<span class="normal"><a href="#line-1570">1570</a></span>
<span class="normal"><a href="#line-1571">1571</a></span>
<span class="normal"><a href="#line-1572">1572</a></span>
<span class="normal"><a href="#line-1573">1573</a></span>
<span class="normal"><a href="#line-1574">1574</a></span>
<span class="normal"><a href="#line-1575">1575</a></span>
<span class="normal"><a href="#line-1576">1576</a></span>
<span class="normal"><a href="#line-1577">1577</a></span>
<span class="normal"><a href="#line-1578">1578</a></span>
<span class="normal"><a href="#line-1579">1579</a></span>
<span class="normal"><a href="#line-1580">1580</a></span>
<span class="normal"><a href="#line-1581">1581</a></span>
<span class="normal"><a href="#line-1582">1582</a></span>
<span class="normal"><a href="#line-1583">1583</a></span>
<span class="normal"><a href="#line-1584">1584</a></span>
<span class="normal"><a href="#line-1585">1585</a></span>
<span class="normal"><a href="#line-1586">1586</a></span>
<span class="normal"><a href="#line-1587">1587</a></span>
<span class="normal"><a href="#line-1588">1588</a></span>
<span class="normal"><a href="#line-1589">1589</a></span>
<span class="normal"><a href="#line-1590">1590</a></span>
<span class="normal"><a href="#line-1591">1591</a></span>
<span class="normal"><a href="#line-1592">1592</a></span>
<span class="normal"><a href="#line-1593">1593</a></span>
<span class="normal"><a href="#line-1594">1594</a></span>
<span class="normal"><a href="#line-1595">1595</a></span>
<span class="normal"><a href="#line-1596">1596</a></span>
<span class="normal"><a href="#line-1597">1597</a></span>
<span class="normal"><a href="#line-1598">1598</a></span>
<span class="normal"><a href="#line-1599">1599</a></span>
<span class="normal"><a href="#line-1600">1600</a></span>
<span class="normal"><a href="#line-1601">1601</a></span>
<span class="normal"><a href="#line-1602">1602</a></span>
<span class="normal"><a href="#line-1603">1603</a></span>
<span class="normal"><a href="#line-1604">1604</a></span>
<span class="normal"><a href="#line-1605">1605</a></span>
<span class="normal"><a href="#line-1606">1606</a></span>
<span class="normal"><a href="#line-1607">1607</a></span>
<span class="normal"><a href="#line-1608">1608</a></span>
<span class="normal"><a href="#line-1609">1609</a></span>
<span class="normal"><a href="#line-1610">1610</a></span>
<span class="normal"><a href="#line-1611">1611</a></span>
<span class="normal"><a href="#line-1612">1612</a></span>
<span class="normal"><a href="#line-1613">1613</a></span>
<span class="normal"><a href="#line-1614">1614</a></span>
<span class="normal"><a href="#line-1615">1615</a></span>
<span class="normal"><a href="#line-1616">1616</a></span>
<span class="normal"><a href="#line-1617">1617</a></span>
<span class="normal"><a href="#line-1618">1618</a></span>
<span class="normal"><a href="#line-1619">1619</a></span>
<span class="normal"><a href="#line-1620">1620</a></span>
<span class="normal"><a href="#line-1621">1621</a></span>
<span class="normal"><a href="#line-1622">1622</a></span>
<span class="normal"><a href="#line-1623">1623</a></span>
<span class="normal"><a href="#line-1624">1624</a></span>
<span class="normal"><a href="#line-1625">1625</a></span>
<span class="normal"><a href="#line-1626">1626</a></span>
<span class="normal"><a href="#line-1627">1627</a></span>
<span class="normal"><a href="#line-1628">1628</a></span>
<span class="normal"><a href="#line-1629">1629</a></span>
<span class="normal"><a href="#line-1630">1630</a></span>
<span class="normal"><a href="#line-1631">1631</a></span>
<span class="normal"><a href="#line-1632">1632</a></span>
<span class="normal"><a href="#line-1633">1633</a></span>
<span class="normal"><a href="#line-1634">1634</a></span>
<span class="normal"><a href="#line-1635">1635</a></span>
<span class="normal"><a href="#line-1636">1636</a></span>
<span class="normal"><a href="#line-1637">1637</a></span>
<span class="normal"><a href="#line-1638">1638</a></span>
<span class="normal"><a href="#line-1639">1639</a></span>
<span class="normal"><a href="#line-1640">1640</a></span>
<span class="normal"><a href="#line-1641">1641</a></span>
<span class="normal"><a href="#line-1642">1642</a></span>
<span class="normal"><a href="#line-1643">1643</a></span>
<span class="normal"><a href="#line-1644">1644</a></span>
<span class="normal"><a href="#line-1645">1645</a></span>
<span class="normal"><a href="#line-1646">1646</a></span>
<span class="normal"><a href="#line-1647">1647</a></span>
<span class="normal"><a href="#line-1648">1648</a></span>
<span class="normal"><a href="#line-1649">1649</a></span>
<span class="normal"><a href="#line-1650">1650</a></span>
<span class="normal"><a href="#line-1651">1651</a></span>
<span class="normal"><a href="#line-1652">1652</a></span>
<span class="normal"><a href="#line-1653">1653</a></span>
<span class="normal"><a href="#line-1654">1654</a></span>
<span class="normal"><a href="#line-1655">1655</a></span>
<span class="normal"><a href="#line-1656">1656</a></span>
<span class="normal"><a href="#line-1657">1657</a></span>
<span class="normal"><a href="#line-1658">1658</a></span>
<span class="normal"><a href="#line-1659">1659</a></span>
<span class="normal"><a href="#line-1660">1660</a></span>
<span class="normal"><a href="#line-1661">1661</a></span>
<span class="normal"><a href="#line-1662">1662</a></span>
<span class="normal"><a href="#line-1663">1663</a></span>
<span class="normal"><a href="#line-1664">1664</a></span>
<span class="normal"><a href="#line-1665">1665</a></span>
<span class="normal"><a href="#line-1666">1666</a></span>
<span class="normal"><a href="#line-1667">1667</a></span>
<span class="normal"><a href="#line-1668">1668</a></span>
<span class="normal"><a href="#line-1669">1669</a></span>
<span class="normal"><a href="#line-1670">1670</a></span>
<span class="normal"><a href="#line-1671">1671</a></span>
<span class="normal"><a href="#line-1672">1672</a></span>
<span class="normal"><a href="#line-1673">1673</a></span>
<span class="normal"><a href="#line-1674">1674</a></span>
<span class="normal"><a href="#line-1675">1675</a></span>
<span class="normal"><a href="#line-1676">1676</a></span>
<span class="normal"><a href="#line-1677">1677</a></span>
<span class="normal"><a href="#line-1678">1678</a></span>
<span class="normal"><a href="#line-1679">1679</a></span>
<span class="normal"><a href="#line-1680">1680</a></span>
<span class="normal"><a href="#line-1681">1681</a></span>
<span class="normal"><a href="#line-1682">1682</a></span>
<span class="normal"><a href="#line-1683">1683</a></span>
<span class="normal"><a href="#line-1684">1684</a></span>
<span class="normal"><a href="#line-1685">1685</a></span>
<span class="normal"><a href="#line-1686">1686</a></span>
<span class="normal"><a href="#line-1687">1687</a></span>
<span class="normal"><a href="#line-1688">1688</a></span>
<span class="normal"><a href="#line-1689">1689</a></span>
<span class="normal"><a href="#line-1690">1690</a></span>
<span class="normal"><a href="#line-1691">1691</a></span>
<span class="normal"><a href="#line-1692">1692</a></span>
<span class="normal"><a href="#line-1693">1693</a></span>
<span class="normal"><a href="#line-1694">1694</a></span>
<span class="normal"><a href="#line-1695">1695</a></span>
<span class="normal"><a href="#line-1696">1696</a></span>
<span class="normal"><a href="#line-1697">1697</a></span>
<span class="normal"><a href="#line-1698">1698</a></span>
<span class="normal"><a href="#line-1699">1699</a></span>
<span class="normal"><a href="#line-1700">1700</a></span>
<span class="normal"><a href="#line-1701">1701</a></span>
<span class="normal"><a href="#line-1702">1702</a></span>
<span class="normal"><a href="#line-1703">1703</a></span>
<span class="normal"><a href="#line-1704">1704</a></span>
<span class="normal"><a href="#line-1705">1705</a></span>
<span class="normal"><a href="#line-1706">1706</a></span>
<span class="normal"><a href="#line-1707">1707</a></span>
<span class="normal"><a href="#line-1708">1708</a></span>
<span class="normal"><a href="#line-1709">1709</a></span>
<span class="normal"><a href="#line-1710">1710</a></span>
<span class="normal"><a href="#line-1711">1711</a></span>
<span class="normal"><a href="#line-1712">1712</a></span>
<span class="normal"><a href="#line-1713">1713</a></span>
<span class="normal"><a href="#line-1714">1714</a></span>
<span class="normal"><a href="#line-1715">1715</a></span>
<span class="normal"><a href="#line-1716">1716</a></span>
<span class="normal"><a href="#line-1717">1717</a></span>
<span class="normal"><a href="#line-1718">1718</a></span>
<span class="normal"><a href="#line-1719">1719</a></span>
<span class="normal"><a href="#line-1720">1720</a></span>
<span class="normal"><a href="#line-1721">1721</a></span>
<span class="normal"><a href="#line-1722">1722</a></span>
<span class="normal"><a href="#line-1723">1723</a></span>
<span class="normal"><a href="#line-1724">1724</a></span>
<span class="normal"><a href="#line-1725">1725</a></span>
<span class="normal"><a href="#line-1726">1726</a></span>
<span class="normal"><a href="#line-1727">1727</a></span>
<span class="normal"><a href="#line-1728">1728</a></span>
<span class="normal"><a href="#line-1729">1729</a></span>
<span class="normal"><a href="#line-1730">1730</a></span>
<span class="normal"><a href="#line-1731">1731</a></span>
<span class="normal"><a href="#line-1732">1732</a></span>
<span class="normal"><a href="#line-1733">1733</a></span>
<span class="normal"><a href="#line-1734">1734</a></span>
<span class="normal"><a href="#line-1735">1735</a></span>
<span class="normal"><a href="#line-1736">1736</a></span>
<span class="normal"><a href="#line-1737">1737</a></span>
<span class="normal"><a href="#line-1738">1738</a></span>
<span class="normal"><a href="#line-1739">1739</a></span>
<span class="normal"><a href="#line-1740">1740</a></span>
<span class="normal"><a href="#line-1741">1741</a></span>
<span class="normal"><a href="#line-1742">1742</a></span>
<span class="normal"><a href="#line-1743">1743</a></span>
<span class="normal"><a href="#line-1744">1744</a></span>
<span class="normal"><a href="#line-1745">1745</a></span>
<span class="normal"><a href="#line-1746">1746</a></span>
<span class="normal"><a href="#line-1747">1747</a></span>
<span class="normal"><a href="#line-1748">1748</a></span>
<span class="normal"><a href="#line-1749">1749</a></span>
<span class="normal"><a href="#line-1750">1750</a></span>
<span class="normal"><a href="#line-1751">1751</a></span>
<span class="normal"><a href="#line-1752">1752</a></span>
<span class="normal"><a href="#line-1753">1753</a></span>
<span class="normal"><a href="#line-1754">1754</a></span>
<span class="normal"><a href="#line-1755">1755</a></span>
<span class="normal"><a href="#line-1756">1756</a></span>
<span class="normal"><a href="#line-1757">1757</a></span>
<span class="normal"><a href="#line-1758">1758</a></span>
<span class="normal"><a href="#line-1759">1759</a></span>
<span class="normal"><a href="#line-1760">1760</a></span>
<span class="normal"><a href="#line-1761">1761</a></span>
<span class="normal"><a href="#line-1762">1762</a></span>
<span class="normal"><a href="#line-1763">1763</a></span>
<span class="normal"><a href="#line-1764">1764</a></span>
<span class="normal"><a href="#line-1765">1765</a></span>
<span class="normal"><a href="#line-1766">1766</a></span>
<span class="normal"><a href="#line-1767">1767</a></span>
<span class="normal"><a href="#line-1768">1768</a></span>
<span class="normal"><a href="#line-1769">1769</a></span>
<span class="normal"><a href="#line-1770">1770</a></span>
<span class="normal"><a href="#line-1771">1771</a></span>
<span class="normal"><a href="#line-1772">1772</a></span>
<span class="normal"><a href="#line-1773">1773</a></span>
<span class="normal"><a href="#line-1774">1774</a></span>
<span class="normal"><a href="#line-1775">1775</a></span>
<span class="normal"><a href="#line-1776">1776</a></span>
<span class="normal"><a href="#line-1777">1777</a></span>
<span class="normal"><a href="#line-1778">1778</a></span>
<span class="normal"><a href="#line-1779">1779</a></span>
<span class="normal"><a href="#line-1780">1780</a></span>
<span class="normal"><a href="#line-1781">1781</a></span>
<span class="normal"><a href="#line-1782">1782</a></span>
<span class="normal"><a href="#line-1783">1783</a></span>
<span class="normal"><a href="#line-1784">1784</a></span>
<span class="normal"><a href="#line-1785">1785</a></span>
<span class="normal"><a href="#line-1786">1786</a></span>
<span class="normal"><a href="#line-1787">1787</a></span>
<span class="normal"><a href="#line-1788">1788</a></span>
<span class="normal"><a href="#line-1789">1789</a></span>
<span class="normal"><a href="#line-1790">1790</a></span>
<span class="normal"><a href="#line-1791">1791</a></span>
<span class="normal"><a href="#line-1792">1792</a></span>
<span class="normal"><a href="#line-1793">1793</a></span>
<span class="normal"><a href="#line-1794">1794</a></span>
<span class="normal"><a href="#line-1795">1795</a></span>
<span class="normal"><a href="#line-1796">1796</a></span>
<span class="normal"><a href="#line-1797">1797</a></span>
<span class="normal"><a href="#line-1798">1798</a></span>
<span class="normal"><a href="#line-1799">1799</a></span>
<span class="normal"><a href="#line-1800">1800</a></span>
<span class="normal"><a href="#line-1801">1801</a></span>
<span class="normal"><a href="#line-1802">1802</a></span>
<span class="normal"><a href="#line-1803">1803</a></span>
<span class="normal"><a href="#line-1804">1804</a></span>
<span class="normal"><a href="#line-1805">1805</a></span>
<span class="normal"><a href="#line-1806">1806</a></span>
<span class="normal"><a href="#line-1807">1807</a></span>
<span class="normal"><a href="#line-1808">1808</a></span>
<span class="normal"><a href="#line-1809">1809</a></span>
<span class="normal"><a href="#line-1810">1810</a></span>
<span class="normal"><a href="#line-1811">1811</a></span>
<span class="normal"><a href="#line-1812">1812</a></span>
<span class="normal"><a href="#line-1813">1813</a></span>
<span class="normal"><a href="#line-1814">1814</a></span>
<span class="normal"><a href="#line-1815">1815</a></span>
<span class="normal"><a href="#line-1816">1816</a></span>
<span class="normal"><a href="#line-1817">1817</a></span>
<span class="normal"><a href="#line-1818">1818</a></span>
<span class="normal"><a href="#line-1819">1819</a></span>
<span class="normal"><a href="#line-1820">1820</a></span>
<span class="normal"><a href="#line-1821">1821</a></span>
<span class="normal"><a href="#line-1822">1822</a></span>
<span class="normal"><a href="#line-1823">1823</a></span>
<span class="normal"><a href="#line-1824">1824</a></span>
<span class="normal"><a href="#line-1825">1825</a></span>
<span class="normal"><a href="#line-1826">1826</a></span>
<span class="normal"><a href="#line-1827">1827</a></span>
<span class="normal"><a href="#line-1828">1828</a></span>
<span class="normal"><a href="#line-1829">1829</a></span>
<span class="normal"><a href="#line-1830">1830</a></span>
<span class="normal"><a href="#line-1831">1831</a></span>
<span class="normal"><a href="#line-1832">1832</a></span>
<span class="normal"><a href="#line-1833">1833</a></span>
<span class="normal"><a href="#line-1834">1834</a></span>
<span class="normal"><a href="#line-1835">1835</a></span>
<span class="normal"><a href="#line-1836">1836</a></span>
<span class="normal"><a href="#line-1837">1837</a></span>
<span class="normal"><a href="#line-1838">1838</a></span>
<span class="normal"><a href="#line-1839">1839</a></span>
<span class="normal"><a href="#line-1840">1840</a></span>
<span class="normal"><a href="#line-1841">1841</a></span>
<span class="normal"><a href="#line-1842">1842</a></span>
<span class="normal"><a href="#line-1843">1843</a></span>
<span class="normal"><a href="#line-1844">1844</a></span>
<span class="normal"><a href="#line-1845">1845</a></span>
<span class="normal"><a href="#line-1846">1846</a></span>
<span class="normal"><a href="#line-1847">1847</a></span>
<span class="normal"><a href="#line-1848">1848</a></span>
<span class="normal"><a href="#line-1849">1849</a></span>
<span class="normal"><a href="#line-1850">1850</a></span>
<span class="normal"><a href="#line-1851">1851</a></span>
<span class="normal"><a href="#line-1852">1852</a></span>
<span class="normal"><a href="#line-1853">1853</a></span>
<span class="normal"><a href="#line-1854">1854</a></span>
<span class="normal"><a href="#line-1855">1855</a></span>
<span class="normal"><a href="#line-1856">1856</a></span>
<span class="normal"><a href="#line-1857">1857</a></span>
<span class="normal"><a href="#line-1858">1858</a></span>
<span class="normal"><a href="#line-1859">1859</a></span>
<span class="normal"><a href="#line-1860">1860</a></span>
<span class="normal"><a href="#line-1861">1861</a></span>
<span class="normal"><a href="#line-1862">1862</a></span>
<span class="normal"><a href="#line-1863">1863</a></span>
<span class="normal"><a href="#line-1864">1864</a></span>
<span class="normal"><a href="#line-1865">1865</a></span>
<span class="normal"><a href="#line-1866">1866</a></span>
<span class="normal"><a href="#line-1867">1867</a></span>
<span class="normal"><a href="#line-1868">1868</a></span>
<span class="normal"><a href="#line-1869">1869</a></span>
<span class="normal"><a href="#line-1870">1870</a></span>
<span class="normal"><a href="#line-1871">1871</a></span>
<span class="normal"><a href="#line-1872">1872</a></span>
<span class="normal"><a href="#line-1873">1873</a></span>
<span class="normal"><a href="#line-1874">1874</a></span>
<span class="normal"><a href="#line-1875">1875</a></span>
<span class="normal"><a href="#line-1876">1876</a></span>
<span class="normal"><a href="#line-1877">1877</a></span>
<span class="normal"><a href="#line-1878">1878</a></span>
<span class="normal"><a href="#line-1879">1879</a></span>
<span class="normal"><a href="#line-1880">1880</a></span>
<span class="normal"><a href="#line-1881">1881</a></span>
<span class="normal"><a href="#line-1882">1882</a></span>
<span class="normal"><a href="#line-1883">1883</a></span>
<span class="normal"><a href="#line-1884">1884</a></span>
<span class="normal"><a href="#line-1885">1885</a></span>
<span class="normal"><a href="#line-1886">1886</a></span>
<span class="normal"><a href="#line-1887">1887</a></span>
<span class="normal"><a href="#line-1888">1888</a></span>
<span class="normal"><a href="#line-1889">1889</a></span>
<span class="normal"><a href="#line-1890">1890</a></span>
<span class="normal"><a href="#line-1891">1891</a></span>
<span class="normal"><a href="#line-1892">1892</a></span>
<span class="normal"><a href="#line-1893">1893</a></span>
<span class="normal"><a href="#line-1894">1894</a></span>
<span class="normal"><a href="#line-1895">1895</a></span>
<span class="normal"><a href="#line-1896">1896</a></span>
<span class="normal"><a href="#line-1897">1897</a></span>
<span class="normal"><a href="#line-1898">1898</a></span>
<span class="normal"><a href="#line-1899">1899</a></span>
<span class="normal"><a href="#line-1900">1900</a></span>
<span class="normal"><a href="#line-1901">1901</a></span>
<span class="normal"><a href="#line-1902">1902</a></span>
<span class="normal"><a href="#line-1903">1903</a></span>
<span class="normal"><a href="#line-1904">1904</a></span>
<span class="normal"><a href="#line-1905">1905</a></span>
<span class="normal"><a href="#line-1906">1906</a></span>
<span class="normal"><a href="#line-1907">1907</a></span>
<span class="normal"><a href="#line-1908">1908</a></span>
<span class="normal"><a href="#line-1909">1909</a></span>
<span class="normal"><a href="#line-1910">1910</a></span>
<span class="normal"><a href="#line-1911">1911</a></span>
<span class="normal"><a href="#line-1912">1912</a></span>
<span class="normal"><a href="#line-1913">1913</a></span>
<span class="normal"><a href="#line-1914">1914</a></span>
<span class="normal"><a href="#line-1915">1915</a></span>
<span class="normal"><a href="#line-1916">1916</a></span>
<span class="normal"><a href="#line-1917">1917</a></span>
<span class="normal"><a href="#line-1918">1918</a></span>
<span class="normal"><a href="#line-1919">1919</a></span>
<span class="normal"><a href="#line-1920">1920</a></span>
<span class="normal"><a href="#line-1921">1921</a></span>
<span class="normal"><a href="#line-1922">1922</a></span>
<span class="normal"><a href="#line-1923">1923</a></span>
<span class="normal"><a href="#line-1924">1924</a></span>
<span class="normal"><a href="#line-1925">1925</a></span>
<span class="normal"><a href="#line-1926">1926</a></span>
<span class="normal"><a href="#line-1927">1927</a></span>
<span class="normal"><a href="#line-1928">1928</a></span>
<span class="normal"><a href="#line-1929">1929</a></span>
<span class="normal"><a href="#line-1930">1930</a></span>
<span class="normal"><a href="#line-1931">1931</a></span>
<span class="normal"><a href="#line-1932">1932</a></span>
<span class="normal"><a href="#line-1933">1933</a></span>
<span class="normal"><a href="#line-1934">1934</a></span>
<span class="normal"><a href="#line-1935">1935</a></span>
<span class="normal"><a href="#line-1936">1936</a></span>
<span class="normal"><a href="#line-1937">1937</a></span>
<span class="normal"><a href="#line-1938">1938</a></span>
<span class="normal"><a href="#line-1939">1939</a></span>
<span class="normal"><a href="#line-1940">1940</a></span>
<span class="normal"><a href="#line-1941">1941</a></span>
<span class="normal"><a href="#line-1942">1942</a></span>
<span class="normal"><a href="#line-1943">1943</a></span>
<span class="normal"><a href="#line-1944">1944</a></span>
<span class="normal"><a href="#line-1945">1945</a></span>
<span class="normal"><a href="#line-1946">1946</a></span>
<span class="normal"><a href="#line-1947">1947</a></span>
<span class="normal"><a href="#line-1948">1948</a></span>
<span class="normal"><a href="#line-1949">1949</a></span>
<span class="normal"><a href="#line-1950">1950</a></span>
<span class="normal"><a href="#line-1951">1951</a></span>
<span class="normal"><a href="#line-1952">1952</a></span>
<span class="normal"><a href="#line-1953">1953</a></span>
<span class="normal"><a href="#line-1954">1954</a></span>
<span class="normal"><a href="#line-1955">1955</a></span>
<span class="normal"><a href="#line-1956">1956</a></span>
<span class="normal"><a href="#line-1957">1957</a></span>
<span class="normal"><a href="#line-1958">1958</a></span>
<span class="normal"><a href="#line-1959">1959</a></span>
<span class="normal"><a href="#line-1960">1960</a></span>
<span class="normal"><a href="#line-1961">1961</a></span>
<span class="normal"><a href="#line-1962">1962</a></span>
<span class="normal"><a href="#line-1963">1963</a></span>
<span class="normal"><a href="#line-1964">1964</a></span>
<span class="normal"><a href="#line-1965">1965</a></span>
<span class="normal"><a href="#line-1966">1966</a></span>
<span class="normal"><a href="#line-1967">1967</a></span>
<span class="normal"><a href="#line-1968">1968</a></span>
<span class="normal"><a href="#line-1969">1969</a></span>
<span class="normal"><a href="#line-1970">1970</a></span>
<span class="normal"><a href="#line-1971">1971</a></span>
<span class="normal"><a href="#line-1972">1972</a></span>
<span class="normal"><a href="#line-1973">1973</a></span>
<span class="normal"><a href="#line-1974">1974</a></span>
<span class="normal"><a href="#line-1975">1975</a></span>
<span class="normal"><a href="#line-1976">1976</a></span>
<span class="normal"><a href="#line-1977">1977</a></span>
<span class="normal"><a href="#line-1978">1978</a></span>
<span class="normal"><a href="#line-1979">1979</a></span>
<span class="normal"><a href="#line-1980">1980</a></span>
<span class="normal"><a href="#line-1981">1981</a></span>
<span class="normal"><a href="#line-1982">1982</a></span>
<span class="normal"><a href="#line-1983">1983</a></span>
<span class="normal"><a href="#line-1984">1984</a></span>
<span class="normal"><a href="#line-1985">1985</a></span>
<span class="normal"><a href="#line-1986">1986</a></span>
<span class="normal"><a href="#line-1987">1987</a></span>
<span class="normal"><a href="#line-1988">1988</a></span>
<span class="normal"><a href="#line-1989">1989</a></span>
<span class="normal"><a href="#line-1990">1990</a></span>
<span class="normal"><a href="#line-1991">1991</a></span>
<span class="normal"><a href="#line-1992">1992</a></span>
<span class="normal"><a href="#line-1993">1993</a></span>
<span class="normal"><a href="#line-1994">1994</a></span>
<span class="normal"><a href="#line-1995">1995</a></span>
<span class="normal"><a href="#line-1996">1996</a></span>
<span class="normal"><a href="#line-1997">1997</a></span>
<span class="normal"><a href="#line-1998">1998</a></span>
<span class="normal"><a href="#line-1999">1999</a></span>
<span class="normal"><a href="#line-2000">2000</a></span>
<span class="normal"><a href="#line-2001">2001</a></span>
<span class="normal"><a href="#line-2002">2002</a></span>
<span class="normal"><a href="#line-2003">2003</a></span>
<span class="normal"><a href="#line-2004">2004</a></span>
<span class="normal"><a href="#line-2005">2005</a></span>
<span class="normal"><a href="#line-2006">2006</a></span>
<span class="normal"><a href="#line-2007">2007</a></span>
<span class="normal"><a href="#line-2008">2008</a></span>
<span class="normal"><a href="#line-2009">2009</a></span>
<span class="normal"><a href="#line-2010">2010</a></span>
<span class="normal"><a href="#line-2011">2011</a></span>
<span class="normal"><a href="#line-2012">2012</a></span>
<span class="normal"><a href="#line-2013">2013</a></span>
<span class="normal"><a href="#line-2014">2014</a></span>
<span class="normal"><a href="#line-2015">2015</a></span>
<span class="normal"><a href="#line-2016">2016</a></span>
<span class="normal"><a href="#line-2017">2017</a></span>
<span class="normal"><a href="#line-2018">2018</a></span>
<span class="normal"><a href="#line-2019">2019</a></span>
<span class="normal"><a href="#line-2020">2020</a></span>
<span class="normal"><a href="#line-2021">2021</a></span>
<span class="normal"><a href="#line-2022">2022</a></span>
<span class="normal"><a href="#line-2023">2023</a></span>
<span class="normal"><a href="#line-2024">2024</a></span>
<span class="normal"><a href="#line-2025">2025</a></span>
<span class="normal"><a href="#line-2026">2026</a></span>
<span class="normal"><a href="#line-2027">2027</a></span>
<span class="normal"><a href="#line-2028">2028</a></span>
<span class="normal"><a href="#line-2029">2029</a></span>
<span class="normal"><a href="#line-2030">2030</a></span>
<span class="normal"><a href="#line-2031">2031</a></span>
<span class="normal"><a href="#line-2032">2032</a></span>
<span class="normal"><a href="#line-2033">2033</a></span>
<span class="normal"><a href="#line-2034">2034</a></span>
<span class="normal"><a href="#line-2035">2035</a></span>
<span class="normal"><a href="#line-2036">2036</a></span>
<span class="normal"><a href="#line-2037">2037</a></span>
<span class="normal"><a href="#line-2038">2038</a></span>
<span class="normal"><a href="#line-2039">2039</a></span>
<span class="normal"><a href="#line-2040">2040</a></span>
<span class="normal"><a href="#line-2041">2041</a></span>
<span class="normal"><a href="#line-2042">2042</a></span>
<span class="normal"><a href="#line-2043">2043</a></span>
<span class="normal"><a href="#line-2044">2044</a></span>
<span class="normal"><a href="#line-2045">2045</a></span>
<span class="normal"><a href="#line-2046">2046</a></span>
<span class="normal"><a href="#line-2047">2047</a></span>
<span class="normal"><a href="#line-2048">2048</a></span>
<span class="normal"><a href="#line-2049">2049</a></span>
<span class="normal"><a href="#line-2050">2050</a></span>
<span class="normal"><a href="#line-2051">2051</a></span>
<span class="normal"><a href="#line-2052">2052</a></span>
<span class="normal"><a href="#line-2053">2053</a></span>
<span class="normal"><a href="#line-2054">2054</a></span>
<span class="normal"><a href="#line-2055">2055</a></span>
<span class="normal"><a href="#line-2056">2056</a></span>
<span class="normal"><a href="#line-2057">2057</a></span>
<span class="normal"><a href="#line-2058">2058</a></span>
<span class="normal"><a href="#line-2059">2059</a></span>
<span class="normal"><a href="#line-2060">2060</a></span>
<span class="normal"><a href="#line-2061">2061</a></span>
<span class="normal"><a href="#line-2062">2062</a></span>
<span class="normal"><a href="#line-2063">2063</a></span>
<span class="normal"><a href="#line-2064">2064</a></span>
<span class="normal"><a href="#line-2065">2065</a></span>
<span class="normal"><a href="#line-2066">2066</a></span>
<span class="normal"><a href="#line-2067">2067</a></span>
<span class="normal"><a href="#line-2068">2068</a></span>
<span class="normal"><a href="#line-2069">2069</a></span>
<span class="normal"><a href="#line-2070">2070</a></span>
<span class="normal"><a href="#line-2071">2071</a></span>
<span class="normal"><a href="#line-2072">2072</a></span>
<span class="normal"><a href="#line-2073">2073</a></span>
<span class="normal"><a href="#line-2074">2074</a></span>
<span class="normal"><a href="#line-2075">2075</a></span>
<span class="normal"><a href="#line-2076">2076</a></span>
<span class="normal"><a href="#line-2077">2077</a></span>
<span class="normal"><a href="#line-2078">2078</a></span>
<span class="normal"><a href="#line-2079">2079</a></span>
<span class="normal"><a href="#line-2080">2080</a></span>
<span class="normal"><a href="#line-2081">2081</a></span>
<span class="normal"><a href="#line-2082">2082</a></span>
<span class="normal"><a href="#line-2083">2083</a></span>
<span class="normal"><a href="#line-2084">2084</a></span>
<span class="normal"><a href="#line-2085">2085</a></span>
<span class="normal"><a href="#line-2086">2086</a></span>
<span class="normal"><a href="#line-2087">2087</a></span>
<span class="normal"><a href="#line-2088">2088</a></span>
<span class="normal"><a href="#line-2089">2089</a></span>
<span class="normal"><a href="#line-2090">2090</a></span>
<span class="normal"><a href="#line-2091">2091</a></span>
<span class="normal"><a href="#line-2092">2092</a></span>
<span class="normal"><a href="#line-2093">2093</a></span>
<span class="normal"><a href="#line-2094">2094</a></span>
<span class="normal"><a href="#line-2095">2095</a></span>
<span class="normal"><a href="#line-2096">2096</a></span>
<span class="normal"><a href="#line-2097">2097</a></span>
<span class="normal"><a href="#line-2098">2098</a></span>
<span class="normal"><a href="#line-2099">2099</a></span>
<span class="normal"><a href="#line-2100">2100</a></span>
<span class="normal"><a href="#line-2101">2101</a></span>
<span class="normal"><a href="#line-2102">2102</a></span>
<span class="normal"><a href="#line-2103">2103</a></span>
<span class="normal"><a href="#line-2104">2104</a></span>
<span class="normal"><a href="#line-2105">2105</a></span>
<span class="normal"><a href="#line-2106">2106</a></span>
<span class="normal"><a href="#line-2107">2107</a></span>
<span class="normal"><a href="#line-2108">2108</a></span>
<span class="normal"><a href="#line-2109">2109</a></span>
<span class="normal"><a href="#line-2110">2110</a></span>
<span class="normal"><a href="#line-2111">2111</a></span>
<span class="normal"><a href="#line-2112">2112</a></span>
<span class="normal"><a href="#line-2113">2113</a></span>
<span class="normal"><a href="#line-2114">2114</a></span>
<span class="normal"><a href="#line-2115">2115</a></span>
<span class="normal"><a href="#line-2116">2116</a></span>
<span class="normal"><a href="#line-2117">2117</a></span>
<span class="normal"><a href="#line-2118">2118</a></span>
<span class="normal"><a href="#line-2119">2119</a></span>
<span class="normal"><a href="#line-2120">2120</a></span>
<span class="normal"><a href="#line-2121">2121</a></span>
<span class="normal"><a href="#line-2122">2122</a></span>
<span class="normal"><a href="#line-2123">2123</a></span>
<span class="normal"><a href="#line-2124">2124</a></span>
<span class="normal"><a href="#line-2125">2125</a></span>
<span class="normal"><a href="#line-2126">2126</a></span>
<span class="normal"><a href="#line-2127">2127</a></span>
<span class="normal"><a href="#line-2128">2128</a></span>
<span class="normal"><a href="#line-2129">2129</a></span>
<span class="normal"><a href="#line-2130">2130</a></span>
<span class="normal"><a href="#line-2131">2131</a></span>
<span class="normal"><a href="#line-2132">2132</a></span>
<span class="normal"><a href="#line-2133">2133</a></span>
<span class="normal"><a href="#line-2134">2134</a></span>
<span class="normal"><a href="#line-2135">2135</a></span>
<span class="normal"><a href="#line-2136">2136</a></span>
<span class="normal"><a href="#line-2137">2137</a></span>
<span class="normal"><a href="#line-2138">2138</a></span>
<span class="normal"><a href="#line-2139">2139</a></span>
<span class="normal"><a href="#line-2140">2140</a></span>
<span class="normal"><a href="#line-2141">2141</a></span>
<span class="normal"><a href="#line-2142">2142</a></span>
<span class="normal"><a href="#line-2143">2143</a></span>
<span class="normal"><a href="#line-2144">2144</a></span>
<span class="normal"><a href="#line-2145">2145</a></span>
<span class="normal"><a href="#line-2146">2146</a></span>
<span class="normal"><a href="#line-2147">2147</a></span>
<span class="normal"><a href="#line-2148">2148</a></span>
<span class="normal"><a href="#line-2149">2149</a></span>
<span class="normal"><a href="#line-2150">2150</a></span>
<span class="normal"><a href="#line-2151">2151</a></span>
<span class="normal"><a href="#line-2152">2152</a></span>
<span class="normal"><a href="#line-2153">2153</a></span>
<span class="normal"><a href="#line-2154">2154</a></span>
<span class="normal"><a href="#line-2155">2155</a></span>
<span class="normal"><a href="#line-2156">2156</a></span>
<span class="normal"><a href="#line-2157">2157</a></span>
<span class="normal"><a href="#line-2158">2158</a></span>
<span class="normal"><a href="#line-2159">2159</a></span>
<span class="normal"><a href="#line-2160">2160</a></span>
<span class="normal"><a href="#line-2161">2161</a></span>
<span class="normal"><a href="#line-2162">2162</a></span>
<span class="normal"><a href="#line-2163">2163</a></span>
<span class="normal"><a href="#line-2164">2164</a></span>
<span class="normal"><a href="#line-2165">2165</a></span>
<span class="normal"><a href="#line-2166">2166</a></span>
<span class="normal"><a href="#line-2167">2167</a></span>
<span class="normal"><a href="#line-2168">2168</a></span>
<span class="normal"><a href="#line-2169">2169</a></span>
<span class="normal"><a href="#line-2170">2170</a></span>
<span class="normal"><a href="#line-2171">2171</a></span>
<span class="normal"><a href="#line-2172">2172</a></span>
<span class="normal"><a href="#line-2173">2173</a></span>
<span class="normal"><a href="#line-2174">2174</a></span>
<span class="normal"><a href="#line-2175">2175</a></span>
<span class="normal"><a href="#line-2176">2176</a></span>
<span class="normal"><a href="#line-2177">2177</a></span>
<span class="normal"><a href="#line-2178">2178</a></span>
<span class="normal"><a href="#line-2179">2179</a></span>
<span class="normal"><a href="#line-2180">2180</a></span>
<span class="normal"><a href="#line-2181">2181</a></span>
<span class="normal"><a href="#line-2182">2182</a></span>
<span class="normal"><a href="#line-2183">2183</a></span>
<span class="normal"><a href="#line-2184">2184</a></span>
<span class="normal"><a href="#line-2185">2185</a></span>
<span class="normal"><a href="#line-2186">2186</a></span>
<span class="normal"><a href="#line-2187">2187</a></span>
<span class="normal"><a href="#line-2188">2188</a></span>
<span class="normal"><a href="#line-2189">2189</a></span>
<span class="normal"><a href="#line-2190">2190</a></span>
<span class="normal"><a href="#line-2191">2191</a></span>
<span class="normal"><a href="#line-2192">2192</a></span>
<span class="normal"><a href="#line-2193">2193</a></span>
<span class="normal"><a href="#line-2194">2194</a></span>
<span class="normal"><a href="#line-2195">2195</a></span>
<span class="normal"><a href="#line-2196">2196</a></span>
<span class="normal"><a href="#line-2197">2197</a></span>
<span class="normal"><a href="#line-2198">2198</a></span>
<span class="normal"><a href="#line-2199">2199</a></span>
<span class="normal"><a href="#line-2200">2200</a></span>
<span class="normal"><a href="#line-2201">2201</a></span>
<span class="normal"><a href="#line-2202">2202</a></span>
<span class="normal"><a href="#line-2203">2203</a></span>
<span class="normal"><a href="#line-2204">2204</a></span>
<span class="normal"><a href="#line-2205">2205</a></span>
<span class="normal"><a href="#line-2206">2206</a></span>
<span class="normal"><a href="#line-2207">2207</a></span>
<span class="normal"><a href="#line-2208">2208</a></span>
<span class="normal"><a href="#line-2209">2209</a></span>
<span class="normal"><a href="#line-2210">2210</a></span>
<span class="normal"><a href="#line-2211">2211</a></span>
<span class="normal"><a href="#line-2212">2212</a></span>
<span class="normal"><a href="#line-2213">2213</a></span>
<span class="normal"><a href="#line-2214">2214</a></span>
<span class="normal"><a href="#line-2215">2215</a></span>
<span class="normal"><a href="#line-2216">2216</a></span>
<span class="normal"><a href="#line-2217">2217</a></span>
<span class="normal"><a href="#line-2218">2218</a></span>
<span class="normal"><a href="#line-2219">2219</a></span>
<span class="normal"><a href="#line-2220">2220</a></span>
<span class="normal"><a href="#line-2221">2221</a></span>
<span class="normal"><a href="#line-2222">2222</a></span>
<span class="normal"><a href="#line-2223">2223</a></span>
<span class="normal"><a href="#line-2224">2224</a></span>
<span class="normal"><a href="#line-2225">2225</a></span>
<span class="normal"><a href="#line-2226">2226</a></span>
<span class="normal"><a href="#line-2227">2227</a></span>
<span class="normal"><a href="#line-2228">2228</a></span>
<span class="normal"><a href="#line-2229">2229</a></span>
<span class="normal"><a href="#line-2230">2230</a></span>
<span class="normal"><a href="#line-2231">2231</a></span>
<span class="normal"><a href="#line-2232">2232</a></span>
<span class="normal"><a href="#line-2233">2233</a></span>
<span class="normal"><a href="#line-2234">2234</a></span>
<span class="normal"><a href="#line-2235">2235</a></span>
<span class="normal"><a href="#line-2236">2236</a></span>
<span class="normal"><a href="#line-2237">2237</a></span>
<span class="normal"><a href="#line-2238">2238</a></span>
<span class="normal"><a href="#line-2239">2239</a></span>
<span class="normal"><a href="#line-2240">2240</a></span>
<span class="normal"><a href="#line-2241">2241</a></span>
<span class="normal"><a href="#line-2242">2242</a></span>
<span class="normal"><a href="#line-2243">2243</a></span>
<span class="normal"><a href="#line-2244">2244</a></span>
<span class="normal"><a href="#line-2245">2245</a></span>
<span class="normal"><a href="#line-2246">2246</a></span>
<span class="normal"><a href="#line-2247">2247</a></span>
<span class="normal"><a href="#line-2248">2248</a></span>
<span class="normal"><a href="#line-2249">2249</a></span>
<span class="normal"><a href="#line-2250">2250</a></span>
<span class="normal"><a href="#line-2251">2251</a></span>
<span class="normal"><a href="#line-2252">2252</a></span>
<span class="normal"><a href="#line-2253">2253</a></span>
<span class="normal"><a href="#line-2254">2254</a></span>
<span class="normal"><a href="#line-2255">2255</a></span>
<span class="normal"><a href="#line-2256">2256</a></span>
<span class="normal"><a href="#line-2257">2257</a></span>
<span class="normal"><a href="#line-2258">2258</a></span>
<span class="normal"><a href="#line-2259">2259</a></span>
<span class="normal"><a href="#line-2260">2260</a></span>
<span class="normal"><a href="#line-2261">2261</a></span>
<span class="normal"><a href="#line-2262">2262</a></span>
<span class="normal"><a href="#line-2263">2263</a></span>
<span class="normal"><a href="#line-2264">2264</a></span>
<span class="normal"><a href="#line-2265">2265</a></span>
<span class="normal"><a href="#line-2266">2266</a></span>
<span class="normal"><a href="#line-2267">2267</a></span>
<span class="normal"><a href="#line-2268">2268</a></span>
<span class="normal"><a href="#line-2269">2269</a></span>
<span class="normal"><a href="#line-2270">2270</a></span>
<span class="normal"><a href="#line-2271">2271</a></span>
<span class="normal"><a href="#line-2272">2272</a></span>
<span class="normal"><a href="#line-2273">2273</a></span>
<span class="normal"><a href="#line-2274">2274</a></span>
<span class="normal"><a href="#line-2275">2275</a></span>
<span class="normal"><a href="#line-2276">2276</a></span>
<span class="normal"><a href="#line-2277">2277</a></span>
<span class="normal"><a href="#line-2278">2278</a></span>
<span class="normal"><a href="#line-2279">2279</a></span>
<span class="normal"><a href="#line-2280">2280</a></span>
<span class="normal"><a href="#line-2281">2281</a></span>
<span class="normal"><a href="#line-2282">2282</a></span>
<span class="normal"><a href="#line-2283">2283</a></span>
<span class="normal"><a href="#line-2284">2284</a></span>
<span class="normal"><a href="#line-2285">2285</a></span>
<span class="normal"><a href="#line-2286">2286</a></span>
<span class="normal"><a href="#line-2287">2287</a></span>
<span class="normal"><a href="#line-2288">2288</a></span>
<span class="normal"><a href="#line-2289">2289</a></span>
<span class="normal"><a href="#line-2290">2290</a></span>
<span class="normal"><a href="#line-2291">2291</a></span>
<span class="normal"><a href="#line-2292">2292</a></span>
<span class="normal"><a href="#line-2293">2293</a></span>
<span class="normal"><a href="#line-2294">2294</a></span>
<span class="normal"><a href="#line-2295">2295</a></span>
<span class="normal"><a href="#line-2296">2296</a></span>
<span class="normal"><a href="#line-2297">2297</a></span>
<span class="normal"><a href="#line-2298">2298</a></span>
<span class="normal"><a href="#line-2299">2299</a></span>
<span class="normal"><a href="#line-2300">2300</a></span>
<span class="normal"><a href="#line-2301">2301</a></span>
<span class="normal"><a href="#line-2302">2302</a></span>
<span class="normal"><a href="#line-2303">2303</a></span>
<span class="normal"><a href="#line-2304">2304</a></span>
<span class="normal"><a href="#line-2305">2305</a></span>
<span class="normal"><a href="#line-2306">2306</a></span>
<span class="normal"><a href="#line-2307">2307</a></span>
<span class="normal"><a href="#line-2308">2308</a></span>
<span class="normal"><a href="#line-2309">2309</a></span>
<span class="normal"><a href="#line-2310">2310</a></span>
<span class="normal"><a href="#line-2311">2311</a></span>
<span class="normal"><a href="#line-2312">2312</a></span>
<span class="normal"><a href="#line-2313">2313</a></span>
<span class="normal"><a href="#line-2314">2314</a></span>
<span class="normal"><a href="#line-2315">2315</a></span>
<span class="normal"><a href="#line-2316">2316</a></span>
<span class="normal"><a href="#line-2317">2317</a></span>
<span class="normal"><a href="#line-2318">2318</a></span>
<span class="normal"><a href="#line-2319">2319</a></span>
<span class="normal"><a href="#line-2320">2320</a></span>
<span class="normal"><a href="#line-2321">2321</a></span>
<span class="normal"><a href="#line-2322">2322</a></span>
<span class="normal"><a href="#line-2323">2323</a></span>
<span class="normal"><a href="#line-2324">2324</a></span>
<span class="normal"><a href="#line-2325">2325</a></span>
<span class="normal"><a href="#line-2326">2326</a></span>
<span class="normal"><a href="#line-2327">2327</a></span>
<span class="normal"><a href="#line-2328">2328</a></span>
<span class="normal"><a href="#line-2329">2329</a></span>
<span class="normal"><a href="#line-2330">2330</a></span>
<span class="normal"><a href="#line-2331">2331</a></span>
<span class="normal"><a href="#line-2332">2332</a></span>
<span class="normal"><a href="#line-2333">2333</a></span>
<span class="normal"><a href="#line-2334">2334</a></span>
<span class="normal"><a href="#line-2335">2335</a></span>
<span class="normal"><a href="#line-2336">2336</a></span>
<span class="normal"><a href="#line-2337">2337</a></span>
<span class="normal"><a href="#line-2338">2338</a></span>
<span class="normal"><a href="#line-2339">2339</a></span>
<span class="normal"><a href="#line-2340">2340</a></span>
<span class="normal"><a href="#line-2341">2341</a></span>
<span class="normal"><a href="#line-2342">2342</a></span>
<span class="normal"><a href="#line-2343">2343</a></span>
<span class="normal"><a href="#line-2344">2344</a></span>
<span class="normal"><a href="#line-2345">2345</a></span>
<span class="normal"><a href="#line-2346">2346</a></span>
<span class="normal"><a href="#line-2347">2347</a></span>
<span class="normal"><a href="#line-2348">2348</a></span>
<span class="normal"><a href="#line-2349">2349</a></span>
<span class="normal"><a href="#line-2350">2350</a></span>
<span class="normal"><a href="#line-2351">2351</a></span>
<span class="normal"><a href="#line-2352">2352</a></span>
<span class="normal"><a href="#line-2353">2353</a></span>
<span class="normal"><a href="#line-2354">2354</a></span>
<span class="normal"><a href="#line-2355">2355</a></span>
<span class="normal"><a href="#line-2356">2356</a></span>
<span class="normal"><a href="#line-2357">2357</a></span>
<span class="normal"><a href="#line-2358">2358</a></span>
<span class="normal"><a href="#line-2359">2359</a></span>
<span class="normal"><a href="#line-2360">2360</a></span>
<span class="normal"><a href="#line-2361">2361</a></span>
<span class="normal"><a href="#line-2362">2362</a></span>
<span class="normal"><a href="#line-2363">2363</a></span>
<span class="normal"><a href="#line-2364">2364</a></span>
<span class="normal"><a href="#line-2365">2365</a></span>
<span class="normal"><a href="#line-2366">2366</a></span>
<span class="normal"><a href="#line-2367">2367</a></span>
<span class="normal"><a href="#line-2368">2368</a></span>
<span class="normal"><a href="#line-2369">2369</a></span>
<span class="normal"><a href="#line-2370">2370</a></span>
<span class="normal"><a href="#line-2371">2371</a></span>
<span class="normal"><a href="#line-2372">2372</a></span>
<span class="normal"><a href="#line-2373">2373</a></span>
<span class="normal"><a href="#line-2374">2374</a></span>
<span class="normal"><a href="#line-2375">2375</a></span>
<span class="normal"><a href="#line-2376">2376</a></span>
<span class="normal"><a href="#line-2377">2377</a></span>
<span class="normal"><a href="#line-2378">2378</a></span>
<span class="normal"><a href="#line-2379">2379</a></span>
<span class="normal"><a href="#line-2380">2380</a></span>
<span class="normal"><a href="#line-2381">2381</a></span>
<span class="normal"><a href="#line-2382">2382</a></span>
<span class="normal"><a href="#line-2383">2383</a></span>
<span class="normal"><a href="#line-2384">2384</a></span>
<span class="normal"><a href="#line-2385">2385</a></span>
<span class="normal"><a href="#line-2386">2386</a></span>
<span class="normal"><a href="#line-2387">2387</a></span>
<span class="normal"><a href="#line-2388">2388</a></span>
<span class="normal"><a href="#line-2389">2389</a></span>
<span class="normal"><a href="#line-2390">2390</a></span>
<span class="normal"><a href="#line-2391">2391</a></span>
<span class="normal"><a href="#line-2392">2392</a></span>
<span class="normal"><a href="#line-2393">2393</a></span>
<span class="normal"><a href="#line-2394">2394</a></span>
<span class="normal"><a href="#line-2395">2395</a></span>
<span class="normal"><a href="#line-2396">2396</a></span>
<span class="normal"><a href="#line-2397">2397</a></span>
<span class="normal"><a href="#line-2398">2398</a></span>
<span class="normal"><a href="#line-2399">2399</a></span>
<span class="normal"><a href="#line-2400">2400</a></span>
<span class="normal"><a href="#line-2401">2401</a></span>
<span class="normal"><a href="#line-2402">2402</a></span>
<span class="normal"><a href="#line-2403">2403</a></span>
<span class="normal"><a href="#line-2404">2404</a></span>
<span class="normal"><a href="#line-2405">2405</a></span>
<span class="normal"><a href="#line-2406">2406</a></span>
<span class="normal"><a href="#line-2407">2407</a></span>
<span class="normal"><a href="#line-2408">2408</a></span>
<span class="normal"><a href="#line-2409">2409</a></span>
<span class="normal"><a href="#line-2410">2410</a></span>
<span class="normal"><a href="#line-2411">2411</a></span>
<span class="normal"><a href="#line-2412">2412</a></span>
<span class="normal"><a href="#line-2413">2413</a></span>
<span class="normal"><a href="#line-2414">2414</a></span>
<span class="normal"><a href="#line-2415">2415</a></span>
<span class="normal"><a href="#line-2416">2416</a></span>
<span class="normal"><a href="#line-2417">2417</a></span>
<span class="normal"><a href="#line-2418">2418</a></span>
<span class="normal"><a href="#line-2419">2419</a></span>
<span class="normal"><a href="#line-2420">2420</a></span>
<span class="normal"><a href="#line-2421">2421</a></span>
<span class="normal"><a href="#line-2422">2422</a></span>
<span class="normal"><a href="#line-2423">2423</a></span>
<span class="normal"><a href="#line-2424">2424</a></span>
<span class="normal"><a href="#line-2425">2425</a></span>
<span class="normal"><a href="#line-2426">2426</a></span>
<span class="normal"><a href="#line-2427">2427</a></span>
<span class="normal"><a href="#line-2428">2428</a></span>
<span class="normal"><a href="#line-2429">2429</a></span>
<span class="normal"><a href="#line-2430">2430</a></span>
<span class="normal"><a href="#line-2431">2431</a></span>
<span class="normal"><a href="#line-2432">2432</a></span>
<span class="normal"><a href="#line-2433">2433</a></span>
<span class="normal"><a href="#line-2434">2434</a></span>
<span class="normal"><a href="#line-2435">2435</a></span>
<span class="normal"><a href="#line-2436">2436</a></span>
<span class="normal"><a href="#line-2437">2437</a></span>
<span class="normal"><a href="#line-2438">2438</a></span>
<span class="normal"><a href="#line-2439">2439</a></span>
<span class="normal"><a href="#line-2440">2440</a></span>
<span class="normal"><a href="#line-2441">2441</a></span>
<span class="normal"><a href="#line-2442">2442</a></span>
<span class="normal"><a href="#line-2443">2443</a></span>
<span class="normal"><a href="#line-2444">2444</a></span>
<span class="normal"><a href="#line-2445">2445</a></span>
<span class="normal"><a href="#line-2446">2446</a></span>
<span class="normal"><a href="#line-2447">2447</a></span>
<span class="normal"><a href="#line-2448">2448</a></span>
<span class="normal"><a href="#line-2449">2449</a></span>
<span class="normal"><a href="#line-2450">2450</a></span>
<span class="normal"><a href="#line-2451">2451</a></span>
<span class="normal"><a href="#line-2452">2452</a></span>
<span class="normal"><a href="#line-2453">2453</a></span>
<span class="normal"><a href="#line-2454">2454</a></span>
<span class="normal"><a href="#line-2455">2455</a></span>
<span class="normal"><a href="#line-2456">2456</a></span>
<span class="normal"><a href="#line-2457">2457</a></span>
<span class="normal"><a href="#line-2458">2458</a></span>
<span class="normal"><a href="#line-2459">2459</a></span>
<span class="normal"><a href="#line-2460">2460</a></span>
<span class="normal"><a href="#line-2461">2461</a></span>
<span class="normal"><a href="#line-2462">2462</a></span>
<span class="normal"><a href="#line-2463">2463</a></span>
<span class="normal"><a href="#line-2464">2464</a></span>
<span class="normal"><a href="#line-2465">2465</a></span>
<span class="normal"><a href="#line-2466">2466</a></span>
<span class="normal"><a href="#line-2467">2467</a></span>
<span class="normal"><a href="#line-2468">2468</a></span>
<span class="normal"><a href="#line-2469">2469</a></span>
<span class="normal"><a href="#line-2470">2470</a></span>
<span class="normal"><a href="#line-2471">2471</a></span>
<span class="normal"><a href="#line-2472">2472</a></span>
<span class="normal"><a href="#line-2473">2473</a></span>
<span class="normal"><a href="#line-2474">2474</a></span>
<span class="normal"><a href="#line-2475">2475</a></span>
<span class="normal"><a href="#line-2476">2476</a></span>
<span class="normal"><a href="#line-2477">2477</a></span>
<span class="normal"><a href="#line-2478">2478</a></span>
<span class="normal"><a href="#line-2479">2479</a></span>
<span class="normal"><a href="#line-2480">2480</a></span>
<span class="normal"><a href="#line-2481">2481</a></span>
<span class="normal"><a href="#line-2482">2482</a></span>
<span class="normal"><a href="#line-2483">2483</a></span>
<span class="normal"><a href="#line-2484">2484</a></span>
<span class="normal"><a href="#line-2485">2485</a></span>
<span class="normal"><a href="#line-2486">2486</a></span>
<span class="normal"><a href="#line-2487">2487</a></span>
<span class="normal"><a href="#line-2488">2488</a></span>
<span class="normal"><a href="#line-2489">2489</a></span>
<span class="normal"><a href="#line-2490">2490</a></span>
<span class="normal"><a href="#line-2491">2491</a></span>
<span class="normal"><a href="#line-2492">2492</a></span>
<span class="normal"><a href="#line-2493">2493</a></span>
<span class="normal"><a href="#line-2494">2494</a></span>
<span class="normal"><a href="#line-2495">2495</a></span>
<span class="normal"><a href="#line-2496">2496</a></span>
<span class="normal"><a href="#line-2497">2497</a></span>
<span class="normal"><a href="#line-2498">2498</a></span>
<span class="normal"><a href="#line-2499">2499</a></span>
<span class="normal"><a href="#line-2500">2500</a></span>
<span class="normal"><a href="#line-2501">2501</a></span>
<span class="normal"><a href="#line-2502">2502</a></span>
<span class="normal"><a href="#line-2503">2503</a></span>
<span class="normal"><a href="#line-2504">2504</a></span>
<span class="normal"><a href="#line-2505">2505</a></span>
<span class="normal"><a href="#line-2506">2506</a></span>
<span class="normal"><a href="#line-2507">2507</a></span>
<span class="normal"><a href="#line-2508">2508</a></span>
<span class="normal"><a href="#line-2509">2509</a></span>
<span class="normal"><a href="#line-2510">2510</a></span>
<span class="normal"><a href="#line-2511">2511</a></span>
<span class="normal"><a href="#line-2512">2512</a></span>
<span class="normal"><a href="#line-2513">2513</a></span>
<span class="normal"><a href="#line-2514">2514</a></span>
<span class="normal"><a href="#line-2515">2515</a></span>
<span class="normal"><a href="#line-2516">2516</a></span>
<span class="normal"><a href="#line-2517">2517</a></span>
<span class="normal"><a href="#line-2518">2518</a></span>
<span class="normal"><a href="#line-2519">2519</a></span>
<span class="normal"><a href="#line-2520">2520</a></span>
<span class="normal"><a href="#line-2521">2521</a></span>
<span class="normal"><a href="#line-2522">2522</a></span>
<span class="normal"><a href="#line-2523">2523</a></span>
<span class="normal"><a href="#line-2524">2524</a></span>
<span class="normal"><a href="#line-2525">2525</a></span>
<span class="normal"><a href="#line-2526">2526</a></span>
<span class="normal"><a href="#line-2527">2527</a></span>
<span class="normal"><a href="#line-2528">2528</a></span>
<span class="normal"><a href="#line-2529">2529</a></span>
<span class="normal"><a href="#line-2530">2530</a></span>
<span class="normal"><a href="#line-2531">2531</a></span>
<span class="normal"><a href="#line-2532">2532</a></span>
<span class="normal"><a href="#line-2533">2533</a></span>
<span class="normal"><a href="#line-2534">2534</a></span>
<span class="normal"><a href="#line-2535">2535</a></span>
<span class="normal"><a href="#line-2536">2536</a></span>
<span class="normal"><a href="#line-2537">2537</a></span>
<span class="normal"><a href="#line-2538">2538</a></span>
<span class="normal"><a href="#line-2539">2539</a></span>
<span class="normal"><a href="#line-2540">2540</a></span>
<span class="normal"><a href="#line-2541">2541</a></span>
<span class="normal"><a href="#line-2542">2542</a></span>
<span class="normal"><a href="#line-2543">2543</a></span>
<span class="normal"><a href="#line-2544">2544</a></span>
<span class="normal"><a href="#line-2545">2545</a></span>
<span class="normal"><a href="#line-2546">2546</a></span>
<span class="normal"><a href="#line-2547">2547</a></span>
<span class="normal"><a href="#line-2548">2548</a></span>
<span class="normal"><a href="#line-2549">2549</a></span>
<span class="normal"><a href="#line-2550">2550</a></span>
<span class="normal"><a href="#line-2551">2551</a></span>
<span class="normal"><a href="#line-2552">2552</a></span>
<span class="normal"><a href="#line-2553">2553</a></span>
<span class="normal"><a href="#line-2554">2554</a></span>
<span class="normal"><a href="#line-2555">2555</a></span>
<span class="normal"><a href="#line-2556">2556</a></span>
<span class="normal"><a href="#line-2557">2557</a></span>
<span class="normal"><a href="#line-2558">2558</a></span>
<span class="normal"><a href="#line-2559">2559</a></span>
<span class="normal"><a href="#line-2560">2560</a></span>
<span class="normal"><a href="#line-2561">2561</a></span>
<span class="normal"><a href="#line-2562">2562</a></span>
<span class="normal"><a href="#line-2563">2563</a></span>
<span class="normal"><a href="#line-2564">2564</a></span>
<span class="normal"><a href="#line-2565">2565</a></span>
<span class="normal"><a href="#line-2566">2566</a></span>
<span class="normal"><a href="#line-2567">2567</a></span>
<span class="normal"><a href="#line-2568">2568</a></span>
<span class="normal"><a href="#line-2569">2569</a></span>
<span class="normal"><a href="#line-2570">2570</a></span>
<span class="normal"><a href="#line-2571">2571</a></span>
<span class="normal"><a href="#line-2572">2572</a></span>
<span class="normal"><a href="#line-2573">2573</a></span>
<span class="normal"><a href="#line-2574">2574</a></span>
<span class="normal"><a href="#line-2575">2575</a></span>
<span class="normal"><a href="#line-2576">2576</a></span>
<span class="normal"><a href="#line-2577">2577</a></span>
<span class="normal"><a href="#line-2578">2578</a></span>
<span class="normal"><a href="#line-2579">2579</a></span>
<span class="normal"><a href="#line-2580">2580</a></span>
<span class="normal"><a href="#line-2581">2581</a></span>
<span class="normal"><a href="#line-2582">2582</a></span>
<span class="normal"><a href="#line-2583">2583</a></span>
<span class="normal"><a href="#line-2584">2584</a></span>
<span class="normal"><a href="#line-2585">2585</a></span>
<span class="normal"><a href="#line-2586">2586</a></span>
<span class="normal"><a href="#line-2587">2587</a></span>
<span class="normal"><a href="#line-2588">2588</a></span>
<span class="normal"><a href="#line-2589">2589</a></span>
<span class="normal"><a href="#line-2590">2590</a></span>
<span class="normal"><a href="#line-2591">2591</a></span>
<span class="normal"><a href="#line-2592">2592</a></span>
<span class="normal"><a href="#line-2593">2593</a></span>
<span class="normal"><a href="#line-2594">2594</a></span>
<span class="normal"><a href="#line-2595">2595</a></span>
<span class="normal"><a href="#line-2596">2596</a></span>
<span class="normal"><a href="#line-2597">2597</a></span>
<span class="normal"><a href="#line-2598">2598</a></span>
<span class="normal"><a href="#line-2599">2599</a></span>
<span class="normal"><a href="#line-2600">2600</a></span>
<span class="normal"><a href="#line-2601">2601</a></span>
<span class="normal"><a href="#line-2602">2602</a></span>
<span class="normal"><a href="#line-2603">2603</a></span>
<span class="normal"><a href="#line-2604">2604</a></span>
<span class="normal"><a href="#line-2605">2605</a></span>
<span class="normal"><a href="#line-2606">2606</a></span>
<span class="normal"><a href="#line-2607">2607</a></span>
<span class="normal"><a href="#line-2608">2608</a></span>
<span class="normal"><a href="#line-2609">2609</a></span>
<span class="normal"><a href="#line-2610">2610</a></span>
<span class="normal"><a href="#line-2611">2611</a></span>
<span class="normal"><a href="#line-2612">2612</a></span>
<span class="normal"><a href="#line-2613">2613</a></span>
<span class="normal"><a href="#line-2614">2614</a></span>
<span class="normal"><a href="#line-2615">2615</a></span>
<span class="normal"><a href="#line-2616">2616</a></span>
<span class="normal"><a href="#line-2617">2617</a></span>
<span class="normal"><a href="#line-2618">2618</a></span>
<span class="normal"><a href="#line-2619">2619</a></span>
<span class="normal"><a href="#line-2620">2620</a></span>
<span class="normal"><a href="#line-2621">2621</a></span>
<span class="normal"><a href="#line-2622">2622</a></span>
<span class="normal"><a href="#line-2623">2623</a></span>
<span class="normal"><a href="#line-2624">2624</a></span>
<span class="normal"><a href="#line-2625">2625</a></span>
<span class="normal"><a href="#line-2626">2626</a></span>
<span class="normal"><a href="#line-2627">2627</a></span>
<span class="normal"><a href="#line-2628">2628</a></span>
<span class="normal"><a href="#line-2629">2629</a></span>
<span class="normal"><a href="#line-2630">2630</a></span>
<span class="normal"><a href="#line-2631">2631</a></span>
<span class="normal"><a href="#line-2632">2632</a></span>
<span class="normal"><a href="#line-2633">2633</a></span>
<span class="normal"><a href="#line-2634">2634</a></span>
<span class="normal"><a href="#line-2635">2635</a></span>
<span class="normal"><a href="#line-2636">2636</a></span>
<span class="normal"><a href="#line-2637">2637</a></span>
<span class="normal"><a href="#line-2638">2638</a></span>
<span class="normal"><a href="#line-2639">2639</a></span>
<span class="normal"><a href="#line-2640">2640</a></span>
<span class="normal"><a href="#line-2641">2641</a></span>
<span class="normal"><a href="#line-2642">2642</a></span>
<span class="normal"><a href="#line-2643">2643</a></span>
<span class="normal"><a href="#line-2644">2644</a></span>
<span class="normal"><a href="#line-2645">2645</a></span>
<span class="normal"><a href="#line-2646">2646</a></span>
<span class="normal"><a href="#line-2647">2647</a></span>
<span class="normal"><a href="#line-2648">2648</a></span>
<span class="normal"><a href="#line-2649">2649</a></span>
<span class="normal"><a href="#line-2650">2650</a></span>
<span class="normal"><a href="#line-2651">2651</a></span>
<span class="normal"><a href="#line-2652">2652</a></span>
<span class="normal"><a href="#line-2653">2653</a></span>
<span class="normal"><a href="#line-2654">2654</a></span>
<span class="normal"><a href="#line-2655">2655</a></span>
<span class="normal"><a href="#line-2656">2656</a></span>
<span class="normal"><a href="#line-2657">2657</a></span>
<span class="normal"><a href="#line-2658">2658</a></span>
<span class="normal"><a href="#line-2659">2659</a></span>
<span class="normal"><a href="#line-2660">2660</a></span>
<span class="normal"><a href="#line-2661">2661</a></span>
<span class="normal"><a href="#line-2662">2662</a></span>
<span class="normal"><a href="#line-2663">2663</a></span>
<span class="normal"><a href="#line-2664">2664</a></span>
<span class="normal"><a href="#line-2665">2665</a></span>
<span class="normal"><a href="#line-2666">2666</a></span>
<span class="normal"><a href="#line-2667">2667</a></span>
<span class="normal"><a href="#line-2668">2668</a></span>
<span class="normal"><a href="#line-2669">2669</a></span>
<span class="normal"><a href="#line-2670">2670</a></span>
<span class="normal"><a href="#line-2671">2671</a></span>
<span class="normal"><a href="#line-2672">2672</a></span>
<span class="normal"><a href="#line-2673">2673</a></span>
<span class="normal"><a href="#line-2674">2674</a></span>
<span class="normal"><a href="#line-2675">2675</a></span>
<span class="normal"><a href="#line-2676">2676</a></span>
<span class="normal"><a href="#line-2677">2677</a></span>
<span class="normal"><a href="#line-2678">2678</a></span>
<span class="normal"><a href="#line-2679">2679</a></span>
<span class="normal"><a href="#line-2680">2680</a></span>
<span class="normal"><a href="#line-2681">2681</a></span>
<span class="normal"><a href="#line-2682">2682</a></span>
<span class="normal"><a href="#line-2683">2683</a></span>
<span class="normal"><a href="#line-2684">2684</a></span>
<span class="normal"><a href="#line-2685">2685</a></span>
<span class="normal"><a href="#line-2686">2686</a></span>
<span class="normal"><a href="#line-2687">2687</a></span>
<span class="normal"><a href="#line-2688">2688</a></span>
<span class="normal"><a href="#line-2689">2689</a></span>
<span class="normal"><a href="#line-2690">2690</a></span>
<span class="normal"><a href="#line-2691">2691</a></span>
<span class="normal"><a href="#line-2692">2692</a></span>
<span class="normal"><a href="#line-2693">2693</a></span>
<span class="normal"><a href="#line-2694">2694</a></span>
<span class="normal"><a href="#line-2695">2695</a></span>
<span class="normal"><a href="#line-2696">2696</a></span>
<span class="normal"><a href="#line-2697">2697</a></span>
<span class="normal"><a href="#line-2698">2698</a></span>
<span class="normal"><a href="#line-2699">2699</a></span>
<span class="normal"><a href="#line-2700">2700</a></span>
<span class="normal"><a href="#line-2701">2701</a></span>
<span class="normal"><a href="#line-2702">2702</a></span>
<span class="normal"><a href="#line-2703">2703</a></span>
<span class="normal"><a href="#line-2704">2704</a></span>
<span class="normal"><a href="#line-2705">2705</a></span>
<span class="normal"><a href="#line-2706">2706</a></span>
<span class="normal"><a href="#line-2707">2707</a></span>
<span class="normal"><a href="#line-2708">2708</a></span>
<span class="normal"><a href="#line-2709">2709</a></span>
<span class="normal"><a href="#line-2710">2710</a></span>
<span class="normal"><a href="#line-2711">2711</a></span>
<span class="normal"><a href="#line-2712">2712</a></span>
<span class="normal"><a href="#line-2713">2713</a></span>
<span class="normal"><a href="#line-2714">2714</a></span>
<span class="normal"><a href="#line-2715">2715</a></span>
<span class="normal"><a href="#line-2716">2716</a></span>
<span class="normal"><a href="#line-2717">2717</a></span>
<span class="normal"><a href="#line-2718">2718</a></span>
<span class="normal"><a href="#line-2719">2719</a></span>
<span class="normal"><a href="#line-2720">2720</a></span>
<span class="normal"><a href="#line-2721">2721</a></span>
<span class="normal"><a href="#line-2722">2722</a></span>
<span class="normal"><a href="#line-2723">2723</a></span>
<span class="normal"><a href="#line-2724">2724</a></span>
<span class="normal"><a href="#line-2725">2725</a></span>
<span class="normal"><a href="#line-2726">2726</a></span>
<span class="normal"><a href="#line-2727">2727</a></span>
<span class="normal"><a href="#line-2728">2728</a></span>
<span class="normal"><a href="#line-2729">2729</a></span>
<span class="normal"><a href="#line-2730">2730</a></span>
<span class="normal"><a href="#line-2731">2731</a></span>
<span class="normal"><a href="#line-2732">2732</a></span>
<span class="normal"><a href="#line-2733">2733</a></span>
<span class="normal"><a href="#line-2734">2734</a></span>
<span class="normal"><a href="#line-2735">2735</a></span>
<span class="normal"><a href="#line-2736">2736</a></span>
<span class="normal"><a href="#line-2737">2737</a></span>
<span class="normal"><a href="#line-2738">2738</a></span>
<span class="normal"><a href="#line-2739">2739</a></span>
<span class="normal"><a href="#line-2740">2740</a></span>
<span class="normal"><a href="#line-2741">2741</a></span>
<span class="normal"><a href="#line-2742">2742</a></span>
<span class="normal"><a href="#line-2743">2743</a></span>
<span class="normal"><a href="#line-2744">2744</a></span>
<span class="normal"><a href="#line-2745">2745</a></span>
<span class="normal"><a href="#line-2746">2746</a></span>
<span class="normal"><a href="#line-2747">2747</a></span>
<span class="normal"><a href="#line-2748">2748</a></span>
<span class="normal"><a href="#line-2749">2749</a></span>
<span class="normal"><a href="#line-2750">2750</a></span>
<span class="normal"><a href="#line-2751">2751</a></span>
<span class="normal"><a href="#line-2752">2752</a></span>
<span class="normal"><a href="#line-2753">2753</a></span>
<span class="normal"><a href="#line-2754">2754</a></span>
<span class="normal"><a href="#line-2755">2755</a></span>
<span class="normal"><a href="#line-2756">2756</a></span>
<span class="normal"><a href="#line-2757">2757</a></span>
<span class="normal"><a href="#line-2758">2758</a></span>
<span class="normal"><a href="#line-2759">2759</a></span>
<span class="normal"><a href="#line-2760">2760</a></span>
<span class="normal"><a href="#line-2761">2761</a></span>
<span class="normal"><a href="#line-2762">2762</a></span>
<span class="normal"><a href="#line-2763">2763</a></span>
<span class="normal"><a href="#line-2764">2764</a></span>
<span class="normal"><a href="#line-2765">2765</a></span>
<span class="normal"><a href="#line-2766">2766</a></span>
<span class="normal"><a href="#line-2767">2767</a></span>
<span class="normal"><a href="#line-2768">2768</a></span>
<span class="normal"><a href="#line-2769">2769</a></span>
<span class="normal"><a href="#line-2770">2770</a></span>
<span class="normal"><a href="#line-2771">2771</a></span>
<span class="normal"><a href="#line-2772">2772</a></span>
<span class="normal"><a href="#line-2773">2773</a></span>
<span class="normal"><a href="#line-2774">2774</a></span>
<span class="normal"><a href="#line-2775">2775</a></span>
<span class="normal"><a href="#line-2776">2776</a></span>
<span class="normal"><a href="#line-2777">2777</a></span>
<span class="normal"><a href="#line-2778">2778</a></span>
<span class="normal"><a href="#line-2779">2779</a></span>
<span class="normal"><a href="#line-2780">2780</a></span>
<span class="normal"><a href="#line-2781">2781</a></span>
<span class="normal"><a href="#line-2782">2782</a></span>
<span class="normal"><a href="#line-2783">2783</a></span>
<span class="normal"><a href="#line-2784">2784</a></span>
<span class="normal"><a href="#line-2785">2785</a></span>
<span class="normal"><a href="#line-2786">2786</a></span>
<span class="normal"><a href="#line-2787">2787</a></span>
<span class="normal"><a href="#line-2788">2788</a></span>
<span class="normal"><a href="#line-2789">2789</a></span>
<span class="normal"><a href="#line-2790">2790</a></span>
<span class="normal"><a href="#line-2791">2791</a></span>
<span class="normal"><a href="#line-2792">2792</a></span>
<span class="normal"><a href="#line-2793">2793</a></span>
<span class="normal"><a href="#line-2794">2794</a></span>
<span class="normal"><a href="#line-2795">2795</a></span>
<span class="normal"><a href="#line-2796">2796</a></span>
<span class="normal"><a href="#line-2797">2797</a></span>
<span class="normal"><a href="#line-2798">2798</a></span>
<span class="normal"><a href="#line-2799">2799</a></span>
<span class="normal"><a href="#line-2800">2800</a></span>
<span class="normal"><a href="#line-2801">2801</a></span>
<span class="normal"><a href="#line-2802">2802</a></span>
<span class="normal"><a href="#line-2803">2803</a></span>
<span class="normal"><a href="#line-2804">2804</a></span>
<span class="normal"><a href="#line-2805">2805</a></span>
<span class="normal"><a href="#line-2806">2806</a></span>
<span class="normal"><a href="#line-2807">2807</a></span>
<span class="normal"><a href="#line-2808">2808</a></span>
<span class="normal"><a href="#line-2809">2809</a></span>
<span class="normal"><a href="#line-2810">2810</a></span>
<span class="normal"><a href="#line-2811">2811</a></span>
<span class="normal"><a href="#line-2812">2812</a></span>
<span class="normal"><a href="#line-2813">2813</a></span>
<span class="normal"><a href="#line-2814">2814</a></span>
<span class="normal"><a href="#line-2815">2815</a></span>
<span class="normal"><a href="#line-2816">2816</a></span>
<span class="normal"><a href="#line-2817">2817</a></span>
<span class="normal"><a href="#line-2818">2818</a></span>
<span class="normal"><a href="#line-2819">2819</a></span>
<span class="normal"><a href="#line-2820">2820</a></span>
<span class="normal"><a href="#line-2821">2821</a></span>
<span class="normal"><a href="#line-2822">2822</a></span>
<span class="normal"><a href="#line-2823">2823</a></span>
<span class="normal"><a href="#line-2824">2824</a></span>
<span class="normal"><a href="#line-2825">2825</a></span>
<span class="normal"><a href="#line-2826">2826</a></span>
<span class="normal"><a href="#line-2827">2827</a></span>
<span class="normal"><a href="#line-2828">2828</a></span>
<span class="normal"><a href="#line-2829">2829</a></span>
<span class="normal"><a href="#line-2830">2830</a></span>
<span class="normal"><a href="#line-2831">2831</a></span>
<span class="normal"><a href="#line-2832">2832</a></span>
<span class="normal"><a href="#line-2833">2833</a></span>
<span class="normal"><a href="#line-2834">2834</a></span>
<span class="normal"><a href="#line-2835">2835</a></span>
<span class="normal"><a href="#line-2836">2836</a></span>
<span class="normal"><a href="#line-2837">2837</a></span>
<span class="normal"><a href="#line-2838">2838</a></span>
<span class="normal"><a href="#line-2839">2839</a></span>
<span class="normal"><a href="#line-2840">2840</a></span>
<span class="normal"><a href="#line-2841">2841</a></span>
<span class="normal"><a href="#line-2842">2842</a></span>
<span class="normal"><a href="#line-2843">2843</a></span>
<span class="normal"><a href="#line-2844">2844</a></span>
<span class="normal"><a href="#line-2845">2845</a></span>
<span class="normal"><a href="#line-2846">2846</a></span>
<span class="normal"><a href="#line-2847">2847</a></span>
<span class="normal"><a href="#line-2848">2848</a></span>
<span class="normal"><a href="#line-2849">2849</a></span>
<span class="normal"><a href="#line-2850">2850</a></span>
<span class="normal"><a href="#line-2851">2851</a></span>
<span class="normal"><a href="#line-2852">2852</a></span>
<span class="normal"><a href="#line-2853">2853</a></span>
<span class="normal"><a href="#line-2854">2854</a></span>
<span class="normal"><a href="#line-2855">2855</a></span>
<span class="normal"><a href="#line-2856">2856</a></span>
<span class="normal"><a href="#line-2857">2857</a></span>
<span class="normal"><a href="#line-2858">2858</a></span>
<span class="normal"><a href="#line-2859">2859</a></span>
<span class="normal"><a href="#line-2860">2860</a></span>
<span class="normal"><a href="#line-2861">2861</a></span>
<span class="normal"><a href="#line-2862">2862</a></span>
<span class="normal"><a href="#line-2863">2863</a></span>
<span class="normal"><a href="#line-2864">2864</a></span>
<span class="normal"><a href="#line-2865">2865</a></span>
<span class="normal"><a href="#line-2866">2866</a></span>
<span class="normal"><a href="#line-2867">2867</a></span>
<span class="normal"><a href="#line-2868">2868</a></span>
<span class="normal"><a href="#line-2869">2869</a></span>
<span class="normal"><a href="#line-2870">2870</a></span>
<span class="normal"><a href="#line-2871">2871</a></span>
<span class="normal"><a href="#line-2872">2872</a></span>
<span class="normal"><a href="#line-2873">2873</a></span>
<span class="normal"><a href="#line-2874">2874</a></span>
<span class="normal"><a href="#line-2875">2875</a></span>
<span class="normal"><a href="#line-2876">2876</a></span>
<span class="normal"><a href="#line-2877">2877</a></span>
<span class="normal"><a href="#line-2878">2878</a></span>
<span class="normal"><a href="#line-2879">2879</a></span>
<span class="normal"><a href="#line-2880">2880</a></span>
<span class="normal"><a href="#line-2881">2881</a></span>
<span class="normal"><a href="#line-2882">2882</a></span>
<span class="normal"><a href="#line-2883">2883</a></span>
<span class="normal"><a href="#line-2884">2884</a></span>
<span class="normal"><a href="#line-2885">2885</a></span>
<span class="normal"><a href="#line-2886">2886</a></span>
<span class="normal"><a href="#line-2887">2887</a></span>
<span class="normal"><a href="#line-2888">2888</a></span>
<span class="normal"><a href="#line-2889">2889</a></span>
<span class="normal"><a href="#line-2890">2890</a></span>
<span class="normal"><a href="#line-2891">2891</a></span>
<span class="normal"><a href="#line-2892">2892</a></span>
<span class="normal"><a href="#line-2893">2893</a></span>
<span class="normal"><a href="#line-2894">2894</a></span>
<span class="normal"><a href="#line-2895">2895</a></span>
<span class="normal"><a href="#line-2896">2896</a></span>
<span class="normal"><a href="#line-2897">2897</a></span>
<span class="normal"><a href="#line-2898">2898</a></span>
<span class="normal"><a href="#line-2899">2899</a></span>
<span class="normal"><a href="#line-2900">2900</a></span>
<span class="normal"><a href="#line-2901">2901</a></span>
<span class="normal"><a href="#line-2902">2902</a></span>
<span class="normal"><a href="#line-2903">2903</a></span>
<span class="normal"><a href="#line-2904">2904</a></span>
<span class="normal"><a href="#line-2905">2905</a></span>
<span class="normal"><a href="#line-2906">2906</a></span>
<span class="normal"><a href="#line-2907">2907</a></span>
<span class="normal"><a href="#line-2908">2908</a></span>
<span class="normal"><a href="#line-2909">2909</a></span>
<span class="normal"><a href="#line-2910">2910</a></span>
<span class="normal"><a href="#line-2911">2911</a></span>
<span class="normal"><a href="#line-2912">2912</a></span>
<span class="normal"><a href="#line-2913">2913</a></span>
<span class="normal"><a href="#line-2914">2914</a></span>
<span class="normal"><a href="#line-2915">2915</a></span>
<span class="normal"><a href="#line-2916">2916</a></span>
<span class="normal"><a href="#line-2917">2917</a></span>
<span class="normal"><a href="#line-2918">2918</a></span>
<span class="normal"><a href="#line-2919">2919</a></span>
<span class="normal"><a href="#line-2920">2920</a></span>
<span class="normal"><a href="#line-2921">2921</a></span>
<span class="normal"><a href="#line-2922">2922</a></span>
<span class="normal"><a href="#line-2923">2923</a></span>
<span class="normal"><a href="#line-2924">2924</a></span>
<span class="normal"><a href="#line-2925">2925</a></span>
<span class="normal"><a href="#line-2926">2926</a></span>
<span class="normal"><a href="#line-2927">2927</a></span>
<span class="normal"><a href="#line-2928">2928</a></span>
<span class="normal"><a href="#line-2929">2929</a></span>
<span class="normal"><a href="#line-2930">2930</a></span>
<span class="normal"><a href="#line-2931">2931</a></span>
<span class="normal"><a href="#line-2932">2932</a></span>
<span class="normal"><a href="#line-2933">2933</a></span>
<span class="normal"><a href="#line-2934">2934</a></span>
<span class="normal"><a href="#line-2935">2935</a></span>
<span class="normal"><a href="#line-2936">2936</a></span>
<span class="normal"><a href="#line-2937">2937</a></span>
<span class="normal"><a href="#line-2938">2938</a></span>
<span class="normal"><a href="#line-2939">2939</a></span>
<span class="normal"><a href="#line-2940">2940</a></span>
<span class="normal"><a href="#line-2941">2941</a></span>
<span class="normal"><a href="#line-2942">2942</a></span>
<span class="normal"><a href="#line-2943">2943</a></span>
<span class="normal"><a href="#line-2944">2944</a></span>
<span class="normal"><a href="#line-2945">2945</a></span>
<span class="normal"><a href="#line-2946">2946</a></span>
<span class="normal"><a href="#line-2947">2947</a></span>
<span class="normal"><a href="#line-2948">2948</a></span>
<span class="normal"><a href="#line-2949">2949</a></span>
<span class="normal"><a href="#line-2950">2950</a></span>
<span class="normal"><a href="#line-2951">2951</a></span>
<span class="normal"><a href="#line-2952">2952</a></span>
<span class="normal"><a href="#line-2953">2953</a></span>
<span class="normal"><a href="#line-2954">2954</a></span>
<span class="normal"><a href="#line-2955">2955</a></span>
<span class="normal"><a href="#line-2956">2956</a></span>
<span class="normal"><a href="#line-2957">2957</a></span>
<span class="normal"><a href="#line-2958">2958</a></span>
<span class="normal"><a href="#line-2959">2959</a></span>
<span class="normal"><a href="#line-2960">2960</a></span>
<span class="normal"><a href="#line-2961">2961</a></span>
<span class="normal"><a href="#line-2962">2962</a></span>
<span class="normal"><a href="#line-2963">2963</a></span>
<span class="normal"><a href="#line-2964">2964</a></span>
<span class="normal"><a href="#line-2965">2965</a></span>
<span class="normal"><a href="#line-2966">2966</a></span>
<span class="normal"><a href="#line-2967">2967</a></span>
<span class="normal"><a href="#line-2968">2968</a></span>
<span class="normal"><a href="#line-2969">2969</a></span>
<span class="normal"><a href="#line-2970">2970</a></span>
<span class="normal"><a href="#line-2971">2971</a></span>
<span class="normal"><a href="#line-2972">2972</a></span>
<span class="normal"><a href="#line-2973">2973</a></span>
<span class="normal"><a href="#line-2974">2974</a></span>
<span class="normal"><a href="#line-2975">2975</a></span>
<span class="normal"><a href="#line-2976">2976</a></span>
<span class="normal"><a href="#line-2977">2977</a></span>
<span class="normal"><a href="#line-2978">2978</a></span>
<span class="normal"><a href="#line-2979">2979</a></span>
<span class="normal"><a href="#line-2980">2980</a></span>
<span class="normal"><a href="#line-2981">2981</a></span>
<span class="normal"><a href="#line-2982">2982</a></span>
<span class="normal"><a href="#line-2983">2983</a></span>
<span class="normal"><a href="#line-2984">2984</a></span>
<span class="normal"><a href="#line-2985">2985</a></span>
<span class="normal"><a href="#line-2986">2986</a></span>
<span class="normal"><a href="#line-2987">2987</a></span>
<span class="normal"><a href="#line-2988">2988</a></span>
<span class="normal"><a href="#line-2989">2989</a></span>
<span class="normal"><a href="#line-2990">2990</a></span>
<span class="normal"><a href="#line-2991">2991</a></span>
<span class="normal"><a href="#line-2992">2992</a></span>
<span class="normal"><a href="#line-2993">2993</a></span>
<span class="normal"><a href="#line-2994">2994</a></span>
<span class="normal"><a href="#line-2995">2995</a></span>
<span class="normal"><a href="#line-2996">2996</a></span>
<span class="normal"><a href="#line-2997">2997</a></span>
<span class="normal"><a href="#line-2998">2998</a></span>
<span class="normal"><a href="#line-2999">2999</a></span>
<span class="normal"><a href="#line-3000">3000</a></span>
<span class="normal"><a href="#line-3001">3001</a></span>
<span class="normal"><a href="#line-3002">3002</a></span>
<span class="normal"><a href="#line-3003">3003</a></span>
<span class="normal"><a href="#line-3004">3004</a></span>
<span class="normal"><a href="#line-3005">3005</a></span>
<span class="normal"><a href="#line-3006">3006</a></span>
<span class="normal"><a href="#line-3007">3007</a></span>
<span class="normal"><a href="#line-3008">3008</a></span>
<span class="normal"><a href="#line-3009">3009</a></span>
<span class="normal"><a href="#line-3010">3010</a></span>
<span class="normal"><a href="#line-3011">3011</a></span>
<span class="normal"><a href="#line-3012">3012</a></span>
<span class="normal"><a href="#line-3013">3013</a></span>
<span class="normal"><a href="#line-3014">3014</a></span>
<span class="normal"><a href="#line-3015">3015</a></span>
<span class="normal"><a href="#line-3016">3016</a></span>
<span class="normal"><a href="#line-3017">3017</a></span>
<span class="normal"><a href="#line-3018">3018</a></span>
<span class="normal"><a href="#line-3019">3019</a></span>
<span class="normal"><a href="#line-3020">3020</a></span>
<span class="normal"><a href="#line-3021">3021</a></span>
<span class="normal"><a href="#line-3022">3022</a></span>
<span class="normal"><a href="#line-3023">3023</a></span>
<span class="normal"><a href="#line-3024">3024</a></span>
<span class="normal"><a href="#line-3025">3025</a></span>
<span class="normal"><a href="#line-3026">3026</a></span>
<span class="normal"><a href="#line-3027">3027</a></span>
<span class="normal"><a href="#line-3028">3028</a></span>
<span class="normal"><a href="#line-3029">3029</a></span>
<span class="normal"><a href="#line-3030">3030</a></span>
<span class="normal"><a href="#line-3031">3031</a></span>
<span class="normal"><a href="#line-3032">3032</a></span>
<span class="normal"><a href="#line-3033">3033</a></span>
<span class="normal"><a href="#line-3034">3034</a></span>
<span class="normal"><a href="#line-3035">3035</a></span>
<span class="normal"><a href="#line-3036">3036</a></span>
<span class="normal"><a href="#line-3037">3037</a></span>
<span class="normal"><a href="#line-3038">3038</a></span>
<span class="normal"><a href="#line-3039">3039</a></span>
<span class="normal"><a href="#line-3040">3040</a></span>
<span class="normal"><a href="#line-3041">3041</a></span>
<span class="normal"><a href="#line-3042">3042</a></span>
<span class="normal"><a href="#line-3043">3043</a></span>
<span class="normal"><a href="#line-3044">3044</a></span>
<span class="normal"><a href="#line-3045">3045</a></span>
<span class="normal"><a href="#line-3046">3046</a></span>
<span class="normal"><a href="#line-3047">3047</a></span>
<span class="normal"><a href="#line-3048">3048</a></span>
<span class="normal"><a href="#line-3049">3049</a></span>
<span class="normal"><a href="#line-3050">3050</a></span>
<span class="normal"><a href="#line-3051">3051</a></span>
<span class="normal"><a href="#line-3052">3052</a></span>
<span class="normal"><a href="#line-3053">3053</a></span>
<span class="normal"><a href="#line-3054">3054</a></span>
<span class="normal"><a href="#line-3055">3055</a></span>
<span class="normal"><a href="#line-3056">3056</a></span>
<span class="normal"><a href="#line-3057">3057</a></span>
<span class="normal"><a href="#line-3058">3058</a></span>
<span class="normal"><a href="#line-3059">3059</a></span>
<span class="normal"><a href="#line-3060">3060</a></span>
<span class="normal"><a href="#line-3061">3061</a></span>
<span class="normal"><a href="#line-3062">3062</a></span>
<span class="normal"><a href="#line-3063">3063</a></span>
<span class="normal"><a href="#line-3064">3064</a></span>
<span class="normal"><a href="#line-3065">3065</a></span>
<span class="normal"><a href="#line-3066">3066</a></span>
<span class="normal"><a href="#line-3067">3067</a></span>
<span class="normal"><a href="#line-3068">3068</a></span>
<span class="normal"><a href="#line-3069">3069</a></span>
<span class="normal"><a href="#line-3070">3070</a></span>
<span class="normal"><a href="#line-3071">3071</a></span>
<span class="normal"><a href="#line-3072">3072</a></span>
<span class="normal"><a href="#line-3073">3073</a></span>
<span class="normal"><a href="#line-3074">3074</a></span>
<span class="normal"><a href="#line-3075">3075</a></span>
<span class="normal"><a href="#line-3076">3076</a></span>
<span class="normal"><a href="#line-3077">3077</a></span>
<span class="normal"><a href="#line-3078">3078</a></span>
<span class="normal"><a href="#line-3079">3079</a></span>
<span class="normal"><a href="#line-3080">3080</a></span>
<span class="normal"><a href="#line-3081">3081</a></span>
<span class="normal"><a href="#line-3082">3082</a></span>
<span class="normal"><a href="#line-3083">3083</a></span>
<span class="normal"><a href="#line-3084">3084</a></span>
<span class="normal"><a href="#line-3085">3085</a></span>
<span class="normal"><a href="#line-3086">3086</a></span>
<span class="normal"><a href="#line-3087">3087</a></span>
<span class="normal"><a href="#line-3088">3088</a></span>
<span class="normal"><a href="#line-3089">3089</a></span>
<span class="normal"><a href="#line-3090">3090</a></span>
<span class="normal"><a href="#line-3091">3091</a></span>
<span class="normal"><a href="#line-3092">3092</a></span>
<span class="normal"><a href="#line-3093">3093</a></span>
<span class="normal"><a href="#line-3094">3094</a></span>
<span class="normal"><a href="#line-3095">3095</a></span>
<span class="normal"><a href="#line-3096">3096</a></span>
<span class="normal"><a href="#line-3097">3097</a></span>
<span class="normal"><a href="#line-3098">3098</a></span>
<span class="normal"><a href="#line-3099">3099</a></span>
<span class="normal"><a href="#line-3100">3100</a></span>
<span class="normal"><a href="#line-3101">3101</a></span>
<span class="normal"><a href="#line-3102">3102</a></span>
<span class="normal"><a href="#line-3103">3103</a></span>
<span class="normal"><a href="#line-3104">3104</a></span>
<span class="normal"><a href="#line-3105">3105</a></span>
<span class="normal"><a href="#line-3106">3106</a></span>
<span class="normal"><a href="#line-3107">3107</a></span>
<span class="normal"><a href="#line-3108">3108</a></span>
<span class="normal"><a href="#line-3109">3109</a></span>
<span class="normal"><a href="#line-3110">3110</a></span>
<span class="normal"><a href="#line-3111">3111</a></span>
<span class="normal"><a href="#line-3112">3112</a></span>
<span class="normal"><a href="#line-3113">3113</a></span>
<span class="normal"><a href="#line-3114">3114</a></span>
<span class="normal"><a href="#line-3115">3115</a></span>
<span class="normal"><a href="#line-3116">3116</a></span>
<span class="normal"><a href="#line-3117">3117</a></span>
<span class="normal"><a href="#line-3118">3118</a></span>
<span class="normal"><a href="#line-3119">3119</a></span>
<span class="normal"><a href="#line-3120">3120</a></span>
<span class="normal"><a href="#line-3121">3121</a></span>
<span class="normal"><a href="#line-3122">3122</a></span>
<span class="normal"><a href="#line-3123">3123</a></span>
<span class="normal"><a href="#line-3124">3124</a></span>
<span class="normal"><a href="#line-3125">3125</a></span>
<span class="normal"><a href="#line-3126">3126</a></span>
<span class="normal"><a href="#line-3127">3127</a></span>
<span class="normal"><a href="#line-3128">3128</a></span>
<span class="normal"><a href="#line-3129">3129</a></span>
<span class="normal"><a href="#line-3130">3130</a></span>
<span class="normal"><a href="#line-3131">3131</a></span>
<span class="normal"><a href="#line-3132">3132</a></span>
<span class="normal"><a href="#line-3133">3133</a></span>
<span class="normal"><a href="#line-3134">3134</a></span>
<span class="normal"><a href="#line-3135">3135</a></span>
<span class="normal"><a href="#line-3136">3136</a></span>
<span class="normal"><a href="#line-3137">3137</a></span>
<span class="normal"><a href="#line-3138">3138</a></span>
<span class="normal"><a href="#line-3139">3139</a></span>
<span class="normal"><a href="#line-3140">3140</a></span>
<span class="normal"><a href="#line-3141">3141</a></span>
<span class="normal"><a href="#line-3142">3142</a></span>
<span class="normal"><a href="#line-3143">3143</a></span>
<span class="normal"><a href="#line-3144">3144</a></span>
<span class="normal"><a href="#line-3145">3145</a></span>
<span class="normal"><a href="#line-3146">3146</a></span>
<span class="normal"><a href="#line-3147">3147</a></span>
<span class="normal"><a href="#line-3148">3148</a></span>
<span class="normal"><a href="#line-3149">3149</a></span>
<span class="normal"><a href="#line-3150">3150</a></span>
<span class="normal"><a href="#line-3151">3151</a></span>
<span class="normal"><a href="#line-3152">3152</a></span>
<span class="normal"><a href="#line-3153">3153</a></span>
<span class="normal"><a href="#line-3154">3154</a></span>
<span class="normal"><a href="#line-3155">3155</a></span>
<span class="normal"><a href="#line-3156">3156</a></span>
<span class="normal"><a href="#line-3157">3157</a></span>
<span class="normal"><a href="#line-3158">3158</a></span>
<span class="normal"><a href="#line-3159">3159</a></span>
<span class="normal"><a href="#line-3160">3160</a></span>
<span class="normal"><a href="#line-3161">3161</a></span>
<span class="normal"><a href="#line-3162">3162</a></span>
<span class="normal"><a href="#line-3163">3163</a></span>
<span class="normal"><a href="#line-3164">3164</a></span>
<span class="normal"><a href="#line-3165">3165</a></span>
<span class="normal"><a href="#line-3166">3166</a></span>
<span class="normal"><a href="#line-3167">3167</a></span>
<span class="normal"><a href="#line-3168">3168</a></span>
<span class="normal"><a href="#line-3169">3169</a></span>
<span class="normal"><a href="#line-3170">3170</a></span>
<span class="normal"><a href="#line-3171">3171</a></span>
<span class="normal"><a href="#line-3172">3172</a></span>
<span class="normal"><a href="#line-3173">3173</a></span>
<span class="normal"><a href="#line-3174">3174</a></span>
<span class="normal"><a href="#line-3175">3175</a></span>
<span class="normal"><a href="#line-3176">3176</a></span>
<span class="normal"><a href="#line-3177">3177</a></span>
<span class="normal"><a href="#line-3178">3178</a></span>
<span class="normal"><a href="#line-3179">3179</a></span>
<span class="normal"><a href="#line-3180">3180</a></span>
<span class="normal"><a href="#line-3181">3181</a></span>
<span class="normal"><a href="#line-3182">3182</a></span>
<span class="normal"><a href="#line-3183">3183</a></span>
<span class="normal"><a href="#line-3184">3184</a></span>
<span class="normal"><a href="#line-3185">3185</a></span>
<span class="normal"><a href="#line-3186">3186</a></span>
<span class="normal"><a href="#line-3187">3187</a></span>
<span class="normal"><a href="#line-3188">3188</a></span>
<span class="normal"><a href="#line-3189">3189</a></span>
<span class="normal"><a href="#line-3190">3190</a></span>
<span class="normal"><a href="#line-3191">3191</a></span>
<span class="normal"><a href="#line-3192">3192</a></span>
<span class="normal"><a href="#line-3193">3193</a></span>
<span class="normal"><a href="#line-3194">3194</a></span>
<span class="normal"><a href="#line-3195">3195</a></span>
<span class="normal"><a href="#line-3196">3196</a></span>
<span class="normal"><a href="#line-3197">3197</a></span>
<span class="normal"><a href="#line-3198">3198</a></span>
<span class="normal"><a href="#line-3199">3199</a></span>
<span class="normal"><a href="#line-3200">3200</a></span>
<span class="normal"><a href="#line-3201">3201</a></span>
<span class="normal"><a href="#line-3202">3202</a></span>
<span class="normal"><a href="#line-3203">3203</a></span>
<span class="normal"><a href="#line-3204">3204</a></span>
<span class="normal"><a href="#line-3205">3205</a></span>
<span class="normal"><a href="#line-3206">3206</a></span>
<span class="normal"><a href="#line-3207">3207</a></span>
<span class="normal"><a href="#line-3208">3208</a></span>
<span class="normal"><a href="#line-3209">3209</a></span>
<span class="normal"><a href="#line-3210">3210</a></span>
<span class="normal"><a href="#line-3211">3211</a></span>
<span class="normal"><a href="#line-3212">3212</a></span>
<span class="normal"><a href="#line-3213">3213</a></span>
<span class="normal"><a href="#line-3214">3214</a></span>
<span class="normal"><a href="#line-3215">3215</a></span>
<span class="normal"><a href="#line-3216">3216</a></span>
<span class="normal"><a href="#line-3217">3217</a></span>
<span class="normal"><a href="#line-3218">3218</a></span>
<span class="normal"><a href="#line-3219">3219</a></span>
<span class="normal"><a href="#line-3220">3220</a></span>
<span class="normal"><a href="#line-3221">3221</a></span>
<span class="normal"><a href="#line-3222">3222</a></span>
<span class="normal"><a href="#line-3223">3223</a></span>
<span class="normal"><a href="#line-3224">3224</a></span>
<span class="normal"><a href="#line-3225">3225</a></span>
<span class="normal"><a href="#line-3226">3226</a></span>
<span class="normal"><a href="#line-3227">3227</a></span>
<span class="normal"><a href="#line-3228">3228</a></span>
<span class="normal"><a href="#line-3229">3229</a></span>
<span class="normal"><a href="#line-3230">3230</a></span>
<span class="normal"><a href="#line-3231">3231</a></span>
<span class="normal"><a href="#line-3232">3232</a></span>
<span class="normal"><a href="#line-3233">3233</a></span>
<span class="normal"><a href="#line-3234">3234</a></span>
<span class="normal"><a href="#line-3235">3235</a></span>
<span class="normal"><a href="#line-3236">3236</a></span>
<span class="normal"><a href="#line-3237">3237</a></span>
<span class="normal"><a href="#line-3238">3238</a></span>
<span class="normal"><a href="#line-3239">3239</a></span>
<span class="normal"><a href="#line-3240">3240</a></span>
<span class="normal"><a href="#line-3241">3241</a></span>
<span class="normal"><a href="#line-3242">3242</a></span>
<span class="normal"><a href="#line-3243">3243</a></span>
<span class="normal"><a href="#line-3244">3244</a></span>
<span class="normal"><a href="#line-3245">3245</a></span>
<span class="normal"><a href="#line-3246">3246</a></span>
<span class="normal"><a href="#line-3247">3247</a></span>
<span class="normal"><a href="#line-3248">3248</a></span>
<span class="normal"><a href="#line-3249">3249</a></span>
<span class="normal"><a href="#line-3250">3250</a></span>
<span class="normal"><a href="#line-3251">3251</a></span>
<span class="normal"><a href="#line-3252">3252</a></span>
<span class="normal"><a href="#line-3253">3253</a></span>
<span class="normal"><a href="#line-3254">3254</a></span>
<span class="normal"><a href="#line-3255">3255</a></span>
<span class="normal"><a href="#line-3256">3256</a></span>
<span class="normal"><a href="#line-3257">3257</a></span>
<span class="normal"><a href="#line-3258">3258</a></span>
<span class="normal"><a href="#line-3259">3259</a></span>
<span class="normal"><a href="#line-3260">3260</a></span>
<span class="normal"><a href="#line-3261">3261</a></span>
<span class="normal"><a href="#line-3262">3262</a></span>
<span class="normal"><a href="#line-3263">3263</a></span>
<span class="normal"><a href="#line-3264">3264</a></span>
<span class="normal"><a href="#line-3265">3265</a></span>
<span class="normal"><a href="#line-3266">3266</a></span>
<span class="normal"><a href="#line-3267">3267</a></span>
<span class="normal"><a href="#line-3268">3268</a></span>
<span class="normal"><a href="#line-3269">3269</a></span>
<span class="normal"><a href="#line-3270">3270</a></span>
<span class="normal"><a href="#line-3271">3271</a></span>
<span class="normal"><a href="#line-3272">3272</a></span>
<span class="normal"><a href="#line-3273">3273</a></span>
<span class="normal"><a href="#line-3274">3274</a></span>
<span class="normal"><a href="#line-3275">3275</a></span>
<span class="normal"><a href="#line-3276">3276</a></span>
<span class="normal"><a href="#line-3277">3277</a></span>
<span class="normal"><a href="#line-3278">3278</a></span>
<span class="normal"><a href="#line-3279">3279</a></span>
<span class="normal"><a href="#line-3280">3280</a></span>
<span class="normal"><a href="#line-3281">3281</a></span>
<span class="normal"><a href="#line-3282">3282</a></span>
<span class="normal"><a href="#line-3283">3283</a></span>
<span class="normal"><a href="#line-3284">3284</a></span>
<span class="normal"><a href="#line-3285">3285</a></span>
<span class="normal"><a href="#line-3286">3286</a></span>
<span class="normal"><a href="#line-3287">3287</a></span>
<span class="normal"><a href="#line-3288">3288</a></span>
<span class="normal"><a href="#line-3289">3289</a></span>
<span class="normal"><a href="#line-3290">3290</a></span>
<span class="normal"><a href="#line-3291">3291</a></span>
<span class="normal"><a href="#line-3292">3292</a></span>
<span class="normal"><a href="#line-3293">3293</a></span>
<span class="normal"><a href="#line-3294">3294</a></span>
<span class="normal"><a href="#line-3295">3295</a></span>
<span class="normal"><a href="#line-3296">3296</a></span>
<span class="normal"><a href="#line-3297">3297</a></span>
<span class="normal"><a href="#line-3298">3298</a></span>
<span class="normal"><a href="#line-3299">3299</a></span>
<span class="normal"><a href="#line-3300">3300</a></span>
<span class="normal"><a href="#line-3301">3301</a></span>
<span class="normal"><a href="#line-3302">3302</a></span>
<span class="normal"><a href="#line-3303">3303</a></span>
<span class="normal"><a href="#line-3304">3304</a></span>
<span class="normal"><a href="#line-3305">3305</a></span>
<span class="normal"><a href="#line-3306">3306</a></span>
<span class="normal"><a href="#line-3307">3307</a></span>
<span class="normal"><a href="#line-3308">3308</a></span>
<span class="normal"><a href="#line-3309">3309</a></span>
<span class="normal"><a href="#line-3310">3310</a></span>
<span class="normal"><a href="#line-3311">3311</a></span>
<span class="normal"><a href="#line-3312">3312</a></span>
<span class="normal"><a href="#line-3313">3313</a></span>
<span class="normal"><a href="#line-3314">3314</a></span>
<span class="normal"><a href="#line-3315">3315</a></span>
<span class="normal"><a href="#line-3316">3316</a></span>
<span class="normal"><a href="#line-3317">3317</a></span>
<span class="normal"><a href="#line-3318">3318</a></span>
<span class="normal"><a href="#line-3319">3319</a></span>
<span class="normal"><a href="#line-3320">3320</a></span>
<span class="normal"><a href="#line-3321">3321</a></span>
<span class="normal"><a href="#line-3322">3322</a></span>
<span class="normal"><a href="#line-3323">3323</a></span>
<span class="normal"><a href="#line-3324">3324</a></span>
<span class="normal"><a href="#line-3325">3325</a></span>
<span class="normal"><a href="#line-3326">3326</a></span>
<span class="normal"><a href="#line-3327">3327</a></span>
<span class="normal"><a href="#line-3328">3328</a></span>
<span class="normal"><a href="#line-3329">3329</a></span>
<span class="normal"><a href="#line-3330">3330</a></span>
<span class="normal"><a href="#line-3331">3331</a></span>
<span class="normal"><a href="#line-3332">3332</a></span>
<span class="normal"><a href="#line-3333">3333</a></span>
<span class="normal"><a href="#line-3334">3334</a></span>
<span class="normal"><a href="#line-3335">3335</a></span>
<span class="normal"><a href="#line-3336">3336</a></span>
<span class="normal"><a href="#line-3337">3337</a></span>
<span class="normal"><a href="#line-3338">3338</a></span>
<span class="normal"><a href="#line-3339">3339</a></span>
<span class="normal"><a href="#line-3340">3340</a></span>
<span class="normal"><a href="#line-3341">3341</a></span>
<span class="normal"><a href="#line-3342">3342</a></span>
<span class="normal"><a href="#line-3343">3343</a></span>
<span class="normal"><a href="#line-3344">3344</a></span>
<span class="normal"><a href="#line-3345">3345</a></span>
<span class="normal"><a href="#line-3346">3346</a></span>
<span class="normal"><a href="#line-3347">3347</a></span>
<span class="normal"><a href="#line-3348">3348</a></span>
<span class="normal"><a href="#line-3349">3349</a></span>
<span class="normal"><a href="#line-3350">3350</a></span>
<span class="normal"><a href="#line-3351">3351</a></span>
<span class="normal"><a href="#line-3352">3352</a></span>
<span class="normal"><a href="#line-3353">3353</a></span>
<span class="normal"><a href="#line-3354">3354</a></span>
<span class="normal"><a href="#line-3355">3355</a></span>
<span class="normal"><a href="#line-3356">3356</a></span>
<span class="normal"><a href="#line-3357">3357</a></span>
<span class="normal"><a href="#line-3358">3358</a></span>
<span class="normal"><a href="#line-3359">3359</a></span>
<span class="normal"><a href="#line-3360">3360</a></span>
<span class="normal"><a href="#line-3361">3361</a></span>
<span class="normal"><a href="#line-3362">3362</a></span>
<span class="normal"><a href="#line-3363">3363</a></span>
<span class="normal"><a href="#line-3364">3364</a></span>
<span class="normal"><a href="#line-3365">3365</a></span>
<span class="normal"><a href="#line-3366">3366</a></span>
<span class="normal"><a href="#line-3367">3367</a></span>
<span class="normal"><a href="#line-3368">3368</a></span>
<span class="normal"><a href="#line-3369">3369</a></span>
<span class="normal"><a href="#line-3370">3370</a></span>
<span class="normal"><a href="#line-3371">3371</a></span>
<span class="normal"><a href="#line-3372">3372</a></span>
<span class="normal"><a href="#line-3373">3373</a></span>
<span class="normal"><a href="#line-3374">3374</a></span>
<span class="normal"><a href="#line-3375">3375</a></span>
<span class="normal"><a href="#line-3376">3376</a></span>
<span class="normal"><a href="#line-3377">3377</a></span>
<span class="normal"><a href="#line-3378">3378</a></span>
<span class="normal"><a href="#line-3379">3379</a></span>
<span class="normal"><a href="#line-3380">3380</a></span>
<span class="normal"><a href="#line-3381">3381</a></span>
<span class="normal"><a href="#line-3382">3382</a></span>
<span class="normal"><a href="#line-3383">3383</a></span>
<span class="normal"><a href="#line-3384">3384</a></span>
<span class="normal"><a href="#line-3385">3385</a></span>
<span class="normal"><a href="#line-3386">3386</a></span>
<span class="normal"><a href="#line-3387">3387</a></span>
<span class="normal"><a href="#line-3388">3388</a></span>
<span class="normal"><a href="#line-3389">3389</a></span>
<span class="normal"><a href="#line-3390">3390</a></span>
<span class="normal"><a href="#line-3391">3391</a></span>
<span class="normal"><a href="#line-3392">3392</a></span>
<span class="normal"><a href="#line-3393">3393</a></span>
<span class="normal"><a href="#line-3394">3394</a></span>
<span class="normal"><a href="#line-3395">3395</a></span>
<span class="normal"><a href="#line-3396">3396</a></span>
<span class="normal"><a href="#line-3397">3397</a></span>
<span class="normal"><a href="#line-3398">3398</a></span>
<span class="normal"><a href="#line-3399">3399</a></span>
<span class="normal"><a href="#line-3400">3400</a></span>
<span class="normal"><a href="#line-3401">3401</a></span>
<span class="normal"><a href="#line-3402">3402</a></span>
<span class="normal"><a href="#line-3403">3403</a></span>
<span class="normal"><a href="#line-3404">3404</a></span>
<span class="normal"><a href="#line-3405">3405</a></span>
<span class="normal"><a href="#line-3406">3406</a></span>
<span class="normal"><a href="#line-3407">3407</a></span>
<span class="normal"><a href="#line-3408">3408</a></span>
<span class="normal"><a href="#line-3409">3409</a></span>
<span class="normal"><a href="#line-3410">3410</a></span>
<span class="normal"><a href="#line-3411">3411</a></span>
<span class="normal"><a href="#line-3412">3412</a></span>
<span class="normal"><a href="#line-3413">3413</a></span>
<span class="normal"><a href="#line-3414">3414</a></span>
<span class="normal"><a href="#line-3415">3415</a></span>
<span class="normal"><a href="#line-3416">3416</a></span>
<span class="normal"><a href="#line-3417">3417</a></span>
<span class="normal"><a href="#line-3418">3418</a></span>
<span class="normal"><a href="#line-3419">3419</a></span>
<span class="normal"><a href="#line-3420">3420</a></span>
<span class="normal"><a href="#line-3421">3421</a></span>
<span class="normal"><a href="#line-3422">3422</a></span>
<span class="normal"><a href="#line-3423">3423</a></span>
<span class="normal"><a href="#line-3424">3424</a></span>
<span class="normal"><a href="#line-3425">3425</a></span>
<span class="normal"><a href="#line-3426">3426</a></span>
<span class="normal"><a href="#line-3427">3427</a></span>
<span class="normal"><a href="#line-3428">3428</a></span>
<span class="normal"><a href="#line-3429">3429</a></span>
<span class="normal"><a href="#line-3430">3430</a></span>
<span class="normal"><a href="#line-3431">3431</a></span>
<span class="normal"><a href="#line-3432">3432</a></span>
<span class="normal"><a href="#line-3433">3433</a></span>
<span class="normal"><a href="#line-3434">3434</a></span>
<span class="normal"><a href="#line-3435">3435</a></span>
<span class="normal"><a href="#line-3436">3436</a></span>
<span class="normal"><a href="#line-3437">3437</a></span>
<span class="normal"><a href="#line-3438">3438</a></span>
<span class="normal"><a href="#line-3439">3439</a></span>
<span class="normal"><a href="#line-3440">3440</a></span>
<span class="normal"><a href="#line-3441">3441</a></span>
<span class="normal"><a href="#line-3442">3442</a></span>
<span class="normal"><a href="#line-3443">3443</a></span>
<span class="normal"><a href="#line-3444">3444</a></span>
<span class="normal"><a href="#line-3445">3445</a></span>
<span class="normal"><a href="#line-3446">3446</a></span>
<span class="normal"><a href="#line-3447">3447</a></span>
<span class="normal"><a href="#line-3448">3448</a></span>
<span class="normal"><a href="#line-3449">3449</a></span>
<span class="normal"><a href="#line-3450">3450</a></span>
<span class="normal"><a href="#line-3451">3451</a></span>
<span class="normal"><a href="#line-3452">3452</a></span>
<span class="normal"><a href="#line-3453">3453</a></span>
<span class="normal"><a href="#line-3454">3454</a></span>
<span class="normal"><a href="#line-3455">3455</a></span>
<span class="normal"><a href="#line-3456">3456</a></span>
<span class="normal"><a href="#line-3457">3457</a></span>
<span class="normal"><a href="#line-3458">3458</a></span>
<span class="normal"><a href="#line-3459">3459</a></span>
<span class="normal"><a href="#line-3460">3460</a></span>
<span class="normal"><a href="#line-3461">3461</a></span>
<span class="normal"><a href="#line-3462">3462</a></span>
<span class="normal"><a href="#line-3463">3463</a></span>
<span class="normal"><a href="#line-3464">3464</a></span>
<span class="normal"><a href="#line-3465">3465</a></span>
<span class="normal"><a href="#line-3466">3466</a></span>
<span class="normal"><a href="#line-3467">3467</a></span>
<span class="normal"><a href="#line-3468">3468</a></span>
<span class="normal"><a href="#line-3469">3469</a></span>
<span class="normal"><a href="#line-3470">3470</a></span>
<span class="normal"><a href="#line-3471">3471</a></span>
<span class="normal"><a href="#line-3472">3472</a></span>
<span class="normal"><a href="#line-3473">3473</a></span>
<span class="normal"><a href="#line-3474">3474</a></span>
<span class="normal"><a href="#line-3475">3475</a></span>
<span class="normal"><a href="#line-3476">3476</a></span>
<span class="normal"><a href="#line-3477">3477</a></span>
<span class="normal"><a href="#line-3478">3478</a></span>
<span class="normal"><a href="#line-3479">3479</a></span>
<span class="normal"><a href="#line-3480">3480</a></span>
<span class="normal"><a href="#line-3481">3481</a></span>
<span class="normal"><a href="#line-3482">3482</a></span>
<span class="normal"><a href="#line-3483">3483</a></span>
<span class="normal"><a href="#line-3484">3484</a></span>
<span class="normal"><a href="#line-3485">3485</a></span>
<span class="normal"><a href="#line-3486">3486</a></span>
<span class="normal"><a href="#line-3487">3487</a></span>
<span class="normal"><a href="#line-3488">3488</a></span>
<span class="normal"><a href="#line-3489">3489</a></span>
<span class="normal"><a href="#line-3490">3490</a></span>
<span class="normal"><a href="#line-3491">3491</a></span>
<span class="normal"><a href="#line-3492">3492</a></span>
<span class="normal"><a href="#line-3493">3493</a></span>
<span class="normal"><a href="#line-3494">3494</a></span>
<span class="normal"><a href="#line-3495">3495</a></span>
<span class="normal"><a href="#line-3496">3496</a></span>
<span class="normal"><a href="#line-3497">3497</a></span>
<span class="normal"><a href="#line-3498">3498</a></span>
<span class="normal"><a href="#line-3499">3499</a></span>
<span class="normal"><a href="#line-3500">3500</a></span>
<span class="normal"><a href="#line-3501">3501</a></span>
<span class="normal"><a href="#line-3502">3502</a></span>
<span class="normal"><a href="#line-3503">3503</a></span>
<span class="normal"><a href="#line-3504">3504</a></span>
<span class="normal"><a href="#line-3505">3505</a></span>
<span class="normal"><a href="#line-3506">3506</a></span>
<span class="normal"><a href="#line-3507">3507</a></span>
<span class="normal"><a href="#line-3508">3508</a></span>
<span class="normal"><a href="#line-3509">3509</a></span>
<span class="normal"><a href="#line-3510">3510</a></span>
<span class="normal"><a href="#line-3511">3511</a></span>
<span class="normal"><a href="#line-3512">3512</a></span>
<span class="normal"><a href="#line-3513">3513</a></span>
<span class="normal"><a href="#line-3514">3514</a></span>
<span class="normal"><a href="#line-3515">3515</a></span>
<span class="normal"><a href="#line-3516">3516</a></span>
<span class="normal"><a href="#line-3517">3517</a></span>
<span class="normal"><a href="#line-3518">3518</a></span>
<span class="normal"><a href="#line-3519">3519</a></span>
<span class="normal"><a href="#line-3520">3520</a></span>
<span class="normal"><a href="#line-3521">3521</a></span>
<span class="normal"><a href="#line-3522">3522</a></span>
<span class="normal"><a href="#line-3523">3523</a></span></pre></div></td><td class="code"><div><pre><span></span><span id="linespan-1"><a id="line-1" name="line-1"></a><span class="kn">From</span> <span class="n">cgraphs.locks.lambdalockpp</span> <span class="kn">Require</span> <span class="kn">Export</span> <span class="n">rtypesystem</span><span class="o">.</span>
</span><span id="linespan-2"><a id="line-2" name="line-2"></a><span class="kn">From</span> <span class="n">cgraphs.locks.lambdalockpp</span> <span class="kn">Require</span> <span class="kn">Export</span> <span class="n">definitions</span><span class="o">.</span>
</span><span id="linespan-3"><a id="line-3" name="line-3"></a>
</span><span id="linespan-4"><a id="line-4" name="line-4"></a><span class="kn">Definition</span> <span class="n">Mlen</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span> <span class="n">nat</span> <span class="o">:=</span> <span class="n">length</span> <span class="o">(</span><span class="n">multiset_car</span> <span class="n">m</span><span class="o">).</span>
</span><span id="linespan-5"><a id="line-5" name="line-5"></a>
</span><span id="linespan-6"><a id="line-6" name="line-6"></a><span class="kn">Global</span> <span class="kn">Instance</span> <span class="n">Mlen_Proper</span> <span class="o">{</span><span class="n">A</span><span class="o">}</span> <span class="o">:</span> <span class="n">Proper</span> <span class="o">((</span><span class="bp">≡</span><span class="o">)</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="bp">≡</span><span class="o">))</span> <span class="o">(@</span><span class="n">Mlen</span> <span class="n">A</span><span class="o">).</span>
</span><span id="linespan-7"><a id="line-7" name="line-7"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-8"><a id="line-8" name="line-8"></a>  <span class="k">intros</span> <span class="o">???.</span>
</span><span id="linespan-9"><a id="line-9" name="line-9"></a>  <span class="k">destruct</span> <span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">.</span>
</span><span id="linespan-10"><a id="line-10" name="line-10"></a>  <span class="k">rewrite</span> <span class="o">/</span><span class="n">Mlen</span> <span class="o">/=.</span> <span class="k">destruct</span> <span class="n">H</span> <span class="k">as</span> <span class="o">[</span><span class="n">x</span> <span class="o">[</span><span class="n">H1</span> <span class="n">H2</span><span class="o">]].</span>
</span><span id="linespan-11"><a id="line-11" name="line-11"></a>  <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-12"><a id="line-12" name="line-12"></a>  <span class="k">rewrite</span> <span class="o">-</span><span class="n">H2</span> <span class="n">H1</span> <span class="o">//.</span>
</span><span id="linespan-13"><a id="line-13" name="line-13"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-14"><a id="line-14" name="line-14"></a>
</span><span id="linespan-15"><a id="line-15" name="line-15"></a><span class="kn">Lemma</span> <span class="n">Mlen_mult</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span> <span class="n">Mlen</span> <span class="o">(</span><span class="n">x</span> <span class="bp">⋅</span> <span class="n">y</span><span class="o">)</span> <span class="o">=</span> <span class="n">Mlen</span> <span class="n">x</span> <span class="o">+</span> <span class="n">Mlen</span> <span class="n">y</span><span class="o">.</span>
</span><span id="linespan-16"><a id="line-16" name="line-16"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-17"><a id="line-17" name="line-17"></a>  <span class="k">unfold</span> <span class="n">Mlen</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">;</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-18"><a id="line-18" name="line-18"></a>  <span class="k">rewrite</span> <span class="n">app_length</span> <span class="o">//.</span>
</span><span id="linespan-19"><a id="line-19" name="line-19"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-20"><a id="line-20" name="line-20"></a>
</span><span id="linespan-21"><a id="line-21" name="line-21"></a><span class="kn">Lemma</span> <span class="n">Mlen_unit</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">:</span> <span class="n">Mlen</span> <span class="o">(</span><span class="n">ε</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">A</span><span class="o">)</span> <span class="o">=</span> <span class="mi">0</span><span class="o">.</span>
</span><span id="linespan-22"><a id="line-22" name="line-22"></a><span class="kn">Proof</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span> <span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-23"><a id="line-23" name="line-23"></a>
</span><span id="linespan-24"><a id="line-24" name="line-24"></a><span class="kn">Lemma</span> <span class="n">Mlen_singleton</span> <span class="o">{</span><span class="n">A</span> <span class="o">:</span> <span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span> <span class="n">Mlen</span> <span class="o">{[</span> <span class="n">l</span> <span class="o">]}</span> <span class="o">=</span> <span class="mi">1</span><span class="o">.</span>
</span><span id="linespan-25"><a id="line-25" name="line-25"></a><span class="kn">Proof</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span> <span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-26"><a id="line-26" name="line-26"></a>
</span><span id="linespan-27"><a id="line-27" name="line-27"></a><span class="kn">Lemma</span> <span class="n">Mpermute1</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-28"><a id="line-28" name="line-28"></a>  <span class="n">a</span> <span class="bp">⋅</span> <span class="n">b</span> <span class="bp">⋅</span> <span class="n">c</span> <span class="bp">≡</span> <span class="n">c</span> <span class="bp">⋅</span> <span class="n">a</span> <span class="bp">⋅</span> <span class="n">b</span><span class="o">.</span>
</span><span id="linespan-29"><a id="line-29" name="line-29"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-30"><a id="line-30" name="line-30"></a>  <span class="k">rewrite</span> <span class="n">comm</span> <span class="n">assoc</span> <span class="o">//.</span>
</span><span id="linespan-31"><a id="line-31" name="line-31"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-32"><a id="line-32" name="line-32"></a>
</span><span id="linespan-33"><a id="line-33" name="line-33"></a><span class="kn">Lemma</span> <span class="n">Mpermute2</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-34"><a id="line-34" name="line-34"></a>  <span class="n">a</span> <span class="bp">⋅</span> <span class="n">b</span> <span class="bp">⋅</span> <span class="n">c</span> <span class="bp">≡</span> <span class="n">b</span> <span class="bp">⋅</span> <span class="n">a</span> <span class="bp">⋅</span> <span class="n">c</span><span class="o">.</span>
</span><span id="linespan-35"><a id="line-35" name="line-35"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-36"><a id="line-36" name="line-36"></a>  <span class="k">rewrite</span> <span class="n">comm</span><span class="o">.</span> <span class="k">symmetry</span><span class="o">.</span>
</span><span id="linespan-37"><a id="line-37" name="line-37"></a>  <span class="k">rewrite</span> <span class="n">comm</span><span class="o">.</span> <span class="n">f_equiv</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">comm</span> <span class="o">//.</span>
</span><span id="linespan-38"><a id="line-38" name="line-38"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-39"><a id="line-39" name="line-39"></a>
</span><span id="linespan-40"><a id="line-40" name="line-40"></a><span class="kn">Lemma</span> <span class="n">Mlen_zero_inv</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-41"><a id="line-41" name="line-41"></a>  <span class="n">Mlen</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">ε</span><span class="o">.</span>
</span><span id="linespan-42"><a id="line-42" name="line-42"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-43"><a id="line-43" name="line-43"></a>  <span class="k">destruct</span> <span class="n">a</span><span class="o">;</span> <span class="k">rewrite</span> <span class="o">/</span><span class="n">Mlen</span> <span class="o">/=;</span>
</span><span id="linespan-44"><a id="line-44" name="line-44"></a>  <span class="k">destruct</span> <span class="n">multiset_car</span><span class="o">;</span> <span class="k">rewrite</span> <span class="o">//=.</span>
</span><span id="linespan-45"><a id="line-45" name="line-45"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-46"><a id="line-46" name="line-46"></a>
</span><span id="linespan-47"><a id="line-47" name="line-47"></a><span class="kn">Lemma</span> <span class="n">Mlen_nonzero_inv</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-48"><a id="line-48" name="line-48"></a>  <span class="n">Mlen</span> <span class="n">a</span> <span class="o">≠</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="o">∃</span> <span class="n">l</span> <span class="n">a'</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="n">l</span> <span class="o">]}</span> <span class="bp">⋅</span> <span class="n">a'</span><span class="o">.</span>
</span><span id="linespan-49"><a id="line-49" name="line-49"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-50"><a id="line-50" name="line-50"></a>  <span class="k">destruct</span> <span class="n">a</span><span class="o">;</span> <span class="k">rewrite</span> <span class="o">/</span><span class="n">Mlen</span> <span class="o">/=;</span>
</span><span id="linespan-51"><a id="line-51" name="line-51"></a>  <span class="k">destruct</span> <span class="n">multiset_car</span><span class="o">;</span> <span class="k">rewrite</span> <span class="o">//=.</span>
</span><span id="linespan-52"><a id="line-52" name="line-52"></a>  <span class="k">intros</span> <span class="o">_.</span> <span class="k">exists</span> <span class="n">o</span><span class="o">.</span>
</span><span id="linespan-53"><a id="line-53" name="line-53"></a>  <span class="k">exists</span> <span class="o">(</span><span class="n">MultiSet</span> <span class="n">multiset_car</span><span class="o">).</span>
</span><span id="linespan-54"><a id="line-54" name="line-54"></a>  <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-55"><a id="line-55" name="line-55"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-56"><a id="line-56" name="line-56"></a>
</span><span id="linespan-57"><a id="line-57" name="line-57"></a><span class="kn">Definition</span> <span class="n">labelO'</span><span class="o">:</span><span class="n">ofe</span> <span class="o">:=</span> <span class="n">leibnizO</span> <span class="o">(</span><span class="n">lockcap</span><span class="o">*</span><span class="n">type</span><span class="o">).</span>
</span><span id="linespan-58"><a id="line-58" name="line-58"></a>
</span><span id="linespan-59"><a id="line-59" name="line-59"></a><span class="kn">Record</span> <span class="n">lockrel</span> <span class="o">(</span><span class="n">refcnt</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">(</span><span class="n">o</span> <span class="o">:</span> <span class="n">option</span> <span class="n">val</span><span class="o">)</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">type</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">labelO'</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="o">{</span>
</span><span id="linespan-60"><a id="line-60" name="line-60"></a>  <span class="n">ls_owner</span> <span class="o">:</span> <span class="n">lockstate</span><span class="o">;</span>
</span><span id="linespan-61"><a id="line-61" name="line-61"></a>  <span class="n">x_closed</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">labelO'</span><span class="o">;</span>
</span><span id="linespan-62"><a id="line-62" name="line-62"></a>  <span class="n">x_opened</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">labelO'</span><span class="o">;</span>
</span><span id="linespan-63"><a id="line-63" name="line-63"></a>  <span class="n">lr_split</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="o">((</span><span class="n">Owner</span><span class="o">,</span><span class="n">ls_owner</span><span class="o">),</span><span class="n">t</span><span class="o">):</span><span class="n">labelO'</span> <span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x_closed</span> <span class="bp">⋅</span> <span class="n">x_opened</span><span class="o">;</span>
</span><span id="linespan-64"><a id="line-64" name="line-64"></a>  <span class="n">lr_closed</span> <span class="o">:</span> <span class="o">∀</span> <span class="n">l</span> <span class="n">x_closed'</span><span class="o">,</span> <span class="n">x_closed</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="n">l</span> <span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x_closed'</span> <span class="o">-&gt;</span> <span class="n">l</span> <span class="o">=</span> <span class="o">((</span><span class="n">Client</span><span class="o">,</span><span class="n">Closed</span><span class="o">,</span><span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">);</span>
</span><span id="linespan-65"><a id="line-65" name="line-65"></a>  <span class="n">lr_openedclosed</span> <span class="o">:</span> <span class="k">match</span> <span class="n">o</span> <span class="k">with</span>
</span><span id="linespan-66"><a id="line-66" name="line-66"></a>    <span class="o">|</span> <span class="n">None</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="n">ls_owner</span> <span class="o">=</span> <span class="n">Opened</span> <span class="o">∧</span> <span class="n">x_opened</span> <span class="o">=</span> <span class="n">ε</span><span class="o">)</span> <span class="o">∨</span>
</span><span id="linespan-67"><a id="line-67" name="line-67"></a>              <span class="o">(</span><span class="n">ls_owner</span> <span class="o">=</span> <span class="n">Closed</span> <span class="o">∧</span> <span class="n">x_opened</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span><span class="n">Opened</span><span class="o">,</span><span class="n">t</span><span class="o">):</span><span class="n">labelO'</span> <span class="o">]})</span>
</span><span id="linespan-68"><a id="line-68" name="line-68"></a>    <span class="o">|</span> <span class="n">Some</span> <span class="o">_</span> <span class="o">=&gt;</span> <span class="n">ls_owner</span> <span class="o">=</span> <span class="n">Closed</span> <span class="o">∧</span> <span class="n">x_opened</span> <span class="o">=</span> <span class="n">ε</span>
</span><span id="linespan-69"><a id="line-69" name="line-69"></a>  <span class="k">end</span><span class="o">;</span>
</span><span id="linespan-70"><a id="line-70" name="line-70"></a>  <span class="n">lr_refcount</span> <span class="o">:</span> <span class="n">Mlen</span> <span class="n">x_closed</span> <span class="o">+</span> <span class="n">Mlen</span> <span class="n">x_opened</span> <span class="o">=</span> <span class="n">refcnt</span><span class="o">;</span>
</span><span id="linespan-71"><a id="line-71" name="line-71"></a><span class="o">}.</span>
</span><span id="linespan-72"><a id="line-72" name="line-72"></a>
</span><span id="linespan-73"><a id="line-73" name="line-73"></a><span class="kn">Global</span> <span class="kn">Instance</span> <span class="n">lockrel_Proper</span> <span class="n">refcnt</span> <span class="n">o</span> <span class="n">t</span> <span class="o">:</span> <span class="n">Proper</span> <span class="o">((</span><span class="bp">≡</span><span class="o">)</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="bp">≡</span><span class="o">))</span> <span class="o">(</span><span class="n">lockrel</span> <span class="n">refcnt</span> <span class="n">o</span> <span class="n">t</span><span class="o">).</span>
</span><span id="linespan-74"><a id="line-74" name="line-74"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-75"><a id="line-75" name="line-75"></a>  <span class="k">intros</span> <span class="o">???.</span>
</span><span id="linespan-76"><a id="line-76" name="line-76"></a>  <span class="k">split</span><span class="o">;</span> <span class="k">intros</span> <span class="bp">[]</span><span class="o">;</span> <span class="k">econstructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-77"><a id="line-77" name="line-77"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="o">-</span><span class="n">H</span> <span class="o">//.</span>
</span><span id="linespan-78"><a id="line-78" name="line-78"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">H</span> <span class="o">//.</span>
</span><span id="linespan-79"><a id="line-79" name="line-79"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-80"><a id="line-80" name="line-80"></a>
</span><span id="linespan-81"><a id="line-81" name="line-81"></a><span class="kn">Definition</span> <span class="n">extract1</span> <span class="o">(</span><span class="n">jj</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">(</span><span class="n">ls</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">nat</span> <span class="o">*</span> <span class="o">(</span><span class="n">lockcap</span> <span class="o">*</span> <span class="n">type</span><span class="o">)))</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">labelO'</span> <span class="o">:=</span>
</span><span id="linespan-82"><a id="line-82" name="line-82"></a>  <span class="n">list_to_multiset</span> <span class="o">((</span><span class="n">filter</span> <span class="o">(λ</span> <span class="k">'</span><span class="o">(</span><span class="n">jj'</span><span class="o">,</span><span class="n">c</span><span class="o">),</span> <span class="n">jj</span> <span class="o">=</span> <span class="n">jj'</span><span class="o">)</span> <span class="n">ls</span><span class="o">).*</span><span class="mi">2</span><span class="o">).</span>
</span><span id="linespan-83"><a id="line-83" name="line-83"></a>
</span><span id="linespan-84"><a id="line-84" name="line-84"></a><span class="kn">Definition</span> <span class="n">extract</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">labelO</span><span class="o">)</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">labelO'</span> <span class="o">:=</span>
</span><span id="linespan-85"><a id="line-85" name="line-85"></a>  <span class="n">list_to_multiset</span> <span class="o">(</span><span class="n">flat_map</span> <span class="o">(λ</span> <span class="n">l</span><span class="o">,</span>
</span><span id="linespan-86"><a id="line-86" name="line-86"></a>    <span class="k">match</span> <span class="n">l</span> <span class="k">with</span> <span class="n">LockLabel</span> <span class="n">xs</span> <span class="o">=&gt;</span> <span class="n">multiset_car</span> <span class="o">(</span><span class="n">extract1</span> <span class="n">i</span> <span class="n">xs</span><span class="o">)</span> <span class="o">|</span> <span class="o">_</span> <span class="o">=&gt;</span> <span class="bp">[]</span> <span class="k">end</span><span class="o">)</span> <span class="o">(</span><span class="n">multiset_car</span> <span class="n">x</span><span class="o">)).</span>
</span><span id="linespan-87"><a id="line-87" name="line-87"></a>
</span><span id="linespan-88"><a id="line-88" name="line-88"></a><span class="kn">Lemma</span> <span class="n">flat_map_permute</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">list</span> <span class="n">B</span><span class="o">)</span> <span class="n">xs</span> <span class="n">ys</span> <span class="o">:</span>
</span><span id="linespan-89"><a id="line-89" name="line-89"></a>  <span class="n">xs</span> <span class="bp">≡</span><span class="n">ₚ</span> <span class="n">ys</span> <span class="o">-&gt;</span> <span class="n">flat_map</span> <span class="n">f</span> <span class="n">xs</span> <span class="bp">≡</span><span class="n">ₚ</span> <span class="n">flat_map</span> <span class="n">f</span> <span class="n">ys</span><span class="o">.</span>
</span><span id="linespan-90"><a id="line-90" name="line-90"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-91"><a id="line-91" name="line-91"></a>  <span class="k">induction</span> <span class="mi">1</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-92"><a id="line-92" name="line-92"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">Permutation_app</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-93"><a id="line-93" name="line-93"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">assoc_L</span><span class="o">.</span> <span class="n">f_equiv</span><span class="o">.</span>
</span><span id="linespan-94"><a id="line-94" name="line-94"></a>    <span class="k">eapply</span> <span class="n">Permutation_app_swap</span><span class="o">.</span>
</span><span id="linespan-95"><a id="line-95" name="line-95"></a>  <span class="o">-</span> <span class="n">etrans</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-96"><a id="line-96" name="line-96"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-97"><a id="line-97" name="line-97"></a>
</span><span id="linespan-98"><a id="line-98" name="line-98"></a><span class="kn">Global</span> <span class="kn">Instance</span> <span class="n">extract_Proper</span> <span class="n">i</span> <span class="o">:</span>
</span><span id="linespan-99"><a id="line-99" name="line-99"></a>  <span class="n">Proper</span> <span class="o">((</span><span class="bp">≡</span><span class="o">)</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="bp">≡</span><span class="o">))</span> <span class="o">(</span><span class="n">extract</span> <span class="n">i</span><span class="o">).</span>
</span><span id="linespan-100"><a id="line-100" name="line-100"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-101"><a id="line-101" name="line-101"></a>  <span class="k">intros</span> <span class="o">???.</span> <span class="k">unfold</span> <span class="n">extract</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">x</span><span class="o">,</span><span class="n">y</span><span class="o">;</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-102"><a id="line-102" name="line-102"></a>  <span class="k">eapply</span> <span class="n">list_to_multiset_proper</span><span class="o">.</span>
</span><span id="linespan-103"><a id="line-103" name="line-103"></a>  <span class="k">eapply</span> <span class="n">flat_map_permute</span><span class="o">.</span>
</span><span id="linespan-104"><a id="line-104" name="line-104"></a>  <span class="k">inversion</span> <span class="n">H</span><span class="o">.</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-105"><a id="line-105" name="line-105"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-106"><a id="line-106" name="line-106"></a>
</span><span id="linespan-107"><a id="line-107" name="line-107"></a><span class="kn">Definition</span> <span class="n">melem_of</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span><span class="o">:</span><span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span><span class="n">multiset</span> <span class="n">A</span><span class="o">)</span> <span class="o">:=</span> <span class="o">∃</span> <span class="n">x'</span><span class="o">,</span> <span class="n">x</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="n">a</span> <span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x'</span><span class="o">.</span>
</span><span id="linespan-108"><a id="line-108" name="line-108"></a>
</span><span id="linespan-109"><a id="line-109" name="line-109"></a><span class="kn">Global</span> <span class="kn">Instance</span> <span class="n">melem_of_Proper</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">:</span> <span class="n">Proper</span> <span class="o">((</span><span class="bp">≡</span><span class="o">)</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="bp">≡</span><span class="o">)</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="bp">≡</span><span class="o">))</span> <span class="o">(@</span><span class="n">melem_of</span> <span class="n">A</span><span class="o">).</span>
</span><span id="linespan-110"><a id="line-110" name="line-110"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-111"><a id="line-111" name="line-111"></a>  <span class="k">intros</span> <span class="o">??????.</span>
</span><span id="linespan-112"><a id="line-112" name="line-112"></a>  <span class="k">split</span><span class="o">;</span> <span class="k">intros</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">eexists</span><span class="o">;</span> <span class="n">setoid_subst</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-113"><a id="line-113" name="line-113"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-114"><a id="line-114" name="line-114"></a>
</span><span id="linespan-115"><a id="line-115" name="line-115"></a><span class="kn">Lemma</span> <span class="n">melem_of_singleton</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span><span class="o">:</span><span class="n">A</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-116"><a id="line-116" name="line-116"></a>  <span class="n">melem_of</span> <span class="n">a</span> <span class="o">{[</span> <span class="n">a</span> <span class="o">]}.</span>
</span><span id="linespan-117"><a id="line-117" name="line-117"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-118"><a id="line-118" name="line-118"></a>  <span class="k">exists</span> <span class="n">ε</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">right_id</span> <span class="o">//.</span>
</span><span id="linespan-119"><a id="line-119" name="line-119"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-120"><a id="line-120" name="line-120"></a>
</span><span id="linespan-121"><a id="line-121" name="line-121"></a><span class="kn">Lemma</span> <span class="n">melem_of_singleton_inv</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span><span class="o">:</span><span class="n">A</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-122"><a id="line-122" name="line-122"></a>  <span class="n">melem_of</span> <span class="n">a</span> <span class="o">{[</span> <span class="n">b</span> <span class="o">]}</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="bp">≡</span> <span class="n">b</span><span class="o">.</span>
</span><span id="linespan-123"><a id="line-123" name="line-123"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-124"><a id="line-124" name="line-124"></a>  <span class="k">intros</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-125"><a id="line-125" name="line-125"></a>  <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-126"><a id="line-126" name="line-126"></a>  <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-127"><a id="line-127" name="line-127"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-128"><a id="line-128" name="line-128"></a>
</span><span id="linespan-129"><a id="line-129" name="line-129"></a><span class="kn">Lemma</span> <span class="n">melem_of_op_singleton</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span><span class="o">:</span><span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span><span class="n">multiset</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-130"><a id="line-130" name="line-130"></a>  <span class="n">melem_of</span> <span class="n">a</span> <span class="o">({[</span> <span class="n">a</span> <span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-131"><a id="line-131" name="line-131"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-132"><a id="line-132" name="line-132"></a>  <span class="k">exists</span> <span class="n">x</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-133"><a id="line-133" name="line-133"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-134"><a id="line-134" name="line-134"></a>
</span><span id="linespan-135"><a id="line-135" name="line-135"></a><span class="kn">Lemma</span> <span class="n">melem_of_op</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">)</span> <span class="n">x1</span> <span class="n">x2</span> <span class="o">:</span>
</span><span id="linespan-136"><a id="line-136" name="line-136"></a>  <span class="n">melem_of</span> <span class="n">a</span> <span class="o">(</span><span class="n">x1</span> <span class="bp">⋅</span> <span class="n">x2</span><span class="o">)</span> <span class="o">&lt;-&gt;</span> <span class="n">melem_of</span> <span class="n">a</span> <span class="n">x1</span> <span class="o">∨</span> <span class="n">melem_of</span> <span class="n">a</span> <span class="n">x2</span><span class="o">.</span>
</span><span id="linespan-137"><a id="line-137" name="line-137"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-138"><a id="line-138" name="line-138"></a>  <span class="k">split</span><span class="o">.</span>
</span><span id="linespan-139"><a id="line-139" name="line-139"></a>  <span class="o">-</span> <span class="k">intros</span> <span class="bp">[]</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-140"><a id="line-140" name="line-140"></a>    <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H5</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-141"><a id="line-141" name="line-141"></a>    <span class="o">+</span> <span class="k">right</span><span class="o">.</span> <span class="k">apply</span> <span class="n">melem_of_op_singleton</span><span class="o">.</span>
</span><span id="linespan-142"><a id="line-142" name="line-142"></a>    <span class="o">+</span> <span class="k">left</span><span class="o">.</span> <span class="k">apply</span> <span class="n">melem_of_op_singleton</span><span class="o">.</span>
</span><span id="linespan-143"><a id="line-143" name="line-143"></a>  <span class="o">-</span> <span class="k">intros</span> <span class="o">[</span><span class="bp">[]</span><span class="o">|</span><span class="bp">[]</span><span class="o">].</span>
</span><span id="linespan-144"><a id="line-144" name="line-144"></a>    <span class="o">+</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">-</span><span class="n">assoc</span><span class="o">.</span> <span class="k">apply</span> <span class="n">melem_of_op_singleton</span><span class="o">.</span>
</span><span id="linespan-145"><a id="line-145" name="line-145"></a>    <span class="o">+</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">comm</span> <span class="o">-</span><span class="n">assoc</span><span class="o">.</span> <span class="k">apply</span> <span class="n">melem_of_op_singleton</span><span class="o">.</span>
</span><span id="linespan-146"><a id="line-146" name="line-146"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-147"><a id="line-147" name="line-147"></a>
</span><span id="linespan-148"><a id="line-148" name="line-148"></a><span class="kn">Definition</span> <span class="n">mset_forall</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">P</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">A</span><span class="o">)</span> <span class="o">:=</span>
</span><span id="linespan-149"><a id="line-149" name="line-149"></a>  <span class="o">∀</span> <span class="n">a</span><span class="o">,</span> <span class="n">melem_of</span> <span class="n">a</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">P</span> <span class="n">a</span><span class="o">.</span>
</span><span id="linespan-150"><a id="line-150" name="line-150"></a>
</span><span id="linespan-151"><a id="line-151" name="line-151"></a><span class="kn">Lemma</span> <span class="n">mset_forall_op</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">P</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">x1</span> <span class="n">x2</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-152"><a id="line-152" name="line-152"></a>  <span class="n">mset_forall</span> <span class="n">P</span> <span class="o">(</span><span class="n">x1</span> <span class="bp">⋅</span> <span class="n">x2</span><span class="o">)</span> <span class="o">&lt;-&gt;</span> <span class="n">mset_forall</span> <span class="n">P</span> <span class="n">x1</span> <span class="o">∧</span> <span class="n">mset_forall</span> <span class="n">P</span> <span class="n">x2</span><span class="o">.</span>
</span><span id="linespan-153"><a id="line-153" name="line-153"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-154"><a id="line-154" name="line-154"></a>  <span class="k">split</span><span class="o">;</span> <span class="k">intros</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-155"><a id="line-155" name="line-155"></a>  <span class="o">-</span> <span class="k">split</span><span class="o">.</span>
</span><span id="linespan-156"><a id="line-156" name="line-156"></a>    <span class="o">+</span> <span class="k">intros</span> <span class="o">??.</span> <span class="k">eapply</span> <span class="n">H</span><span class="o">.</span> <span class="k">apply</span> <span class="n">melem_of_op</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-157"><a id="line-157" name="line-157"></a>    <span class="o">+</span> <span class="k">intros</span> <span class="o">??.</span> <span class="k">eapply</span> <span class="n">H</span><span class="o">.</span> <span class="k">apply</span> <span class="n">melem_of_op</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-158"><a id="line-158" name="line-158"></a>  <span class="o">-</span> <span class="k">intros</span> <span class="o">??.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-159"><a id="line-159" name="line-159"></a>    <span class="k">eapply</span> <span class="n">melem_of_op</span> <span class="k">in</span> <span class="n">H0</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-160"><a id="line-160" name="line-160"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-161"><a id="line-161" name="line-161"></a>
</span><span id="linespan-162"><a id="line-162" name="line-162"></a><span class="kn">Lemma</span> <span class="n">mset_forall_singleton</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">`{@</span><span class="n">LeibnizEquiv</span> <span class="n">A</span> <span class="o">(</span><span class="n">ofe_equiv</span> <span class="n">A</span><span class="o">)}</span> <span class="o">(</span><span class="n">P</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-163"><a id="line-163" name="line-163"></a>  <span class="n">mset_forall</span> <span class="n">P</span> <span class="o">{[</span> <span class="n">a</span> <span class="o">]}</span> <span class="o">&lt;-&gt;</span> <span class="n">P</span> <span class="n">a</span><span class="o">.</span>
</span><span id="linespan-164"><a id="line-164" name="line-164"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-165"><a id="line-165" name="line-165"></a>  <span class="k">split</span><span class="o">;</span> <span class="k">intros</span> <span class="n">H'</span><span class="o">.</span>
</span><span id="linespan-166"><a id="line-166" name="line-166"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">H'</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">melem_of_singleton</span><span class="o">.</span>
</span><span id="linespan-167"><a id="line-167" name="line-167"></a>  <span class="o">-</span> <span class="k">intros</span> <span class="o">??.</span> <span class="k">eapply</span> <span class="n">melem_of_singleton_inv</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-168"><a id="line-168" name="line-168"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-169"><a id="line-169" name="line-169"></a>
</span><span id="linespan-170"><a id="line-170" name="line-170"></a><span class="kn">Record</span> <span class="n">lockrelG'</span> <span class="o">(</span><span class="n">order</span> <span class="o">:</span> <span class="n">list</span> <span class="n">nat</span><span class="o">)</span> <span class="o">(</span><span class="n">refcnt</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">(</span><span class="n">xs</span> <span class="o">:</span> <span class="n">locksbundle</span><span class="o">)</span> <span class="o">(</span><span class="n">ts</span> <span class="o">:</span> <span class="n">gmap</span> <span class="n">nat</span> <span class="n">type</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">labelO</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="o">{</span>
</span><span id="linespan-171"><a id="line-171" name="line-171"></a>  <span class="n">order_NoDup</span> <span class="o">:</span> <span class="n">NoDup</span> <span class="n">order</span><span class="o">;</span>
</span><span id="linespan-172"><a id="line-172" name="line-172"></a>  <span class="n">order_dom</span> <span class="o">:</span> <span class="n">list_to_set</span> <span class="n">order</span> <span class="o">=</span> <span class="n">dom</span> <span class="n">xs</span><span class="o">;</span>
</span><span id="linespan-173"><a id="line-173" name="line-173"></a>  <span class="n">order_subsequences</span> <span class="o">:</span> <span class="n">mset_forall</span> <span class="o">(λ</span> <span class="n">l</span><span class="o">,</span> <span class="o">∃</span> <span class="n">xs</span><span class="o">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">LockLabel</span> <span class="n">xs</span> <span class="o">∧</span> <span class="n">sublist</span> <span class="o">(</span><span class="n">xs</span><span class="o">.*</span><span class="mi">1</span><span class="o">)</span> <span class="n">order</span><span class="o">)</span> <span class="n">x</span><span class="o">;</span>
</span><span id="linespan-174"><a id="line-174" name="line-174"></a>  <span class="n">lr_lockrel</span> <span class="o">:</span> <span class="o">∀</span> <span class="n">i</span><span class="o">,</span> <span class="k">match</span> <span class="n">xs</span> <span class="o">!!</span> <span class="n">i</span><span class="o">,</span> <span class="n">ts</span> <span class="o">!!</span> <span class="n">i</span> <span class="k">with</span>
</span><span id="linespan-175"><a id="line-175" name="line-175"></a>    <span class="o">|</span> <span class="n">Some</span> <span class="o">(</span><span class="n">refcounti</span><span class="o">,</span> <span class="n">o</span><span class="o">),</span> <span class="n">Some</span> <span class="n">t</span> <span class="o">=&gt;</span> <span class="n">lockrel</span> <span class="n">refcounti</span> <span class="n">o</span> <span class="n">t</span> <span class="o">(</span><span class="n">extract</span> <span class="n">i</span> <span class="n">x</span><span class="o">)</span>
</span><span id="linespan-176"><a id="line-176" name="line-176"></a>    <span class="o">|</span> <span class="n">None</span><span class="o">,</span> <span class="n">None</span> <span class="o">=&gt;</span> <span class="n">True</span>
</span><span id="linespan-177"><a id="line-177" name="line-177"></a>    <span class="o">|</span> <span class="o">_,</span> <span class="o">_</span> <span class="o">=&gt;</span> <span class="n">False</span>
</span><span id="linespan-178"><a id="line-178" name="line-178"></a>    <span class="k">end</span><span class="o">;</span>
</span><span id="linespan-179"><a id="line-179" name="line-179"></a>  <span class="n">lr_refcount</span> <span class="o">:</span> <span class="n">Mlen</span> <span class="n">x</span> <span class="o">=</span> <span class="n">refcnt</span><span class="o">;</span>
</span><span id="linespan-180"><a id="line-180" name="line-180"></a><span class="o">}.</span>
</span><span id="linespan-181"><a id="line-181" name="line-181"></a>
</span><span id="linespan-182"><a id="line-182" name="line-182"></a><span class="kn">Definition</span> <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="n">ts</span> <span class="n">x</span> <span class="o">:=</span> <span class="o">∃</span> <span class="n">order</span><span class="o">,</span> <span class="n">lockrelG'</span> <span class="n">order</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="n">ts</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-183"><a id="line-183" name="line-183"></a>
</span><span id="linespan-184"><a id="line-184" name="line-184"></a><span class="kn">Global</span> <span class="kn">Instance</span> <span class="n">mset_forall_Proper</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">:</span> <span class="n">Proper</span> <span class="o">(((</span><span class="bp">≡</span><span class="o">)</span> <span class="o">==&gt;</span> <span class="n">iff</span><span class="o">)</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="bp">≡</span><span class="o">)</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="bp">≡</span><span class="o">))</span> <span class="o">(@</span><span class="n">mset_forall</span> <span class="n">A</span><span class="o">).</span>
</span><span id="linespan-185"><a id="line-185" name="line-185"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-186"><a id="line-186" name="line-186"></a>  <span class="k">intros</span> <span class="o">??????.</span>
</span><span id="linespan-187"><a id="line-187" name="line-187"></a>  <span class="k">split</span><span class="o">.</span>
</span><span id="linespan-188"><a id="line-188" name="line-188"></a>  <span class="o">{</span> <span class="k">intros</span> <span class="o">???.</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">H</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-189"><a id="line-189" name="line-189"></a>  <span class="o">{</span> <span class="k">intros</span> <span class="o">???.</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">H</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-190"><a id="line-190" name="line-190"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-191"><a id="line-191" name="line-191"></a>
</span><span id="linespan-192"><a id="line-192" name="line-192"></a><span class="kn">Global</span> <span class="kn">Instance</span> <span class="n">lockrelG_Proper</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="o">:</span>
</span><span id="linespan-193"><a id="line-193" name="line-193"></a>  <span class="n">Proper</span> <span class="o">((</span><span class="bp">≡</span><span class="o">)</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="bp">≡</span><span class="o">)</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="bp">≡</span><span class="o">))</span> <span class="o">(</span><span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="n">xs</span><span class="o">).</span>
</span><span id="linespan-194"><a id="line-194" name="line-194"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-195"><a id="line-195" name="line-195"></a>  <span class="k">intros</span> <span class="o">??????.</span>
</span><span id="linespan-196"><a id="line-196" name="line-196"></a>  <span class="k">split</span><span class="o">.</span>
</span><span id="linespan-197"><a id="line-197" name="line-197"></a>  <span class="o">{</span>
</span><span id="linespan-198"><a id="line-198" name="line-198"></a>    <span class="k">intros</span> <span class="o">[</span><span class="n">order</span> <span class="bp">[]</span><span class="o">].</span> <span class="n">ofe_subst</span><span class="o">.</span> <span class="kr">do</span> <span class="mi">2</span> <span class="k">econstructor</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span>
</span><span id="linespan-199"><a id="line-199" name="line-199"></a>    <span class="kr">try</span> <span class="k">rewrite</span> <span class="o">-</span><span class="n">H0</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-200"><a id="line-200" name="line-200"></a>    <span class="k">intros</span><span class="o">.</span> <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_lockrel0</span> <span class="n">i</span><span class="o">).</span>
</span><span id="linespan-201"><a id="line-201" name="line-201"></a>    <span class="k">destruct</span> <span class="o">(</span><span class="n">xs</span><span class="o">!!</span><span class="n">i</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">y</span><span class="o">!!</span><span class="n">i</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-202"><a id="line-202" name="line-202"></a>    <span class="k">eapply</span> <span class="n">lockrel_Proper</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">H0</span> <span class="o">//.</span>
</span><span id="linespan-203"><a id="line-203" name="line-203"></a>  <span class="o">}</span>
</span><span id="linespan-204"><a id="line-204" name="line-204"></a>  <span class="o">{</span>
</span><span id="linespan-205"><a id="line-205" name="line-205"></a>    <span class="k">intros</span> <span class="o">[</span><span class="n">order</span> <span class="bp">[]</span><span class="o">].</span> <span class="n">ofe_subst</span><span class="o">.</span> <span class="kr">do</span> <span class="mi">2</span> <span class="k">econstructor</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span>
</span><span id="linespan-206"><a id="line-206" name="line-206"></a>    <span class="kr">try</span> <span class="k">rewrite</span> <span class="n">H0</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-207"><a id="line-207" name="line-207"></a>    <span class="k">intros</span><span class="o">.</span> <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_lockrel0</span> <span class="n">i</span><span class="o">).</span>
</span><span id="linespan-208"><a id="line-208" name="line-208"></a>    <span class="k">destruct</span> <span class="o">(</span><span class="n">xs</span><span class="o">!!</span><span class="n">i</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">y</span><span class="o">!!</span><span class="n">i</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-209"><a id="line-209" name="line-209"></a>    <span class="k">eapply</span> <span class="n">lockrel_Proper</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">H0</span> <span class="o">//.</span>
</span><span id="linespan-210"><a id="line-210" name="line-210"></a>  <span class="o">}</span>
</span><span id="linespan-211"><a id="line-211" name="line-211"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-212"><a id="line-212" name="line-212"></a>
</span><span id="linespan-213"><a id="line-213" name="line-213"></a><span class="kn">Lemma</span> <span class="n">lockrel_newlock</span> <span class="n">v</span> <span class="n">t</span> <span class="o">:</span>
</span><span id="linespan-214"><a id="line-214" name="line-214"></a>  <span class="n">lockrel</span> <span class="mi">0</span> <span class="o">(</span><span class="n">Some</span> <span class="n">v</span><span class="o">)</span> <span class="n">t</span> <span class="o">{[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">)</span> <span class="o">:</span> <span class="n">labelO'</span> <span class="o">]}.</span>
</span><span id="linespan-215"><a id="line-215" name="line-215"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-216"><a id="line-216" name="line-216"></a>  <span class="n">eexists</span> <span class="n">Closed</span> <span class="n">ε</span> <span class="n">ε</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-217"><a id="line-217" name="line-217"></a>  <span class="k">intros</span> <span class="n">l</span> <span class="n">x_closed'</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-218"><a id="line-218" name="line-218"></a>  <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-219"><a id="line-219" name="line-219"></a>  <span class="k">eapply</span> <span class="n">multiset_op_unit</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-220"><a id="line-220" name="line-220"></a>  <span class="k">eapply</span> <span class="n">multiset_singleton_not_unit</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-221"><a id="line-221" name="line-221"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-222"><a id="line-222" name="line-222"></a>
</span><span id="linespan-223"><a id="line-223" name="line-223"></a><span class="kn">Lemma</span> <span class="n">lockrel_newlock'</span> <span class="n">t</span> <span class="o">:</span>
</span><span id="linespan-224"><a id="line-224" name="line-224"></a>  <span class="n">lockrel</span> <span class="mi">0</span> <span class="n">None</span> <span class="n">t</span> <span class="o">{[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t</span><span class="o">)</span> <span class="o">:</span> <span class="n">labelO'</span> <span class="o">]}.</span>
</span><span id="linespan-225"><a id="line-225" name="line-225"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-226"><a id="line-226" name="line-226"></a>  <span class="n">eexists</span> <span class="n">Opened</span> <span class="n">ε</span> <span class="n">ε</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-227"><a id="line-227" name="line-227"></a>  <span class="k">intros</span> <span class="n">l</span> <span class="n">x_closed'</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-228"><a id="line-228" name="line-228"></a>  <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-229"><a id="line-229" name="line-229"></a>  <span class="k">eapply</span> <span class="n">multiset_op_unit</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-230"><a id="line-230" name="line-230"></a>  <span class="k">eapply</span> <span class="n">multiset_singleton_not_unit</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-231"><a id="line-231" name="line-231"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-232"><a id="line-232" name="line-232"></a>
</span><span id="linespan-233"><a id="line-233" name="line-233"></a><span class="kn">Lemma</span> <span class="n">multiset_unit_empty_mult</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="n">l</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-234"><a id="line-234" name="line-234"></a>  <span class="n">ε</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="n">l</span> <span class="o">]}</span> <span class="bp">⋅</span> <span class="n">a</span> <span class="o">-&gt;</span> <span class="n">False</span><span class="o">.</span>
</span><span id="linespan-235"><a id="line-235" name="line-235"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-236"><a id="line-236" name="line-236"></a>  <span class="k">intros</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-237"><a id="line-237" name="line-237"></a>  <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-238"><a id="line-238" name="line-238"></a>  <span class="k">eapply</span> <span class="n">multiset_empty_mult</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span> <span class="k">subst</span><span class="o">.</span>
</span><span id="linespan-239"><a id="line-239" name="line-239"></a>  <span class="k">eapply</span> <span class="n">multiset_empty_neq_singleton</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-240"><a id="line-240" name="line-240"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-241"><a id="line-241" name="line-241"></a>
</span><span id="linespan-242"><a id="line-242" name="line-242"></a><span class="kn">Lemma</span> <span class="n">lockrel_same_type</span> <span class="n">refcnt</span> <span class="n">o</span> <span class="n">t</span> <span class="n">t'</span> <span class="n">l</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-243"><a id="line-243" name="line-243"></a>  <span class="n">lockrel</span> <span class="n">refcnt</span> <span class="n">o</span> <span class="n">t</span> <span class="o">({[</span> <span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">t'</span><span class="o">):</span><span class="n">labelO'</span> <span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">t'</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span>
</span><span id="linespan-244"><a id="line-244" name="line-244"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-245"><a id="line-245" name="line-245"></a>  <span class="k">intros</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-246"><a id="line-246" name="line-246"></a>  <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-247"><a id="line-247" name="line-247"></a>  <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span>
</span><span id="linespan-248"><a id="line-248" name="line-248"></a>  <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-249"><a id="line-249" name="line-249"></a>  <span class="k">destruct</span> <span class="n">H3</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-250"><a id="line-250" name="line-250"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">multiset_unit_equiv_eq</span> <span class="k">in</span> <span class="n">H13</span><span class="o">.</span> <span class="k">subst</span><span class="o">.</span>
</span><span id="linespan-251"><a id="line-251" name="line-251"></a>    <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H12</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_empty_mult</span> <span class="k">in</span> <span class="n">H12</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-252"><a id="line-252" name="line-252"></a>    <span class="k">subst</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H10</span><span class="o">.</span>
</span><span id="linespan-253"><a id="line-253" name="line-253"></a>    <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H11</span><span class="o">.</span>
</span><span id="linespan-254"><a id="line-254" name="line-254"></a>    <span class="k">rewrite</span> <span class="n">H15</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">&lt;-</span><span class="n">H10</span> <span class="k">in</span> <span class="n">H14</span><span class="o">.</span>
</span><span id="linespan-255"><a id="line-255" name="line-255"></a>    <span class="k">destruct</span> <span class="n">o</span><span class="o">.</span>
</span><span id="linespan-256"><a id="line-256" name="line-256"></a>    <span class="o">{</span> <span class="k">destruct</span> <span class="n">lr_openedclosed</span><span class="o">.</span> <span class="k">subst</span><span class="o">.</span>
</span><span id="linespan-257"><a id="line-257" name="line-257"></a>      <span class="k">eapply</span> <span class="n">multiset_unit_empty_mult</span> <span class="k">in</span> <span class="n">H7</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-258"><a id="line-258" name="line-258"></a>    <span class="k">destruct</span> <span class="n">lr_openedclosed</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-259"><a id="line-259" name="line-259"></a>    <span class="o">{</span> <span class="k">eapply</span> <span class="n">multiset_unit_empty_mult</span> <span class="k">in</span> <span class="n">H7</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-260"><a id="line-260" name="line-260"></a>    <span class="k">rewrite</span> <span class="n">H6</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span>
</span><span id="linespan-261"><a id="line-261" name="line-261"></a>    <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span>
</span><span id="linespan-262"><a id="line-262" name="line-262"></a>    <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H7</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-263"><a id="line-263" name="line-263"></a>    <span class="k">subst</span><span class="o">.</span>
</span><span id="linespan-264"><a id="line-264" name="line-264"></a>    <span class="n">inv</span> <span class="n">H</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-265"><a id="line-265" name="line-265"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">H15</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span>
</span><span id="linespan-266"><a id="line-266" name="line-266"></a>    <span class="k">rewrite</span> <span class="o">-</span><span class="n">H7</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span>
</span><span id="linespan-267"><a id="line-267" name="line-267"></a>    <span class="k">rewrite</span> <span class="n">H13</span> <span class="k">in</span> <span class="n">H12</span><span class="o">.</span>
</span><span id="linespan-268"><a id="line-268" name="line-268"></a>    <span class="k">clear</span> <span class="n">H15</span> <span class="n">H1</span><span class="o">.</span>
</span><span id="linespan-269"><a id="line-269" name="line-269"></a>    <span class="k">clear</span> <span class="n">H13</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-270"><a id="line-270" name="line-270"></a>    <span class="k">rewrite</span> <span class="n">H14</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span>
</span><span id="linespan-271"><a id="line-271" name="line-271"></a>    <span class="k">clear</span> <span class="n">H0</span> <span class="n">H14</span><span class="o">.</span>
</span><span id="linespan-272"><a id="line-272" name="line-272"></a>    <span class="k">setoid_rewrite</span> <span class="n">H11</span> <span class="k">in</span> <span class="n">lr_closed</span><span class="o">.</span>
</span><span id="linespan-273"><a id="line-273" name="line-273"></a>    <span class="k">clear</span> <span class="n">H11</span> <span class="n">x_closed</span><span class="o">.</span>
</span><span id="linespan-274"><a id="line-274" name="line-274"></a>    <span class="k">clear</span> <span class="n">H2</span> <span class="n">H7</span><span class="o">.</span>
</span><span id="linespan-275"><a id="line-275" name="line-275"></a>    <span class="k">clear</span> <span class="n">H4</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-276"><a id="line-276" name="line-276"></a>    <span class="k">clear</span> <span class="n">lr_openedclosed</span> <span class="n">x_opened</span><span class="o">.</span>
</span><span id="linespan-277"><a id="line-277" name="line-277"></a>    <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H12</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-278"><a id="line-278" name="line-278"></a>    <span class="o">+</span> <span class="k">setoid_rewrite</span> <span class="n">H1</span> <span class="k">in</span> <span class="n">lr_closed</span><span class="o">.</span>
</span><span id="linespan-279"><a id="line-279" name="line-279"></a>      <span class="k">assert</span> <span class="o">((</span><span class="n">l</span><span class="o">,</span><span class="n">t'</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span><span class="n">t</span><span class="o">)).</span>
</span><span id="linespan-280"><a id="line-280" name="line-280"></a>      <span class="o">{</span> <span class="k">eapply</span> <span class="n">lr_closed</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-281"><a id="line-281" name="line-281"></a>      <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-282"><a id="line-282" name="line-282"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="n">H0</span> <span class="k">in</span> <span class="n">H10</span><span class="o">.</span> <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H10</span><span class="o">.</span>
</span><span id="linespan-283"><a id="line-283" name="line-283"></a>      <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H10</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-284"><a id="line-284" name="line-284"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-285"><a id="line-285" name="line-285"></a>
</span><span id="linespan-286"><a id="line-286" name="line-286"></a><span class="kn">Lemma</span> <span class="n">lockrel_drop</span> <span class="n">refcnt</span> <span class="n">o</span> <span class="n">t</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-287"><a id="line-287" name="line-287"></a>  <span class="n">lockrel</span> <span class="o">(</span><span class="n">S</span> <span class="n">refcnt</span><span class="o">)</span> <span class="n">o</span> <span class="n">t</span> <span class="o">({[</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span> <span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-288"><a id="line-288" name="line-288"></a>  <span class="n">lockrel</span> <span class="n">refcnt</span> <span class="n">o</span> <span class="n">t</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-289"><a id="line-289" name="line-289"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-290"><a id="line-290" name="line-290"></a>  <span class="k">intros</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-291"><a id="line-291" name="line-291"></a>  <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-292"><a id="line-292" name="line-292"></a>  <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-293"><a id="line-293" name="line-293"></a>  <span class="k">rewrite</span> <span class="n">H7</span> <span class="k">in</span> <span class="n">lr_refcount0</span><span class="o">.</span>
</span><span id="linespan-294"><a id="line-294" name="line-294"></a>  <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H3</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-295"><a id="line-295" name="line-295"></a>  <span class="o">-</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span>
</span><span id="linespan-296"><a id="line-296" name="line-296"></a>    <span class="n">exfalso</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">o</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-297"><a id="line-297" name="line-297"></a>    <span class="o">+</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">multiset_unit_empty_mult</span><span class="o">.</span>
</span><span id="linespan-298"><a id="line-298" name="line-298"></a>    <span class="o">+</span> <span class="k">destruct</span> <span class="n">lr_openedclosed</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">multiset_unit_empty_mult</span><span class="o">.</span>
</span><span id="linespan-299"><a id="line-299" name="line-299"></a>      <span class="k">rewrite</span> <span class="n">H7</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H3</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-300"><a id="line-300" name="line-300"></a>  <span class="o">-</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-301"><a id="line-301" name="line-301"></a>    <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">lr_refcount0</span><span class="o">.</span>
</span><span id="linespan-302"><a id="line-302" name="line-302"></a>    <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-303"><a id="line-303" name="line-303"></a>    <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H6</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-304"><a id="line-304" name="line-304"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-305"><a id="line-305" name="line-305"></a>      <span class="n">eexists</span> <span class="o">_</span> <span class="o">_</span> <span class="o">_;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-306"><a id="line-306" name="line-306"></a>      <span class="k">intros</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">lr_closed</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">comm</span> <span class="o">-</span><span class="n">assoc</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-307"><a id="line-307" name="line-307"></a>    <span class="o">+</span> <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-308"><a id="line-308" name="line-308"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-309"><a id="line-309" name="line-309"></a>
</span><span id="linespan-310"><a id="line-310" name="line-310"></a><span class="c">(* Version that assumes wlog that l2 &lt;= l3 for some order. *)</span>
</span><span id="linespan-311"><a id="line-311" name="line-311"></a><span class="kn">Lemma</span> <span class="n">lockrel_split'</span> <span class="n">l</span> <span class="n">l2</span> <span class="n">l3</span> <span class="n">refcnt</span> <span class="n">o</span> <span class="n">t</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-312"><a id="line-312" name="line-312"></a>  <span class="o">((</span><span class="n">l2</span><span class="o">.</span><span class="mi">1</span> <span class="o">=</span> <span class="n">Owner</span> <span class="o">-&gt;</span> <span class="n">l3</span><span class="o">.</span><span class="mi">1</span> <span class="o">=</span> <span class="n">Owner</span><span class="o">)</span> <span class="o">∧</span>
</span><span id="linespan-313"><a id="line-313" name="line-313"></a>  <span class="o">(</span><span class="n">l2</span><span class="o">.</span><span class="mi">1</span> <span class="o">=</span> <span class="n">l3</span><span class="o">.</span><span class="mi">1</span> <span class="o">-&gt;</span> <span class="n">l2</span><span class="o">.</span><span class="mi">2</span> <span class="o">=</span> <span class="n">Closed</span> <span class="o">-&gt;</span> <span class="n">l3</span><span class="o">.</span><span class="mi">2</span> <span class="o">=</span> <span class="n">Closed</span><span class="o">))</span> <span class="o">-&gt;</span>
</span><span id="linespan-314"><a id="line-314" name="line-314"></a>  <span class="n">lockcap_split</span> <span class="n">l</span> <span class="n">l2</span> <span class="n">l3</span> <span class="o">-&gt;</span>
</span><span id="linespan-315"><a id="line-315" name="line-315"></a>  <span class="n">lockrel</span> <span class="n">refcnt</span> <span class="n">o</span> <span class="n">t</span> <span class="o">({[(</span><span class="n">l</span><span class="o">,</span><span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-316"><a id="line-316" name="line-316"></a>  <span class="n">lockrel</span> <span class="o">(</span><span class="n">S</span> <span class="n">refcnt</span><span class="o">)</span> <span class="n">o</span> <span class="n">t</span> <span class="o">({[(</span><span class="n">l3</span><span class="o">,</span><span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="o">{[(</span><span class="n">l2</span><span class="o">,</span><span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-317"><a id="line-317" name="line-317"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-318"><a id="line-318" name="line-318"></a>  <span class="k">intros</span> <span class="o">[</span><span class="n">HQ1</span> <span class="n">HQ2</span><span class="o">]</span> <span class="n">Hsplit</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-319"><a id="line-319" name="line-319"></a>  <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-320"><a id="line-320" name="line-320"></a>  <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H3</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-321"><a id="line-321" name="line-321"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-322"><a id="line-322" name="line-322"></a>    <span class="k">destruct</span> <span class="n">o</span><span class="o">.</span>
</span><span id="linespan-323"><a id="line-323" name="line-323"></a>    <span class="o">{</span> <span class="n">simp</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_unit_empty_mult</span> <span class="k">in</span> <span class="n">H7</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-324"><a id="line-324" name="line-324"></a>    <span class="k">destruct</span> <span class="n">lr_openedclosed</span><span class="o">.</span>
</span><span id="linespan-325"><a id="line-325" name="line-325"></a>    <span class="o">{</span> <span class="n">simp</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_unit_empty_mult</span> <span class="k">in</span> <span class="n">H7</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-326"><a id="line-326" name="line-326"></a>    <span class="n">simp</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-327"><a id="line-327" name="line-327"></a>    <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span>
</span><span id="linespan-328"><a id="line-328" name="line-328"></a>    <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-329"><a id="line-329" name="line-329"></a>    <span class="k">rewrite</span> <span class="n">right_id</span><span class="o">.</span>
</span><span id="linespan-330"><a id="line-330" name="line-330"></a>    <span class="n">inv</span> <span class="n">Hsplit</span><span class="o">.</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-331"><a id="line-331" name="line-331"></a>    <span class="k">destruct</span> <span class="n">l2</span><span class="o">,</span><span class="n">l3</span><span class="o">.</span>
</span><span id="linespan-332"><a id="line-332" name="line-332"></a>    <span class="n">inv</span> <span class="n">H</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-333"><a id="line-333" name="line-333"></a>    <span class="n">inv</span> <span class="n">H0</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="o">{</span> <span class="n">naive_solver</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-334"><a id="line-334" name="line-334"></a>    <span class="n">eexists</span> <span class="o">_</span> <span class="o">_</span> <span class="o">_.</span>
</span><span id="linespan-335"><a id="line-335" name="line-335"></a>    <span class="o">{</span>
</span><span id="linespan-336"><a id="line-336" name="line-336"></a>      <span class="k">assert</span> <span class="o">({[</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span> <span class="o">]}</span> <span class="bp">⋅</span>
</span><span id="linespan-337"><a id="line-337" name="line-337"></a>              <span class="o">{[</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span> <span class="o">]}</span> <span class="bp">⋅</span>
</span><span id="linespan-338"><a id="line-338" name="line-338"></a>              <span class="o">({[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span> <span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x_closed</span><span class="o">)</span>
</span><span id="linespan-339"><a id="line-339" name="line-339"></a>              <span class="bp">≡</span>
</span><span id="linespan-340"><a id="line-340" name="line-340"></a>              <span class="o">{[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span> <span class="o">]}</span> <span class="bp">⋅</span>
</span><span id="linespan-341"><a id="line-341" name="line-341"></a>              <span class="o">({[</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span> <span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x_closed</span><span class="o">)</span> <span class="bp">⋅</span>
</span><span id="linespan-342"><a id="line-342" name="line-342"></a>              <span class="o">{[</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span> <span class="o">]});</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-343"><a id="line-343" name="line-343"></a>      <span class="k">rewrite</span> <span class="n">Mpermute1</span><span class="o">.</span> <span class="n">f_equiv</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">-</span><span class="n">assoc</span><span class="o">.</span> <span class="n">f_equiv</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">comm</span> <span class="o">//.</span>
</span><span id="linespan-344"><a id="line-344" name="line-344"></a>    <span class="o">}</span>
</span><span id="linespan-345"><a id="line-345" name="line-345"></a>    <span class="o">+</span> <span class="k">intros</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-346"><a id="line-346" name="line-346"></a>      <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H5</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-347"><a id="line-347" name="line-347"></a>      <span class="o">*</span> <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-348"><a id="line-348" name="line-348"></a>      <span class="o">*</span> <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-349"><a id="line-349" name="line-349"></a>    <span class="o">+</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-350"><a id="line-350" name="line-350"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="n">Mlen_mult</span> <span class="o">!</span><span class="n">Mlen_singleton</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-351"><a id="line-351" name="line-351"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-352"><a id="line-352" name="line-352"></a>    <span class="k">destruct</span> <span class="n">l2</span><span class="o">,</span><span class="n">l3</span><span class="o">.</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-353"><a id="line-353" name="line-353"></a>    <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-354"><a id="line-354" name="line-354"></a>    <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-355"><a id="line-355" name="line-355"></a>    <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H4</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-356"><a id="line-356" name="line-356"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H6</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-357"><a id="line-357" name="line-357"></a>      <span class="k">assert</span> <span class="o">((</span><span class="n">l</span><span class="o">,</span> <span class="n">t</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">))</span> <span class="kp">by</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-358"><a id="line-358" name="line-358"></a>      <span class="k">destruct</span> <span class="n">Hsplit</span> <span class="k">as</span> <span class="o">[</span><span class="n">R1</span> <span class="n">R2</span><span class="o">].</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-359"><a id="line-359" name="line-359"></a>      <span class="n">inv</span> <span class="n">R1</span><span class="o">.</span> <span class="n">inv</span> <span class="n">R2</span><span class="o">.</span>
</span><span id="linespan-360"><a id="line-360" name="line-360"></a>      <span class="n">eexists</span> <span class="o">_</span> <span class="o">_</span> <span class="o">_.</span>
</span><span id="linespan-361"><a id="line-361" name="line-361"></a>      <span class="o">{</span>
</span><span id="linespan-362"><a id="line-362" name="line-362"></a>        <span class="k">assert</span> <span class="o">({[</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span>
</span><span id="linespan-363"><a id="line-363" name="line-363"></a>                <span class="o">{[</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span>
</span><span id="linespan-364"><a id="line-364" name="line-364"></a>                <span class="o">({[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">ls_owner</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">H3</span> <span class="bp">⋅</span> <span class="n">x_opened</span><span class="o">)</span>
</span><span id="linespan-365"><a id="line-365" name="line-365"></a>                <span class="bp">≡</span>
</span><span id="linespan-366"><a id="line-366" name="line-366"></a>                <span class="o">{[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">ls_owner</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span>
</span><span id="linespan-367"><a id="line-367" name="line-367"></a>                <span class="o">({[</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="o">{[(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">H3</span><span class="o">)</span> <span class="bp">⋅</span>
</span><span id="linespan-368"><a id="line-368" name="line-368"></a>                <span class="n">x_opened</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-369"><a id="line-369" name="line-369"></a>        <span class="k">rewrite</span> <span class="n">Mpermute1</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">-!</span><span class="n">assoc</span><span class="o">.</span> <span class="n">f_equiv</span><span class="o">.</span>
</span><span id="linespan-370"><a id="line-370" name="line-370"></a>        <span class="k">rewrite</span> <span class="o">!</span><span class="n">assoc</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">Mpermute1</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">-!</span><span class="n">assoc</span><span class="o">.</span>
</span><span id="linespan-371"><a id="line-371" name="line-371"></a>        <span class="n">f_equiv</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">assoc</span> <span class="n">Mpermute1</span> <span class="o">-</span><span class="n">assoc</span> <span class="o">//.</span>
</span><span id="linespan-372"><a id="line-372" name="line-372"></a>      <span class="o">}</span>
</span><span id="linespan-373"><a id="line-373" name="line-373"></a>      <span class="o">++</span> <span class="k">intros</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-374"><a id="line-374" name="line-374"></a>         <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H6</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-375"><a id="line-375" name="line-375"></a>         <span class="o">*</span> <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">lr_closed</span><span class="o">.</span>
</span><span id="linespan-376"><a id="line-376" name="line-376"></a>           <span class="k">rewrite</span> <span class="n">assoc</span> <span class="n">Mpermute1</span> <span class="n">Mpermute1</span> <span class="o">-</span><span class="n">assoc</span> <span class="o">//.</span>
</span><span id="linespan-377"><a id="line-377" name="line-377"></a>         <span class="o">*</span> <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_xsplit_singleton</span> <span class="k">in</span> <span class="n">H4</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-378"><a id="line-378" name="line-378"></a>      <span class="o">++</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-379"><a id="line-379" name="line-379"></a>      <span class="o">++</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">Mlen_mult</span> <span class="o">!</span><span class="n">Mlen_singleton</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">Mlen</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-380"><a id="line-380" name="line-380"></a>    <span class="o">+</span> <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H6</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H6</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-381"><a id="line-381" name="line-381"></a>      <span class="k">destruct</span> <span class="n">Hsplit</span> <span class="k">as</span> <span class="o">[</span><span class="n">R1</span> <span class="n">R2</span><span class="o">].</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-382"><a id="line-382" name="line-382"></a>      <span class="n">inv</span> <span class="n">R1</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="kr">last</span> <span class="n">naive_solver</span><span class="o">.</span>
</span><span id="linespan-383"><a id="line-383" name="line-383"></a>      <span class="k">clear</span> <span class="n">HQ1</span> <span class="n">HQ2</span><span class="o">.</span>
</span><span id="linespan-384"><a id="line-384" name="line-384"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">ε</span> <span class="bp">⋅</span> <span class="n">H3</span> <span class="o">=</span> <span class="n">H3</span><span class="o">)</span> <span class="k">as</span> <span class="n">HH</span><span class="o">.</span>
</span><span id="linespan-385"><a id="line-385" name="line-385"></a>      <span class="o">{</span> <span class="k">unfold</span> <span class="n">op</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">multiset_op_instance</span><span class="o">.</span>
</span><span id="linespan-386"><a id="line-386" name="line-386"></a>        <span class="k">simpl</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">H3</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-387"><a id="line-387" name="line-387"></a>      <span class="k">rewrite</span> <span class="n">HH</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">HH</span> <span class="k">in</span> <span class="n">lr_closed</span><span class="o">.</span>
</span><span id="linespan-388"><a id="line-388" name="line-388"></a>      <span class="k">rewrite</span> <span class="n">assoc</span><span class="o">.</span>
</span><span id="linespan-389"><a id="line-389" name="line-389"></a>      <span class="k">destruct</span> <span class="n">l1</span><span class="o">.</span>
</span><span id="linespan-390"><a id="line-390" name="line-390"></a>      <span class="o">{</span>
</span><span id="linespan-391"><a id="line-391" name="line-391"></a>        <span class="n">inv</span> <span class="n">R2</span><span class="o">.</span>
</span><span id="linespan-392"><a id="line-392" name="line-392"></a>        <span class="k">destruct</span> <span class="n">o</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">lr_openedclosed</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-393"><a id="line-393" name="line-393"></a>        <span class="k">rewrite</span> <span class="n">Mlen_unit</span> <span class="n">right_id</span><span class="o">.</span>
</span><span id="linespan-394"><a id="line-394" name="line-394"></a>        <span class="k">rewrite</span> <span class="n">Mpermute2</span> <span class="o">-</span><span class="n">assoc</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">comm</span><span class="o">.</span>
</span><span id="linespan-395"><a id="line-395" name="line-395"></a>        <span class="n">eexists</span> <span class="o">_</span> <span class="o">_</span> <span class="o">_;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-396"><a id="line-396" name="line-396"></a>        <span class="k">rewrite</span> <span class="n">Mlen_singleton</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-397"><a id="line-397" name="line-397"></a>      <span class="o">}</span>
</span><span id="linespan-398"><a id="line-398" name="line-398"></a>      <span class="o">{</span>
</span><span id="linespan-399"><a id="line-399" name="line-399"></a>        <span class="k">assert</span> <span class="o">(</span>
</span><span id="linespan-400"><a id="line-400" name="line-400"></a>          <span class="o">{[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">l3</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="o">{[</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">H3</span> <span class="bp">⋅</span> <span class="n">x_opened</span> <span class="bp">≡</span>
</span><span id="linespan-401"><a id="line-401" name="line-401"></a>          <span class="o">{[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">l3</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="o">({[</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">H3</span><span class="o">)</span> <span class="bp">⋅</span> <span class="n">x_opened</span>
</span><span id="linespan-402"><a id="line-402" name="line-402"></a>        <span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;</span> <span class="kp">by</span> <span class="k">rewrite</span> <span class="n">assoc</span> <span class="o">//.</span>
</span><span id="linespan-403"><a id="line-403" name="line-403"></a>        <span class="n">eexists</span> <span class="o">_</span> <span class="o">_</span> <span class="o">_;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-404"><a id="line-404" name="line-404"></a>        <span class="o">-</span> <span class="k">intros</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="k">clear</span> <span class="n">HH</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-405"><a id="line-405" name="line-405"></a>          <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H6</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-406"><a id="line-406" name="line-406"></a>          <span class="o">+</span> <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-407"><a id="line-407" name="line-407"></a>          <span class="o">+</span> <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-408"><a id="line-408" name="line-408"></a>        <span class="o">-</span> <span class="k">destruct</span> <span class="n">o</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="n">inv</span> <span class="n">R2</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-409"><a id="line-409" name="line-409"></a>      <span class="o">}</span>
</span><span id="linespan-410"><a id="line-410" name="line-410"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-411"><a id="line-411" name="line-411"></a>
</span><span id="linespan-412"><a id="line-412" name="line-412"></a><span class="kn">Lemma</span> <span class="n">lockrel_split</span> <span class="n">l</span> <span class="n">l2</span> <span class="n">l3</span> <span class="n">refcnt</span> <span class="n">o</span> <span class="n">t</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-413"><a id="line-413" name="line-413"></a>  <span class="n">lockcap_split</span> <span class="n">l</span> <span class="n">l2</span> <span class="n">l3</span> <span class="o">-&gt;</span>
</span><span id="linespan-414"><a id="line-414" name="line-414"></a>  <span class="n">lockrel</span> <span class="n">refcnt</span> <span class="n">o</span> <span class="n">t</span> <span class="o">({[</span> <span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-415"><a id="line-415" name="line-415"></a>  <span class="n">lockrel</span> <span class="o">(</span><span class="n">S</span> <span class="n">refcnt</span><span class="o">)</span> <span class="n">o</span> <span class="n">t</span> <span class="o">({[</span> <span class="o">(</span><span class="n">l3</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="o">{[</span> <span class="o">(</span><span class="n">l2</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-416"><a id="line-416" name="line-416"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-417"><a id="line-417" name="line-417"></a>  <span class="k">intros</span> <span class="o">[</span><span class="n">H1</span> <span class="n">H2</span><span class="o">]</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-418"><a id="line-418" name="line-418"></a>  <span class="k">destruct</span> <span class="n">l</span><span class="o">,</span><span class="n">l2</span><span class="o">,</span><span class="n">l3</span><span class="o">.</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-419"><a id="line-419" name="line-419"></a>  <span class="n">inv</span> <span class="n">H1</span><span class="o">;</span> <span class="n">inv</span> <span class="n">H2</span><span class="o">;</span>
</span><span id="linespan-420"><a id="line-420" name="line-420"></a>  <span class="kr">try</span> <span class="kp">solve</span> <span class="o">[</span>
</span><span id="linespan-421"><a id="line-421" name="line-421"></a>    <span class="k">eapply</span> <span class="n">lockrel_split'</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span>
</span><span id="linespan-422"><a id="line-422" name="line-422"></a>    <span class="o">[</span><span class="n">naive_solver</span> <span class="o">|</span> <span class="k">split</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">lockownership_split</span><span class="o">,</span> <span class="n">lockstate_split</span><span class="o">]</span>
</span><span id="linespan-423"><a id="line-423" name="line-423"></a>  <span class="o">];</span> <span class="k">rewrite</span> <span class="n">Mpermute2</span><span class="o">;</span>
</span><span id="linespan-424"><a id="line-424" name="line-424"></a>  <span class="kr">try</span> <span class="kp">solve</span> <span class="o">[</span>
</span><span id="linespan-425"><a id="line-425" name="line-425"></a>    <span class="k">eapply</span> <span class="n">lockrel_split'</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span>
</span><span id="linespan-426"><a id="line-426" name="line-426"></a>    <span class="o">[</span><span class="n">naive_solver</span> <span class="o">|</span> <span class="k">split</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">lockownership_split</span><span class="o">,</span> <span class="n">lockstate_split</span><span class="o">]</span>
</span><span id="linespan-427"><a id="line-427" name="line-427"></a>  <span class="o">].</span>
</span><span id="linespan-428"><a id="line-428" name="line-428"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-429"><a id="line-429" name="line-429"></a>
</span><span id="linespan-430"><a id="line-430" name="line-430"></a><span class="kn">Lemma</span> <span class="n">lockrel_open_close</span> <span class="n">refcnt</span> <span class="n">v</span> <span class="n">t</span> <span class="n">lo</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-431"><a id="line-431" name="line-431"></a>  <span class="n">lockrel</span> <span class="n">refcnt</span> <span class="o">(</span><span class="n">Some</span> <span class="n">v</span><span class="o">)</span> <span class="n">t</span> <span class="o">({[</span> <span class="o">(</span><span class="n">lo</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">)</span> <span class="o">&lt;-&gt;</span>
</span><span id="linespan-432"><a id="line-432" name="line-432"></a>  <span class="n">lockrel</span> <span class="n">refcnt</span> <span class="n">None</span> <span class="n">t</span> <span class="o">({[</span> <span class="o">(</span><span class="n">lo</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-433"><a id="line-433" name="line-433"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-434"><a id="line-434" name="line-434"></a>  <span class="k">split</span><span class="o">;</span> <span class="k">intros</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-435"><a id="line-435" name="line-435"></a>  <span class="o">{</span>
</span><span id="linespan-436"><a id="line-436" name="line-436"></a>    <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-437"><a id="line-437" name="line-437"></a>    <span class="k">rewrite</span> <span class="n">right_id</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span>
</span><span id="linespan-438"><a id="line-438" name="line-438"></a>    <span class="k">rewrite</span> <span class="n">Mlen_unit</span><span class="o">.</span>
</span><span id="linespan-439"><a id="line-439" name="line-439"></a>    <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-440"><a id="line-440" name="line-440"></a>    <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H3</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-441"><a id="line-441" name="line-441"></a>    <span class="o">-</span> <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-442"><a id="line-442" name="line-442"></a>      <span class="k">assert</span> <span class="o">(</span> <span class="o">(</span><span class="n">lo</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">)</span> <span class="o">=</span>  <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">))</span> <span class="kp">by</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-443"><a id="line-443" name="line-443"></a>      <span class="k">assert</span> <span class="o">(</span>
</span><span id="linespan-444"><a id="line-444" name="line-444"></a>        <span class="o">{[</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="o">({[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">H2</span><span class="o">)</span> <span class="bp">≡</span>
</span><span id="linespan-445"><a id="line-445" name="line-445"></a>        <span class="o">{[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">H2</span> <span class="bp">⋅</span> <span class="o">{[</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span>
</span><span id="linespan-446"><a id="line-446" name="line-446"></a>      <span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-447"><a id="line-447" name="line-447"></a>      <span class="o">{</span>
</span><span id="linespan-448"><a id="line-448" name="line-448"></a>        <span class="k">rewrite</span> <span class="n">assoc</span> <span class="n">Mpermute1</span> <span class="n">Mpermute1</span> <span class="o">//.</span>
</span><span id="linespan-449"><a id="line-449" name="line-449"></a>      <span class="o">}</span>
</span><span id="linespan-450"><a id="line-450" name="line-450"></a>      <span class="k">econstructor</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-451"><a id="line-451" name="line-451"></a>      <span class="o">+</span> <span class="k">intros</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">lr_closed</span><span class="o">.</span>
</span><span id="linespan-452"><a id="line-452" name="line-452"></a>        <span class="k">rewrite</span> <span class="n">assoc</span> <span class="n">Mpermute1</span> <span class="n">Mpermute1</span> <span class="o">-</span><span class="n">assoc</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-453"><a id="line-453" name="line-453"></a>      <span class="o">+</span> <span class="k">rewrite</span> <span class="n">Mlen_singleton</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">H2</span><span class="o">;</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-454"><a id="line-454" name="line-454"></a>        <span class="k">unfold</span> <span class="n">Mlen</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-455"><a id="line-455" name="line-455"></a>    <span class="o">-</span> <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-456"><a id="line-456" name="line-456"></a>      <span class="k">assert</span> <span class="o">({[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="o">(</span><span class="n">ε</span> <span class="bp">⋅</span> <span class="n">H2</span><span class="o">)</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">H2</span> <span class="bp">⋅</span> <span class="n">ε</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-457"><a id="line-457" name="line-457"></a>      <span class="o">{</span>
</span><span id="linespan-458"><a id="line-458" name="line-458"></a>        <span class="k">rewrite</span> <span class="n">left_id</span> <span class="n">right_id</span> <span class="n">comm</span> <span class="o">//.</span>
</span><span id="linespan-459"><a id="line-459" name="line-459"></a>      <span class="o">}</span>
</span><span id="linespan-460"><a id="line-460" name="line-460"></a>      <span class="k">econstructor</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-461"><a id="line-461" name="line-461"></a>  <span class="o">}</span>
</span><span id="linespan-462"><a id="line-462" name="line-462"></a>  <span class="o">{</span>
</span><span id="linespan-463"><a id="line-463" name="line-463"></a>    <span class="n">simp</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span> <span class="n">simp</span><span class="o">;</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-464"><a id="line-464" name="line-464"></a>    <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H3</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-465"><a id="line-465" name="line-465"></a>    <span class="o">-</span> <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-466"><a id="line-466" name="line-466"></a>      <span class="k">destruct</span> <span class="n">lr_openedclosed</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-467"><a id="line-467" name="line-467"></a>      <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span>
</span><span id="linespan-468"><a id="line-468" name="line-468"></a>      <span class="k">eapply</span> <span class="n">multiset_empty_mult</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-469"><a id="line-469" name="line-469"></a>      <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span>
</span><span id="linespan-470"><a id="line-470" name="line-470"></a>      <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-471"><a id="line-471" name="line-471"></a>      <span class="k">rewrite</span> <span class="n">right_id</span><span class="o">.</span>
</span><span id="linespan-472"><a id="line-472" name="line-472"></a>      <span class="k">assert</span> <span class="o">(</span>
</span><span id="linespan-473"><a id="line-473" name="line-473"></a>        <span class="o">{[</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="o">({[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x_closed</span><span class="o">)</span> <span class="bp">≡</span>
</span><span id="linespan-474"><a id="line-474" name="line-474"></a>        <span class="o">{[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="o">({[</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x_closed</span><span class="o">)</span> <span class="bp">⋅</span> <span class="n">ε</span>
</span><span id="linespan-475"><a id="line-475" name="line-475"></a>      <span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-476"><a id="line-476" name="line-476"></a>      <span class="o">{</span>
</span><span id="linespan-477"><a id="line-477" name="line-477"></a>        <span class="k">rewrite</span> <span class="n">assoc</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">right_id</span><span class="o">.</span>
</span><span id="linespan-478"><a id="line-478" name="line-478"></a>        <span class="k">rewrite</span> <span class="n">assoc</span><span class="o">.</span>
</span><span id="linespan-479"><a id="line-479" name="line-479"></a>        <span class="k">rewrite</span> <span class="n">Mpermute1</span> <span class="n">Mpermute1</span><span class="o">.</span>
</span><span id="linespan-480"><a id="line-480" name="line-480"></a>        <span class="k">rewrite</span> <span class="o">-!</span><span class="n">assoc</span><span class="o">.</span> <span class="n">f_equiv</span><span class="o">.</span>
</span><span id="linespan-481"><a id="line-481" name="line-481"></a>        <span class="k">rewrite</span> <span class="n">comm</span> <span class="o">//.</span>
</span><span id="linespan-482"><a id="line-482" name="line-482"></a>      <span class="o">}</span>
</span><span id="linespan-483"><a id="line-483" name="line-483"></a>      <span class="k">econstructor</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-484"><a id="line-484" name="line-484"></a>      <span class="o">+</span> <span class="k">intros</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-485"><a id="line-485" name="line-485"></a>        <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H5</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-486"><a id="line-486" name="line-486"></a>        <span class="o">*</span> <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-487"><a id="line-487" name="line-487"></a>        <span class="o">*</span> <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-488"><a id="line-488" name="line-488"></a>      <span class="o">+</span> <span class="k">rewrite</span> <span class="n">Mlen_mult</span> <span class="o">!</span><span class="n">Mlen_singleton</span> <span class="n">Mlen_unit</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-489"><a id="line-489" name="line-489"></a>    <span class="o">-</span> <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-490"><a id="line-490" name="line-490"></a>      <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-491"><a id="line-491" name="line-491"></a>      <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H6</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-492"><a id="line-492" name="line-492"></a>      <span class="o">{</span> <span class="k">assert</span> <span class="o">(</span> <span class="o">(</span><span class="n">lo</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">))</span> <span class="kp">by</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-493"><a id="line-493" name="line-493"></a>      <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span>
</span><span id="linespan-494"><a id="line-494" name="line-494"></a>      <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-495"><a id="line-495" name="line-495"></a>      <span class="k">destruct</span> <span class="n">lr_openedclosed</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-496"><a id="line-496" name="line-496"></a>      <span class="k">rewrite</span> <span class="n">Mlen_mult</span><span class="o">.</span>
</span><span id="linespan-497"><a id="line-497" name="line-497"></a>      <span class="k">rewrite</span> <span class="n">left_id</span><span class="o">.</span>
</span><span id="linespan-498"><a id="line-498" name="line-498"></a>      <span class="k">rewrite</span> <span class="n">assoc</span><span class="o">.</span>
</span><span id="linespan-499"><a id="line-499" name="line-499"></a>      <span class="k">rewrite</span> <span class="n">Mlen_unit</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-500"><a id="line-500" name="line-500"></a>      <span class="k">econstructor</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-501"><a id="line-501" name="line-501"></a>  <span class="o">}</span>
</span><span id="linespan-502"><a id="line-502" name="line-502"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-503"><a id="line-503" name="line-503"></a>
</span><span id="linespan-504"><a id="line-504" name="line-504"></a><span class="kn">Lemma</span> <span class="n">lockrel_only_owner</span> <span class="n">v</span> <span class="n">t</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-505"><a id="line-505" name="line-505"></a>  <span class="n">lockrel</span> <span class="mi">0</span> <span class="o">(</span><span class="n">Some</span> <span class="n">v</span><span class="o">)</span> <span class="n">t</span> <span class="o">({[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">ε</span><span class="o">.</span>
</span><span id="linespan-506"><a id="line-506" name="line-506"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-507"><a id="line-507" name="line-507"></a>  <span class="k">intros</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-508"><a id="line-508" name="line-508"></a>  <span class="k">destruct</span> <span class="n">lr_openedclosed</span><span class="o">.</span> <span class="k">subst</span><span class="o">.</span>
</span><span id="linespan-509"><a id="line-509" name="line-509"></a>  <span class="k">rewrite</span> <span class="n">Mlen_unit</span> <span class="k">in</span> <span class="n">lr_refcount0</span><span class="o">.</span>
</span><span id="linespan-510"><a id="line-510" name="line-510"></a>  <span class="k">assert</span> <span class="o">(</span><span class="n">Mlen</span> <span class="n">x_closed</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;%</span><span class="n">Mlen_zero_inv</span> <span class="kp">by</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-511"><a id="line-511" name="line-511"></a>  <span class="k">rewrite</span> <span class="o">!</span><span class="n">right_id</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span>
</span><span id="linespan-512"><a id="line-512" name="line-512"></a>  <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">lr_split</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-513"><a id="line-513" name="line-513"></a>  <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-514"><a id="line-514" name="line-514"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-515"><a id="line-515" name="line-515"></a>
</span><span id="linespan-516"><a id="line-516" name="line-516"></a><span class="kn">Lemma</span> <span class="n">lockrel_progress</span> <span class="n">refcnt</span> <span class="n">o</span> <span class="n">t</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-517"><a id="line-517" name="line-517"></a>  <span class="n">lockrel</span> <span class="n">refcnt</span> <span class="n">o</span> <span class="n">t</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="o">∃</span> <span class="n">l</span> <span class="n">x'</span><span class="o">,</span>
</span><span id="linespan-518"><a id="line-518" name="line-518"></a>    <span class="n">x</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span> <span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x'</span> <span class="o">∧</span>
</span><span id="linespan-519"><a id="line-519" name="line-519"></a>    <span class="n">l</span> <span class="o">=</span> <span class="k">match</span> <span class="n">o</span> <span class="k">with</span>
</span><span id="linespan-520"><a id="line-520" name="line-520"></a>    <span class="o">|</span> <span class="n">None</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="n">l</span><span class="o">.</span><span class="mi">1</span><span class="o">,</span><span class="n">Opened</span><span class="o">)</span>
</span><span id="linespan-521"><a id="line-521" name="line-521"></a>    <span class="o">|</span> <span class="n">Some</span> <span class="o">_</span> <span class="o">=&gt;</span>
</span><span id="linespan-522"><a id="line-522" name="line-522"></a>      <span class="k">match</span> <span class="n">refcnt</span> <span class="k">with</span>
</span><span id="linespan-523"><a id="line-523" name="line-523"></a>      <span class="o">|</span> <span class="mi">0</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span><span class="n">Closed</span><span class="o">)</span>
</span><span id="linespan-524"><a id="line-524" name="line-524"></a>      <span class="o">|</span> <span class="n">S</span> <span class="o">_</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span><span class="n">Closed</span><span class="o">)</span>
</span><span id="linespan-525"><a id="line-525" name="line-525"></a>      <span class="k">end</span>
</span><span id="linespan-526"><a id="line-526" name="line-526"></a>    <span class="k">end</span><span class="o">.</span>
</span><span id="linespan-527"><a id="line-527" name="line-527"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-528"><a id="line-528" name="line-528"></a>  <span class="k">intros</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-529"><a id="line-529" name="line-529"></a>  <span class="k">destruct</span> <span class="n">o</span><span class="o">.</span>
</span><span id="linespan-530"><a id="line-530" name="line-530"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">lr_openedclosed</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">refcnt</span><span class="o">;</span> <span class="k">subst</span><span class="o">.</span>
</span><span id="linespan-531"><a id="line-531" name="line-531"></a>    <span class="o">+</span> <span class="n">eexists</span> <span class="o">_,_;</span> <span class="k">split</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-532"><a id="line-532" name="line-532"></a>      <span class="k">rewrite</span> <span class="o">-</span><span class="n">assoc</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-533"><a id="line-533" name="line-533"></a>    <span class="o">+</span> <span class="k">exists</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span><span class="n">Closed</span><span class="o">).</span>
</span><span id="linespan-534"><a id="line-534" name="line-534"></a>      <span class="k">rewrite</span> <span class="n">Mlen_unit</span> <span class="k">in</span> <span class="n">lr_refcount0</span><span class="o">.</span>
</span><span id="linespan-535"><a id="line-535" name="line-535"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">Mlen</span> <span class="n">x_closed</span> <span class="o">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="k">as</span> <span class="n">H</span> <span class="kp">by</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-536"><a id="line-536" name="line-536"></a>      <span class="k">eapply</span> <span class="n">Mlen_nonzero_inv</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-537"><a id="line-537" name="line-537"></a>      <span class="k">destruct</span> <span class="n">H</span> <span class="k">as</span> <span class="o">[</span><span class="n">l</span> <span class="o">[</span><span class="n">x_closed'</span> <span class="n">Hxcl</span><span class="o">]].</span>
</span><span id="linespan-538"><a id="line-538" name="line-538"></a>      <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_closed</span> <span class="o">_</span> <span class="o">_</span> <span class="n">Hxcl</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-539"><a id="line-539" name="line-539"></a>      <span class="k">rewrite</span> <span class="n">Hxcl</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span>
</span><span id="linespan-540"><a id="line-540" name="line-540"></a>      <span class="n">eexists</span> <span class="o">({[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x_closed'</span><span class="o">).</span> <span class="k">split</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-541"><a id="line-541" name="line-541"></a>      <span class="k">rewrite</span> <span class="n">lr_split</span><span class="o">.</span>
</span><span id="linespan-542"><a id="line-542" name="line-542"></a>      <span class="k">rewrite</span> <span class="o">!</span><span class="n">assoc</span> <span class="n">right_id</span> <span class="n">Mpermute2</span> <span class="o">//.</span>
</span><span id="linespan-543"><a id="line-543" name="line-543"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">lr_openedclosed</span> <span class="k">as</span> <span class="o">[</span><span class="bp">[]</span><span class="o">|</span><span class="bp">[]</span><span class="o">];</span> <span class="k">subst</span><span class="o">.</span>
</span><span id="linespan-544"><a id="line-544" name="line-544"></a>    <span class="o">+</span> <span class="k">exists</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span><span class="n">Opened</span><span class="o">),</span> <span class="n">x_closed</span><span class="o">.</span>
</span><span id="linespan-545"><a id="line-545" name="line-545"></a>      <span class="k">split</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-546"><a id="line-546" name="line-546"></a>      <span class="k">rewrite</span> <span class="n">lr_split</span> <span class="n">right_id</span> <span class="o">//.</span>
</span><span id="linespan-547"><a id="line-547" name="line-547"></a>    <span class="o">+</span> <span class="k">exists</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span><span class="n">Opened</span><span class="o">),({[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x_closed</span><span class="o">).</span>
</span><span id="linespan-548"><a id="line-548" name="line-548"></a>      <span class="k">split</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-549"><a id="line-549" name="line-549"></a>      <span class="k">rewrite</span> <span class="n">assoc</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">-</span><span class="n">Mpermute1</span> <span class="n">lr_split</span> <span class="n">H0</span> <span class="o">//.</span>
</span><span id="linespan-550"><a id="line-550" name="line-550"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-551"><a id="line-551" name="line-551"></a>
</span><span id="linespan-552"><a id="line-552" name="line-552"></a>
</span><span id="linespan-553"><a id="line-553" name="line-553"></a><span class="kn">Definition</span> <span class="n">linv</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">:</span> <span class="n">cfg</span><span class="o">)</span> <span class="o">(</span><span class="n">v</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">(</span><span class="n">in_l</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">labelO</span><span class="o">)</span> <span class="o">:</span> <span class="n">rProp</span> <span class="o">:=</span>
</span><span id="linespan-554"><a id="line-554" name="line-554"></a>  <span class="k">match</span> <span class="n">ρ</span> <span class="o">!!</span> <span class="n">v</span> <span class="k">with</span>
</span><span id="linespan-555"><a id="line-555" name="line-555"></a>  <span class="o">|</span> <span class="n">Some</span> <span class="o">(</span><span class="n">Thread</span> <span class="n">e</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="bp">⌜⌜</span> <span class="n">in_l</span> <span class="bp">≡</span> <span class="n">ε</span> <span class="bp">⌝⌝</span> <span class="bp">∗</span> <span class="n">rtyped0</span> <span class="n">e</span> <span class="n">UnitT</span>
</span><span id="linespan-556"><a id="line-556" name="line-556"></a>  <span class="o">|</span> <span class="n">Some</span> <span class="n">Barrier</span> <span class="o">=&gt;</span> <span class="bp">⌜⌜</span> <span class="o">∃</span> <span class="n">t1</span> <span class="n">t2</span> <span class="o">:</span> <span class="n">type</span><span class="o">,</span>
</span><span id="linespan-557"><a id="line-557" name="line-557"></a>      <span class="n">in_l</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="n">BarrierLabel</span> <span class="bp">false</span> <span class="n">t1</span> <span class="n">t2</span> <span class="o">]}</span> <span class="bp">⋅</span>
</span><span id="linespan-558"><a id="line-558" name="line-558"></a>             <span class="o">{[</span> <span class="n">BarrierLabel</span> <span class="bp">false</span> <span class="n">t2</span> <span class="n">t1</span> <span class="o">]}</span> <span class="bp">⌝⌝</span>
</span><span id="linespan-559"><a id="line-559" name="line-559"></a>  <span class="o">|</span> <span class="n">Some</span> <span class="o">(</span><span class="n">LockG</span> <span class="n">refcnt</span> <span class="n">xs</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="o">∃</span> <span class="n">ts</span><span class="o">,</span>
</span><span id="linespan-560"><a id="line-560" name="line-560"></a>      <span class="bp">⌜⌜</span> <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="n">ts</span> <span class="n">in_l</span> <span class="bp">⌝⌝</span> <span class="bp">∗</span>
</span><span id="linespan-561"><a id="line-561" name="line-561"></a>      <span class="o">[</span><span class="bp">∗</span> <span class="n">map</span><span class="o">]</span> <span class="n">i</span><span class="bp">↦</span><span class="n">x</span><span class="o">;</span><span class="n">t</span> <span class="bp">∈</span> <span class="n">xs</span><span class="o">;</span><span class="n">ts</span><span class="o">,</span>
</span><span id="linespan-562"><a id="line-562" name="line-562"></a>        <span class="k">match</span> <span class="n">x</span><span class="o">.</span><span class="mi">2</span> <span class="k">with</span>
</span><span id="linespan-563"><a id="line-563" name="line-563"></a>        <span class="o">|</span> <span class="n">Some</span> <span class="n">v</span> <span class="o">=&gt;</span> <span class="n">vtyped</span> <span class="n">v</span> <span class="n">t</span>
</span><span id="linespan-564"><a id="line-564" name="line-564"></a>        <span class="o">|</span> <span class="n">None</span> <span class="o">=&gt;</span> <span class="n">emp</span>
</span><span id="linespan-565"><a id="line-565" name="line-565"></a>        <span class="k">end</span>
</span><span id="linespan-566"><a id="line-566" name="line-566"></a>  <span class="o">|</span> <span class="n">None</span> <span class="o">=&gt;</span> <span class="bp">⌜⌜</span> <span class="n">in_l</span> <span class="bp">≡</span> <span class="n">ε</span> <span class="bp">⌝⌝</span>
</span><span id="linespan-567"><a id="line-567" name="line-567"></a>  <span class="k">end</span><span class="o">%</span><span class="n">I</span><span class="o">.</span>
</span><span id="linespan-568"><a id="line-568" name="line-568"></a>
</span><span id="linespan-569"><a id="line-569" name="line-569"></a><span class="kn">Global</span> <span class="kn">Instance</span> <span class="n">lin_Proper</span> <span class="n">ρ</span> <span class="n">v</span> <span class="o">:</span> <span class="n">Proper</span> <span class="o">((</span><span class="bp">≡</span><span class="o">)</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="bp">≡</span><span class="o">))</span> <span class="o">(</span><span class="n">linv</span> <span class="n">ρ</span> <span class="n">v</span><span class="o">).</span>
</span><span id="linespan-570"><a id="line-570" name="line-570"></a><span class="kn">Proof</span><span class="o">.</span> <span class="n">solve_proper</span><span class="o">.</span> <span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-571"><a id="line-571" name="line-571"></a>
</span><span id="linespan-572"><a id="line-572" name="line-572"></a><span class="kn">Definition</span> <span class="n">ginv</span> <span class="n">ρ</span> <span class="o">:=</span> <span class="n">inv</span> <span class="o">(</span><span class="n">linv</span> <span class="n">ρ</span><span class="o">).</span>
</span><span id="linespan-573"><a id="line-573" name="line-573"></a>
</span><span id="linespan-574"><a id="line-574" name="line-574"></a><span class="kn">Lemma</span> <span class="n">lookup_union_spec</span> <span class="o">`{</span><span class="n">Countable</span> <span class="n">K</span><span class="o">}</span> <span class="o">{</span><span class="n">V</span><span class="o">}</span> <span class="o">(</span><span class="n">m1</span> <span class="n">m2</span> <span class="o">:</span> <span class="n">gmap</span> <span class="n">K</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-575"><a id="line-575" name="line-575"></a>  <span class="o">(</span><span class="n">m1</span> <span class="bp">∪</span> <span class="n">m2</span><span class="o">)</span> <span class="o">!!</span> <span class="n">x</span> <span class="o">=</span> <span class="n">from_option</span> <span class="n">Some</span> <span class="o">(</span><span class="n">m2</span> <span class="o">!!</span> <span class="n">x</span><span class="o">)</span> <span class="o">(</span><span class="n">m1</span> <span class="o">!!</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-576"><a id="line-576" name="line-576"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-577"><a id="line-577" name="line-577"></a>  <span class="k">rewrite</span> <span class="n">lookup_union</span><span class="o">.</span>
</span><span id="linespan-578"><a id="line-578" name="line-578"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">m1</span> <span class="o">!!</span> <span class="n">x</span><span class="o">),(</span><span class="n">m2</span> <span class="o">!!</span> <span class="n">x</span><span class="o">);</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-579"><a id="line-579" name="line-579"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-580"><a id="line-580" name="line-580"></a>
</span><span id="linespan-581"><a id="line-581" name="line-581"></a><span class="kn">Ltac</span> <span class="n">sdec</span> <span class="o">:=</span> <span class="kr">repeat</span> <span class="o">(</span><span class="n">progress</span> <span class="n">simp</span> <span class="o">||</span> <span class="n">case_decide</span> <span class="o">||</span> <span class="kp">done</span> <span class="o">||</span> <span class="k">eauto</span><span class="o">).</span>
</span><span id="linespan-582"><a id="line-582" name="line-582"></a><span class="kn">Ltac</span> <span class="n">smap</span> <span class="o">:=</span> <span class="kr">repeat</span> <span class="o">(</span>
</span><span id="linespan-583"><a id="line-583" name="line-583"></a>  <span class="k">rewrite</span> <span class="n">lookup_union_spec</span> <span class="o">||</span>
</span><span id="linespan-584"><a id="line-584" name="line-584"></a>  <span class="k">rewrite</span> <span class="n">lookup_alter_spec</span> <span class="o">||</span>
</span><span id="linespan-585"><a id="line-585" name="line-585"></a>  <span class="k">rewrite</span> <span class="n">lookup_insert_spec</span> <span class="o">||</span>
</span><span id="linespan-586"><a id="line-586" name="line-586"></a>  <span class="k">rewrite</span> <span class="n">lookup_delete_spec</span> <span class="o">||</span>
</span><span id="linespan-587"><a id="line-587" name="line-587"></a>  <span class="k">rewrite</span> <span class="n">lookup_empty</span> <span class="o">||</span> <span class="n">sdec</span><span class="o">).</span>
</span><span id="linespan-588"><a id="line-588" name="line-588"></a>
</span><span id="linespan-589"><a id="line-589" name="line-589"></a><span class="kn">Lemma</span> <span class="n">lockcaps_split_length</span> <span class="n">xs1</span> <span class="n">xs2</span> <span class="n">xs3</span> <span class="o">:</span>
</span><span id="linespan-590"><a id="line-590" name="line-590"></a>  <span class="n">lockcaps_split</span> <span class="n">xs1</span> <span class="n">xs2</span> <span class="n">xs3</span> <span class="o">-&gt;</span> <span class="n">length</span> <span class="n">xs1</span> <span class="o">=</span> <span class="n">length</span> <span class="n">xs2</span> <span class="o">∧</span> <span class="n">length</span> <span class="n">xs1</span> <span class="o">=</span> <span class="n">length</span> <span class="n">xs3</span><span class="o">.</span>
</span><span id="linespan-591"><a id="line-591" name="line-591"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-592"><a id="line-592" name="line-592"></a>  <span class="k">intros</span> <span class="n">H</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">lockcaps_split</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-593"><a id="line-593" name="line-593"></a>  <span class="k">eauto</span> <span class="k">using</span> <span class="n">Forall3_length_lr</span><span class="o">,</span> <span class="n">Forall3_length_lm</span><span class="o">.</span>
</span><span id="linespan-594"><a id="line-594" name="line-594"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-595"><a id="line-595" name="line-595"></a>
</span><span id="linespan-596"><a id="line-596" name="line-596"></a><span class="kn">Lemma</span> <span class="n">extract_op</span> <span class="n">jj</span> <span class="n">x1</span> <span class="n">x2</span> <span class="o">:</span>
</span><span id="linespan-597"><a id="line-597" name="line-597"></a>  <span class="n">extract</span> <span class="n">jj</span> <span class="o">(</span><span class="n">x1</span> <span class="bp">⋅</span> <span class="n">x2</span><span class="o">)</span> <span class="o">=</span> <span class="n">extract</span> <span class="n">jj</span> <span class="n">x1</span> <span class="bp">⋅</span> <span class="n">extract</span> <span class="n">jj</span> <span class="n">x2</span><span class="o">.</span>
</span><span id="linespan-598"><a id="line-598" name="line-598"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-599"><a id="line-599" name="line-599"></a>  <span class="k">unfold</span> <span class="n">extract</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">op</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-600"><a id="line-600" name="line-600"></a>  <span class="k">rewrite</span> <span class="o">!</span><span class="n">flat_map_app</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-601"><a id="line-601" name="line-601"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-602"><a id="line-602" name="line-602"></a>
</span><span id="linespan-603"><a id="line-603" name="line-603"></a><span class="kn">Lemma</span> <span class="n">extract_singleton</span> <span class="n">jj</span> <span class="n">a</span> <span class="o">:</span>
</span><span id="linespan-604"><a id="line-604" name="line-604"></a>  <span class="n">extract</span> <span class="n">jj</span> <span class="o">{[</span> <span class="n">a</span> <span class="o">]}</span> <span class="o">=</span> <span class="k">match</span> <span class="n">a</span> <span class="k">with</span>
</span><span id="linespan-605"><a id="line-605" name="line-605"></a>    <span class="o">|</span> <span class="n">LockLabel</span> <span class="n">xs</span> <span class="o">=&gt;</span> <span class="n">extract1</span> <span class="n">jj</span> <span class="n">xs</span>
</span><span id="linespan-606"><a id="line-606" name="line-606"></a>    <span class="o">|</span> <span class="o">_</span> <span class="o">=&gt;</span> <span class="n">ε</span>
</span><span id="linespan-607"><a id="line-607" name="line-607"></a>    <span class="k">end</span><span class="o">.</span>
</span><span id="linespan-608"><a id="line-608" name="line-608"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-609"><a id="line-609" name="line-609"></a>  <span class="k">unfold</span> <span class="n">extract</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">a</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="kr">try</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-610"><a id="line-610" name="line-610"></a>  <span class="k">rewrite</span> <span class="n">right_id_L</span> <span class="o">//.</span>
</span><span id="linespan-611"><a id="line-611" name="line-611"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-612"><a id="line-612" name="line-612"></a>
</span><span id="linespan-613"><a id="line-613" name="line-613"></a><span class="kn">Lemma</span> <span class="n">extract1_cons</span> <span class="n">jj</span> <span class="n">jj'</span> <span class="n">p</span> <span class="n">xs</span> <span class="o">:</span>
</span><span id="linespan-614"><a id="line-614" name="line-614"></a>  <span class="n">extract1</span> <span class="n">jj</span> <span class="o">((</span><span class="n">jj'</span><span class="o">,</span><span class="n">p</span><span class="o">)::</span><span class="n">xs</span><span class="o">)</span> <span class="o">=</span>
</span><span id="linespan-615"><a id="line-615" name="line-615"></a>    <span class="k">if</span> <span class="n">decide</span> <span class="o">(</span><span class="n">jj</span> <span class="o">=</span> <span class="n">jj'</span><span class="o">)</span>
</span><span id="linespan-616"><a id="line-616" name="line-616"></a>    <span class="k">then</span> <span class="o">{[</span> <span class="n">p</span><span class="o">:</span><span class="n">labelO'</span> <span class="o">]}</span> <span class="bp">⋅</span> <span class="n">extract1</span> <span class="n">jj</span> <span class="n">xs</span>
</span><span id="linespan-617"><a id="line-617" name="line-617"></a>    <span class="k">else</span> <span class="n">extract1</span> <span class="n">jj</span> <span class="n">xs</span><span class="o">.</span>
</span><span id="linespan-618"><a id="line-618" name="line-618"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-619"><a id="line-619" name="line-619"></a>  <span class="k">unfold</span> <span class="n">extract1</span><span class="o">.</span>
</span><span id="linespan-620"><a id="line-620" name="line-620"></a>  <span class="k">rewrite</span> <span class="o">!</span><span class="n">filter_cons</span><span class="o">.</span>
</span><span id="linespan-621"><a id="line-621" name="line-621"></a>  <span class="n">case_decide</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="n">case_decide</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-622"><a id="line-622" name="line-622"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-623"><a id="line-623" name="line-623"></a>
</span><span id="linespan-624"><a id="line-624" name="line-624"></a><span class="kn">Lemma</span> <span class="n">extract1_Some</span> <span class="n">ii</span> <span class="n">i</span> <span class="n">l</span> <span class="n">ls</span> <span class="n">xs</span> <span class="o">:</span>
</span><span id="linespan-625"><a id="line-625" name="line-625"></a>  <span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">i</span> <span class="o">-&gt;</span>
</span><span id="linespan-626"><a id="line-626" name="line-626"></a>  <span class="n">xs</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">l</span> <span class="o">-&gt;</span>
</span><span id="linespan-627"><a id="line-627" name="line-627"></a>  <span class="n">extract1</span> <span class="n">i</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs</span><span class="o">)</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="n">l</span><span class="o">:</span><span class="n">labelO'</span> <span class="o">]}</span> <span class="bp">⋅</span> <span class="n">extract1</span> <span class="n">i</span> <span class="o">(</span><span class="n">zip</span> <span class="o">(</span><span class="n">delete</span> <span class="n">ii</span> <span class="n">ls</span><span class="o">)</span> <span class="o">(</span><span class="n">delete</span> <span class="n">ii</span> <span class="n">xs</span><span class="o">)).</span>
</span><span id="linespan-628"><a id="line-628" name="line-628"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-629"><a id="line-629" name="line-629"></a>  <span class="k">revert</span> <span class="n">ii</span> <span class="n">xs</span><span class="o">.</span>
</span><span id="linespan-630"><a id="line-630" name="line-630"></a>  <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="kr">first</span> <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-631"><a id="line-631" name="line-631"></a>  <span class="k">intros</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">xs</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-632"><a id="line-632" name="line-632"></a>  <span class="k">destruct</span> <span class="n">ii</span><span class="o">;</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-633"><a id="line-633" name="line-633"></a>  <span class="o">-</span> <span class="k">unfold</span> <span class="n">extract1</span> <span class="n">at</span> <span class="mi">1</span><span class="o">.</span>
</span><span id="linespan-634"><a id="line-634" name="line-634"></a>    <span class="k">rewrite</span> <span class="n">filter_cons</span><span class="o">.</span> <span class="n">case_decide</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-635"><a id="line-635" name="line-635"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">extract1_cons</span><span class="o">.</span>
</span><span id="linespan-636"><a id="line-636" name="line-636"></a>    <span class="n">case_decide</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-637"><a id="line-637" name="line-637"></a>    <span class="k">rewrite</span> <span class="n">IHls</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-638"><a id="line-638" name="line-638"></a>    <span class="k">rewrite</span> <span class="n">comm</span><span class="o">.</span>
</span><span id="linespan-639"><a id="line-639" name="line-639"></a>    <span class="k">rewrite</span> <span class="o">(</span><span class="n">comm</span> <span class="o">_</span> <span class="o">{[</span> <span class="n">p</span><span class="o">:</span><span class="n">labelO'</span> <span class="o">]}).</span>
</span><span id="linespan-640"><a id="line-640" name="line-640"></a>    <span class="k">rewrite</span> <span class="n">assoc</span> <span class="o">//.</span>
</span><span id="linespan-641"><a id="line-641" name="line-641"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-642"><a id="line-642" name="line-642"></a>
</span><span id="linespan-643"><a id="line-643" name="line-643"></a><span class="kn">Lemma</span> <span class="n">extract_Some</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">xs1</span> <span class="n">a</span> <span class="n">b</span> <span class="n">t2</span> <span class="n">ls</span> <span class="o">:</span>
</span><span id="linespan-644"><a id="line-644" name="line-644"></a>  <span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">jj</span> <span class="o">-&gt;</span>
</span><span id="linespan-645"><a id="line-645" name="line-645"></a>  <span class="n">xs1</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">t2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">∃</span> <span class="n">x'</span><span class="o">,</span>
</span><span id="linespan-646"><a id="line-646" name="line-646"></a>  <span class="n">extract1</span> <span class="n">jj</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs1</span><span class="o">)</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">,</span><span class="n">t2</span><span class="o">):</span><span class="n">labelO'</span> <span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x'</span><span class="o">.</span>
</span><span id="linespan-647"><a id="line-647" name="line-647"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-648"><a id="line-648" name="line-648"></a>  <span class="k">intros</span> <span class="n">H1</span> <span class="n">H2</span><span class="o">.</span>
</span><span id="linespan-649"><a id="line-649" name="line-649"></a>  <span class="n">eexists</span><span class="o">.</span>
</span><span id="linespan-650"><a id="line-650" name="line-650"></a>  <span class="k">rewrite</span> <span class="n">extract1_Some</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-651"><a id="line-651" name="line-651"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-652"><a id="line-652" name="line-652"></a>
</span><span id="linespan-653"><a id="line-653" name="line-653"></a><span class="kn">Lemma</span> <span class="n">lockrelG_types_same</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="n">ts</span> <span class="n">ls</span> <span class="n">xs1</span> <span class="n">x</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">a</span> <span class="n">b</span> <span class="n">t1</span> <span class="n">t2</span> <span class="o">:</span>
</span><span id="linespan-654"><a id="line-654" name="line-654"></a>  <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="n">ts</span> <span class="o">({[</span><span class="n">LockLabel</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs1</span><span class="o">)]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-655"><a id="line-655" name="line-655"></a>  <span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">jj</span> <span class="o">-&gt;</span>
</span><span id="linespan-656"><a id="line-656" name="line-656"></a>  <span class="n">ts</span> <span class="o">!!</span> <span class="n">jj</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">t1</span> <span class="o">-&gt;</span>
</span><span id="linespan-657"><a id="line-657" name="line-657"></a>  <span class="n">xs1</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">t2</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-658"><a id="line-658" name="line-658"></a>  <span class="n">t1</span> <span class="o">=</span> <span class="n">t2</span><span class="o">.</span>
</span><span id="linespan-659"><a id="line-659" name="line-659"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-660"><a id="line-660" name="line-660"></a>  <span class="k">intros</span> <span class="o">[</span><span class="n">order</span> <span class="bp">[]</span><span class="o">]</span> <span class="o">???.</span>
</span><span id="linespan-661"><a id="line-661" name="line-661"></a>  <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_lockrel0</span> <span class="n">jj</span><span class="o">).</span> <span class="k">rewrite</span> <span class="n">H0</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-662"><a id="line-662" name="line-662"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">xs</span> <span class="o">!!</span> <span class="n">jj</span><span class="o">);</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span>
</span><span id="linespan-663"><a id="line-663" name="line-663"></a>  <span class="k">rewrite</span> <span class="n">extract_op</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-664"><a id="line-664" name="line-664"></a>  <span class="k">rewrite</span> <span class="n">extract_singleton</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-665"><a id="line-665" name="line-665"></a>  <span class="n">edestruct</span> <span class="n">extract_Some</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-666"><a id="line-666" name="line-666"></a>  <span class="k">rewrite</span> <span class="n">H2</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-667"><a id="line-667" name="line-667"></a>  <span class="k">rewrite</span> <span class="o">-</span><span class="n">assoc</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-668"><a id="line-668" name="line-668"></a>  <span class="k">eapply</span> <span class="n">lockrel_same_type</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-669"><a id="line-669" name="line-669"></a>  <span class="k">subst</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-670"><a id="line-670" name="line-670"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-671"><a id="line-671" name="line-671"></a>
</span><span id="linespan-672"><a id="line-672" name="line-672"></a><span class="kn">Lemma</span> <span class="n">extract1_ne_Some</span> <span class="n">ii</span> <span class="n">i</span> <span class="n">ls</span> <span class="n">xs</span> <span class="o">:</span>
</span><span id="linespan-673"><a id="line-673" name="line-673"></a>  <span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">≠</span> <span class="n">Some</span> <span class="n">i</span> <span class="o">-&gt;</span>
</span><span id="linespan-674"><a id="line-674" name="line-674"></a>  <span class="n">extract1</span> <span class="n">i</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs</span><span class="o">)</span> <span class="o">=</span> <span class="n">extract1</span> <span class="n">i</span> <span class="o">(</span><span class="n">zip</span> <span class="o">(</span><span class="n">delete</span> <span class="n">ii</span> <span class="n">ls</span><span class="o">)</span> <span class="o">(</span><span class="n">delete</span> <span class="n">ii</span> <span class="n">xs</span><span class="o">)).</span>
</span><span id="linespan-675"><a id="line-675" name="line-675"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-676"><a id="line-676" name="line-676"></a>  <span class="k">revert</span> <span class="n">ii</span> <span class="n">xs</span><span class="o">.</span>
</span><span id="linespan-677"><a id="line-677" name="line-677"></a>  <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="kr">first</span> <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-678"><a id="line-678" name="line-678"></a>  <span class="k">intros</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">xs</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-679"><a id="line-679" name="line-679"></a>  <span class="k">destruct</span> <span class="n">ii</span><span class="o">;</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-680"><a id="line-680" name="line-680"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">ls</span><span class="o">;</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-681"><a id="line-681" name="line-681"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">extract1_cons</span><span class="o">.</span>
</span><span id="linespan-682"><a id="line-682" name="line-682"></a>    <span class="k">destruct</span> <span class="n">ii</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="n">case_decide</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span>
</span><span id="linespan-683"><a id="line-683" name="line-683"></a>    <span class="k">rewrite</span> <span class="n">extract1_cons</span><span class="o">;</span> <span class="n">case_decide</span><span class="o">;</span> <span class="kr">try</span> <span class="kp">done</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-684"><a id="line-684" name="line-684"></a>    <span class="n">f_equal</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-685"><a id="line-685" name="line-685"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-686"><a id="line-686" name="line-686"></a>
</span><span id="linespan-687"><a id="line-687" name="line-687"></a><span class="kn">Lemma</span> <span class="n">list_delete_insert_delete</span> <span class="o">{</span><span class="n">A</span><span class="o">}</span> <span class="n">i</span> <span class="o">(</span><span class="n">a</span><span class="o">:</span><span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">xs</span><span class="o">:</span><span class="n">list</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-688"><a id="line-688" name="line-688"></a>  <span class="n">delete</span> <span class="n">i</span> <span class="o">(&lt;[</span> <span class="n">i</span> <span class="o">:=</span> <span class="n">a</span> <span class="o">]&gt;</span> <span class="n">xs</span><span class="o">)</span> <span class="o">=</span> <span class="n">delete</span> <span class="n">i</span> <span class="n">xs</span><span class="o">.</span>
</span><span id="linespan-689"><a id="line-689" name="line-689"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-690"><a id="line-690" name="line-690"></a>  <span class="k">revert</span> <span class="n">i</span><span class="o">;</span> <span class="k">induction</span> <span class="n">xs</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-691"><a id="line-691" name="line-691"></a>  <span class="k">intros</span> <span class="bp">[]</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-692"><a id="line-692" name="line-692"></a>  <span class="n">f_equal</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-693"><a id="line-693" name="line-693"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-694"><a id="line-694" name="line-694"></a>
</span><span id="linespan-695"><a id="line-695" name="line-695"></a><span class="kn">Lemma</span> <span class="n">lockrelG_Release</span> <span class="n">ls</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">xs</span> <span class="n">refcntii</span> <span class="n">xs1</span> <span class="n">a</span> <span class="n">t'</span> <span class="n">x</span> <span class="n">refcnt</span> <span class="n">ts</span> <span class="n">v</span> <span class="o">:</span>
</span><span id="linespan-696"><a id="line-696" name="line-696"></a>  <span class="n">length</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">length</span> <span class="n">xs1</span> <span class="o">-&gt;</span>
</span><span id="linespan-697"><a id="line-697" name="line-697"></a>  <span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">jj</span> <span class="o">-&gt;</span>
</span><span id="linespan-698"><a id="line-698" name="line-698"></a>  <span class="n">xs</span> <span class="o">!!</span> <span class="n">jj</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">refcntii</span><span class="o">,</span> <span class="n">None</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-699"><a id="line-699" name="line-699"></a>  <span class="n">xs1</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t'</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-700"><a id="line-700" name="line-700"></a>  <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="n">ts</span> <span class="o">({[</span><span class="n">LockLabel</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs1</span><span class="o">)]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-701"><a id="line-701" name="line-701"></a>  <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="o">(&lt;[</span><span class="n">jj</span><span class="o">:=(</span><span class="n">refcntii</span><span class="o">,</span> <span class="n">Some</span> <span class="n">v</span><span class="o">)]&gt;</span> <span class="n">xs</span><span class="o">)</span> <span class="n">ts</span>
</span><span id="linespan-702"><a id="line-702" name="line-702"></a>    <span class="o">({[</span><span class="n">LockLabel</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="o">(&lt;[</span><span class="n">ii</span><span class="o">:=(</span><span class="n">a</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t'</span><span class="o">)]&gt;</span> <span class="n">xs1</span><span class="o">))]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-703"><a id="line-703" name="line-703"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-704"><a id="line-704" name="line-704"></a>  <span class="k">intros</span> <span class="o">????</span> <span class="o">[</span><span class="n">order</span> <span class="bp">[]</span><span class="o">].</span>
</span><span id="linespan-705"><a id="line-705" name="line-705"></a>  <span class="kr">do</span> <span class="mi">2</span> <span class="k">econstructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-706"><a id="line-706" name="line-706"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">dom_insert_lookup_L</span> <span class="o">//.</span>
</span><span id="linespan-707"><a id="line-707" name="line-707"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">mset_forall_op</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">mset_forall_op</span> <span class="k">in</span> <span class="n">order_subsequences0</span><span class="o">.</span>
</span><span id="linespan-708"><a id="line-708" name="line-708"></a>    <span class="k">destruct</span> <span class="n">order_subsequences0</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-709"><a id="line-709" name="line-709"></a>    <span class="k">rewrite</span> <span class="n">mset_forall_singleton</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">mset_forall_singleton</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span>
</span><span id="linespan-710"><a id="line-710" name="line-710"></a>    <span class="n">simp</span><span class="o">.</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-711"><a id="line-711" name="line-711"></a>    <span class="k">rewrite</span> <span class="n">fst_zip</span> <span class="k">in</span> <span class="n">H7</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-712"><a id="line-712" name="line-712"></a>    <span class="k">rewrite</span> <span class="n">fst_zip</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-713"><a id="line-713" name="line-713"></a>    <span class="k">rewrite</span> <span class="n">insert_length</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-714"><a id="line-714" name="line-714"></a>  <span class="o">-</span> <span class="k">intro</span><span class="o">.</span> <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_lockrel0</span> <span class="n">i</span><span class="o">).</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-715"><a id="line-715" name="line-715"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="n">H1</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-716"><a id="line-716" name="line-716"></a>      <span class="k">destruct</span> <span class="o">(</span><span class="n">ts</span> <span class="o">!!</span> <span class="n">i</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-717"><a id="line-717" name="line-717"></a>      <span class="k">revert</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-718"><a id="line-718" name="line-718"></a>      <span class="k">rewrite</span> <span class="o">!</span><span class="n">extract_op</span> <span class="o">!</span><span class="n">extract_singleton</span><span class="o">.</span>
</span><span id="linespan-719"><a id="line-719" name="line-719"></a>      <span class="k">erewrite</span> <span class="n">extract1_Some</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-720"><a id="line-720" name="line-720"></a>      <span class="k">intros</span> <span class="n">lr</span><span class="o">.</span>
</span><span id="linespan-721"><a id="line-721" name="line-721"></a>      <span class="k">erewrite</span> <span class="n">extract1_Some</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span> <span class="kr">last</span> <span class="kr">first</span><span class="o">.</span>
</span><span id="linespan-722"><a id="line-722" name="line-722"></a>      <span class="o">{</span> <span class="k">rewrite</span> <span class="n">list_lookup_insert</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span> <span class="kp">by</span> <span class="k">eapply</span> <span class="n">lookup_lt_Some</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-723"><a id="line-723" name="line-723"></a>      <span class="k">rewrite</span> <span class="n">list_delete_insert_delete</span><span class="o">.</span>
</span><span id="linespan-724"><a id="line-724" name="line-724"></a>      <span class="k">rewrite</span> <span class="o">-</span><span class="n">assoc</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">-</span><span class="n">assoc</span> <span class="k">in</span> <span class="n">lr</span><span class="o">.</span>
</span><span id="linespan-725"><a id="line-725" name="line-725"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">t'</span><span class="o">=</span><span class="n">t</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;</span> <span class="kp">by</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">lockrel_same_type</span><span class="o">.</span>
</span><span id="linespan-726"><a id="line-726" name="line-726"></a>      <span class="k">eapply</span> <span class="n">lockrel_open_close</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-727"><a id="line-727" name="line-727"></a>    <span class="o">+</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">xs</span> <span class="o">!!</span> <span class="n">i</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">E</span><span class="o">;</span> <span class="k">rewrite</span> <span class="n">E</span><span class="o">;</span> <span class="kr">last</span> <span class="kr">first</span><span class="o">.</span>
</span><span id="linespan-728"><a id="line-728" name="line-728"></a>      <span class="o">{</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">ts</span> <span class="o">!!</span> <span class="n">i</span><span class="o">);</span> <span class="kp">done</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-729"><a id="line-729" name="line-729"></a>      <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">ts</span> <span class="o">!!</span> <span class="n">i</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-730"><a id="line-730" name="line-730"></a>      <span class="k">revert</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-731"><a id="line-731" name="line-731"></a>      <span class="k">rewrite</span> <span class="o">!</span><span class="n">extract_op</span> <span class="o">!</span><span class="n">extract_singleton</span><span class="o">.</span>
</span><span id="linespan-732"><a id="line-732" name="line-732"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">≠</span> <span class="n">Some</span> <span class="n">i</span><span class="o">).</span> <span class="o">{</span> <span class="kp">congruence</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-733"><a id="line-733" name="line-733"></a>      <span class="k">erewrite</span> <span class="n">extract1_ne_Some</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span> <span class="k">intros</span> <span class="n">lr</span><span class="o">.</span>
</span><span id="linespan-734"><a id="line-734" name="line-734"></a>      <span class="k">erewrite</span> <span class="n">extract1_ne_Some</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-735"><a id="line-735" name="line-735"></a>      <span class="k">rewrite</span> <span class="n">list_delete_insert_delete</span> <span class="o">//.</span>
</span><span id="linespan-736"><a id="line-736" name="line-736"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-737"><a id="line-737" name="line-737"></a>
</span><span id="linespan-738"><a id="line-738" name="line-738"></a><span class="kn">Lemma</span> <span class="n">lockrelG_Acquire</span> <span class="n">ls</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">xs</span> <span class="n">refcntii</span> <span class="n">v</span> <span class="n">t'</span> <span class="n">x</span> <span class="n">xs1</span> <span class="n">a</span> <span class="n">ts</span> <span class="n">refcnt</span> <span class="o">:</span>
</span><span id="linespan-739"><a id="line-739" name="line-739"></a>  <span class="n">length</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">length</span> <span class="n">xs1</span> <span class="o">-&gt;</span>
</span><span id="linespan-740"><a id="line-740" name="line-740"></a>  <span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">jj</span> <span class="o">-&gt;</span>
</span><span id="linespan-741"><a id="line-741" name="line-741"></a>  <span class="n">xs</span> <span class="o">!!</span> <span class="n">jj</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">refcntii</span><span class="o">,</span> <span class="n">Some</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-742"><a id="line-742" name="line-742"></a>  <span class="n">xs1</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t'</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-743"><a id="line-743" name="line-743"></a>  <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="n">ts</span> <span class="o">({[</span><span class="n">LockLabel</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs1</span><span class="o">)]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-744"><a id="line-744" name="line-744"></a>  <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="o">(&lt;[</span><span class="n">jj</span><span class="o">:=(</span><span class="n">refcntii</span><span class="o">,</span> <span class="n">None</span><span class="o">)]&gt;</span> <span class="n">xs</span><span class="o">)</span> <span class="n">ts</span>
</span><span id="linespan-745"><a id="line-745" name="line-745"></a>    <span class="o">({[</span><span class="n">LockLabel</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="o">(&lt;[</span><span class="n">ii</span><span class="o">:=(</span><span class="n">a</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t'</span><span class="o">)]&gt;</span> <span class="n">xs1</span><span class="o">))]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-746"><a id="line-746" name="line-746"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-747"><a id="line-747" name="line-747"></a>  <span class="k">intros</span> <span class="o">????</span> <span class="o">[</span><span class="n">order</span> <span class="bp">[]</span><span class="o">].</span>
</span><span id="linespan-748"><a id="line-748" name="line-748"></a>  <span class="kr">do</span> <span class="mi">2</span> <span class="k">econstructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-749"><a id="line-749" name="line-749"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">dom_insert_lookup_L</span> <span class="o">//.</span>
</span><span id="linespan-750"><a id="line-750" name="line-750"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">mset_forall_op</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">mset_forall_op</span> <span class="k">in</span> <span class="n">order_subsequences0</span><span class="o">.</span>
</span><span id="linespan-751"><a id="line-751" name="line-751"></a>    <span class="k">destruct</span> <span class="n">order_subsequences0</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-752"><a id="line-752" name="line-752"></a>    <span class="k">rewrite</span> <span class="n">mset_forall_singleton</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">mset_forall_singleton</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span>
</span><span id="linespan-753"><a id="line-753" name="line-753"></a>    <span class="n">simp</span><span class="o">.</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-754"><a id="line-754" name="line-754"></a>    <span class="k">rewrite</span> <span class="n">fst_zip</span> <span class="k">in</span> <span class="n">H7</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-755"><a id="line-755" name="line-755"></a>    <span class="k">rewrite</span> <span class="n">fst_zip</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-756"><a id="line-756" name="line-756"></a>    <span class="k">rewrite</span> <span class="n">insert_length</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-757"><a id="line-757" name="line-757"></a>  <span class="o">-</span> <span class="k">intro</span><span class="o">.</span> <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_lockrel0</span> <span class="n">i</span><span class="o">).</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-758"><a id="line-758" name="line-758"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="n">H1</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-759"><a id="line-759" name="line-759"></a>      <span class="k">destruct</span> <span class="o">(</span><span class="n">ts</span> <span class="o">!!</span> <span class="n">i</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-760"><a id="line-760" name="line-760"></a>      <span class="k">revert</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-761"><a id="line-761" name="line-761"></a>      <span class="k">rewrite</span> <span class="o">!</span><span class="n">extract_op</span> <span class="o">!</span><span class="n">extract_singleton</span><span class="o">.</span>
</span><span id="linespan-762"><a id="line-762" name="line-762"></a>      <span class="k">erewrite</span> <span class="n">extract1_Some</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-763"><a id="line-763" name="line-763"></a>      <span class="k">intros</span> <span class="n">lr</span><span class="o">.</span>
</span><span id="linespan-764"><a id="line-764" name="line-764"></a>      <span class="k">erewrite</span> <span class="n">extract1_Some</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span> <span class="kr">last</span> <span class="kr">first</span><span class="o">.</span>
</span><span id="linespan-765"><a id="line-765" name="line-765"></a>      <span class="o">{</span> <span class="k">rewrite</span> <span class="n">list_lookup_insert</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span> <span class="kp">by</span> <span class="k">eapply</span> <span class="n">lookup_lt_Some</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-766"><a id="line-766" name="line-766"></a>      <span class="k">rewrite</span> <span class="n">list_delete_insert_delete</span><span class="o">.</span>
</span><span id="linespan-767"><a id="line-767" name="line-767"></a>      <span class="k">rewrite</span> <span class="o">-</span><span class="n">assoc</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">-</span><span class="n">assoc</span> <span class="k">in</span> <span class="n">lr</span><span class="o">.</span>
</span><span id="linespan-768"><a id="line-768" name="line-768"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">t'</span><span class="o">=</span><span class="n">t</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;</span> <span class="kp">by</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">lockrel_same_type</span><span class="o">.</span>
</span><span id="linespan-769"><a id="line-769" name="line-769"></a>      <span class="k">eapply</span> <span class="n">lockrel_open_close</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-770"><a id="line-770" name="line-770"></a>    <span class="o">+</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">xs</span> <span class="o">!!</span> <span class="n">i</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">E</span><span class="o">;</span> <span class="k">rewrite</span> <span class="n">E</span><span class="o">;</span> <span class="kr">last</span> <span class="kr">first</span><span class="o">.</span>
</span><span id="linespan-771"><a id="line-771" name="line-771"></a>      <span class="o">{</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">ts</span> <span class="o">!!</span> <span class="n">i</span><span class="o">);</span> <span class="kp">done</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-772"><a id="line-772" name="line-772"></a>      <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">ts</span> <span class="o">!!</span> <span class="n">i</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-773"><a id="line-773" name="line-773"></a>      <span class="k">revert</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-774"><a id="line-774" name="line-774"></a>      <span class="k">rewrite</span> <span class="o">!</span><span class="n">extract_op</span> <span class="o">!</span><span class="n">extract_singleton</span><span class="o">.</span>
</span><span id="linespan-775"><a id="line-775" name="line-775"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">≠</span> <span class="n">Some</span> <span class="n">i</span><span class="o">).</span> <span class="o">{</span> <span class="kp">congruence</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-776"><a id="line-776" name="line-776"></a>      <span class="k">erewrite</span> <span class="n">extract1_ne_Some</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span> <span class="k">intros</span> <span class="n">lr</span><span class="o">.</span>
</span><span id="linespan-777"><a id="line-777" name="line-777"></a>      <span class="k">erewrite</span> <span class="n">extract1_ne_Some</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-778"><a id="line-778" name="line-778"></a>      <span class="k">rewrite</span> <span class="n">list_delete_insert_delete</span> <span class="o">//.</span>
</span><span id="linespan-779"><a id="line-779" name="line-779"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-780"><a id="line-780" name="line-780"></a>
</span><span id="linespan-781"><a id="line-781" name="line-781"></a><span class="kn">Lemma</span> <span class="n">sublist_filter</span> <span class="o">{</span><span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">xs</span> <span class="n">ys</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span><span class="o">)</span> <span class="n">P</span> <span class="o">`{∀</span> <span class="n">x</span><span class="o">,</span> <span class="n">Decision</span> <span class="o">(</span><span class="n">P</span> <span class="n">x</span><span class="o">)}</span> <span class="o">:</span>
</span><span id="linespan-782"><a id="line-782" name="line-782"></a>  <span class="n">xs</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">ys</span> <span class="o">-&gt;</span>
</span><span id="linespan-783"><a id="line-783" name="line-783"></a>  <span class="n">filter</span> <span class="n">P</span> <span class="n">xs</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">filter</span> <span class="n">P</span> <span class="n">ys</span><span class="o">.</span>
</span><span id="linespan-784"><a id="line-784" name="line-784"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-785"><a id="line-785" name="line-785"></a>  <span class="k">induction</span> <span class="mi">1</span><span class="o">.</span>
</span><span id="linespan-786"><a id="line-786" name="line-786"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">filter_nil</span><span class="o">.</span> <span class="k">constructor</span><span class="o">.</span>
</span><span id="linespan-787"><a id="line-787" name="line-787"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">filter_cons</span><span class="o">.</span> <span class="n">case_decide</span><span class="o">.</span>
</span><span id="linespan-788"><a id="line-788" name="line-788"></a>    <span class="o">+</span> <span class="k">constructor</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-789"><a id="line-789" name="line-789"></a>    <span class="o">+</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-790"><a id="line-790" name="line-790"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">filter_cons</span><span class="o">.</span> <span class="n">case_decide</span><span class="o">.</span>
</span><span id="linespan-791"><a id="line-791" name="line-791"></a>    <span class="o">+</span> <span class="k">econstructor</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-792"><a id="line-792" name="line-792"></a>    <span class="o">+</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-793"><a id="line-793" name="line-793"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-794"><a id="line-794" name="line-794"></a>
</span><span id="linespan-795"><a id="line-795" name="line-795"></a><span class="kn">Lemma</span> <span class="n">delete_NoDup_filter</span> <span class="o">(</span><span class="n">ls</span> <span class="o">:</span> <span class="n">list</span> <span class="n">nat</span><span class="o">)</span> <span class="n">ii</span> <span class="n">jj</span> <span class="o">:</span>
</span><span id="linespan-796"><a id="line-796" name="line-796"></a>  <span class="n">NoDup</span> <span class="n">ls</span> <span class="o">-&gt;</span>
</span><span id="linespan-797"><a id="line-797" name="line-797"></a>  <span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">jj</span> <span class="o">-&gt;</span>
</span><span id="linespan-798"><a id="line-798" name="line-798"></a>  <span class="n">delete</span> <span class="n">ii</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">filter</span> <span class="o">(λ</span> <span class="n">x0</span> <span class="o">:</span> <span class="n">vertex</span><span class="o">,</span> <span class="n">x0</span> <span class="o">≠</span> <span class="n">jj</span><span class="o">)</span> <span class="n">ls</span><span class="o">.</span>
</span><span id="linespan-799"><a id="line-799" name="line-799"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-800"><a id="line-800" name="line-800"></a>  <span class="k">intros</span> <span class="n">H1</span> <span class="n">H2</span><span class="o">.</span>
</span><span id="linespan-801"><a id="line-801" name="line-801"></a>  <span class="k">revert</span> <span class="n">ii</span> <span class="n">H2</span><span class="o">.</span>
</span><span id="linespan-802"><a id="line-802" name="line-802"></a>  <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="k">intros</span> <span class="n">ii</span> <span class="n">H2</span><span class="o">.</span> <span class="o">{</span> <span class="k">revert</span> <span class="n">H2</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-803"><a id="line-803" name="line-803"></a>  <span class="k">revert</span> <span class="n">H2</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">ii</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-804"><a id="line-804" name="line-804"></a>  <span class="o">+</span> <span class="k">rewrite</span> <span class="n">filter_cons</span><span class="o">.</span> <span class="n">case_decide</span><span class="o">;</span> <span class="kr">try</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-805"><a id="line-805" name="line-805"></a>    <span class="k">apply</span> <span class="n">NoDup_cons</span> <span class="k">in</span> <span class="n">H1</span> <span class="k">as</span> <span class="o">[</span><span class="n">H1</span> <span class="n">H2</span><span class="o">].</span>
</span><span id="linespan-806"><a id="line-806" name="line-806"></a>    <span class="k">symmetry</span><span class="o">.</span> <span class="k">clear</span> <span class="n">H2</span> <span class="n">IHls</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-807"><a id="line-807" name="line-807"></a>    <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-808"><a id="line-808" name="line-808"></a>    <span class="k">rewrite</span> <span class="n">filter_cons</span><span class="o">.</span>
</span><span id="linespan-809"><a id="line-809" name="line-809"></a>    <span class="k">apply</span> <span class="n">not_elem_of_cons</span> <span class="k">in</span> <span class="n">H1</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-810"><a id="line-810" name="line-810"></a>    <span class="n">case_decide</span><span class="o">;</span> <span class="kr">try</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-811"><a id="line-811" name="line-811"></a>    <span class="n">f_equal</span><span class="o">.</span> <span class="k">apply</span> <span class="n">IHls</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-812"><a id="line-812" name="line-812"></a>  <span class="o">+</span> <span class="k">simpl</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">filter_cons</span><span class="o">.</span> <span class="k">intros</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-813"><a id="line-813" name="line-813"></a>    <span class="n">case_decide</span><span class="o">.</span>
</span><span id="linespan-814"><a id="line-814" name="line-814"></a>    <span class="o">*</span> <span class="n">f_equal</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">IHls</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-815"><a id="line-815" name="line-815"></a>      <span class="k">eapply</span> <span class="n">NoDup_cons</span><span class="o">;</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-816"><a id="line-816" name="line-816"></a>    <span class="o">*</span> <span class="k">subst</span><span class="o">.</span> <span class="n">exfalso</span><span class="o">.</span>
</span><span id="linespan-817"><a id="line-817" name="line-817"></a>      <span class="k">eapply</span> <span class="n">NoDup_cons</span> <span class="k">in</span> <span class="n">H1</span> <span class="k">as</span> <span class="o">[</span><span class="n">HH</span> <span class="o">?].</span>
</span><span id="linespan-818"><a id="line-818" name="line-818"></a>      <span class="k">eapply</span> <span class="n">HH</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">elem_of_list_lookup_2</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-819"><a id="line-819" name="line-819"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-820"><a id="line-820" name="line-820"></a>
</span><span id="linespan-821"><a id="line-821" name="line-821"></a><span class="kn">Lemma</span> <span class="n">NoDup_sublist</span> <span class="o">{</span><span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">xs</span> <span class="n">ys</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-822"><a id="line-822" name="line-822"></a>  <span class="n">NoDup</span> <span class="n">xs</span> <span class="o">-&gt;</span>
</span><span id="linespan-823"><a id="line-823" name="line-823"></a>  <span class="n">ys</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">xs</span> <span class="o">-&gt;</span>
</span><span id="linespan-824"><a id="line-824" name="line-824"></a>  <span class="n">NoDup</span> <span class="n">ys</span><span class="o">.</span>
</span><span id="linespan-825"><a id="line-825" name="line-825"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-826"><a id="line-826" name="line-826"></a>  <span class="k">intros</span> <span class="n">H1</span><span class="o">.</span> <span class="k">induction</span> <span class="mi">1</span><span class="o">.</span>
</span><span id="linespan-827"><a id="line-827" name="line-827"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">NoDup_nil</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-828"><a id="line-828" name="line-828"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">NoDup_cons</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">NoDup_cons</span> <span class="k">in</span> <span class="n">H1</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-829"><a id="line-829" name="line-829"></a>    <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-830"><a id="line-830" name="line-830"></a>    <span class="k">intros</span> <span class="n">HH</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">H0</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">sublist_elem_of</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-831"><a id="line-831" name="line-831"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">NoDup_cons</span> <span class="k">in</span> <span class="n">H1</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-832"><a id="line-832" name="line-832"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-833"><a id="line-833" name="line-833"></a>
</span><span id="linespan-834"><a id="line-834" name="line-834"></a><span class="kn">Lemma</span> <span class="n">order_delete</span> <span class="n">order</span> <span class="n">ls</span> <span class="n">ii</span> <span class="n">jj</span> <span class="o">:</span>
</span><span id="linespan-835"><a id="line-835" name="line-835"></a>  <span class="n">NoDup</span> <span class="n">order</span> <span class="o">-&gt;</span>
</span><span id="linespan-836"><a id="line-836" name="line-836"></a>  <span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">jj</span> <span class="o">-&gt;</span>
</span><span id="linespan-837"><a id="line-837" name="line-837"></a>  <span class="n">ls</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">order</span> <span class="o">-&gt;</span>
</span><span id="linespan-838"><a id="line-838" name="line-838"></a>  <span class="n">delete</span> <span class="n">ii</span> <span class="n">ls</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">filter</span> <span class="o">(λ</span> <span class="n">x0</span> <span class="o">:</span> <span class="n">vertex</span><span class="o">,</span> <span class="n">x0</span> <span class="o">≠</span> <span class="n">jj</span><span class="o">)</span> <span class="n">order</span><span class="o">.</span>
</span><span id="linespan-839"><a id="line-839" name="line-839"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-840"><a id="line-840" name="line-840"></a>  <span class="k">intros</span> <span class="n">H1</span> <span class="n">H2</span> <span class="n">H3</span><span class="o">.</span>
</span><span id="linespan-841"><a id="line-841" name="line-841"></a>  <span class="k">erewrite</span> <span class="n">delete_NoDup_filter</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">NoDup_sublist</span><span class="o">.</span>
</span><span id="linespan-842"><a id="line-842" name="line-842"></a>  <span class="k">eapply</span> <span class="n">sublist_filter</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-843"><a id="line-843" name="line-843"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-844"><a id="line-844" name="line-844"></a>
</span><span id="linespan-845"><a id="line-845" name="line-845"></a><span class="kn">Lemma</span> <span class="n">flat_map_nil</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">list</span> <span class="n">B</span><span class="o">)</span> <span class="n">xs</span> <span class="o">:</span>
</span><span id="linespan-846"><a id="line-846" name="line-846"></a>  <span class="n">flat_map</span> <span class="n">f</span> <span class="n">xs</span> <span class="o">=</span> <span class="n">nil</span> <span class="o">-&gt;</span> <span class="o">∀</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">xs</span> <span class="o">-&gt;</span> <span class="n">f</span> <span class="n">x</span> <span class="o">=</span> <span class="n">nil</span><span class="o">.</span>
</span><span id="linespan-847"><a id="line-847" name="line-847"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-848"><a id="line-848" name="line-848"></a>  <span class="k">induction</span> <span class="n">xs</span><span class="o">;</span> <span class="kr">first</span> <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-849"><a id="line-849" name="line-849"></a>  <span class="k">simpl</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">app_nil</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-850"><a id="line-850" name="line-850"></a>  <span class="k">eapply</span> <span class="n">elem_of_cons</span> <span class="k">in</span> <span class="n">H0</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-851"><a id="line-851" name="line-851"></a>  <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-852"><a id="line-852" name="line-852"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-853"><a id="line-853" name="line-853"></a>
</span><span id="linespan-854"><a id="line-854" name="line-854"></a><span class="kn">Lemma</span> <span class="n">extract_empty</span> <span class="n">i</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-855"><a id="line-855" name="line-855"></a>  <span class="n">extract</span> <span class="n">i</span> <span class="n">x</span> <span class="o">=</span> <span class="n">ε</span> <span class="o">-&gt;</span>
</span><span id="linespan-856"><a id="line-856" name="line-856"></a>  <span class="n">mset_forall</span> <span class="o">(λ</span> <span class="n">l</span><span class="o">,</span> <span class="o">∀</span> <span class="n">xs</span><span class="o">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">LockLabel</span> <span class="n">xs</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="bp">∉</span> <span class="n">xs</span><span class="o">.*</span><span class="mi">1</span><span class="o">)</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-857"><a id="line-857" name="line-857"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-858"><a id="line-858" name="line-858"></a>  <span class="k">intros</span> <span class="n">H</span><span class="o">?????.</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">H0</span><span class="o">.</span>
</span><span id="linespan-859"><a id="line-859" name="line-859"></a>  <span class="n">inv</span> <span class="n">H0</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-860"><a id="line-860" name="line-860"></a>  <span class="k">unfold</span> <span class="n">extract</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-861"><a id="line-861" name="line-861"></a>  <span class="k">destruct</span> <span class="n">x</span><span class="o">;</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span> <span class="n">inv</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-862"><a id="line-862" name="line-862"></a>  <span class="k">eapply</span> <span class="n">elem_of_list_fmap</span> <span class="k">in</span> <span class="n">H2</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-863"><a id="line-863" name="line-863"></a>  <span class="k">eapply</span> <span class="o">(</span><span class="n">flat_map_permute</span> <span class="o">(λ</span> <span class="n">l</span> <span class="o">:</span> <span class="n">label</span><span class="o">,</span>
</span><span id="linespan-864"><a id="line-864" name="line-864"></a>  <span class="k">match</span> <span class="n">l</span> <span class="k">with</span>
</span><span id="linespan-865"><a id="line-865" name="line-865"></a>  <span class="o">|</span> <span class="n">BarrierLabel</span> <span class="o">_</span> <span class="o">_</span> <span class="o">_</span> <span class="o">=&gt;</span> <span class="bp">[]</span>
</span><span id="linespan-866"><a id="line-866" name="line-866"></a>  <span class="o">|</span> <span class="n">LockLabel</span> <span class="n">xs</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="n">filter</span> <span class="o">(λ</span> <span class="k">'</span><span class="o">(</span><span class="n">jj'</span><span class="o">,</span> <span class="o">_),</span> <span class="n">H</span><span class="o">.</span><span class="mi">1</span> <span class="o">=</span> <span class="n">jj'</span><span class="o">)</span> <span class="n">xs</span><span class="o">).*</span><span class="mi">2</span>
</span><span id="linespan-867"><a id="line-867" name="line-867"></a>  <span class="k">end</span><span class="o">))</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span>
</span><span id="linespan-868"><a id="line-868" name="line-868"></a>  <span class="k">rewrite</span> <span class="n">H3</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span> <span class="k">simpl</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span>
</span><span id="linespan-869"><a id="line-869" name="line-869"></a>  <span class="k">eapply</span> <span class="n">Permutation_nil</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span>
</span><span id="linespan-870"><a id="line-870" name="line-870"></a>  <span class="k">eapply</span> <span class="n">app_nil</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-871"><a id="line-871" name="line-871"></a>  <span class="k">eapply</span> <span class="n">fmap_nil_inv</span> <span class="k">in</span> <span class="n">H1</span><span class="o">.</span> <span class="k">clear</span> <span class="n">H3</span> <span class="n">H2</span><span class="o">.</span>
</span><span id="linespan-872"><a id="line-872" name="line-872"></a>  <span class="k">assert</span> <span class="o">(</span><span class="n">H</span> <span class="bp">∉</span> <span class="n">xs</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-873"><a id="line-873" name="line-873"></a>  <span class="k">eapply</span> <span class="n">filter_nil_not_elem_of</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-874"><a id="line-874" name="line-874"></a>  <span class="k">destruct</span> <span class="n">H</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-875"><a id="line-875" name="line-875"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-876"><a id="line-876" name="line-876"></a>
</span><span id="linespan-877"><a id="line-877" name="line-877"></a><span class="kn">Lemma</span> <span class="n">mset_forall_impl</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">P</span> <span class="n">Q</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-878"><a id="line-878" name="line-878"></a>  <span class="n">mset_forall</span> <span class="n">P</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="o">(∀</span> <span class="n">a</span><span class="o">,</span> <span class="n">P</span> <span class="n">a</span> <span class="o">-&gt;</span> <span class="n">Q</span> <span class="n">a</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">mset_forall</span> <span class="n">Q</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-879"><a id="line-879" name="line-879"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-880"><a id="line-880" name="line-880"></a>  <span class="k">intros</span> <span class="n">H1</span> <span class="n">H2</span> <span class="o">??.</span>
</span><span id="linespan-881"><a id="line-881" name="line-881"></a>  <span class="k">eapply</span> <span class="n">H2</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">H1</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-882"><a id="line-882" name="line-882"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-883"><a id="line-883" name="line-883"></a>
</span><span id="linespan-884"><a id="line-884" name="line-884"></a><span class="kn">Lemma</span> <span class="n">mset_forall_and</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">P</span> <span class="n">Q</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-885"><a id="line-885" name="line-885"></a>  <span class="n">mset_forall</span> <span class="n">P</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">mset_forall</span> <span class="n">Q</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-886"><a id="line-886" name="line-886"></a>  <span class="n">mset_forall</span> <span class="o">(λ</span> <span class="n">a</span><span class="o">,</span> <span class="n">P</span> <span class="n">a</span> <span class="o">∧</span> <span class="n">Q</span> <span class="n">a</span><span class="o">)</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-887"><a id="line-887" name="line-887"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-888"><a id="line-888" name="line-888"></a>  <span class="k">intros</span> <span class="n">H1</span> <span class="n">H2</span> <span class="o">??.</span>
</span><span id="linespan-889"><a id="line-889" name="line-889"></a>  <span class="k">split</span><span class="o">;</span> <span class="o">[</span><span class="k">eapply</span> <span class="n">H1</span><span class="o">|</span><span class="k">eapply</span> <span class="n">H2</span><span class="o">];</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-890"><a id="line-890" name="line-890"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-891"><a id="line-891" name="line-891"></a>
</span><span id="linespan-892"><a id="line-892" name="line-892"></a><span class="kn">Lemma</span> <span class="n">filter_id</span> <span class="o">{</span><span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">xs</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">P</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">`{∀</span> <span class="n">x</span><span class="o">,</span> <span class="n">Decision</span> <span class="o">(</span><span class="n">P</span> <span class="n">x</span><span class="o">)}</span> <span class="o">:</span>
</span><span id="linespan-893"><a id="line-893" name="line-893"></a>  <span class="o">(∀</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">xs</span> <span class="o">-&gt;</span> <span class="n">P</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-894"><a id="line-894" name="line-894"></a>  <span class="n">filter</span> <span class="n">P</span> <span class="n">xs</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span>
</span><span id="linespan-895"><a id="line-895" name="line-895"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-896"><a id="line-896" name="line-896"></a>  <span class="k">induction</span> <span class="n">xs</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">intro</span><span class="o">.</span>
</span><span id="linespan-897"><a id="line-897" name="line-897"></a>  <span class="k">rewrite</span> <span class="n">filter_cons</span><span class="o">.</span>
</span><span id="linespan-898"><a id="line-898" name="line-898"></a>  <span class="n">case_decide</span><span class="o">;</span> <span class="k">rewrite</span> <span class="n">IHxs</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span> <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-899"><a id="line-899" name="line-899"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">H0</span><span class="o">,</span> <span class="n">elem_of_cons</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-900"><a id="line-900" name="line-900"></a>  <span class="o">-</span> <span class="n">exfalso</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">H1</span><span class="o">,</span> <span class="n">H0</span><span class="o">,</span> <span class="n">elem_of_cons</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-901"><a id="line-901" name="line-901"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">H0</span><span class="o">,</span> <span class="n">elem_of_cons</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-902"><a id="line-902" name="line-902"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-903"><a id="line-903" name="line-903"></a>
</span><span id="linespan-904"><a id="line-904" name="line-904"></a><span class="kn">Lemma</span> <span class="n">filter_sublist</span> <span class="o">{</span><span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">xs</span> <span class="n">ys</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">P</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">`{∀</span> <span class="n">x</span><span class="o">,</span> <span class="n">Decision</span> <span class="o">(</span><span class="n">P</span> <span class="n">x</span><span class="o">)}</span> <span class="o">:</span>
</span><span id="linespan-905"><a id="line-905" name="line-905"></a>  <span class="n">xs</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">ys</span> <span class="o">-&gt;</span>
</span><span id="linespan-906"><a id="line-906" name="line-906"></a>  <span class="o">(∀</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">xs</span> <span class="o">-&gt;</span> <span class="n">P</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-907"><a id="line-907" name="line-907"></a>  <span class="n">xs</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">filter</span> <span class="n">P</span> <span class="n">ys</span><span class="o">.</span>
</span><span id="linespan-908"><a id="line-908" name="line-908"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-909"><a id="line-909" name="line-909"></a>  <span class="k">induction</span> <span class="mi">1</span><span class="o">;</span> <span class="k">intros</span> <span class="n">HH</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">sublist</span><span class="o">;</span>
</span><span id="linespan-910"><a id="line-910" name="line-910"></a>  <span class="k">rewrite</span> <span class="n">filter_cons</span><span class="o">;</span> <span class="n">case_decide</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">sublist</span><span class="o">.</span>
</span><span id="linespan-911"><a id="line-911" name="line-911"></a>  <span class="o">-</span> <span class="k">econstructor</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">IHsublist</span><span class="o">.</span>
</span><span id="linespan-912"><a id="line-912" name="line-912"></a>    <span class="k">intros</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">HH</span><span class="o">,</span> <span class="n">elem_of_cons</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-913"><a id="line-913" name="line-913"></a>  <span class="o">-</span> <span class="n">exfalso</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">H1</span><span class="o">,</span> <span class="n">HH</span><span class="o">,</span> <span class="n">elem_of_cons</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-914"><a id="line-914" name="line-914"></a>  <span class="o">-</span> <span class="k">econstructor</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">IHsublist</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-915"><a id="line-915" name="line-915"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-916"><a id="line-916" name="line-916"></a>
</span><span id="linespan-917"><a id="line-917" name="line-917"></a><span class="kn">Lemma</span> <span class="n">extract1_delete</span> <span class="n">ls</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">i</span> <span class="n">xs1</span> <span class="o">:</span>
</span><span id="linespan-918"><a id="line-918" name="line-918"></a>  <span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">jj</span> <span class="o">-&gt;</span>
</span><span id="linespan-919"><a id="line-919" name="line-919"></a>  <span class="n">jj</span> <span class="o">≠</span> <span class="n">i</span> <span class="o">-&gt;</span>
</span><span id="linespan-920"><a id="line-920" name="line-920"></a>  <span class="n">extract1</span> <span class="n">i</span> <span class="o">(</span><span class="n">zip</span> <span class="o">(</span><span class="n">delete</span> <span class="n">ii</span> <span class="n">ls</span><span class="o">)</span> <span class="o">(</span><span class="n">delete</span> <span class="n">ii</span> <span class="n">xs1</span><span class="o">))</span> <span class="o">=</span> <span class="n">extract1</span> <span class="n">i</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs1</span><span class="o">).</span>
</span><span id="linespan-921"><a id="line-921" name="line-921"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-922"><a id="line-922" name="line-922"></a>  <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-923"><a id="line-923" name="line-923"></a>  <span class="k">symmetry</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">extract1_ne_Some</span><span class="o">.</span>
</span><span id="linespan-924"><a id="line-924" name="line-924"></a>  <span class="k">intro</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-925"><a id="line-925" name="line-925"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-926"><a id="line-926" name="line-926"></a>
</span><span id="linespan-927"><a id="line-927" name="line-927"></a><span class="kn">Lemma</span> <span class="n">lockrelG_Wait</span> <span class="n">ls</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">xs</span> <span class="n">v</span> <span class="n">xs1</span> <span class="n">t'</span> <span class="n">ts</span> <span class="n">x</span> <span class="n">refcnt</span> <span class="o">:</span>
</span><span id="linespan-928"><a id="line-928" name="line-928"></a>  <span class="n">length</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">length</span> <span class="n">xs1</span> <span class="o">-&gt;</span>
</span><span id="linespan-929"><a id="line-929" name="line-929"></a>  <span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">jj</span> <span class="o">-&gt;</span>
</span><span id="linespan-930"><a id="line-930" name="line-930"></a>  <span class="n">xs</span> <span class="o">!!</span> <span class="n">jj</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">Some</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-931"><a id="line-931" name="line-931"></a>  <span class="n">xs1</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t'</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-932"><a id="line-932" name="line-932"></a>  <span class="n">ts</span> <span class="o">!!</span> <span class="n">jj</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">t'</span> <span class="o">-&gt;</span>
</span><span id="linespan-933"><a id="line-933" name="line-933"></a>  <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="n">ts</span> <span class="o">({[</span><span class="n">LockLabel</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs1</span><span class="o">)]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-934"><a id="line-934" name="line-934"></a>  <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="o">(</span><span class="n">delete</span> <span class="n">jj</span> <span class="n">xs</span><span class="o">)</span> <span class="o">(</span><span class="n">delete</span> <span class="n">jj</span> <span class="n">ts</span><span class="o">)</span>
</span><span id="linespan-935"><a id="line-935" name="line-935"></a>    <span class="o">({[</span><span class="n">LockLabel</span> <span class="o">(</span><span class="n">zip</span> <span class="o">(</span><span class="n">delete</span> <span class="n">ii</span> <span class="n">ls</span><span class="o">)</span> <span class="o">(</span><span class="n">delete</span> <span class="n">ii</span> <span class="n">xs1</span><span class="o">))]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-936"><a id="line-936" name="line-936"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-937"><a id="line-937" name="line-937"></a>  <span class="k">intros</span> <span class="n">HH</span><span class="o">????[</span><span class="n">order</span> <span class="bp">[]</span><span class="o">].</span>
</span><span id="linespan-938"><a id="line-938" name="line-938"></a>  <span class="n">eexists</span> <span class="o">(</span><span class="n">filter</span> <span class="o">(λ</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span> <span class="o">≠</span> <span class="n">jj</span><span class="o">)</span> <span class="n">order</span><span class="o">).</span> <span class="k">econstructor</span><span class="o">.</span>
</span><span id="linespan-939"><a id="line-939" name="line-939"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">NoDup_filter</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-940"><a id="line-940" name="line-940"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">dom_delete_L</span><span class="o">.</span>
</span><span id="linespan-941"><a id="line-941" name="line-941"></a>    <span class="k">eapply</span> <span class="n">set_eq</span><span class="o">.</span> <span class="k">intro</span><span class="o">.</span>
</span><span id="linespan-942"><a id="line-942" name="line-942"></a>    <span class="k">rewrite</span> <span class="n">elem_of_list_to_set</span> <span class="n">elem_of_list_filter</span><span class="o">.</span>
</span><span id="linespan-943"><a id="line-943" name="line-943"></a>    <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-944"><a id="line-944" name="line-944"></a>  <span class="o">-</span> <span class="k">revert</span> <span class="n">order_subsequences0</span><span class="o">.</span>
</span><span id="linespan-945"><a id="line-945" name="line-945"></a>    <span class="k">rewrite</span> <span class="o">!</span><span class="n">mset_forall_op</span> <span class="o">!</span><span class="n">mset_forall_singleton</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-946"><a id="line-946" name="line-946"></a>    <span class="k">rewrite</span> <span class="n">fst_zip</span> <span class="k">in</span> <span class="n">H7</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-947"><a id="line-947" name="line-947"></a>    <span class="k">split</span><span class="o">.</span>
</span><span id="linespan-948"><a id="line-948" name="line-948"></a>    <span class="o">+</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-949"><a id="line-949" name="line-949"></a>      <span class="k">rewrite</span> <span class="n">fst_zip</span><span class="o">.</span> <span class="o">{</span> <span class="k">eapply</span> <span class="n">order_delete</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-950"><a id="line-950" name="line-950"></a>      <span class="k">rewrite</span> <span class="o">!</span><span class="n">length_delete</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-951"><a id="line-951" name="line-951"></a>      <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-952"><a id="line-952" name="line-952"></a>    <span class="o">+</span> <span class="k">pose</span> <span class="n">proof</span> <span class="o">(</span><span class="n">lr_lockrel0</span> <span class="n">jj</span><span class="o">)</span> <span class="k">as</span> <span class="n">Q</span><span class="o">.</span>
</span><span id="linespan-953"><a id="line-953" name="line-953"></a>      <span class="k">rewrite</span> <span class="n">H0</span> <span class="n">H2</span> <span class="n">extract_op</span> <span class="n">extract_singleton</span> <span class="k">in</span> <span class="n">Q</span><span class="o">.</span>
</span><span id="linespan-954"><a id="line-954" name="line-954"></a>      <span class="k">erewrite</span> <span class="n">extract1_Some</span> <span class="k">in</span> <span class="n">Q</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-955"><a id="line-955" name="line-955"></a>      <span class="k">rewrite</span> <span class="o">-</span><span class="n">assoc</span> <span class="k">in</span> <span class="n">Q</span><span class="o">.</span>
</span><span id="linespan-956"><a id="line-956" name="line-956"></a>      <span class="k">eapply</span> <span class="n">lockrel_only_owner</span> <span class="k">in</span> <span class="n">Q</span><span class="o">.</span>
</span><span id="linespan-957"><a id="line-957" name="line-957"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">extract1</span> <span class="n">jj</span> <span class="o">(</span><span class="n">zip</span> <span class="o">(</span><span class="n">delete</span> <span class="n">ii</span> <span class="n">ls</span><span class="o">)</span> <span class="o">(</span><span class="n">delete</span> <span class="n">ii</span> <span class="n">xs1</span><span class="o">))</span> <span class="bp">⋅</span> <span class="n">extract</span> <span class="n">jj</span> <span class="n">x</span> <span class="bp">≡</span> <span class="n">ε</span><span class="o">)</span> <span class="k">as</span> <span class="n">Q'</span><span class="o">.</span>
</span><span id="linespan-958"><a id="line-958" name="line-958"></a>      <span class="o">{</span> <span class="k">rewrite</span> <span class="n">Q</span> <span class="o">//.</span> <span class="o">}</span>
</span><span id="linespan-959"><a id="line-959" name="line-959"></a>      <span class="k">eapply</span> <span class="n">multiset_empty_mult</span> <span class="k">in</span> <span class="n">Q'</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-960"><a id="line-960" name="line-960"></a>      <span class="n">epose</span> <span class="n">proof</span> <span class="o">(</span><span class="n">extract_empty</span> <span class="n">jj</span> <span class="n">x</span> <span class="n">H5</span><span class="o">).</span>
</span><span id="linespan-961"><a id="line-961" name="line-961"></a>      <span class="k">eapply</span> <span class="n">mset_forall_impl</span><span class="o">.</span>
</span><span id="linespan-962"><a id="line-962" name="line-962"></a>      <span class="o">{</span> <span class="k">eapply</span> <span class="n">mset_forall_and</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">H4</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">H6</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-963"><a id="line-963" name="line-963"></a>      <span class="k">intros</span> <span class="o">?</span><span class="bp">[]</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-964"><a id="line-964" name="line-964"></a>      <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-965"><a id="line-965" name="line-965"></a>      <span class="k">eapply</span> <span class="n">filter_sublist</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-966"><a id="line-966" name="line-966"></a>      <span class="k">intros</span> <span class="o">???.</span> <span class="k">subst</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">H9</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-967"><a id="line-967" name="line-967"></a>  <span class="o">-</span> <span class="k">intros</span> <span class="n">i</span><span class="o">.</span> <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_lockrel0</span> <span class="n">i</span><span class="o">).</span>
</span><span id="linespan-968"><a id="line-968" name="line-968"></a>    <span class="n">smap</span><span class="o">.</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">xs</span> <span class="o">!!</span> <span class="n">i</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">E</span><span class="o">;</span> <span class="k">rewrite</span> <span class="n">E</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-969"><a id="line-969" name="line-969"></a>    <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">ts</span> <span class="o">!!</span> <span class="n">i</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-970"><a id="line-970" name="line-970"></a>    <span class="k">revert</span> <span class="n">lr_lockrel0</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">extract_op</span> <span class="o">!</span><span class="n">extract_singleton</span><span class="o">.</span>
</span><span id="linespan-971"><a id="line-971" name="line-971"></a>    <span class="k">intros</span> <span class="n">lr</span><span class="o">.</span>
</span><span id="linespan-972"><a id="line-972" name="line-972"></a>    <span class="k">erewrite</span> <span class="n">extract1_delete</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-973"><a id="line-973" name="line-973"></a>  <span class="o">-</span> <span class="k">revert</span> <span class="n">lr_refcount0</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">Mlen_mult</span> <span class="o">!</span><span class="n">Mlen_singleton</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-974"><a id="line-974" name="line-974"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-975"><a id="line-975" name="line-975"></a>
</span><span id="linespan-976"><a id="line-976" name="line-976"></a><span class="kn">Lemma</span> <span class="n">extract1_empty</span> <span class="n">i</span> <span class="o">:</span> <span class="n">extract1</span> <span class="n">i</span> <span class="bp">[]</span> <span class="o">=</span> <span class="n">ε</span><span class="o">.</span>
</span><span id="linespan-977"><a id="line-977" name="line-977"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-978"><a id="line-978" name="line-978"></a>  <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-979"><a id="line-979" name="line-979"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-980"><a id="line-980" name="line-980"></a>
</span><span id="linespan-981"><a id="line-981" name="line-981"></a><span class="kn">Lemma</span> <span class="n">lockrelG_DropGroup</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="n">ts</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-982"><a id="line-982" name="line-982"></a>  <span class="n">lockrelG</span> <span class="o">(</span><span class="n">S</span> <span class="n">refcnt</span><span class="o">)</span> <span class="n">xs</span> <span class="n">ts</span> <span class="o">({[</span><span class="n">LockLabel</span> <span class="bp">[]</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-983"><a id="line-983" name="line-983"></a>  <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="n">ts</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-984"><a id="line-984" name="line-984"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-985"><a id="line-985" name="line-985"></a>  <span class="k">intros</span> <span class="o">[</span><span class="n">order</span> <span class="bp">[]</span><span class="o">].</span>
</span><span id="linespan-986"><a id="line-986" name="line-986"></a>  <span class="k">exists</span> <span class="n">order</span><span class="o">;</span> <span class="k">econstructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-987"><a id="line-987" name="line-987"></a>  <span class="k">apply</span> <span class="n">mset_forall_op</span> <span class="k">in</span> <span class="n">order_subsequences0</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-988"><a id="line-988" name="line-988"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-989"><a id="line-989" name="line-989"></a>
</span><span id="linespan-990"><a id="line-990" name="line-990"></a><span class="kn">Lemma</span> <span class="n">lockrelG_NewGroup</span> <span class="o">:</span> <span class="n">lockrelG</span> <span class="mi">1</span> <span class="bp">∅</span> <span class="bp">∅</span> <span class="o">{[</span><span class="n">LockLabel</span> <span class="bp">[]</span><span class="o">]}.</span>
</span><span id="linespan-991"><a id="line-991" name="line-991"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-992"><a id="line-992" name="line-992"></a>  <span class="k">exists</span> <span class="bp">[]</span><span class="o">.</span> <span class="k">econstructor</span><span class="o">.</span>
</span><span id="linespan-993"><a id="line-993" name="line-993"></a>  <span class="o">-</span> <span class="kp">by</span> <span class="k">eapply</span> <span class="n">NoDup_nil</span><span class="o">.</span>
</span><span id="linespan-994"><a id="line-994" name="line-994"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">list_to_set_nil</span> <span class="n">dom_empty_L</span> <span class="o">//.</span>
</span><span id="linespan-995"><a id="line-995" name="line-995"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">mset_forall_singleton</span><span class="o">.</span> <span class="k">exists</span> <span class="bp">[]</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-996"><a id="line-996" name="line-996"></a>  <span class="o">-</span> <span class="k">intro</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-997"><a id="line-997" name="line-997"></a>  <span class="o">-</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-998"><a id="line-998" name="line-998"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-999"><a id="line-999" name="line-999"></a>
</span><span id="linespan-1000"><a id="line-1000" name="line-1000"></a><span class="kn">Lemma</span> <span class="n">lockrelG_empty_inv</span> <span class="n">x</span> <span class="o">:</span> <span class="n">lockrelG</span> <span class="mi">0</span> <span class="bp">∅</span> <span class="bp">∅</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">ε</span><span class="o">.</span>
</span><span id="linespan-1001"><a id="line-1001" name="line-1001"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1002"><a id="line-1002" name="line-1002"></a>  <span class="k">intros</span> <span class="o">[</span><span class="n">order</span> <span class="bp">[]</span><span class="o">].</span> <span class="kp">by</span> <span class="k">eapply</span> <span class="n">Mlen_zero_inv</span><span class="o">.</span>
</span><span id="linespan-1003"><a id="line-1003" name="line-1003"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1004"><a id="line-1004" name="line-1004"></a>
</span><span id="linespan-1005"><a id="line-1005" name="line-1005"></a><span class="kn">Lemma</span> <span class="n">list_to_set_insert2</span> <span class="n">ii</span> <span class="n">jj</span> <span class="o">(</span><span class="n">xs</span> <span class="o">:</span> <span class="n">list</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-1006"><a id="line-1006" name="line-1006"></a>  <span class="o">(</span><span class="n">list_to_set</span> <span class="o">(</span><span class="n">insert2</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">xs</span><span class="o">)</span> <span class="o">:</span> <span class="n">gset</span> <span class="n">nat</span><span class="o">)</span> <span class="o">=</span> <span class="o">{[</span><span class="n">jj</span><span class="o">]}</span> <span class="bp">∪</span> <span class="n">list_to_set</span> <span class="n">xs</span><span class="o">.</span>
</span><span id="linespan-1007"><a id="line-1007" name="line-1007"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1008"><a id="line-1008" name="line-1008"></a>  <span class="k">revert</span> <span class="n">ii</span><span class="o">;</span> <span class="k">induction</span> <span class="n">xs</span><span class="o">;</span> <span class="k">intros</span> <span class="bp">[]</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1009"><a id="line-1009" name="line-1009"></a>  <span class="k">rewrite</span> <span class="n">IHxs</span><span class="o">.</span> <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-1010"><a id="line-1010" name="line-1010"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1011"><a id="line-1011" name="line-1011"></a>
</span><span id="linespan-1012"><a id="line-1012" name="line-1012"></a><span class="kn">Lemma</span> <span class="n">insert2_nil</span> <span class="o">{</span><span class="n">A</span><span class="o">}</span> <span class="n">ii</span> <span class="n">jj</span> <span class="o">:</span>
</span><span id="linespan-1013"><a id="line-1013" name="line-1013"></a>  <span class="n">insert2</span> <span class="n">ii</span> <span class="n">jj</span> <span class="bp">[]</span> <span class="o">=</span> <span class="o">[</span><span class="n">jj</span><span class="o">:</span><span class="n">A</span><span class="o">].</span>
</span><span id="linespan-1014"><a id="line-1014" name="line-1014"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1015"><a id="line-1015" name="line-1015"></a>  <span class="k">destruct</span> <span class="n">ii</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1016"><a id="line-1016" name="line-1016"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1017"><a id="line-1017" name="line-1017"></a>
</span><span id="linespan-1018"><a id="line-1018" name="line-1018"></a><span class="kn">Lemma</span> <span class="n">extract1_insert2_ne</span> <span class="n">i</span> <span class="n">ls</span> <span class="n">xs1</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">c</span> <span class="o">:</span>
</span><span id="linespan-1019"><a id="line-1019" name="line-1019"></a>  <span class="n">length</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">length</span> <span class="n">xs1</span> <span class="o">-&gt;</span>
</span><span id="linespan-1020"><a id="line-1020" name="line-1020"></a>  <span class="n">jj</span> <span class="o">≠</span> <span class="n">i</span> <span class="o">-&gt;</span>
</span><span id="linespan-1021"><a id="line-1021" name="line-1021"></a>  <span class="n">extract1</span> <span class="n">i</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs1</span><span class="o">)</span> <span class="bp">≡</span> <span class="n">extract1</span> <span class="n">i</span> <span class="o">(</span><span class="n">zip</span> <span class="o">(</span><span class="n">insert2</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">ls</span><span class="o">)</span> <span class="o">(</span><span class="n">insert2</span> <span class="n">ii</span> <span class="n">c</span> <span class="n">xs1</span><span class="o">)).</span>
</span><span id="linespan-1022"><a id="line-1022" name="line-1022"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1023"><a id="line-1023" name="line-1023"></a>  <span class="k">intros</span> <span class="n">H1</span> <span class="n">H2</span><span class="o">.</span>
</span><span id="linespan-1024"><a id="line-1024" name="line-1024"></a>  <span class="k">unfold</span> <span class="n">extract1</span><span class="o">.</span>
</span><span id="linespan-1025"><a id="line-1025" name="line-1025"></a>  <span class="n">f_equiv</span><span class="o">.</span> <span class="n">f_equal</span><span class="o">.</span>
</span><span id="linespan-1026"><a id="line-1026" name="line-1026"></a>  <span class="k">revert</span> <span class="n">jj</span> <span class="n">i</span> <span class="n">xs1</span> <span class="n">ii</span> <span class="n">H1</span> <span class="n">H2</span><span class="o">.</span> <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="k">intros</span><span class="o">;</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-1027"><a id="line-1027" name="line-1027"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">xs1</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">filter_nil</span> <span class="o">!</span><span class="n">insert2_nil</span><span class="o">.</span>
</span><span id="linespan-1028"><a id="line-1028" name="line-1028"></a>    <span class="k">rewrite</span> <span class="n">filter_cons</span> <span class="n">filter_nil</span><span class="o">.</span>
</span><span id="linespan-1029"><a id="line-1029" name="line-1029"></a>    <span class="n">case_decide</span><span class="o">;</span> <span class="kr">try</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1030"><a id="line-1030" name="line-1030"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">xs1</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1031"><a id="line-1031" name="line-1031"></a>    <span class="k">destruct</span> <span class="n">ii</span><span class="o">;</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-1032"><a id="line-1032" name="line-1032"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">filter_cons</span><span class="o">.</span>
</span><span id="linespan-1033"><a id="line-1033" name="line-1033"></a>      <span class="kr">repeat</span> <span class="n">case_decide</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1034"><a id="line-1034" name="line-1034"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">filter_cons</span><span class="o">;</span> <span class="kr">repeat</span> <span class="n">case_decide</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1035"><a id="line-1035" name="line-1035"></a>      <span class="o">*</span> <span class="n">f_equal</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1036"><a id="line-1036" name="line-1036"></a>      <span class="o">*</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1037"><a id="line-1037" name="line-1037"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1038"><a id="line-1038" name="line-1038"></a>
</span><span id="linespan-1039"><a id="line-1039" name="line-1039"></a><span class="kn">Lemma</span> <span class="n">extract_empty_inv</span> <span class="n">i</span> <span class="n">order</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-1040"><a id="line-1040" name="line-1040"></a>  <span class="n">i</span> <span class="bp">∉</span> <span class="n">order</span> <span class="o">-&gt;</span>
</span><span id="linespan-1041"><a id="line-1041" name="line-1041"></a>  <span class="n">mset_forall</span>
</span><span id="linespan-1042"><a id="line-1042" name="line-1042"></a>        <span class="o">(λ</span> <span class="n">l</span> <span class="o">:</span> <span class="n">labelO</span><span class="o">,</span>
</span><span id="linespan-1043"><a id="line-1043" name="line-1043"></a>            <span class="o">∃</span> <span class="n">xs</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">vertex</span> <span class="o">*</span> <span class="o">(</span><span class="n">lockcap</span> <span class="o">*</span> <span class="n">type</span><span class="o">)),</span>
</span><span id="linespan-1044"><a id="line-1044" name="line-1044"></a>              <span class="n">l</span> <span class="o">=</span> <span class="n">LockLabel</span> <span class="n">xs</span> <span class="o">∧</span> <span class="n">xs</span><span class="o">.*</span><span class="mi">1</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">order</span><span class="o">)</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-1045"><a id="line-1045" name="line-1045"></a>  <span class="n">extract</span> <span class="n">i</span> <span class="n">x</span> <span class="o">=</span> <span class="n">ε</span><span class="o">.</span>
</span><span id="linespan-1046"><a id="line-1046" name="line-1046"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1047"><a id="line-1047" name="line-1047"></a>  <span class="k">unfold</span> <span class="n">extract</span><span class="o">.</span>
</span><span id="linespan-1048"><a id="line-1048" name="line-1048"></a>  <span class="k">destruct</span> <span class="o">((</span><span class="n">flat_map</span>
</span><span id="linespan-1049"><a id="line-1049" name="line-1049"></a>  <span class="o">(λ</span> <span class="n">l</span> <span class="o">:</span> <span class="n">label</span><span class="o">,</span>
</span><span id="linespan-1050"><a id="line-1050" name="line-1050"></a>     <span class="k">match</span> <span class="n">l</span> <span class="k">with</span>
</span><span id="linespan-1051"><a id="line-1051" name="line-1051"></a>     <span class="o">|</span> <span class="n">BarrierLabel</span> <span class="o">_</span> <span class="o">_</span> <span class="o">_</span> <span class="o">=&gt;</span> <span class="bp">[]</span>
</span><span id="linespan-1052"><a id="line-1052" name="line-1052"></a>     <span class="o">|</span> <span class="n">LockLabel</span> <span class="n">xs</span> <span class="o">=&gt;</span> <span class="n">multiset_car</span> <span class="o">(</span><span class="n">extract1</span> <span class="n">i</span> <span class="n">xs</span><span class="o">)</span>
</span><span id="linespan-1053"><a id="line-1053" name="line-1053"></a>     <span class="k">end</span><span class="o">)</span> <span class="o">(</span><span class="n">multiset_car</span> <span class="n">x</span><span class="o">)))</span> <span class="n">eqn</span><span class="o">:</span><span class="n">E</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1054"><a id="line-1054" name="line-1054"></a>  <span class="k">intros</span><span class="o">.</span> <span class="n">exfalso</span><span class="o">.</span>
</span><span id="linespan-1055"><a id="line-1055" name="line-1055"></a>  <span class="k">assert</span> <span class="o">(</span><span class="n">In</span> <span class="n">o</span> <span class="o">(</span><span class="n">o</span> <span class="o">::</span> <span class="n">l</span><span class="o">));</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">in_eq</span><span class="o">.</span>
</span><span id="linespan-1056"><a id="line-1056" name="line-1056"></a>  <span class="k">rewrite</span> <span class="o">-</span><span class="n">E</span> <span class="n">in_flat_map</span> <span class="k">in</span> <span class="n">H1</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1057"><a id="line-1057" name="line-1057"></a>  <span class="k">destruct</span> <span class="n">H2</span><span class="o">.</span> <span class="o">{</span> <span class="n">inv</span> <span class="n">H4</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-1058"><a id="line-1058" name="line-1058"></a>  <span class="k">eapply</span> <span class="n">elem_of_list_In</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span>
</span><span id="linespan-1059"><a id="line-1059" name="line-1059"></a>  <span class="k">eapply</span> <span class="n">elem_of_list_fmap</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span>
</span><span id="linespan-1060"><a id="line-1060" name="line-1060"></a>  <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1061"><a id="line-1061" name="line-1061"></a>  <span class="k">eapply</span> <span class="n">elem_of_list_filter</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1062"><a id="line-1062" name="line-1062"></a>  <span class="k">destruct</span> <span class="n">H2</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1063"><a id="line-1063" name="line-1063"></a>  <span class="k">eapply</span> <span class="n">elem_of_list_In</span> <span class="k">in</span> <span class="n">H1</span><span class="o">.</span>
</span><span id="linespan-1064"><a id="line-1064" name="line-1064"></a>  <span class="k">assert</span> <span class="o">(∃</span> <span class="n">x'</span><span class="o">,</span> <span class="n">x</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="n">LockLabel</span> <span class="n">ls</span> <span class="o">:</span> <span class="n">labelO</span> <span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x'</span><span class="o">).</span>
</span><span id="linespan-1065"><a id="line-1065" name="line-1065"></a>  <span class="o">{</span> <span class="k">eapply</span> <span class="n">elem_of_list_lookup</span> <span class="k">in</span> <span class="n">H1</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1066"><a id="line-1066" name="line-1066"></a>    <span class="k">exists</span> <span class="o">(</span><span class="n">list_to_multiset</span> <span class="o">(</span><span class="n">delete</span> <span class="n">H2</span> <span class="o">(</span><span class="n">multiset_car</span> <span class="n">x</span><span class="o">))).</span>
</span><span id="linespan-1067"><a id="line-1067" name="line-1067"></a>    <span class="k">eapply</span> <span class="n">delete_Permutation</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span>
</span><span id="linespan-1068"><a id="line-1068" name="line-1068"></a>    <span class="k">econstructor</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">exact</span> <span class="n">H3</span><span class="o">.</span>
</span><span id="linespan-1069"><a id="line-1069" name="line-1069"></a>    <span class="kp">done</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-1070"><a id="line-1070" name="line-1070"></a>  <span class="n">simp</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">H5</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span>
</span><span id="linespan-1071"><a id="line-1071" name="line-1071"></a>  <span class="k">rewrite</span> <span class="n">mset_forall_op</span> <span class="n">mset_forall_singleton</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1072"><a id="line-1072" name="line-1072"></a>  <span class="k">eapply</span> <span class="n">H</span><span class="o">,</span> <span class="n">sublist_elem_of</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1073"><a id="line-1073" name="line-1073"></a>  <span class="k">eapply</span> <span class="n">elem_of_list_fmap</span><span class="o">.</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1074"><a id="line-1074" name="line-1074"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1075"><a id="line-1075" name="line-1075"></a>
</span><span id="linespan-1076"><a id="line-1076" name="line-1076"></a><span class="kn">Lemma</span> <span class="n">extract1_insert2</span> <span class="n">i</span> <span class="n">ii</span> <span class="n">ls</span> <span class="n">t'</span> <span class="n">xs1</span> <span class="o">:</span>
</span><span id="linespan-1077"><a id="line-1077" name="line-1077"></a>  <span class="n">length</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">length</span> <span class="n">xs1</span> <span class="o">-&gt;</span>
</span><span id="linespan-1078"><a id="line-1078" name="line-1078"></a>  <span class="n">extract1</span> <span class="n">i</span> <span class="o">(</span><span class="n">zip</span> <span class="o">(</span><span class="n">insert2</span> <span class="n">ii</span> <span class="n">i</span> <span class="n">ls</span><span class="o">)</span> <span class="o">(</span><span class="n">insert2</span> <span class="n">ii</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t'</span><span class="o">)</span> <span class="n">xs1</span><span class="o">))</span>
</span><span id="linespan-1079"><a id="line-1079" name="line-1079"></a>  <span class="bp">≡</span> <span class="o">{[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t'</span><span class="o">):</span><span class="n">labelO'</span> <span class="o">]}</span> <span class="bp">⋅</span> <span class="n">extract1</span> <span class="n">i</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs1</span><span class="o">).</span>
</span><span id="linespan-1080"><a id="line-1080" name="line-1080"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1081"><a id="line-1081" name="line-1081"></a>  <span class="k">revert</span> <span class="n">xs1</span> <span class="n">ls</span><span class="o">.</span> <span class="k">induction</span> <span class="n">ii</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-1082"><a id="line-1082" name="line-1082"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">extract1_cons</span><span class="o">.</span> <span class="n">case_decide</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1083"><a id="line-1083" name="line-1083"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">ls</span><span class="o">,</span><span class="n">xs1</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="k">rewrite</span> <span class="o">?</span><span class="n">extract1_cons</span><span class="o">;</span> <span class="n">case_decide</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span>
</span><span id="linespan-1084"><a id="line-1084" name="line-1084"></a>    <span class="k">rewrite</span> <span class="n">IHii</span> <span class="o">//</span> <span class="o">!</span><span class="n">assoc</span><span class="o">.</span>
</span><span id="linespan-1085"><a id="line-1085" name="line-1085"></a>    <span class="n">f_equiv</span><span class="o">.</span> <span class="k">apply</span> <span class="n">comm</span><span class="o">,</span> <span class="o">_.</span>
</span><span id="linespan-1086"><a id="line-1086" name="line-1086"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1087"><a id="line-1087" name="line-1087"></a>
</span><span id="linespan-1088"><a id="line-1088" name="line-1088"></a><span class="kn">Lemma</span> <span class="n">extract1_empty'</span> <span class="n">i</span> <span class="n">ls</span> <span class="n">xs1</span> <span class="o">:</span>
</span><span id="linespan-1089"><a id="line-1089" name="line-1089"></a>  <span class="n">i</span> <span class="bp">∉</span> <span class="n">ls</span> <span class="o">-&gt;</span>
</span><span id="linespan-1090"><a id="line-1090" name="line-1090"></a>  <span class="n">extract1</span> <span class="n">i</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs1</span><span class="o">)</span> <span class="o">=</span> <span class="n">ε</span><span class="o">.</span>
</span><span id="linespan-1091"><a id="line-1091" name="line-1091"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1092"><a id="line-1092" name="line-1092"></a>  <span class="k">unfold</span> <span class="n">extract1</span><span class="o">.</span>
</span><span id="linespan-1093"><a id="line-1093" name="line-1093"></a>  <span class="k">revert</span> <span class="n">xs1</span><span class="o">.</span> <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span> <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-1094"><a id="line-1094" name="line-1094"></a>  <span class="k">eapply</span> <span class="n">not_elem_of_cons</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-1095"><a id="line-1095" name="line-1095"></a>  <span class="k">destruct</span> <span class="n">xs1</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1096"><a id="line-1096" name="line-1096"></a>  <span class="k">rewrite</span> <span class="n">filter_cons</span><span class="o">.</span> <span class="n">case_decide</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1097"><a id="line-1097" name="line-1097"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1098"><a id="line-1098" name="line-1098"></a>
</span><span id="linespan-1099"><a id="line-1099" name="line-1099"></a><span class="kn">Fixpoint</span> <span class="n">find_index</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">(</span><span class="n">xs</span> <span class="o">:</span> <span class="n">list</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:=</span>
</span><span id="linespan-1100"><a id="line-1100" name="line-1100"></a>  <span class="k">match</span> <span class="n">xs</span> <span class="k">with</span>
</span><span id="linespan-1101"><a id="line-1101" name="line-1101"></a>  <span class="o">|</span> <span class="bp">[]</span> <span class="o">=&gt;</span> <span class="n">None</span>
</span><span id="linespan-1102"><a id="line-1102" name="line-1102"></a>  <span class="o">|</span> <span class="n">a'</span> <span class="o">::</span> <span class="n">xs'</span> <span class="o">=&gt;</span> <span class="k">if</span> <span class="n">decide</span><span class="o">(</span><span class="n">a</span> <span class="o">=</span> <span class="n">a'</span><span class="o">)</span> <span class="k">then</span> <span class="n">Some</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">S</span> <span class="o">&lt;$&gt;</span> <span class="n">find_index</span> <span class="n">a</span> <span class="n">xs'</span>
</span><span id="linespan-1103"><a id="line-1103" name="line-1103"></a>  <span class="k">end</span><span class="o">.</span>
</span><span id="linespan-1104"><a id="line-1104" name="line-1104"></a>
</span><span id="linespan-1105"><a id="line-1105" name="line-1105"></a><span class="kn">Lemma</span> <span class="n">find_index_Some</span> <span class="n">a</span> <span class="n">xs</span> <span class="n">i</span> <span class="o">:</span>
</span><span id="linespan-1106"><a id="line-1106" name="line-1106"></a>  <span class="n">find_index</span> <span class="n">a</span> <span class="n">xs</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">xs</span> <span class="o">!!</span> <span class="n">i</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">a</span><span class="o">.</span>
</span><span id="linespan-1107"><a id="line-1107" name="line-1107"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1108"><a id="line-1108" name="line-1108"></a>  <span class="k">revert</span> <span class="n">i</span><span class="o">;</span> <span class="k">induction</span> <span class="n">xs</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1109"><a id="line-1109" name="line-1109"></a>  <span class="n">case_decide</span><span class="o">;</span> <span class="k">destruct</span> <span class="n">i</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1110"><a id="line-1110" name="line-1110"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">find_index</span><span class="o">;</span> <span class="kr">try</span> <span class="kp">discriminate</span><span class="o">.</span>
</span><span id="linespan-1111"><a id="line-1111" name="line-1111"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">IHxs</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1112"><a id="line-1112" name="line-1112"></a>    <span class="k">destruct</span> <span class="n">find_index</span><span class="o">;</span> <span class="kr">try</span> <span class="kp">discriminate</span><span class="o">.</span> <span class="n">inv</span> <span class="n">H</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1113"><a id="line-1113" name="line-1113"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1114"><a id="line-1114" name="line-1114"></a>
</span><span id="linespan-1115"><a id="line-1115" name="line-1115"></a><span class="kn">Lemma</span> <span class="n">find_index_None</span> <span class="n">a</span> <span class="n">xs</span> <span class="o">:</span>
</span><span id="linespan-1116"><a id="line-1116" name="line-1116"></a>  <span class="n">find_index</span> <span class="n">a</span> <span class="n">xs</span> <span class="o">=</span> <span class="n">None</span> <span class="o">-&gt;</span> <span class="n">a</span> <span class="bp">∉</span> <span class="n">xs</span><span class="o">.</span>
</span><span id="linespan-1117"><a id="line-1117" name="line-1117"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1118"><a id="line-1118" name="line-1118"></a>  <span class="k">induction</span> <span class="n">xs</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="kr">try</span> <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-1119"><a id="line-1119" name="line-1119"></a>  <span class="n">case_decide</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1120"><a id="line-1120" name="line-1120"></a>  <span class="k">eapply</span> <span class="n">not_elem_of_cons</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1121"><a id="line-1121" name="line-1121"></a>  <span class="k">destruct</span> <span class="n">find_index</span><span class="o">;</span> <span class="kr">try</span> <span class="kp">discriminate</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1122"><a id="line-1122" name="line-1122"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1123"><a id="line-1123" name="line-1123"></a>
</span><span id="linespan-1124"><a id="line-1124" name="line-1124"></a><span class="kn">Definition</span> <span class="n">insert_at</span> <span class="o">(</span><span class="n">ii</span> <span class="n">jj</span><span class="o">:</span><span class="n">nat</span><span class="o">)</span> <span class="o">(</span><span class="n">ls</span> <span class="n">order</span><span class="o">:</span><span class="n">list</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">list</span> <span class="n">nat</span> <span class="o">:=</span>
</span><span id="linespan-1125"><a id="line-1125" name="line-1125"></a>  <span class="k">match</span> <span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="k">with</span>
</span><span id="linespan-1126"><a id="line-1126" name="line-1126"></a>  <span class="o">|</span> <span class="n">Some</span> <span class="n">a</span> <span class="o">=&gt;</span>
</span><span id="linespan-1127"><a id="line-1127" name="line-1127"></a>    <span class="k">match</span> <span class="n">find_index</span> <span class="n">a</span> <span class="n">order</span> <span class="k">with</span>
</span><span id="linespan-1128"><a id="line-1128" name="line-1128"></a>    <span class="o">|</span> <span class="n">Some</span> <span class="n">i</span> <span class="o">=&gt;</span> <span class="n">insert2</span> <span class="n">i</span> <span class="n">jj</span> <span class="n">order</span>
</span><span id="linespan-1129"><a id="line-1129" name="line-1129"></a>    <span class="o">|</span> <span class="n">None</span> <span class="o">=&gt;</span> <span class="n">order</span> <span class="o">++</span> <span class="o">[</span><span class="n">jj</span><span class="o">]</span>
</span><span id="linespan-1130"><a id="line-1130" name="line-1130"></a>    <span class="k">end</span>
</span><span id="linespan-1131"><a id="line-1131" name="line-1131"></a>  <span class="o">|</span> <span class="n">None</span> <span class="o">=&gt;</span> <span class="n">order</span> <span class="o">++</span> <span class="o">[</span><span class="n">jj</span><span class="o">]</span>
</span><span id="linespan-1132"><a id="line-1132" name="line-1132"></a>  <span class="k">end</span><span class="o">.</span>
</span><span id="linespan-1133"><a id="line-1133" name="line-1133"></a>
</span><span id="linespan-1134"><a id="line-1134" name="line-1134"></a><span class="kn">Lemma</span> <span class="n">insert2_lookup_None</span> <span class="o">{</span><span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">ls</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span><span class="o">)</span> <span class="n">ii</span> <span class="n">jj</span> <span class="o">:</span>
</span><span id="linespan-1135"><a id="line-1135" name="line-1135"></a>  <span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">None</span> <span class="o">-&gt;</span>
</span><span id="linespan-1136"><a id="line-1136" name="line-1136"></a>  <span class="n">insert2</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">ls</span> <span class="o">++</span> <span class="o">[</span><span class="n">jj</span><span class="o">].</span>
</span><span id="linespan-1137"><a id="line-1137" name="line-1137"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1138"><a id="line-1138" name="line-1138"></a>  <span class="k">revert</span> <span class="n">ii</span> <span class="n">ls</span><span class="o">.</span> <span class="k">induction</span> <span class="n">ii</span><span class="o">;</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-1139"><a id="line-1139" name="line-1139"></a>  <span class="o">-</span> <span class="k">intros</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">ls</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1140"><a id="line-1140" name="line-1140"></a>  <span class="o">-</span> <span class="k">intros</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">ls</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="n">f_equal</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1141"><a id="line-1141" name="line-1141"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1142"><a id="line-1142" name="line-1142"></a>
</span><span id="linespan-1143"><a id="line-1143" name="line-1143"></a><span class="kn">Lemma</span> <span class="n">sublist_insert2_corr</span> <span class="o">{</span><span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">ls</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span><span class="o">)</span> <span class="n">ii</span> <span class="n">ii'</span> <span class="n">jj</span> <span class="n">order</span> <span class="n">n</span> <span class="o">:</span>
</span><span id="linespan-1144"><a id="line-1144" name="line-1144"></a>  <span class="n">NoDup</span> <span class="n">order</span> <span class="o">-&gt;</span>
</span><span id="linespan-1145"><a id="line-1145" name="line-1145"></a>  <span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">n</span> <span class="o">-&gt;</span>
</span><span id="linespan-1146"><a id="line-1146" name="line-1146"></a>  <span class="n">order</span> <span class="o">!!</span> <span class="n">ii'</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">n</span> <span class="o">-&gt;</span>
</span><span id="linespan-1147"><a id="line-1147" name="line-1147"></a>  <span class="n">ls</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">order</span> <span class="o">-&gt;</span>
</span><span id="linespan-1148"><a id="line-1148" name="line-1148"></a>  <span class="n">insert2</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">ls</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">insert2</span> <span class="n">ii'</span> <span class="n">jj</span> <span class="n">order</span><span class="o">.</span>
</span><span id="linespan-1149"><a id="line-1149" name="line-1149"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1150"><a id="line-1150" name="line-1150"></a>  <span class="k">intros</span> <span class="n">HND</span> <span class="n">H1</span> <span class="n">H2</span> <span class="n">HH</span><span class="o">.</span> <span class="k">revert</span> <span class="n">H1</span> <span class="n">H2</span><span class="o">.</span> <span class="k">revert</span> <span class="n">ii</span> <span class="n">ii'</span><span class="o">.</span>
</span><span id="linespan-1151"><a id="line-1151" name="line-1151"></a>  <span class="k">induction</span> <span class="n">HH</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1152"><a id="line-1152" name="line-1152"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">ii</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1153"><a id="line-1153" name="line-1153"></a>    <span class="o">+</span> <span class="k">destruct</span> <span class="n">ii'</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1154"><a id="line-1154" name="line-1154"></a>      <span class="o">*</span> <span class="kr">do</span> <span class="mi">2</span> <span class="k">econstructor</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1155"><a id="line-1155" name="line-1155"></a>      <span class="o">*</span> <span class="k">eapply</span> <span class="n">NoDup_cons</span> <span class="k">in</span> <span class="n">HND</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1156"><a id="line-1156" name="line-1156"></a>        <span class="k">eapply</span> <span class="n">elem_of_list_lookup_2</span> <span class="k">in</span> <span class="n">H2</span><span class="o">.</span> <span class="n">exfalso</span><span class="o">.</span>
</span><span id="linespan-1157"><a id="line-1157" name="line-1157"></a>        <span class="k">eapply</span> <span class="n">H</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1158"><a id="line-1158" name="line-1158"></a>    <span class="o">+</span> <span class="k">destruct</span> <span class="n">ii'</span><span class="o">;</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1159"><a id="line-1159" name="line-1159"></a>      <span class="o">*</span> <span class="k">eapply</span> <span class="n">NoDup_cons</span> <span class="k">in</span> <span class="n">HND</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1160"><a id="line-1160" name="line-1160"></a>        <span class="k">eapply</span> <span class="n">elem_of_list_lookup_2</span> <span class="k">in</span> <span class="n">H1</span><span class="o">.</span> <span class="n">exfalso</span><span class="o">.</span>
</span><span id="linespan-1161"><a id="line-1161" name="line-1161"></a>        <span class="k">eapply</span> <span class="n">H</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">sublist_elem_of</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1162"><a id="line-1162" name="line-1162"></a>      <span class="o">*</span> <span class="k">econstructor</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">IHHH</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1163"><a id="line-1163" name="line-1163"></a>        <span class="k">eapply</span> <span class="n">NoDup_cons</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1164"><a id="line-1164" name="line-1164"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">ii'</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1165"><a id="line-1165" name="line-1165"></a>    <span class="o">*</span> <span class="k">eapply</span> <span class="n">NoDup_cons</span> <span class="k">in</span> <span class="n">HND</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1166"><a id="line-1166" name="line-1166"></a>      <span class="k">eapply</span> <span class="n">elem_of_list_lookup_2</span> <span class="k">in</span> <span class="n">H1</span><span class="o">.</span> <span class="n">exfalso</span><span class="o">.</span>
</span><span id="linespan-1167"><a id="line-1167" name="line-1167"></a>      <span class="k">eapply</span> <span class="n">H</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">sublist_elem_of</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1168"><a id="line-1168" name="line-1168"></a>    <span class="o">*</span> <span class="k">econstructor</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">IHHH</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">NoDup_cons</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1169"><a id="line-1169" name="line-1169"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1170"><a id="line-1170" name="line-1170"></a>
</span><span id="linespan-1171"><a id="line-1171" name="line-1171"></a><span class="kn">Lemma</span> <span class="n">insert_at_sublist</span> <span class="n">ls</span> <span class="n">order</span> <span class="n">ii</span> <span class="n">jj</span> <span class="o">:</span>
</span><span id="linespan-1172"><a id="line-1172" name="line-1172"></a>  <span class="n">NoDup</span> <span class="n">order</span> <span class="o">-&gt;</span>
</span><span id="linespan-1173"><a id="line-1173" name="line-1173"></a>  <span class="n">ls</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">order</span> <span class="o">-&gt;</span>
</span><span id="linespan-1174"><a id="line-1174" name="line-1174"></a>  <span class="n">insert2</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">ls</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">insert_at</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">ls</span> <span class="n">order</span><span class="o">.</span>
</span><span id="linespan-1175"><a id="line-1175" name="line-1175"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1176"><a id="line-1176" name="line-1176"></a>  <span class="k">unfold</span> <span class="n">insert_at</span><span class="o">.</span>
</span><span id="linespan-1177"><a id="line-1177" name="line-1177"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">ls</span><span class="o">!!</span><span class="n">ii</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">E</span><span class="o">.</span>
</span><span id="linespan-1178"><a id="line-1178" name="line-1178"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">find_index</span> <span class="n">n</span> <span class="n">order</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">F</span><span class="o">.</span>
</span><span id="linespan-1179"><a id="line-1179" name="line-1179"></a>    <span class="o">+</span> <span class="k">eapply</span> <span class="n">find_index_Some</span> <span class="k">in</span> <span class="n">F</span><span class="o">.</span>
</span><span id="linespan-1180"><a id="line-1180" name="line-1180"></a>      <span class="k">intros</span> <span class="n">HH</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">sublist_insert2_corr</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1181"><a id="line-1181" name="line-1181"></a>    <span class="o">+</span> <span class="k">eapply</span> <span class="n">find_index_None</span> <span class="k">in</span> <span class="n">F</span><span class="o">.</span> <span class="k">intros</span><span class="o">.</span> <span class="n">exfalso</span><span class="o">.</span>
</span><span id="linespan-1182"><a id="line-1182" name="line-1182"></a>      <span class="k">eapply</span> <span class="n">F</span><span class="o">,</span> <span class="n">sublist_elem_of</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1183"><a id="line-1183" name="line-1183"></a>      <span class="k">eapply</span> <span class="n">elem_of_list_lookup</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1184"><a id="line-1184" name="line-1184"></a>  <span class="o">-</span> <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-1185"><a id="line-1185" name="line-1185"></a>    <span class="k">rewrite</span> <span class="n">insert2_lookup_None</span> <span class="o">//.</span>
</span><span id="linespan-1186"><a id="line-1186" name="line-1186"></a>    <span class="k">eapply</span> <span class="n">sublist_app</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1187"><a id="line-1187" name="line-1187"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1188"><a id="line-1188" name="line-1188"></a>
</span><span id="linespan-1189"><a id="line-1189" name="line-1189"></a><span class="kn">Lemma</span> <span class="n">insert_at_NoDup</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">ls</span> <span class="n">order</span> <span class="o">:</span>
</span><span id="linespan-1190"><a id="line-1190" name="line-1190"></a>  <span class="n">NoDup</span> <span class="n">order</span> <span class="o">-&gt;</span>
</span><span id="linespan-1191"><a id="line-1191" name="line-1191"></a>  <span class="n">jj</span> <span class="bp">∉</span> <span class="n">order</span> <span class="o">-&gt;</span>
</span><span id="linespan-1192"><a id="line-1192" name="line-1192"></a>  <span class="n">NoDup</span> <span class="o">(</span><span class="n">insert_at</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">ls</span> <span class="n">order</span><span class="o">).</span>
</span><span id="linespan-1193"><a id="line-1193" name="line-1193"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1194"><a id="line-1194" name="line-1194"></a>  <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-1195"><a id="line-1195" name="line-1195"></a>  <span class="k">unfold</span> <span class="n">insert_at</span><span class="o">.</span>
</span><span id="linespan-1196"><a id="line-1196" name="line-1196"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">ls</span><span class="o">!!</span><span class="n">ii</span><span class="o">).</span>
</span><span id="linespan-1197"><a id="line-1197" name="line-1197"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">find_index</span><span class="o">.</span>
</span><span id="linespan-1198"><a id="line-1198" name="line-1198"></a>    <span class="o">+</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">insert2_NoDup_2</span><span class="o">.</span>
</span><span id="linespan-1199"><a id="line-1199" name="line-1199"></a>    <span class="o">+</span> <span class="k">eapply</span> <span class="n">NoDup_app</span><span class="o">;</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1200"><a id="line-1200" name="line-1200"></a>      <span class="k">split</span><span class="o">.</span> <span class="n">set_solver</span><span class="o">.</span> <span class="k">apply</span> <span class="n">NoDup_singleton</span><span class="o">.</span>
</span><span id="linespan-1201"><a id="line-1201" name="line-1201"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">NoDup_app</span><span class="o">;</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1202"><a id="line-1202" name="line-1202"></a>    <span class="k">split</span><span class="o">.</span> <span class="n">set_solver</span><span class="o">.</span> <span class="k">apply</span> <span class="n">NoDup_singleton</span><span class="o">.</span>
</span><span id="linespan-1203"><a id="line-1203" name="line-1203"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1204"><a id="line-1204" name="line-1204"></a>
</span><span id="linespan-1205"><a id="line-1205" name="line-1205"></a><span class="kn">Lemma</span> <span class="n">list_to_set_insert_at</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">ls</span> <span class="n">order</span><span class="o">:</span>
</span><span id="linespan-1206"><a id="line-1206" name="line-1206"></a>  <span class="o">(</span><span class="n">list_to_set</span> <span class="o">(</span><span class="n">insert_at</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">ls</span> <span class="n">order</span><span class="o">)</span> <span class="o">:</span> <span class="n">gset</span> <span class="n">nat</span><span class="o">)</span> <span class="o">=</span> <span class="o">{[</span> <span class="n">jj</span> <span class="o">]}</span> <span class="bp">∪</span> <span class="n">list_to_set</span> <span class="n">order</span><span class="o">.</span>
</span><span id="linespan-1207"><a id="line-1207" name="line-1207"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1208"><a id="line-1208" name="line-1208"></a>  <span class="k">unfold</span> <span class="n">insert_at</span><span class="o">.</span>
</span><span id="linespan-1209"><a id="line-1209" name="line-1209"></a>  <span class="k">destruct</span> <span class="n">lookup</span><span class="o">.</span>
</span><span id="linespan-1210"><a id="line-1210" name="line-1210"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">find_index</span><span class="o">.</span>
</span><span id="linespan-1211"><a id="line-1211" name="line-1211"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="n">list_to_set_insert2</span> <span class="o">//.</span>
</span><span id="linespan-1212"><a id="line-1212" name="line-1212"></a>    <span class="o">+</span> <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-1213"><a id="line-1213" name="line-1213"></a>  <span class="o">-</span> <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-1214"><a id="line-1214" name="line-1214"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1215"><a id="line-1215" name="line-1215"></a>
</span><span id="linespan-1216"><a id="line-1216" name="line-1216"></a><span class="kn">Lemma</span> <span class="n">insert2_sublist_mono</span> <span class="o">{</span><span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">ls</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span><span class="o">)</span> <span class="n">order</span> <span class="n">ii</span> <span class="n">jj</span> <span class="o">:</span>
</span><span id="linespan-1217"><a id="line-1217" name="line-1217"></a>  <span class="n">ls</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">order</span> <span class="o">-&gt;</span>
</span><span id="linespan-1218"><a id="line-1218" name="line-1218"></a>  <span class="n">ls</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">insert2</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">order</span><span class="o">.</span>
</span><span id="linespan-1219"><a id="line-1219" name="line-1219"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1220"><a id="line-1220" name="line-1220"></a>  <span class="k">intros</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-1221"><a id="line-1221" name="line-1221"></a>  <span class="k">revert</span> <span class="n">ii</span><span class="o">.</span> <span class="k">induction</span> <span class="n">H</span><span class="o">;</span> <span class="k">destruct</span> <span class="n">ii</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span>
</span><span id="linespan-1222"><a id="line-1222" name="line-1222"></a>  <span class="kr">try</span> <span class="k">econstructor</span><span class="o">;</span> <span class="kr">try</span> <span class="k">econstructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1223"><a id="line-1223" name="line-1223"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1224"><a id="line-1224" name="line-1224"></a>
</span><span id="linespan-1225"><a id="line-1225" name="line-1225"></a><span class="kn">Lemma</span> <span class="n">insert_at_sublist_mono</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">ls</span> <span class="n">ls'</span> <span class="n">order</span> <span class="o">:</span>
</span><span id="linespan-1226"><a id="line-1226" name="line-1226"></a>  <span class="n">ls'</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">order</span> <span class="o">-&gt;</span>
</span><span id="linespan-1227"><a id="line-1227" name="line-1227"></a>  <span class="n">ls'</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">insert_at</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">ls</span> <span class="n">order</span><span class="o">.</span>
</span><span id="linespan-1228"><a id="line-1228" name="line-1228"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1229"><a id="line-1229" name="line-1229"></a>  <span class="k">unfold</span> <span class="n">insert_at</span><span class="o">;</span> <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-1230"><a id="line-1230" name="line-1230"></a>  <span class="k">destruct</span> <span class="n">lookup</span><span class="o">.</span>
</span><span id="linespan-1231"><a id="line-1231" name="line-1231"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">find_index</span><span class="o">.</span>
</span><span id="linespan-1232"><a id="line-1232" name="line-1232"></a>    <span class="o">+</span> <span class="k">eapply</span> <span class="n">insert2_sublist_mono</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1233"><a id="line-1233" name="line-1233"></a>    <span class="o">+</span> <span class="k">eapply</span> <span class="n">sublist_inserts_r</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1234"><a id="line-1234" name="line-1234"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">sublist_inserts_r</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1235"><a id="line-1235" name="line-1235"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1236"><a id="line-1236" name="line-1236"></a>
</span><span id="linespan-1237"><a id="line-1237" name="line-1237"></a><span class="kn">Lemma</span> <span class="n">lockrelG_NewLock</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="n">ts</span> <span class="n">ls</span> <span class="n">xs1</span> <span class="n">x</span> <span class="n">t'</span> <span class="n">ii</span> <span class="n">jj</span> <span class="o">:</span>
</span><span id="linespan-1238"><a id="line-1238" name="line-1238"></a>  <span class="n">length</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">length</span> <span class="n">xs1</span> <span class="o">-&gt;</span>
</span><span id="linespan-1239"><a id="line-1239" name="line-1239"></a>  <span class="n">xs</span> <span class="o">!!</span> <span class="n">jj</span> <span class="o">=</span> <span class="n">None</span> <span class="o">-&gt;</span>
</span><span id="linespan-1240"><a id="line-1240" name="line-1240"></a>  <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="n">ts</span> <span class="o">({[</span><span class="n">LockLabel</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs1</span><span class="o">)]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-1241"><a id="line-1241" name="line-1241"></a>  <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="o">(&lt;[</span><span class="n">jj</span><span class="o">:=(</span><span class="mi">0</span><span class="o">,</span> <span class="n">None</span><span class="o">)]&gt;</span> <span class="n">xs</span><span class="o">)</span> <span class="o">(&lt;[</span><span class="n">jj</span><span class="o">:=</span><span class="n">t'</span><span class="o">]&gt;</span> <span class="n">ts</span><span class="o">)</span>
</span><span id="linespan-1242"><a id="line-1242" name="line-1242"></a>    <span class="o">({[</span><span class="n">LockLabel</span> <span class="o">(</span><span class="n">zip</span> <span class="o">(</span><span class="n">insert2</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">ls</span><span class="o">)</span> <span class="o">(</span><span class="n">insert2</span> <span class="n">ii</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t'</span><span class="o">)</span> <span class="n">xs1</span><span class="o">))]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-1243"><a id="line-1243" name="line-1243"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1244"><a id="line-1244" name="line-1244"></a>  <span class="k">intros</span> <span class="n">HH</span> <span class="n">H</span> <span class="o">[</span><span class="n">order</span> <span class="bp">[]</span><span class="o">].</span>
</span><span id="linespan-1245"><a id="line-1245" name="line-1245"></a>  <span class="k">exists</span> <span class="o">(</span><span class="n">insert_at</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">ls</span> <span class="n">order</span><span class="o">).</span> <span class="k">econstructor</span><span class="o">.</span>
</span><span id="linespan-1246"><a id="line-1246" name="line-1246"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">insert_at_NoDup</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1247"><a id="line-1247" name="line-1247"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">jj</span> <span class="bp">∉</span> <span class="n">dom</span> <span class="n">xs</span><span class="o">)</span> <span class="k">as</span> <span class="n">Q</span><span class="o">.</span> <span class="o">{</span> <span class="k">eapply</span> <span class="n">not_elem_of_dom</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-1248"><a id="line-1248" name="line-1248"></a>    <span class="k">rewrite</span> <span class="o">-</span><span class="n">order_dom0</span> <span class="k">in</span> <span class="n">Q</span><span class="o">.</span>
</span><span id="linespan-1249"><a id="line-1249" name="line-1249"></a>    <span class="k">eapply</span> <span class="n">not_elem_of_list_to_set</span> <span class="k">in</span> <span class="n">Q</span><span class="o">.</span>
</span><span id="linespan-1250"><a id="line-1250" name="line-1250"></a>    <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1251"><a id="line-1251" name="line-1251"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">dom_insert_L</span> <span class="o">-</span><span class="n">order_dom0</span> <span class="n">list_to_set_insert_at</span> <span class="o">//.</span>
</span><span id="linespan-1252"><a id="line-1252" name="line-1252"></a>  <span class="o">-</span> <span class="k">revert</span> <span class="n">order_subsequences0</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">mset_forall_op</span> <span class="o">!</span><span class="n">mset_forall_singleton</span><span class="o">.</span>
</span><span id="linespan-1253"><a id="line-1253" name="line-1253"></a>    <span class="k">intros</span> <span class="n">os</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1254"><a id="line-1254" name="line-1254"></a>    <span class="k">rewrite</span> <span class="n">fst_zip</span> <span class="k">in</span> <span class="n">H4</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-1255"><a id="line-1255" name="line-1255"></a>    <span class="k">split</span><span class="o">.</span>
</span><span id="linespan-1256"><a id="line-1256" name="line-1256"></a>    <span class="o">+</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1257"><a id="line-1257" name="line-1257"></a>      <span class="k">rewrite</span> <span class="n">fst_zip</span><span class="o">.</span> <span class="mi">2</span><span class="o">:</span> <span class="o">{</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">insert2_length</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-1258"><a id="line-1258" name="line-1258"></a>      <span class="k">eapply</span> <span class="n">insert_at_sublist</span><span class="o">;</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1259"><a id="line-1259" name="line-1259"></a>    <span class="o">+</span> <span class="k">eapply</span> <span class="n">mset_forall_impl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span> <span class="k">intros</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1260"><a id="line-1260" name="line-1260"></a>      <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1261"><a id="line-1261" name="line-1261"></a>      <span class="k">eapply</span> <span class="n">insert_at_sublist_mono</span><span class="o">;</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1262"><a id="line-1262" name="line-1262"></a>  <span class="o">-</span> <span class="k">intros</span> <span class="n">i</span><span class="o">.</span> <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_lockrel0</span> <span class="n">i</span><span class="o">).</span>
</span><span id="linespan-1263"><a id="line-1263" name="line-1263"></a>    <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1264"><a id="line-1264" name="line-1264"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="n">extract_op</span> <span class="n">extract_singleton</span><span class="o">.</span>
</span><span id="linespan-1265"><a id="line-1265" name="line-1265"></a>      <span class="k">rewrite</span> <span class="n">H</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-1266"><a id="line-1266" name="line-1266"></a>      <span class="k">destruct</span> <span class="o">(</span><span class="n">ts</span> <span class="o">!!</span> <span class="n">i</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">E</span><span class="o">;</span> <span class="kr">try</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1267"><a id="line-1267" name="line-1267"></a>      <span class="k">assert</span> <span class="o">((</span><span class="n">extract1</span> <span class="n">i</span> <span class="o">(</span><span class="n">zip</span> <span class="o">(</span><span class="n">insert2</span> <span class="n">ii</span> <span class="n">i</span> <span class="n">ls</span><span class="o">)</span> <span class="o">(</span><span class="n">insert2</span> <span class="n">ii</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t'</span><span class="o">)</span> <span class="n">xs1</span><span class="o">))</span>
</span><span id="linespan-1268"><a id="line-1268" name="line-1268"></a>        <span class="bp">⋅</span> <span class="n">extract</span> <span class="n">i</span> <span class="n">x</span><span class="o">)</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t'</span><span class="o">):</span><span class="n">labelO'</span> <span class="o">]})</span> <span class="k">as</span> <span class="o">-&gt;;</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">lockrel_newlock'</span><span class="o">.</span>
</span><span id="linespan-1269"><a id="line-1269" name="line-1269"></a>      <span class="k">rewrite</span> <span class="n">mset_forall_op</span> <span class="n">mset_forall_singleton</span> <span class="k">in</span> <span class="n">order_subsequences0</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1270"><a id="line-1270" name="line-1270"></a>      <span class="k">rewrite</span> <span class="n">fst_zip</span> <span class="k">in</span> <span class="n">H4</span><span class="o">;</span> <span class="kr">try</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-1271"><a id="line-1271" name="line-1271"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">extract</span> <span class="n">i</span> <span class="n">x</span> <span class="o">=</span> <span class="n">ε</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-1272"><a id="line-1272" name="line-1272"></a>      <span class="o">{</span>
</span><span id="linespan-1273"><a id="line-1273" name="line-1273"></a>        <span class="k">assert</span> <span class="o">(</span><span class="n">i</span> <span class="bp">∉</span> <span class="n">order</span><span class="o">).</span>
</span><span id="linespan-1274"><a id="line-1274" name="line-1274"></a>        <span class="o">{</span>
</span><span id="linespan-1275"><a id="line-1275" name="line-1275"></a>           <span class="k">intros</span> <span class="n">QQ</span><span class="o">.</span>
</span><span id="linespan-1276"><a id="line-1276" name="line-1276"></a>           <span class="k">assert</span> <span class="o">(</span><span class="n">i</span> <span class="bp">∈</span> <span class="n">dom</span> <span class="n">xs</span><span class="o">).</span>
</span><span id="linespan-1277"><a id="line-1277" name="line-1277"></a>           <span class="o">{</span>
</span><span id="linespan-1278"><a id="line-1278" name="line-1278"></a>            <span class="k">rewrite</span> <span class="o">-</span><span class="n">order_dom0</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">elem_of_list_to_set</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1279"><a id="line-1279" name="line-1279"></a>           <span class="o">}</span>
</span><span id="linespan-1280"><a id="line-1280" name="line-1280"></a>           <span class="k">eapply</span> <span class="n">elem_of_dom</span> <span class="k">in</span> <span class="n">H0</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">H</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span> <span class="kp">congruence</span><span class="o">.</span>
</span><span id="linespan-1281"><a id="line-1281" name="line-1281"></a>        <span class="o">}</span>
</span><span id="linespan-1282"><a id="line-1282" name="line-1282"></a>        <span class="k">eapply</span> <span class="n">extract_empty_inv</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1283"><a id="line-1283" name="line-1283"></a>      <span class="o">}</span>
</span><span id="linespan-1284"><a id="line-1284" name="line-1284"></a>      <span class="k">rewrite</span> <span class="n">right_id</span> <span class="n">extract1_insert2</span> <span class="o">//</span> <span class="n">extract1_empty'</span><span class="o">;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="n">right_id</span><span class="o">,</span> <span class="o">_.</span>
</span><span id="linespan-1285"><a id="line-1285" name="line-1285"></a>      <span class="k">intros</span> <span class="n">QQ</span><span class="o">.</span>
</span><span id="linespan-1286"><a id="line-1286" name="line-1286"></a>      <span class="k">eapply</span> <span class="n">sublist_elem_of</span> <span class="k">in</span> <span class="n">QQ</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1287"><a id="line-1287" name="line-1287"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">i</span> <span class="bp">∈</span> <span class="n">dom</span> <span class="n">xs</span><span class="o">).</span>
</span><span id="linespan-1288"><a id="line-1288" name="line-1288"></a>      <span class="o">{</span>
</span><span id="linespan-1289"><a id="line-1289" name="line-1289"></a>        <span class="k">rewrite</span> <span class="o">-</span><span class="n">order_dom0</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">elem_of_list_to_set</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1290"><a id="line-1290" name="line-1290"></a>      <span class="o">}</span>
</span><span id="linespan-1291"><a id="line-1291" name="line-1291"></a>      <span class="k">eapply</span> <span class="n">elem_of_dom</span> <span class="k">in</span> <span class="n">H0</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">H</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1292"><a id="line-1292" name="line-1292"></a>    <span class="o">+</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">xs</span> <span class="o">!!</span> <span class="n">i</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">E</span><span class="o">;</span> <span class="k">rewrite</span> <span class="n">E</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1293"><a id="line-1293" name="line-1293"></a>      <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">ts</span> <span class="o">!!</span> <span class="n">i</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1294"><a id="line-1294" name="line-1294"></a>      <span class="k">revert</span> <span class="n">lr_lockrel0</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">extract_op</span> <span class="o">!</span><span class="n">extract_singleton</span><span class="o">.</span>
</span><span id="linespan-1295"><a id="line-1295" name="line-1295"></a>      <span class="k">intros</span> <span class="n">lr</span><span class="o">.</span>
</span><span id="linespan-1296"><a id="line-1296" name="line-1296"></a>      <span class="k">assert</span> <span class="o">((</span><span class="n">extract1</span> <span class="n">i</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs1</span><span class="o">)</span> <span class="bp">⋅</span> <span class="n">extract</span> <span class="n">i</span> <span class="n">x</span><span class="o">)</span> <span class="bp">≡</span>
</span><span id="linespan-1297"><a id="line-1297" name="line-1297"></a>        <span class="o">(</span><span class="n">extract1</span> <span class="n">i</span> <span class="o">(</span><span class="n">zip</span> <span class="o">(</span><span class="n">insert2</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">ls</span><span class="o">)</span> <span class="o">(</span><span class="n">insert2</span> <span class="n">ii</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t'</span><span class="o">)</span> <span class="n">xs1</span><span class="o">))</span><span class="bp">⋅</span> <span class="n">extract</span> <span class="n">i</span> <span class="n">x</span><span class="o">))</span> <span class="k">as</span> <span class="o">&lt;-;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1298"><a id="line-1298" name="line-1298"></a>      <span class="n">f_equiv</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">extract1_insert2_ne</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1299"><a id="line-1299" name="line-1299"></a>  <span class="o">-</span> <span class="k">revert</span> <span class="n">lr_refcount0</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">Mlen_mult</span> <span class="o">!</span><span class="n">Mlen_singleton</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-1300"><a id="line-1300" name="line-1300"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1301"><a id="line-1301" name="line-1301"></a>
</span><span id="linespan-1302"><a id="line-1302" name="line-1302"></a><span class="kn">Lemma</span> <span class="n">lockrelG_same_dom_empty</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="n">ts</span> <span class="n">x</span> <span class="n">i</span> <span class="o">:</span>
</span><span id="linespan-1303"><a id="line-1303" name="line-1303"></a>  <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="n">ts</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-1304"><a id="line-1304" name="line-1304"></a>  <span class="n">xs</span> <span class="o">!!</span> <span class="n">i</span> <span class="o">=</span> <span class="n">None</span> <span class="o">&lt;-&gt;</span> <span class="n">ts</span> <span class="o">!!</span> <span class="n">i</span> <span class="o">=</span> <span class="n">None</span><span class="o">.</span>
</span><span id="linespan-1305"><a id="line-1305" name="line-1305"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1306"><a id="line-1306" name="line-1306"></a>  <span class="k">intros</span> <span class="o">[</span><span class="n">order</span> <span class="bp">[]</span><span class="o">].</span>
</span><span id="linespan-1307"><a id="line-1307" name="line-1307"></a>  <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_lockrel0</span> <span class="n">i</span><span class="o">).</span>
</span><span id="linespan-1308"><a id="line-1308" name="line-1308"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">xs</span> <span class="o">!!</span> <span class="n">i</span><span class="o">),(</span><span class="n">ts</span><span class="o">!!</span><span class="n">i</span><span class="o">);</span> <span class="kr">try</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1309"><a id="line-1309" name="line-1309"></a>  <span class="k">destruct</span> <span class="n">p</span><span class="o">;</span><span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1310"><a id="line-1310" name="line-1310"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1311"><a id="line-1311" name="line-1311"></a>
</span><span id="linespan-1312"><a id="line-1312" name="line-1312"></a><span class="kn">Lemma</span> <span class="n">lockrelG_DropLock</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="n">ts</span> <span class="n">ls</span> <span class="n">xs1</span> <span class="n">x</span> <span class="n">t'</span> <span class="n">ii</span> <span class="n">jj</span> <span class="n">refcntii</span> <span class="n">o</span> <span class="o">:</span>
</span><span id="linespan-1313"><a id="line-1313" name="line-1313"></a>  <span class="n">length</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">length</span> <span class="n">xs1</span> <span class="o">-&gt;</span>
</span><span id="linespan-1314"><a id="line-1314" name="line-1314"></a>  <span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">jj</span> <span class="o">-&gt;</span>
</span><span id="linespan-1315"><a id="line-1315" name="line-1315"></a>  <span class="n">xs</span> <span class="o">!!</span> <span class="n">jj</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">S</span> <span class="n">refcntii</span><span class="o">,</span> <span class="n">o</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-1316"><a id="line-1316" name="line-1316"></a>  <span class="n">xs1</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t'</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-1317"><a id="line-1317" name="line-1317"></a>  <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="n">ts</span> <span class="o">({[</span><span class="n">LockLabel</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs1</span><span class="o">)]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-1318"><a id="line-1318" name="line-1318"></a>  <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="o">(&lt;[</span><span class="n">jj</span><span class="o">:=(</span><span class="n">refcntii</span><span class="o">,</span> <span class="n">o</span><span class="o">)]&gt;</span> <span class="n">xs</span><span class="o">)</span> <span class="n">ts</span>
</span><span id="linespan-1319"><a id="line-1319" name="line-1319"></a>    <span class="o">({[</span><span class="n">LockLabel</span> <span class="o">(</span><span class="n">zip</span> <span class="o">(</span><span class="n">delete</span> <span class="n">ii</span> <span class="n">ls</span><span class="o">)</span> <span class="o">(</span><span class="n">delete</span> <span class="n">ii</span> <span class="n">xs1</span><span class="o">))]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-1320"><a id="line-1320" name="line-1320"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1321"><a id="line-1321" name="line-1321"></a>  <span class="k">intros</span> <span class="o">????[</span><span class="n">order</span> <span class="bp">[]</span><span class="o">].</span>
</span><span id="linespan-1322"><a id="line-1322" name="line-1322"></a>  <span class="k">econstructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span> <span class="k">econstructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1323"><a id="line-1323" name="line-1323"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">dom_insert_lookup_L</span> <span class="o">//.</span>
</span><span id="linespan-1324"><a id="line-1324" name="line-1324"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">mset_forall_op</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">mset_forall_op</span> <span class="k">in</span> <span class="n">order_subsequences0</span><span class="o">.</span>
</span><span id="linespan-1325"><a id="line-1325" name="line-1325"></a>    <span class="k">destruct</span> <span class="n">order_subsequences0</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1326"><a id="line-1326" name="line-1326"></a>    <span class="k">rewrite</span> <span class="n">mset_forall_singleton</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">mset_forall_singleton</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span>
</span><span id="linespan-1327"><a id="line-1327" name="line-1327"></a>    <span class="n">simp</span><span class="o">.</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1328"><a id="line-1328" name="line-1328"></a>    <span class="k">rewrite</span> <span class="n">fst_zip</span> <span class="k">in</span> <span class="n">H7</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-1329"><a id="line-1329" name="line-1329"></a>    <span class="k">rewrite</span> <span class="n">fst_zip</span><span class="o">.</span>
</span><span id="linespan-1330"><a id="line-1330" name="line-1330"></a>    <span class="o">+</span> <span class="n">etrans</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span> <span class="k">apply</span> <span class="n">sublist_delete</span><span class="o">.</span>
</span><span id="linespan-1331"><a id="line-1331" name="line-1331"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">length_delete</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-1332"><a id="line-1332" name="line-1332"></a>  <span class="o">-</span> <span class="k">intro</span><span class="o">.</span> <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_lockrel0</span> <span class="n">i</span><span class="o">).</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1333"><a id="line-1333" name="line-1333"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="n">H1</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-1334"><a id="line-1334" name="line-1334"></a>      <span class="k">destruct</span> <span class="o">(</span><span class="n">ts</span> <span class="o">!!</span> <span class="n">i</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1335"><a id="line-1335" name="line-1335"></a>      <span class="k">revert</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-1336"><a id="line-1336" name="line-1336"></a>      <span class="k">rewrite</span> <span class="o">!</span><span class="n">extract_op</span> <span class="o">!</span><span class="n">extract_singleton</span><span class="o">.</span>
</span><span id="linespan-1337"><a id="line-1337" name="line-1337"></a>      <span class="k">erewrite</span> <span class="n">extract1_Some</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1338"><a id="line-1338" name="line-1338"></a>      <span class="k">intros</span> <span class="n">lr</span><span class="o">.</span>
</span><span id="linespan-1339"><a id="line-1339" name="line-1339"></a>      <span class="k">rewrite</span> <span class="o">-</span><span class="n">assoc</span> <span class="k">in</span> <span class="n">lr</span><span class="o">.</span>
</span><span id="linespan-1340"><a id="line-1340" name="line-1340"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">t'</span><span class="o">=</span><span class="n">t</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;</span> <span class="kp">by</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">lockrel_same_type</span><span class="o">.</span>
</span><span id="linespan-1341"><a id="line-1341" name="line-1341"></a>      <span class="k">eapply</span> <span class="n">lockrel_drop</span> <span class="k">in</span> <span class="n">lr</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1342"><a id="line-1342" name="line-1342"></a>    <span class="o">+</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">xs</span> <span class="o">!!</span> <span class="n">i</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">E</span><span class="o">;</span> <span class="k">rewrite</span> <span class="n">E</span><span class="o">;</span> <span class="kr">last</span> <span class="kr">first</span><span class="o">.</span>
</span><span id="linespan-1343"><a id="line-1343" name="line-1343"></a>      <span class="o">{</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">ts</span> <span class="o">!!</span> <span class="n">i</span><span class="o">);</span> <span class="kp">done</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-1344"><a id="line-1344" name="line-1344"></a>      <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">ts</span> <span class="o">!!</span> <span class="n">i</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1345"><a id="line-1345" name="line-1345"></a>      <span class="k">revert</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-1346"><a id="line-1346" name="line-1346"></a>      <span class="k">rewrite</span> <span class="o">!</span><span class="n">extract_op</span> <span class="o">!</span><span class="n">extract_singleton</span><span class="o">.</span>
</span><span id="linespan-1347"><a id="line-1347" name="line-1347"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">≠</span> <span class="n">Some</span> <span class="n">i</span><span class="o">).</span> <span class="o">{</span> <span class="kp">congruence</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-1348"><a id="line-1348" name="line-1348"></a>      <span class="k">erewrite</span> <span class="n">extract1_ne_Some</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1349"><a id="line-1349" name="line-1349"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1350"><a id="line-1350" name="line-1350"></a>
</span><span id="linespan-1351"><a id="line-1351" name="line-1351"></a><span class="kn">Lemma</span> <span class="n">extract1_notin</span> <span class="n">xs</span> <span class="o">{</span><span class="n">ls</span> <span class="n">i</span><span class="o">}</span> <span class="o">:</span>
</span><span id="linespan-1352"><a id="line-1352" name="line-1352"></a>  <span class="n">i</span> <span class="bp">∉</span> <span class="n">ls</span> <span class="o">-&gt;</span>
</span><span id="linespan-1353"><a id="line-1353" name="line-1353"></a>  <span class="n">extract1</span> <span class="n">i</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs</span><span class="o">)</span> <span class="o">=</span> <span class="n">ε</span><span class="o">.</span>
</span><span id="linespan-1354"><a id="line-1354" name="line-1354"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1355"><a id="line-1355" name="line-1355"></a>  <span class="k">revert</span> <span class="n">ls</span><span class="o">.</span> <span class="k">induction</span> <span class="n">xs</span><span class="o">;</span> <span class="k">intros</span> <span class="bp">[]</span><span class="o">;</span> <span class="o">[</span><span class="k">simpl</span><span class="o">..|];</span>
</span><span id="linespan-1356"><a id="line-1356" name="line-1356"></a>  <span class="k">rewrite</span> <span class="o">?</span><span class="n">extract1_empty</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1357"><a id="line-1357" name="line-1357"></a>  <span class="k">intros</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-1358"><a id="line-1358" name="line-1358"></a>  <span class="k">eapply</span> <span class="n">not_elem_of_cons</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-1359"><a id="line-1359" name="line-1359"></a>  <span class="k">erewrite</span> <span class="o">&lt;-(</span><span class="n">extract1_delete</span> <span class="o">_</span> <span class="mi">0</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1360"><a id="line-1360" name="line-1360"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1361"><a id="line-1361" name="line-1361"></a>
</span><span id="linespan-1362"><a id="line-1362" name="line-1362"></a><span class="kn">Lemma</span> <span class="n">NoDup_delete_notin</span> <span class="o">{</span><span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">ls</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span><span class="o">)</span> <span class="n">ii</span> <span class="n">i</span> <span class="o">:</span>
</span><span id="linespan-1363"><a id="line-1363" name="line-1363"></a>  <span class="n">NoDup</span> <span class="n">ls</span> <span class="o">-&gt;</span>
</span><span id="linespan-1364"><a id="line-1364" name="line-1364"></a>  <span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">i</span> <span class="o">-&gt;</span>
</span><span id="linespan-1365"><a id="line-1365" name="line-1365"></a>  <span class="n">i</span> <span class="bp">∉</span> <span class="n">delete</span> <span class="n">ii</span> <span class="n">ls</span><span class="o">.</span>
</span><span id="linespan-1366"><a id="line-1366" name="line-1366"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1367"><a id="line-1367" name="line-1367"></a>  <span class="k">intros</span> <span class="o">???.</span>
</span><span id="linespan-1368"><a id="line-1368" name="line-1368"></a>  <span class="k">eapply</span> <span class="n">elem_of_list_lookup_1</span> <span class="k">in</span> <span class="n">H1</span> <span class="k">as</span> <span class="o">[?</span> <span class="o">?].</span>
</span><span id="linespan-1369"><a id="line-1369" name="line-1369"></a>  <span class="k">rewrite</span> <span class="n">lookup_delete_lr</span> <span class="k">in</span> <span class="n">H1</span><span class="o">.</span>
</span><span id="linespan-1370"><a id="line-1370" name="line-1370"></a>  <span class="n">case_decide</span><span class="o">.</span>
</span><span id="linespan-1371"><a id="line-1371" name="line-1371"></a>  <span class="o">-</span> <span class="k">assert</span> <span class="o">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">ii</span><span class="o">);</span> <span class="kr">last</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-1372"><a id="line-1372" name="line-1372"></a>    <span class="k">eapply</span> <span class="n">NoDup_lookup</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1373"><a id="line-1373" name="line-1373"></a>  <span class="o">-</span> <span class="k">assert</span> <span class="o">(</span><span class="n">S</span> <span class="n">x</span> <span class="o">=</span> <span class="n">ii</span><span class="o">);</span> <span class="kr">last</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-1374"><a id="line-1374" name="line-1374"></a>    <span class="k">eapply</span> <span class="n">NoDup_lookup</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1375"><a id="line-1375" name="line-1375"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1376"><a id="line-1376" name="line-1376"></a>
</span><span id="linespan-1377"><a id="line-1377" name="line-1377"></a><span class="kn">Lemma</span> <span class="n">extract1_Some_NoDup</span> <span class="n">ii</span> <span class="n">i</span> <span class="n">l</span> <span class="n">ls</span> <span class="n">xs</span> <span class="o">:</span>
</span><span id="linespan-1378"><a id="line-1378" name="line-1378"></a>  <span class="n">NoDup</span> <span class="n">ls</span> <span class="o">-&gt;</span>
</span><span id="linespan-1379"><a id="line-1379" name="line-1379"></a>  <span class="n">ls</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">i</span> <span class="o">-&gt;</span>
</span><span id="linespan-1380"><a id="line-1380" name="line-1380"></a>  <span class="n">xs</span> <span class="o">!!</span> <span class="n">ii</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">l</span> <span class="o">-&gt;</span>
</span><span id="linespan-1381"><a id="line-1381" name="line-1381"></a>  <span class="n">extract1</span> <span class="n">i</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs</span><span class="o">)</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="n">l</span><span class="o">:</span><span class="n">labelO'</span> <span class="o">]}.</span>
</span><span id="linespan-1382"><a id="line-1382" name="line-1382"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1383"><a id="line-1383" name="line-1383"></a>  <span class="k">intros</span><span class="o">.</span> <span class="k">erewrite</span> <span class="n">extract1_Some</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1384"><a id="line-1384" name="line-1384"></a>  <span class="k">rewrite</span> <span class="n">extract1_notin</span><span class="o">.</span> <span class="o">{</span> <span class="k">rewrite</span> <span class="n">right_id</span> <span class="o">//.</span> <span class="o">}</span>
</span><span id="linespan-1385"><a id="line-1385" name="line-1385"></a>  <span class="k">eapply</span> <span class="n">NoDup_delete_notin</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1386"><a id="line-1386" name="line-1386"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1387"><a id="line-1387" name="line-1387"></a>
</span><span id="linespan-1388"><a id="line-1388" name="line-1388"></a><span class="kn">Lemma</span> <span class="n">incr_all_refcounts_lookup</span> <span class="n">xs</span> <span class="n">ls</span> <span class="n">i</span> <span class="o">:</span>
</span><span id="linespan-1389"><a id="line-1389" name="line-1389"></a>  <span class="n">NoDup</span> <span class="n">ls</span> <span class="o">-&gt;</span>
</span><span id="linespan-1390"><a id="line-1390" name="line-1390"></a>  <span class="n">incr_all_refcounts</span> <span class="n">xs</span> <span class="n">ls</span> <span class="o">!!</span> <span class="n">i</span> <span class="o">=</span>
</span><span id="linespan-1391"><a id="line-1391" name="line-1391"></a>  <span class="k">match</span> <span class="n">xs</span> <span class="o">!!</span> <span class="n">i</span> <span class="k">with</span>
</span><span id="linespan-1392"><a id="line-1392" name="line-1392"></a>  <span class="o">|</span> <span class="n">None</span> <span class="o">=&gt;</span> <span class="n">None</span>
</span><span id="linespan-1393"><a id="line-1393" name="line-1393"></a>  <span class="o">|</span> <span class="n">Some</span> <span class="o">(</span><span class="n">refcnt</span><span class="o">,</span><span class="n">o</span><span class="o">)</span> <span class="o">=&gt;</span>
</span><span id="linespan-1394"><a id="line-1394" name="line-1394"></a>      <span class="n">Some</span> <span class="o">(</span><span class="k">if</span> <span class="n">decide</span> <span class="o">(</span><span class="n">i</span> <span class="bp">∈</span> <span class="n">ls</span><span class="o">)</span> <span class="k">then</span> <span class="n">S</span> <span class="n">refcnt</span> <span class="k">else</span> <span class="n">refcnt</span><span class="o">,</span> <span class="n">o</span><span class="o">)</span>
</span><span id="linespan-1395"><a id="line-1395" name="line-1395"></a>  <span class="k">end</span><span class="o">.</span>
</span><span id="linespan-1396"><a id="line-1396" name="line-1396"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1397"><a id="line-1397" name="line-1397"></a>  <span class="k">intros</span> <span class="n">Hls</span><span class="o">.</span>
</span><span id="linespan-1398"><a id="line-1398" name="line-1398"></a>  <span class="k">unfold</span> <span class="n">incr_all_refcounts</span><span class="o">.</span>
</span><span id="linespan-1399"><a id="line-1399" name="line-1399"></a>  <span class="k">revert</span> <span class="n">xs</span> <span class="n">i</span><span class="o">.</span> <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="k">intros</span><span class="o">;</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-1400"><a id="line-1400" name="line-1400"></a>  <span class="o">{</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">xs</span><span class="o">!!</span><span class="n">i</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-1401"><a id="line-1401" name="line-1401"></a>  <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1402"><a id="line-1402" name="line-1402"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">NoDup_cons</span> <span class="k">in</span> <span class="n">Hls</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-1403"><a id="line-1403" name="line-1403"></a>    <span class="k">rewrite</span> <span class="n">IHls</span> <span class="o">//.</span>
</span><span id="linespan-1404"><a id="line-1404" name="line-1404"></a>    <span class="k">destruct</span> <span class="o">(</span><span class="n">xs</span> <span class="o">!!</span> <span class="n">i</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1405"><a id="line-1405" name="line-1405"></a>    <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span> <span class="n">case_decide</span><span class="o">;</span> <span class="kr">do</span> <span class="mi">2</span> <span class="n">f_equal</span><span class="o">;</span> <span class="o">(</span><span class="kp">done</span><span class="o">||</span><span class="kp">lia</span><span class="o">).</span>
</span><span id="linespan-1406"><a id="line-1406" name="line-1406"></a>  <span class="o">-</span> <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-1407"><a id="line-1407" name="line-1407"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">NoDup_cons</span> <span class="k">in</span> <span class="n">Hls</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-1408"><a id="line-1408" name="line-1408"></a>    <span class="k">rewrite</span> <span class="n">IHls</span> <span class="o">//.</span>
</span><span id="linespan-1409"><a id="line-1409" name="line-1409"></a>    <span class="k">destruct</span> <span class="o">(</span><span class="n">xs</span> <span class="o">!!</span> <span class="n">i</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1410"><a id="line-1410" name="line-1410"></a>    <span class="k">eapply</span> <span class="n">elem_of_cons</span> <span class="k">in</span> <span class="n">H0</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1411"><a id="line-1411" name="line-1411"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">NoDup_cons</span> <span class="k">in</span> <span class="n">Hls</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-1412"><a id="line-1412" name="line-1412"></a>    <span class="k">rewrite</span> <span class="n">IHls</span> <span class="o">//.</span>
</span><span id="linespan-1413"><a id="line-1413" name="line-1413"></a>    <span class="k">destruct</span> <span class="o">(</span><span class="n">xs</span> <span class="o">!!</span> <span class="n">i</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1414"><a id="line-1414" name="line-1414"></a>    <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-1415"><a id="line-1415" name="line-1415"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1416"><a id="line-1416" name="line-1416"></a>
</span><span id="linespan-1417"><a id="line-1417" name="line-1417"></a><span class="kn">Lemma</span> <span class="n">incr_all_refcounts_dom</span> <span class="n">xs</span> <span class="n">ls</span> <span class="o">:</span>
</span><span id="linespan-1418"><a id="line-1418" name="line-1418"></a>  <span class="n">dom</span> <span class="o">(</span><span class="n">incr_all_refcounts</span> <span class="n">xs</span> <span class="n">ls</span><span class="o">)</span> <span class="o">=</span> <span class="n">dom</span> <span class="n">xs</span><span class="o">.</span>
</span><span id="linespan-1419"><a id="line-1419" name="line-1419"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1420"><a id="line-1420" name="line-1420"></a>  <span class="k">unfold</span> <span class="n">incr_all_refcounts</span><span class="o">.</span>
</span><span id="linespan-1421"><a id="line-1421" name="line-1421"></a>  <span class="k">revert</span> <span class="n">xs</span><span class="o">.</span> <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1422"><a id="line-1422" name="line-1422"></a>  <span class="k">intros</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">dom_alter_L</span> <span class="n">IHls</span> <span class="o">//.</span>
</span><span id="linespan-1423"><a id="line-1423" name="line-1423"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1424"><a id="line-1424" name="line-1424"></a>
</span><span id="linespan-1425"><a id="line-1425" name="line-1425"></a><span class="kn">Lemma</span> <span class="n">lockrelG_ForkLock</span> <span class="n">xs1</span> <span class="n">xs2</span> <span class="n">xs3</span> <span class="n">ls</span> <span class="n">x</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="n">ts</span> <span class="o">:</span>
</span><span id="linespan-1426"><a id="line-1426" name="line-1426"></a>  <span class="n">length</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">length</span> <span class="n">xs1</span> <span class="o">-&gt;</span>
</span><span id="linespan-1427"><a id="line-1427" name="line-1427"></a>  <span class="n">lockcaps_split</span> <span class="n">xs1</span> <span class="n">xs2</span> <span class="n">xs3</span> <span class="o">-&gt;</span>
</span><span id="linespan-1428"><a id="line-1428" name="line-1428"></a>  <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="n">xs</span> <span class="n">ts</span> <span class="o">({[</span><span class="n">LockLabel</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs1</span><span class="o">)]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-1429"><a id="line-1429" name="line-1429"></a>  <span class="n">lockrelG</span> <span class="o">(</span><span class="n">S</span> <span class="n">refcnt</span><span class="o">)</span> <span class="o">(</span><span class="n">incr_all_refcounts</span> <span class="n">xs</span> <span class="n">ls</span><span class="o">)</span> <span class="n">ts</span>
</span><span id="linespan-1430"><a id="line-1430" name="line-1430"></a>    <span class="o">({[</span><span class="n">LockLabel</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs3</span><span class="o">)]}</span> <span class="bp">⋅</span> <span class="o">{[</span><span class="n">LockLabel</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs2</span><span class="o">)]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-1431"><a id="line-1431" name="line-1431"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1432"><a id="line-1432" name="line-1432"></a>  <span class="k">intros</span> <span class="n">HH</span> <span class="n">H</span> <span class="o">[</span><span class="n">order</span> <span class="bp">[]</span><span class="o">].</span>
</span><span id="linespan-1433"><a id="line-1433" name="line-1433"></a>  <span class="k">exists</span> <span class="n">order</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">econstructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1434"><a id="line-1434" name="line-1434"></a>  <span class="o">-</span> <span class="k">revert</span> <span class="n">order_subsequences0</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">mset_forall_op</span> <span class="o">!</span><span class="n">mset_forall_singleton</span><span class="o">.</span>
</span><span id="linespan-1435"><a id="line-1435" name="line-1435"></a>    <span class="k">intros</span> <span class="bp">[]</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1436"><a id="line-1436" name="line-1436"></a>    <span class="k">rewrite</span> <span class="n">fst_zip</span> <span class="k">in</span> <span class="n">H4</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-1437"><a id="line-1437" name="line-1437"></a>    <span class="k">eapply</span> <span class="n">lockcaps_split_length</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-1438"><a id="line-1438" name="line-1438"></a>    <span class="k">rewrite</span> <span class="n">incr_all_refcounts_dom</span> <span class="o">//.</span>
</span><span id="linespan-1439"><a id="line-1439" name="line-1439"></a>  <span class="o">-</span> <span class="k">revert</span> <span class="n">order_subsequences0</span><span class="o">.</span>
</span><span id="linespan-1440"><a id="line-1440" name="line-1440"></a>    <span class="k">rewrite</span> <span class="o">!</span><span class="n">mset_forall_op</span> <span class="o">!</span><span class="n">mset_forall_singleton</span><span class="o">.</span>
</span><span id="linespan-1441"><a id="line-1441" name="line-1441"></a>    <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1442"><a id="line-1442" name="line-1442"></a>    <span class="k">rewrite</span> <span class="n">fst_zip</span> <span class="k">in</span> <span class="n">H4</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-1443"><a id="line-1443" name="line-1443"></a>    <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1444"><a id="line-1444" name="line-1444"></a>    <span class="k">eapply</span> <span class="n">lockcaps_split_length</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-1445"><a id="line-1445" name="line-1445"></a>    <span class="k">split</span><span class="o">;</span> <span class="n">eexists</span><span class="o">;</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span> <span class="k">rewrite</span> <span class="n">fst_zip</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-1446"><a id="line-1446" name="line-1446"></a>  <span class="o">-</span> <span class="k">intros</span> <span class="n">i</span><span class="o">.</span> <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_lockrel0</span> <span class="n">i</span><span class="o">).</span>
</span><span id="linespan-1447"><a id="line-1447" name="line-1447"></a>    <span class="k">rewrite</span> <span class="n">mset_forall_op</span> <span class="n">mset_forall_singleton</span> <span class="k">in</span> <span class="n">order_subsequences0</span><span class="o">.</span>
</span><span id="linespan-1448"><a id="line-1448" name="line-1448"></a>    <span class="n">simp</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">fst_zip</span> <span class="k">in</span> <span class="n">H4</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-1449"><a id="line-1449" name="line-1449"></a>    <span class="k">rewrite</span> <span class="n">incr_all_refcounts_lookup</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">NoDup_sublist</span><span class="o">.</span>
</span><span id="linespan-1450"><a id="line-1450" name="line-1450"></a>    <span class="k">destruct</span> <span class="o">(</span><span class="n">xs</span> <span class="o">!!</span> <span class="n">i</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span>
</span><span id="linespan-1451"><a id="line-1451" name="line-1451"></a>    <span class="k">destruct</span> <span class="o">(</span><span class="n">ts</span> <span class="o">!!</span> <span class="n">i</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1452"><a id="line-1452" name="line-1452"></a>    <span class="k">revert</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-1453"><a id="line-1453" name="line-1453"></a>    <span class="k">rewrite</span> <span class="o">!</span><span class="n">extract_op</span> <span class="o">!</span><span class="n">extract_singleton</span><span class="o">.</span> <span class="k">intro</span><span class="o">.</span>
</span><span id="linespan-1454"><a id="line-1454" name="line-1454"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">NoDup</span> <span class="n">ls</span><span class="o">);</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">NoDup_sublist</span><span class="o">.</span>
</span><span id="linespan-1455"><a id="line-1455" name="line-1455"></a>    <span class="n">case_decide</span><span class="o">;</span> <span class="kr">last</span> <span class="kr">first</span><span class="o">.</span>
</span><span id="linespan-1456"><a id="line-1456" name="line-1456"></a>    <span class="o">{</span>
</span><span id="linespan-1457"><a id="line-1457" name="line-1457"></a>      <span class="k">revert</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-1458"><a id="line-1458" name="line-1458"></a>      <span class="kr">do</span> <span class="mi">3</span> <span class="o">(</span><span class="k">erewrite</span> <span class="n">extract1_notin</span><span class="o">;</span> <span class="k">eauto</span><span class="o">).</span>
</span><span id="linespan-1459"><a id="line-1459" name="line-1459"></a>    <span class="o">}</span>
</span><span id="linespan-1460"><a id="line-1460" name="line-1460"></a>    <span class="k">eapply</span> <span class="n">elem_of_list_lookup_1</span> <span class="k">in</span> <span class="n">H2</span> <span class="k">as</span> <span class="o">[</span><span class="n">ii</span> <span class="n">Hii</span><span class="o">].</span>
</span><span id="linespan-1461"><a id="line-1461" name="line-1461"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">ii</span> <span class="o">&lt;</span> <span class="n">length</span> <span class="n">ls</span><span class="o">);</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">lookup_lt_is_Some_1</span><span class="o">.</span>
</span><span id="linespan-1462"><a id="line-1462" name="line-1462"></a>    <span class="k">destruct</span> <span class="o">(</span><span class="n">lockcaps_split_length</span> <span class="o">_</span> <span class="o">_</span> <span class="o">_</span> <span class="n">H</span><span class="o">).</span>
</span><span id="linespan-1463"><a id="line-1463" name="line-1463"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">is_Some</span> <span class="o">(</span><span class="n">xs1</span> <span class="o">!!</span> <span class="n">ii</span><span class="o">))</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">lookup_lt_is_Some_2</span> <span class="k">with</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-1464"><a id="line-1464" name="line-1464"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">is_Some</span> <span class="o">(</span><span class="n">xs2</span> <span class="o">!!</span> <span class="n">ii</span><span class="o">))</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">lookup_lt_is_Some_2</span> <span class="k">with</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-1465"><a id="line-1465" name="line-1465"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">is_Some</span> <span class="o">(</span><span class="n">xs3</span> <span class="o">!!</span> <span class="n">ii</span><span class="o">))</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">lookup_lt_is_Some_2</span> <span class="k">with</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-1466"><a id="line-1466" name="line-1466"></a>    <span class="k">rewrite</span> <span class="n">extract1_Some_NoDup</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1467"><a id="line-1467" name="line-1467"></a>    <span class="k">rewrite</span> <span class="n">extract1_Some_NoDup</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1468"><a id="line-1468" name="line-1468"></a>    <span class="k">rewrite</span> <span class="n">extract1_Some_NoDup</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1469"><a id="line-1469" name="line-1469"></a>    <span class="k">destruct</span> <span class="n">x0</span><span class="o">,</span> <span class="n">x1</span><span class="o">,</span> <span class="n">x2</span><span class="o">.</span>
</span><span id="linespan-1470"><a id="line-1470" name="line-1470"></a>    <span class="k">unfold</span> <span class="n">lockcaps_split</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-1471"><a id="line-1471" name="line-1471"></a>    <span class="k">eapply</span> <span class="n">Forall3_lookup_lmr</span> <span class="k">in</span> <span class="n">H</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1472"><a id="line-1472" name="line-1472"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">t2</span> <span class="o">=</span> <span class="n">t</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-1473"><a id="line-1473" name="line-1473"></a>    <span class="o">{</span> <span class="k">eapply</span> <span class="n">lockrel_same_type</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-1474"><a id="line-1474" name="line-1474"></a>    <span class="k">eapply</span> <span class="n">lockrel_split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1475"><a id="line-1475" name="line-1475"></a>  <span class="o">-</span> <span class="k">revert</span> <span class="n">lr_refcount0</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">Mlen_mult</span> <span class="o">!</span><span class="n">Mlen_singleton</span><span class="o">.</span> <span class="k">intro</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-1476"><a id="line-1476" name="line-1476"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1477"><a id="line-1477" name="line-1477"></a>
</span><span id="linespan-1478"><a id="line-1478" name="line-1478"></a><span class="kn">Lemma</span> <span class="n">big_sepM_dom'</span> <span class="o">`{</span><span class="n">Countable</span> <span class="n">K</span><span class="o">}</span> <span class="o">{</span><span class="n">V</span><span class="o">}</span> <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">gmap</span> <span class="n">K</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">P</span> <span class="o">:</span> <span class="n">K</span> <span class="o">-&gt;</span> <span class="n">V</span> <span class="o">-&gt;</span> <span class="n">rProp</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-1479"><a id="line-1479" name="line-1479"></a>  <span class="o">([</span><span class="bp">∗</span> <span class="n">map</span><span class="o">]</span> <span class="n">k</span><span class="bp">↦</span><span class="n">v</span> <span class="bp">∈</span> <span class="n">m</span><span class="o">,</span> <span class="n">P</span> <span class="n">k</span> <span class="n">v</span><span class="o">)%</span><span class="n">I</span> <span class="bp">⊣⊢</span> <span class="o">[</span><span class="bp">∗</span> <span class="k">set</span><span class="o">]</span> <span class="n">k</span><span class="bp">∈</span><span class="n">dom</span> <span class="n">m</span><span class="o">,</span> <span class="n">from_option</span> <span class="o">(</span><span class="n">P</span> <span class="n">k</span><span class="o">)</span> <span class="n">True</span> <span class="o">(</span><span class="n">m</span><span class="o">!!</span><span class="n">k</span><span class="o">).</span>
</span><span id="linespan-1480"><a id="line-1480" name="line-1480"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1481"><a id="line-1481" name="line-1481"></a>  <span class="k">induction</span> <span class="n">m</span> <span class="k">using</span> <span class="n">map_ind</span><span class="o">.</span>
</span><span id="linespan-1482"><a id="line-1482" name="line-1482"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">dom_empty_L</span> <span class="n">big_sepM_empty</span> <span class="n">big_sepS_empty</span> <span class="o">//.</span>
</span><span id="linespan-1483"><a id="line-1483" name="line-1483"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">big_sepM_insert</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1484"><a id="line-1484" name="line-1484"></a>    <span class="k">rewrite</span> <span class="n">dom_insert_L</span><span class="o">.</span>
</span><span id="linespan-1485"><a id="line-1485" name="line-1485"></a>    <span class="k">rewrite</span> <span class="n">big_sepS_union</span><span class="o">;</span> <span class="kr">last</span> <span class="kr">first</span><span class="o">.</span>
</span><span id="linespan-1486"><a id="line-1486" name="line-1486"></a>    <span class="o">{</span>
</span><span id="linespan-1487"><a id="line-1487" name="line-1487"></a>      <span class="k">intros</span> <span class="o">???.</span> <span class="k">assert</span> <span class="o">(</span><span class="n">x0</span> <span class="o">=</span> <span class="n">i</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;</span> <span class="kp">by</span> <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-1488"><a id="line-1488" name="line-1488"></a>      <span class="k">apply</span> <span class="n">elem_of_dom</span> <span class="k">in</span> <span class="n">H2</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span> <span class="kp">congruence</span><span class="o">.</span>
</span><span id="linespan-1489"><a id="line-1489" name="line-1489"></a>    <span class="o">}</span>
</span><span id="linespan-1490"><a id="line-1490" name="line-1490"></a>    <span class="k">rewrite</span> <span class="n">IHm</span><span class="o">.</span>
</span><span id="linespan-1491"><a id="line-1491" name="line-1491"></a>    <span class="k">rewrite</span> <span class="n">big_sepS_singleton</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1492"><a id="line-1492" name="line-1492"></a>    <span class="n">iSplit</span><span class="o">;</span> <span class="n">iIntros</span> <span class="s2">"[? H]"</span><span class="o">;</span> <span class="n">iFrame</span><span class="o">;</span> <span class="n">iApply</span> <span class="o">(</span><span class="n">big_sepS_impl</span> <span class="k">with</span> <span class="s2">"H"</span><span class="o">);</span>
</span><span id="linespan-1493"><a id="line-1493" name="line-1493"></a>    <span class="n">iModIntro</span><span class="o">;</span> <span class="n">iIntros</span> <span class="o">(?</span> <span class="o">?);</span> <span class="n">smap</span><span class="o">;</span> <span class="k">eapply</span> <span class="n">elem_of_dom</span> <span class="k">in</span> <span class="n">H1</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="kp">congruence</span><span class="o">.</span>
</span><span id="linespan-1494"><a id="line-1494" name="line-1494"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1495"><a id="line-1495" name="line-1495"></a>
</span><span id="linespan-1496"><a id="line-1496" name="line-1496"></a><span class="kn">Lemma</span> <span class="n">incr_all_refcounts_proj</span> <span class="n">xs</span> <span class="n">x</span> <span class="n">x0</span> <span class="n">x2</span> <span class="n">ls</span> <span class="o">:</span>
</span><span id="linespan-1497"><a id="line-1497" name="line-1497"></a>  <span class="n">xs</span> <span class="o">!!</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">x0</span> <span class="o">-&gt;</span>
</span><span id="linespan-1498"><a id="line-1498" name="line-1498"></a>  <span class="n">incr_all_refcounts</span> <span class="n">xs</span> <span class="n">ls</span> <span class="o">!!</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">x2</span> <span class="o">-&gt;</span>
</span><span id="linespan-1499"><a id="line-1499" name="line-1499"></a>  <span class="n">x0</span><span class="o">.</span><span class="mi">2</span> <span class="o">=</span> <span class="n">x2</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span>
</span><span id="linespan-1500"><a id="line-1500" name="line-1500"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1501"><a id="line-1501" name="line-1501"></a>  <span class="k">destruct</span> <span class="n">x0</span><span class="o">,</span> <span class="n">x2</span><span class="o">.</span>
</span><span id="linespan-1502"><a id="line-1502" name="line-1502"></a>  <span class="k">revert</span> <span class="n">xs</span> <span class="n">x</span> <span class="n">n</span> <span class="n">o</span> <span class="n">n0</span> <span class="n">o0</span><span class="o">;</span> <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="k">intros</span><span class="o">;</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*;</span> <span class="kr">try</span> <span class="kp">congruence</span><span class="o">.</span>
</span><span id="linespan-1503"><a id="line-1503" name="line-1503"></a>  <span class="k">rewrite</span> <span class="n">lookup_alter_spec</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1504"><a id="line-1504" name="line-1504"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">incr_all_refcounts</span> <span class="n">xs</span> <span class="n">ls</span> <span class="o">!!</span> <span class="n">x</span><span class="o">)</span> <span class="k">as</span> <span class="o">[</span><span class="bp">[]</span><span class="o">|]</span> <span class="n">eqn</span><span class="o">:</span><span class="n">E</span><span class="o">.</span>
</span><span id="linespan-1505"><a id="line-1505" name="line-1505"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">E</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1506"><a id="line-1506" name="line-1506"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">E</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1507"><a id="line-1507" name="line-1507"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1508"><a id="line-1508" name="line-1508"></a>
</span><span id="linespan-1509"><a id="line-1509" name="line-1509"></a><span class="kn">Lemma</span> <span class="n">preservation</span> <span class="n">i</span> <span class="n">ρ</span> <span class="n">ρ'</span> <span class="o">:</span>
</span><span id="linespan-1510"><a id="line-1510" name="line-1510"></a>  <span class="n">step</span> <span class="n">i</span> <span class="n">ρ</span> <span class="n">ρ'</span> <span class="o">-&gt;</span> <span class="n">ginv</span> <span class="n">ρ</span> <span class="o">-&gt;</span> <span class="n">ginv</span> <span class="n">ρ'</span><span class="o">.</span>
</span><span id="linespan-1511"><a id="line-1511" name="line-1511"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1512"><a id="line-1512" name="line-1512"></a>  <span class="k">intros</span> <span class="n">H</span> <span class="n">Hinv</span><span class="o">.</span>
</span><span id="linespan-1513"><a id="line-1513" name="line-1513"></a>  <span class="k">destruct</span> <span class="n">H</span> <span class="k">as</span> <span class="o">[</span><span class="n">ρ</span> <span class="n">ρ'</span> <span class="n">ρf</span> <span class="n">D1</span> <span class="n">D2</span> <span class="n">i</span> <span class="n">H</span><span class="o">].</span>
</span><span id="linespan-1514"><a id="line-1514" name="line-1514"></a>  <span class="k">destruct</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-1515"><a id="line-1515" name="line-1515"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">inv_impl</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1516"><a id="line-1516" name="line-1516"></a>    <span class="n">iIntros</span> <span class="o">(</span><span class="n">n</span> <span class="n">x</span><span class="o">)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1517"><a id="line-1517" name="line-1517"></a>    <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="s2">"[? H]"</span><span class="o">.</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-1518"><a id="line-1518" name="line-1518"></a>    <span class="n">iDestruct</span> <span class="o">(</span><span class="n">replacement</span> <span class="k">with</span> <span class="s2">"H"</span><span class="o">)</span> <span class="k">as</span> <span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="s2">"[H Q]"</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1519"><a id="line-1519" name="line-1519"></a>    <span class="n">iApply</span> <span class="s2">"Q"</span><span class="o">.</span> <span class="n">iApply</span> <span class="n">pure_preservation</span><span class="o">;</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1520"><a id="line-1520" name="line-1520"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">inv_impl</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1521"><a id="line-1521" name="line-1521"></a>    <span class="n">iIntros</span> <span class="o">(</span><span class="n">n</span> <span class="n">x</span><span class="o">)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">;</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">;</span>
</span><span id="linespan-1522"><a id="line-1522" name="line-1522"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">ρf</span> <span class="o">!!</span> <span class="n">n</span> <span class="o">=</span> <span class="n">None</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;</span> <span class="kp">by</span> <span class="n">solve_map_disjoint</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1523"><a id="line-1523" name="line-1523"></a>    <span class="k">destruct</span> <span class="n">H</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1524"><a id="line-1524" name="line-1524"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="o">(</span><span class="n">inv_alloc_lr</span> <span class="n">i0</span> <span class="n">n</span> <span class="n">j</span><span class="o">);</span>
</span><span id="linespan-1525"><a id="line-1525" name="line-1525"></a>    <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="o">_;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="o">_.</span>
</span><span id="linespan-1526"><a id="line-1526" name="line-1526"></a>    <span class="o">+</span> <span class="n">naive_solver</span><span class="o">.</span>
</span><span id="linespan-1527"><a id="line-1527" name="line-1527"></a>    <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?</span> <span class="o">?</span> <span class="o">?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1528"><a id="line-1528" name="line-1528"></a>    <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1529"><a id="line-1529" name="line-1529"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">ρf</span> <span class="o">!!</span> <span class="n">n</span> <span class="o">=</span> <span class="n">None</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;</span> <span class="kp">by</span> <span class="n">solve_map_disjoint</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1530"><a id="line-1530" name="line-1530"></a>    <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1531"><a id="line-1531" name="line-1531"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">ρf</span> <span class="o">!!</span> <span class="n">j</span> <span class="o">=</span> <span class="n">None</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;</span> <span class="kp">by</span> <span class="n">solve_map_disjoint</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1532"><a id="line-1532" name="line-1532"></a>    <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1533"><a id="line-1533" name="line-1533"></a>      <span class="n">iDestruct</span> <span class="o">(</span><span class="n">replacement</span> <span class="k">with</span> <span class="s2">"H"</span><span class="o">)</span> <span class="k">as</span> <span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="s2">"[H Q]"</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-1534"><a id="line-1534" name="line-1534"></a>      <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1535"><a id="line-1535" name="line-1535"></a>      <span class="n">iExists</span> <span class="o">(</span><span class="n">BarrierLabel</span> <span class="bp">false</span> <span class="n">t1</span> <span class="n">t2</span><span class="o">),</span> <span class="o">(</span><span class="n">BarrierLabel</span> <span class="bp">false</span> <span class="n">t2</span> <span class="n">t1</span><span class="o">).</span>
</span><span id="linespan-1536"><a id="line-1536" name="line-1536"></a>      <span class="n">iSplitL</span> <span class="s2">"Q"</span><span class="o">.</span>
</span><span id="linespan-1537"><a id="line-1537" name="line-1537"></a>      <span class="o">*</span> <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1538"><a id="line-1538" name="line-1538"></a>        <span class="n">iApply</span> <span class="s2">"Q"</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1539"><a id="line-1539" name="line-1539"></a>      <span class="o">*</span> <span class="n">iSplit</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1540"><a id="line-1540" name="line-1540"></a>        <span class="n">iIntros</span> <span class="s2">"Q"</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="k">eauto</span> <span class="mi">10</span> <span class="k">with</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-1541"><a id="line-1541" name="line-1541"></a>  <span class="o">-</span> <span class="k">assert</span> <span class="o">(</span><span class="n">inv</span> <span class="o">(λ</span> <span class="n">k</span> <span class="n">x</span><span class="o">,</span>
</span><span id="linespan-1542"><a id="line-1542" name="line-1542"></a>      <span class="k">if</span> <span class="n">decide</span> <span class="o">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">i0</span><span class="o">)</span> <span class="k">then</span>
</span><span id="linespan-1543"><a id="line-1543" name="line-1543"></a>        <span class="bp">⌜⌜</span> <span class="n">x</span> <span class="bp">≡</span> <span class="n">ε</span> <span class="bp">⌝⌝</span> <span class="bp">∗</span> <span class="o">∃</span> <span class="n">t1</span> <span class="n">t2</span><span class="o">,</span> <span class="n">own_out</span> <span class="n">n</span> <span class="o">(</span><span class="n">BarrierLabel</span> <span class="bp">true</span> <span class="n">t1</span> <span class="n">t2</span><span class="o">)</span> <span class="bp">∗</span> <span class="o">∀</span> <span class="n">e'</span> <span class="o">:</span> <span class="n">expr</span><span class="o">,</span> <span class="n">rtyped0</span> <span class="n">e'</span> <span class="n">t2</span> <span class="o">-</span><span class="bp">∗</span> <span class="n">rtyped0</span> <span class="o">(</span><span class="n">k1</span> <span class="n">e'</span><span class="o">)</span> <span class="n">UnitT</span>
</span><span id="linespan-1544"><a id="line-1544" name="line-1544"></a>      <span class="k">else</span> <span class="k">if</span> <span class="n">decide</span> <span class="o">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">n</span><span class="o">)</span> <span class="k">then</span>
</span><span id="linespan-1545"><a id="line-1545" name="line-1545"></a>        <span class="o">∃</span> <span class="n">t1</span> <span class="n">t2</span><span class="o">,</span> <span class="bp">⌜⌜</span> <span class="n">x</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="n">BarrierLabel</span> <span class="bp">true</span> <span class="n">t1</span> <span class="n">t2</span> <span class="o">]}</span> <span class="bp">⋅</span> <span class="o">{[</span> <span class="n">BarrierLabel</span> <span class="bp">false</span> <span class="n">t2</span> <span class="n">t1</span> <span class="o">]}</span> <span class="bp">⌝⌝</span> <span class="bp">∗</span>
</span><span id="linespan-1546"><a id="line-1546" name="line-1546"></a>        <span class="n">vtyped</span> <span class="n">v1</span> <span class="n">t1</span>
</span><span id="linespan-1547"><a id="line-1547" name="line-1547"></a>      <span class="k">else</span> <span class="k">if</span> <span class="n">decide</span> <span class="o">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">j</span><span class="o">)</span> <span class="k">then</span>
</span><span id="linespan-1548"><a id="line-1548" name="line-1548"></a>        <span class="bp">⌜⌜</span> <span class="n">x</span> <span class="bp">≡</span> <span class="n">ε</span> <span class="bp">⌝⌝</span> <span class="bp">∗</span> <span class="n">rtyped0</span> <span class="o">(</span><span class="n">k2</span> <span class="o">(</span><span class="n">App</span> <span class="o">(</span><span class="n">Val</span> <span class="o">(</span><span class="n">BarrierV</span> <span class="n">n</span><span class="o">))</span> <span class="o">(</span><span class="n">Val</span> <span class="n">v2</span><span class="o">)))</span> <span class="n">UnitT</span>
</span><span id="linespan-1549"><a id="line-1549" name="line-1549"></a>      <span class="k">else</span> <span class="n">linv</span> <span class="n">ρf</span> <span class="n">k</span> <span class="n">x</span>
</span><span id="linespan-1550"><a id="line-1550" name="line-1550"></a>        <span class="o">)%</span><span class="n">I</span><span class="o">)</span> <span class="k">as</span> <span class="n">Hinv'</span><span class="o">.</span>
</span><span id="linespan-1551"><a id="line-1551" name="line-1551"></a>    <span class="o">{</span>
</span><span id="linespan-1552"><a id="line-1552" name="line-1552"></a>      <span class="k">eapply</span> <span class="o">(</span><span class="n">inv_exchange</span> <span class="n">i0</span> <span class="n">n</span><span class="o">);</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span> <span class="o">[</span><span class="n">solve_proper</span><span class="o">|</span><span class="n">solve_proper</span><span class="o">|..].</span>
</span><span id="linespan-1553"><a id="line-1553" name="line-1553"></a>      <span class="o">-</span> <span class="n">simp</span><span class="o">.</span> <span class="n">smap</span><span class="o">;</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">;</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1554"><a id="line-1554" name="line-1554"></a>      <span class="o">-</span> <span class="n">simp</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1555"><a id="line-1555" name="line-1555"></a>        <span class="n">iIntros</span> <span class="s2">"[% H]"</span><span class="o">.</span>
</span><span id="linespan-1556"><a id="line-1556" name="line-1556"></a>        <span class="k">rewrite</span> <span class="n">replacement</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1557"><a id="line-1557" name="line-1557"></a>        <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="o">(</span><span class="n">t1</span><span class="o">)</span> <span class="s2">"[H1 H2]"</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-1558"><a id="line-1558" name="line-1558"></a>        <span class="n">iDestruct</span> <span class="s2">"H1"</span> <span class="k">as</span> <span class="o">(</span><span class="n">t2</span> <span class="n">l</span><span class="o">)</span> <span class="s2">"[H1 H3]"</span><span class="o">.</span>
</span><span id="linespan-1559"><a id="line-1559" name="line-1559"></a>        <span class="n">iDestruct</span> <span class="s2">"H1"</span> <span class="k">as</span> <span class="o">(</span><span class="n">t1'</span> <span class="n">t2'</span> <span class="o">?)</span> <span class="s2">"H1"</span><span class="o">.</span> <span class="n">simplify_eq</span><span class="o">.</span>
</span><span id="linespan-1560"><a id="line-1560" name="line-1560"></a>        <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span> <span class="n">iIntros</span> <span class="o">(</span><span class="n">x</span> <span class="o">[</span><span class="n">t1</span> <span class="o">[</span><span class="n">t2</span> <span class="o">?]])</span> <span class="s2">""</span><span class="o">.</span>
</span><span id="linespan-1561"><a id="line-1561" name="line-1561"></a>        <span class="k">eapply</span> <span class="n">multiset_xsplit_singleton</span> <span class="k">in</span> <span class="n">H8</span> <span class="k">as</span> <span class="o">[</span><span class="bp">[]</span><span class="o">|</span><span class="bp">[]</span><span class="o">];</span> <span class="n">simplify_eq</span><span class="o">.</span>
</span><span id="linespan-1562"><a id="line-1562" name="line-1562"></a>        <span class="o">+</span> <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iSplitL</span> <span class="s2">"H2"</span><span class="o">.</span>
</span><span id="linespan-1563"><a id="line-1563" name="line-1563"></a>          <span class="o">*</span> <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">iExists</span> <span class="o">_,_.</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-1564"><a id="line-1564" name="line-1564"></a>          <span class="o">*</span> <span class="n">iExists</span> <span class="o">_,_.</span> <span class="n">iFrame</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1565"><a id="line-1565" name="line-1565"></a>        <span class="o">+</span> <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iSplitL</span> <span class="s2">"H2"</span><span class="o">.</span>
</span><span id="linespan-1566"><a id="line-1566" name="line-1566"></a>          <span class="o">*</span> <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">iExists</span> <span class="o">_,_.</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-1567"><a id="line-1567" name="line-1567"></a>          <span class="o">*</span> <span class="n">iExists</span> <span class="o">_,_.</span> <span class="n">iFrame</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1568"><a id="line-1568" name="line-1568"></a>    <span class="o">}</span> <span class="k">clear</span> <span class="n">Hinv</span><span class="o">.</span>
</span><span id="linespan-1569"><a id="line-1569" name="line-1569"></a>
</span><span id="linespan-1570"><a id="line-1570" name="line-1570"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">inv</span> <span class="o">(λ</span> <span class="n">k</span> <span class="n">x</span><span class="o">,</span>
</span><span id="linespan-1571"><a id="line-1571" name="line-1571"></a>      <span class="k">if</span> <span class="n">decide</span> <span class="o">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">i0</span><span class="o">)</span> <span class="k">then</span>
</span><span id="linespan-1572"><a id="line-1572" name="line-1572"></a>        <span class="bp">⌜⌜</span> <span class="n">x</span> <span class="bp">≡</span> <span class="n">ε</span> <span class="bp">⌝⌝</span> <span class="bp">∗</span> <span class="o">∃</span> <span class="n">t1</span> <span class="n">t2</span><span class="o">,</span> <span class="n">own_out</span> <span class="n">n</span> <span class="o">(</span><span class="n">BarrierLabel</span> <span class="bp">true</span> <span class="n">t1</span> <span class="n">t2</span><span class="o">)</span> <span class="bp">∗</span> <span class="o">∀</span> <span class="n">e'</span> <span class="o">:</span> <span class="n">expr</span><span class="o">,</span> <span class="n">rtyped0</span> <span class="n">e'</span> <span class="n">t2</span> <span class="o">-</span><span class="bp">∗</span> <span class="n">rtyped0</span> <span class="o">(</span><span class="n">k1</span> <span class="n">e'</span><span class="o">)</span> <span class="n">UnitT</span>
</span><span id="linespan-1573"><a id="line-1573" name="line-1573"></a>      <span class="k">else</span> <span class="k">if</span> <span class="n">decide</span> <span class="o">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">n</span><span class="o">)</span> <span class="k">then</span>
</span><span id="linespan-1574"><a id="line-1574" name="line-1574"></a>        <span class="o">∃</span> <span class="n">t1</span> <span class="n">t2</span><span class="o">,</span> <span class="bp">⌜⌜</span> <span class="n">x</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="n">BarrierLabel</span> <span class="bp">true</span> <span class="n">t1</span> <span class="n">t2</span> <span class="o">]}</span> <span class="bp">⌝⌝</span> <span class="bp">∗</span>
</span><span id="linespan-1575"><a id="line-1575" name="line-1575"></a>        <span class="n">vtyped</span> <span class="n">v2</span> <span class="n">t2</span>
</span><span id="linespan-1576"><a id="line-1576" name="line-1576"></a>      <span class="k">else</span> <span class="k">if</span> <span class="n">decide</span> <span class="o">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">j</span><span class="o">)</span> <span class="k">then</span>
</span><span id="linespan-1577"><a id="line-1577" name="line-1577"></a>        <span class="bp">⌜⌜</span> <span class="n">x</span> <span class="bp">≡</span> <span class="n">ε</span> <span class="bp">⌝⌝</span> <span class="bp">∗</span> <span class="n">rtyped0</span> <span class="o">(</span><span class="n">k2</span> <span class="o">(</span><span class="n">Val</span> <span class="n">v1</span><span class="o">))</span> <span class="n">UnitT</span>
</span><span id="linespan-1578"><a id="line-1578" name="line-1578"></a>      <span class="k">else</span> <span class="n">linv</span> <span class="n">ρf</span> <span class="n">k</span> <span class="n">x</span>
</span><span id="linespan-1579"><a id="line-1579" name="line-1579"></a>        <span class="o">)%</span><span class="n">I</span><span class="o">)</span> <span class="k">as</span> <span class="n">Hinv''</span><span class="o">.</span>
</span><span id="linespan-1580"><a id="line-1580" name="line-1580"></a>    <span class="o">{</span>
</span><span id="linespan-1581"><a id="line-1581" name="line-1581"></a>      <span class="k">eapply</span> <span class="o">(</span><span class="n">inv_dealloc</span> <span class="n">j</span> <span class="n">n</span><span class="o">);</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span> <span class="o">[</span><span class="n">solve_proper</span><span class="o">|</span><span class="n">solve_proper</span><span class="o">|..].</span>
</span><span id="linespan-1582"><a id="line-1582" name="line-1582"></a>      <span class="o">-</span> <span class="n">simp</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1583"><a id="line-1583" name="line-1583"></a>      <span class="o">-</span> <span class="n">simp</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1584"><a id="line-1584" name="line-1584"></a>        <span class="n">iIntros</span> <span class="s2">"[% H]"</span><span class="o">.</span>
</span><span id="linespan-1585"><a id="line-1585" name="line-1585"></a>        <span class="k">rewrite</span> <span class="n">replacement</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1586"><a id="line-1586" name="line-1586"></a>        <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="o">(</span><span class="n">t1</span><span class="o">)</span> <span class="s2">"[H1 H2]"</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-1587"><a id="line-1587" name="line-1587"></a>        <span class="n">iDestruct</span> <span class="s2">"H1"</span> <span class="k">as</span> <span class="o">(</span><span class="n">t2</span> <span class="n">l</span><span class="o">)</span> <span class="s2">"[H3 H4]"</span><span class="o">.</span>
</span><span id="linespan-1588"><a id="line-1588" name="line-1588"></a>        <span class="n">iDestruct</span> <span class="s2">"H3"</span> <span class="k">as</span> <span class="o">(</span><span class="n">t1'</span> <span class="n">t2'</span> <span class="o">?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">simplify_eq</span><span class="o">.</span>
</span><span id="linespan-1589"><a id="line-1589" name="line-1589"></a>        <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span> <span class="n">iIntros</span> <span class="o">(?)</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1590"><a id="line-1590" name="line-1590"></a>        <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="o">(</span><span class="n">t1</span> <span class="n">t2</span> <span class="o">?)</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1591"><a id="line-1591" name="line-1591"></a>        <span class="k">eapply</span> <span class="n">multiset_xsplit_singleton</span> <span class="k">in</span> <span class="n">H8</span> <span class="k">as</span> <span class="o">[</span><span class="bp">[]</span><span class="o">|</span><span class="bp">[]</span><span class="o">];</span> <span class="n">simplify_eq</span><span class="o">.</span>
</span><span id="linespan-1592"><a id="line-1592" name="line-1592"></a>        <span class="n">iSplitL</span> <span class="s2">"H H2"</span><span class="o">.</span>
</span><span id="linespan-1593"><a id="line-1593" name="line-1593"></a>        <span class="o">+</span> <span class="n">iSplit</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">iApply</span> <span class="s2">"H2"</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1594"><a id="line-1594" name="line-1594"></a>        <span class="o">+</span> <span class="n">iExists</span> <span class="o">_,_.</span> <span class="n">iFrame</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1595"><a id="line-1595" name="line-1595"></a>    <span class="o">}</span> <span class="k">clear</span> <span class="n">Hinv'</span><span class="o">.</span>
</span><span id="linespan-1596"><a id="line-1596" name="line-1596"></a>
</span><span id="linespan-1597"><a id="line-1597" name="line-1597"></a>    <span class="k">eapply</span> <span class="o">(</span><span class="n">inv_dealloc</span> <span class="n">i0</span> <span class="n">n</span><span class="o">);</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span> <span class="o">[</span><span class="n">solve_proper</span><span class="o">|</span><span class="n">solve_proper</span><span class="o">|..].</span>
</span><span id="linespan-1598"><a id="line-1598" name="line-1598"></a>    <span class="o">+</span> <span class="n">simp</span><span class="o">.</span> <span class="n">smap</span><span class="o">;</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">;</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1599"><a id="line-1599" name="line-1599"></a>    <span class="o">+</span> <span class="n">simp</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1600"><a id="line-1600" name="line-1600"></a>      <span class="n">iIntros</span> <span class="s2">"[% H]"</span><span class="o">.</span>
</span><span id="linespan-1601"><a id="line-1601" name="line-1601"></a>      <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="o">(</span><span class="n">t1</span> <span class="n">t2</span><span class="o">)</span> <span class="s2">"[H1 H2]"</span><span class="o">.</span>
</span><span id="linespan-1602"><a id="line-1602" name="line-1602"></a>      <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span> <span class="n">iIntros</span> <span class="o">(?)</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1603"><a id="line-1603" name="line-1603"></a>      <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="o">(</span><span class="n">t1'</span> <span class="n">t2'</span> <span class="o">?)</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1604"><a id="line-1604" name="line-1604"></a>      <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H6</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span> <span class="n">simplify_eq</span><span class="o">.</span>
</span><span id="linespan-1605"><a id="line-1605" name="line-1605"></a>      <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1606"><a id="line-1606" name="line-1606"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">ρf</span> <span class="o">!!</span> <span class="n">n</span> <span class="o">=</span> <span class="n">None</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;</span> <span class="kp">by</span> <span class="n">solve_map_disjoint</span><span class="o">.</span>
</span><span id="linespan-1607"><a id="line-1607" name="line-1607"></a>      <span class="n">iSplit</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1608"><a id="line-1608" name="line-1608"></a>      <span class="n">iApply</span> <span class="s2">"H2"</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1609"><a id="line-1609" name="line-1609"></a>  <span class="o">-</span> <span class="c">(* NewGroup *)</span>
</span><span id="linespan-1610"><a id="line-1610" name="line-1610"></a>    <span class="k">eapply</span> <span class="o">(</span><span class="n">inv_alloc_l</span> <span class="n">i0</span> <span class="n">n</span><span class="o">);</span>
</span><span id="linespan-1611"><a id="line-1611" name="line-1611"></a>    <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="o">_;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="o">_.</span>
</span><span id="linespan-1612"><a id="line-1612" name="line-1612"></a>    <span class="o">+</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1613"><a id="line-1613" name="line-1613"></a>    <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?</span> <span class="o">?</span> <span class="o">?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1614"><a id="line-1614" name="line-1614"></a>    <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1615"><a id="line-1615" name="line-1615"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">ρf</span> <span class="o">!!</span> <span class="n">n</span> <span class="o">=</span> <span class="n">None</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;</span> <span class="kp">by</span> <span class="n">solve_map_disjoint</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1616"><a id="line-1616" name="line-1616"></a>    <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1617"><a id="line-1617" name="line-1617"></a>      <span class="n">iDestruct</span> <span class="o">(</span><span class="n">replacement</span> <span class="k">with</span> <span class="s2">"H"</span><span class="o">)</span> <span class="k">as</span> <span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="s2">"[H Q]"</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-1618"><a id="line-1618" name="line-1618"></a>      <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1619"><a id="line-1619" name="line-1619"></a>      <span class="n">iExists</span> <span class="o">(</span><span class="n">LockLabel</span> <span class="bp">[]</span><span class="o">).</span>
</span><span id="linespan-1620"><a id="line-1620" name="line-1620"></a>      <span class="n">iSplitL</span> <span class="s2">"Q"</span><span class="o">.</span>
</span><span id="linespan-1621"><a id="line-1621" name="line-1621"></a>      <span class="o">*</span> <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1622"><a id="line-1622" name="line-1622"></a>        <span class="n">iApply</span> <span class="s2">"Q"</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1623"><a id="line-1623" name="line-1623"></a>      <span class="o">*</span> <span class="n">iExists</span> <span class="bp">∅</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1624"><a id="line-1624" name="line-1624"></a>        <span class="n">iPureIntro</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">lockrelG_NewGroup</span><span class="o">.</span>
</span><span id="linespan-1625"><a id="line-1625" name="line-1625"></a>  <span class="o">-</span> <span class="c">(* DeleteGroup *)</span>
</span><span id="linespan-1626"><a id="line-1626" name="line-1626"></a>    <span class="k">eapply</span> <span class="n">inv_impl</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1627"><a id="line-1627" name="line-1627"></a>    <span class="n">iIntros</span> <span class="o">(</span><span class="n">m</span> <span class="n">x</span><span class="o">)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">;</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">;</span>
</span><span id="linespan-1628"><a id="line-1628" name="line-1628"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">ρf</span> <span class="o">!!</span> <span class="n">m</span> <span class="o">=</span> <span class="n">None</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;</span> <span class="kp">by</span> <span class="n">solve_map_disjoint</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1629"><a id="line-1629" name="line-1629"></a>    <span class="n">iDestruct</span> <span class="o">(</span><span class="n">big_sepM2_empty_r</span> <span class="k">with</span> <span class="s2">"H"</span><span class="o">)</span> <span class="k">as</span> <span class="o">%-&gt;.</span>
</span><span id="linespan-1630"><a id="line-1630" name="line-1630"></a>    <span class="k">rewrite</span> <span class="n">big_sepM2_empty</span><span class="o">.</span> <span class="n">iPureIntro</span><span class="o">.</span>
</span><span id="linespan-1631"><a id="line-1631" name="line-1631"></a>    <span class="k">apply</span> <span class="n">lockrelG_empty_inv</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="k">subst</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1632"><a id="line-1632" name="line-1632"></a>  <span class="o">-</span> <span class="c">(* DropGroup *)</span>
</span><span id="linespan-1633"><a id="line-1633" name="line-1633"></a>    <span class="k">eapply</span> <span class="o">(</span><span class="n">inv_dealloc</span> <span class="n">i0</span> <span class="n">n</span><span class="o">);</span>
</span><span id="linespan-1634"><a id="line-1634" name="line-1634"></a>    <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="o">_;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="o">_.</span>
</span><span id="linespan-1635"><a id="line-1635" name="line-1635"></a>    <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?</span> <span class="o">?</span> <span class="o">?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1636"><a id="line-1636" name="line-1636"></a>    <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1637"><a id="line-1637" name="line-1637"></a>      <span class="n">iDestruct</span> <span class="o">(</span><span class="n">replacement</span> <span class="k">with</span> <span class="s2">"H"</span><span class="o">)</span> <span class="k">as</span> <span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="s2">"[H Q]"</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-1638"><a id="line-1638" name="line-1638"></a>      <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1639"><a id="line-1639" name="line-1639"></a>      <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span> <span class="n">iIntros</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1640"><a id="line-1640" name="line-1640"></a>      <span class="n">iSplitL</span> <span class="s2">"Q"</span><span class="o">.</span>
</span><span id="linespan-1641"><a id="line-1641" name="line-1641"></a>      <span class="o">*</span> <span class="n">iSplit</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span> <span class="n">iApply</span> <span class="s2">"Q"</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1642"><a id="line-1642" name="line-1642"></a>      <span class="o">*</span> <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1643"><a id="line-1643" name="line-1643"></a>        <span class="n">iPureIntro</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">lockrelG_DropGroup</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1644"><a id="line-1644" name="line-1644"></a>    <span class="o">-</span> <span class="c">(* NewLock *)</span>
</span><span id="linespan-1645"><a id="line-1645" name="line-1645"></a>      <span class="k">eapply</span> <span class="o">(</span><span class="n">inv_exchange</span> <span class="n">i0</span> <span class="n">n</span><span class="o">);</span>
</span><span id="linespan-1646"><a id="line-1646" name="line-1646"></a>      <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="o">_;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="o">_.</span>
</span><span id="linespan-1647"><a id="line-1647" name="line-1647"></a>      <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?</span> <span class="o">?</span> <span class="o">?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1648"><a id="line-1648" name="line-1648"></a>      <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1649"><a id="line-1649" name="line-1649"></a>        <span class="n">iDestruct</span> <span class="o">(</span><span class="n">replacement</span> <span class="k">with</span> <span class="s2">"H"</span><span class="o">)</span> <span class="k">as</span> <span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="s2">"[H Q]"</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-1650"><a id="line-1650" name="line-1650"></a>        <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1651"><a id="line-1651" name="line-1651"></a>        <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span> <span class="n">iIntros</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1652"><a id="line-1652" name="line-1652"></a>        <span class="n">iExists</span> <span class="o">_.</span>
</span><span id="linespan-1653"><a id="line-1653" name="line-1653"></a>        <span class="n">iSplitL</span> <span class="s2">"Q"</span><span class="o">.</span>
</span><span id="linespan-1654"><a id="line-1654" name="line-1654"></a>        <span class="o">*</span> <span class="n">iIntros</span> <span class="s2">"H'"</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1655"><a id="line-1655" name="line-1655"></a>          <span class="n">iApply</span> <span class="s2">"Q"</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span> <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-1656"><a id="line-1656" name="line-1656"></a>          <span class="n">iPureIntro</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1657"><a id="line-1657" name="line-1657"></a>          <span class="k">rewrite</span> <span class="o">!</span><span class="n">insert2_length</span><span class="o">.</span> <span class="n">f_equal</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1658"><a id="line-1658" name="line-1658"></a>        <span class="o">*</span> <span class="n">iExists</span> <span class="o">(&lt;[</span> <span class="n">jj</span> <span class="o">:=</span> <span class="n">t'</span> <span class="o">]&gt;</span> <span class="n">ts</span><span class="o">).</span>
</span><span id="linespan-1659"><a id="line-1659" name="line-1659"></a>          <span class="n">iSplit</span><span class="o">.</span>
</span><span id="linespan-1660"><a id="line-1660" name="line-1660"></a>          <span class="o">**</span> <span class="n">iPureIntro</span><span class="o">.</span>
</span><span id="linespan-1661"><a id="line-1661" name="line-1661"></a>             <span class="k">eapply</span> <span class="n">lockrelG_NewLock</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1662"><a id="line-1662" name="line-1662"></a>          <span class="o">**</span> <span class="k">rewrite</span> <span class="n">big_sepM2_insert</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1663"><a id="line-1663" name="line-1663"></a>             <span class="k">eapply</span> <span class="n">lockrelG_same_dom_empty</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1664"><a id="line-1664" name="line-1664"></a>    <span class="o">-</span> <span class="c">(* DropLock *)</span>
</span><span id="linespan-1665"><a id="line-1665" name="line-1665"></a>      <span class="k">eapply</span> <span class="o">(</span><span class="n">inv_exchange</span> <span class="n">i0</span> <span class="n">n</span><span class="o">);</span>
</span><span id="linespan-1666"><a id="line-1666" name="line-1666"></a>      <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="o">_;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="o">_.</span>
</span><span id="linespan-1667"><a id="line-1667" name="line-1667"></a>      <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?</span> <span class="o">?</span> <span class="o">?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1668"><a id="line-1668" name="line-1668"></a>      <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1669"><a id="line-1669" name="line-1669"></a>        <span class="n">iDestruct</span> <span class="o">(</span><span class="n">replacement</span> <span class="k">with</span> <span class="s2">"H"</span><span class="o">)</span> <span class="k">as</span> <span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="s2">"[H Q]"</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-1670"><a id="line-1670" name="line-1670"></a>        <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1671"><a id="line-1671" name="line-1671"></a>        <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span> <span class="n">iIntros</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1672"><a id="line-1672" name="line-1672"></a>        <span class="n">iExists</span> <span class="o">_.</span>
</span><span id="linespan-1673"><a id="line-1673" name="line-1673"></a>        <span class="n">iSplitL</span> <span class="s2">"Q"</span><span class="o">.</span>
</span><span id="linespan-1674"><a id="line-1674" name="line-1674"></a>        <span class="o">*</span> <span class="n">iIntros</span> <span class="s2">"H'"</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1675"><a id="line-1675" name="line-1675"></a>          <span class="n">iApply</span> <span class="s2">"Q"</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span> <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-1676"><a id="line-1676" name="line-1676"></a>          <span class="n">iPureIntro</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1677"><a id="line-1677" name="line-1677"></a>          <span class="k">rewrite</span> <span class="o">!</span><span class="n">length_delete</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1678"><a id="line-1678" name="line-1678"></a>        <span class="o">*</span> <span class="n">iExists</span> <span class="n">ts</span><span class="o">.</span>
</span><span id="linespan-1679"><a id="line-1679" name="line-1679"></a>          <span class="n">iSplit</span><span class="o">.</span>
</span><span id="linespan-1680"><a id="line-1680" name="line-1680"></a>          <span class="o">**</span> <span class="n">iPureIntro</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">lockrelG_DropLock</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1681"><a id="line-1681" name="line-1681"></a>          <span class="o">**</span> <span class="n">iApply</span> <span class="n">big_sepM2_delete_l</span><span class="o">;</span> <span class="kr">first</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1682"><a id="line-1682" name="line-1682"></a>             <span class="k">rewrite</span> <span class="n">big_sepM2_delete_l</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1683"><a id="line-1683" name="line-1683"></a>             <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="s2">"[H1 H2]"</span><span class="o">.</span>
</span><span id="linespan-1684"><a id="line-1684" name="line-1684"></a>             <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">delete_insert_delete</span><span class="o">.</span>
</span><span id="linespan-1685"><a id="line-1685" name="line-1685"></a>             <span class="n">iSplit</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1686"><a id="line-1686" name="line-1686"></a>    <span class="o">-</span> <span class="c">(* Acquire *)</span>
</span><span id="linespan-1687"><a id="line-1687" name="line-1687"></a>      <span class="k">eapply</span> <span class="o">(</span><span class="n">inv_exchange</span> <span class="n">i0</span> <span class="n">n</span><span class="o">);</span>
</span><span id="linespan-1688"><a id="line-1688" name="line-1688"></a>      <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="o">_;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="o">_.</span>
</span><span id="linespan-1689"><a id="line-1689" name="line-1689"></a>      <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?</span> <span class="o">?</span> <span class="o">?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1690"><a id="line-1690" name="line-1690"></a>      <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1691"><a id="line-1691" name="line-1691"></a>        <span class="n">iDestruct</span> <span class="o">(</span><span class="n">replacement</span> <span class="k">with</span> <span class="s2">"H"</span><span class="o">)</span> <span class="k">as</span> <span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="s2">"[H Q]"</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-1692"><a id="line-1692" name="line-1692"></a>        <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1693"><a id="line-1693" name="line-1693"></a>        <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span> <span class="n">iIntros</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1694"><a id="line-1694" name="line-1694"></a>        <span class="n">iExists</span> <span class="o">_.</span>
</span><span id="linespan-1695"><a id="line-1695" name="line-1695"></a>        <span class="c">(* Need to split "H" into value we need and rest *)</span>
</span><span id="linespan-1696"><a id="line-1696" name="line-1696"></a>        <span class="k">rewrite</span> <span class="n">big_sepM2_delete_l</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1697"><a id="line-1697" name="line-1697"></a>        <span class="k">simpl</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1698"><a id="line-1698" name="line-1698"></a>        <span class="k">assert</span> <span class="o">(</span><span class="n">x2</span> <span class="o">=</span> <span class="n">t'</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;</span> <span class="kp">by</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">lockrelG_types_same</span><span class="o">.</span>
</span><span id="linespan-1699"><a id="line-1699" name="line-1699"></a>        <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="s2">"[Hv H]"</span><span class="o">.</span>
</span><span id="linespan-1700"><a id="line-1700" name="line-1700"></a>        <span class="n">iSplitL</span> <span class="s2">"Q Hv"</span><span class="o">.</span>
</span><span id="linespan-1701"><a id="line-1701" name="line-1701"></a>        <span class="o">*</span> <span class="n">iIntros</span> <span class="s2">"H'"</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1702"><a id="line-1702" name="line-1702"></a>          <span class="n">iApply</span> <span class="s2">"Q"</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span> <span class="n">iExists</span> <span class="o">_,_.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1703"><a id="line-1703" name="line-1703"></a>          <span class="n">iSplitL</span> <span class="s2">"H'"</span><span class="o">;</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-1704"><a id="line-1704" name="line-1704"></a>          <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-1705"><a id="line-1705" name="line-1705"></a>          <span class="n">iPureIntro</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1706"><a id="line-1706" name="line-1706"></a>          <span class="k">rewrite</span> <span class="n">insert_length</span> <span class="o">//.</span>
</span><span id="linespan-1707"><a id="line-1707" name="line-1707"></a>        <span class="o">*</span> <span class="n">iExists</span> <span class="n">ts</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">.</span>
</span><span id="linespan-1708"><a id="line-1708" name="line-1708"></a>          <span class="o">{</span> <span class="n">iPureIntro</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">lockrelG_Acquire</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-1709"><a id="line-1709" name="line-1709"></a>          <span class="n">iApply</span> <span class="n">big_sepM2_delete_l</span><span class="o">;</span> <span class="kr">first</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1710"><a id="line-1710" name="line-1710"></a>          <span class="n">iExists</span> <span class="o">_.</span> <span class="n">smap</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1711"><a id="line-1711" name="line-1711"></a>          <span class="k">rewrite</span> <span class="n">delete_insert_delete</span> <span class="o">//.</span>
</span><span id="linespan-1712"><a id="line-1712" name="line-1712"></a>  <span class="o">-</span> <span class="c">(* Release *)</span>
</span><span id="linespan-1713"><a id="line-1713" name="line-1713"></a>    <span class="k">eapply</span> <span class="o">(</span><span class="n">inv_exchange</span> <span class="n">i0</span> <span class="n">n</span><span class="o">);</span>
</span><span id="linespan-1714"><a id="line-1714" name="line-1714"></a>    <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="o">_;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="o">_.</span>
</span><span id="linespan-1715"><a id="line-1715" name="line-1715"></a>    <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?</span> <span class="o">?</span> <span class="o">?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1716"><a id="line-1716" name="line-1716"></a>    <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1717"><a id="line-1717" name="line-1717"></a>      <span class="n">iDestruct</span> <span class="o">(</span><span class="n">replacement</span> <span class="k">with</span> <span class="s2">"H"</span><span class="o">)</span> <span class="k">as</span> <span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="s2">"[H Q]"</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-1718"><a id="line-1718" name="line-1718"></a>      <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="s2">"[H1 H2]"</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H1"</span><span class="o">.</span>
</span><span id="linespan-1719"><a id="line-1719" name="line-1719"></a>      <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span> <span class="n">iIntros</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1720"><a id="line-1720" name="line-1720"></a>      <span class="n">iExists</span> <span class="o">_.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1721"><a id="line-1721" name="line-1721"></a>      <span class="n">iSplitL</span> <span class="s2">"Q"</span><span class="o">.</span>
</span><span id="linespan-1722"><a id="line-1722" name="line-1722"></a>      <span class="o">*</span> <span class="n">iIntros</span> <span class="s2">"H'"</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1723"><a id="line-1723" name="line-1723"></a>        <span class="n">iApply</span> <span class="s2">"Q"</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span> <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-1724"><a id="line-1724" name="line-1724"></a>        <span class="n">iPureIntro</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1725"><a id="line-1725" name="line-1725"></a>        <span class="k">rewrite</span> <span class="n">insert_length</span> <span class="o">//.</span>
</span><span id="linespan-1726"><a id="line-1726" name="line-1726"></a>      <span class="o">*</span> <span class="n">iExists</span> <span class="n">ts</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">.</span>
</span><span id="linespan-1727"><a id="line-1727" name="line-1727"></a>        <span class="o">{</span> <span class="n">iPureIntro</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">lockrelG_Release</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-1728"><a id="line-1728" name="line-1728"></a>        <span class="k">rewrite</span> <span class="n">big_sepM2_delete_l</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-1729"><a id="line-1729" name="line-1729"></a>        <span class="n">iApply</span> <span class="n">big_sepM2_delete_l</span><span class="o">;</span> <span class="kr">first</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1730"><a id="line-1730" name="line-1730"></a>        <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="s2">"[_ H]"</span><span class="o">.</span>
</span><span id="linespan-1731"><a id="line-1731" name="line-1731"></a>        <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-1732"><a id="line-1732" name="line-1732"></a>        <span class="k">assert</span> <span class="o">(</span><span class="n">x2</span> <span class="o">=</span> <span class="n">t'</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;</span> <span class="kp">by</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">lockrelG_types_same</span><span class="o">.</span>
</span><span id="linespan-1733"><a id="line-1733" name="line-1733"></a>        <span class="n">iFrame</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">delete_insert_delete</span> <span class="o">//.</span>
</span><span id="linespan-1734"><a id="line-1734" name="line-1734"></a>  <span class="o">-</span> <span class="c">(* Wait *)</span>
</span><span id="linespan-1735"><a id="line-1735" name="line-1735"></a>    <span class="k">eapply</span> <span class="o">(</span><span class="n">inv_exchange</span> <span class="n">i0</span> <span class="n">n</span><span class="o">);</span>
</span><span id="linespan-1736"><a id="line-1736" name="line-1736"></a>    <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="o">_;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="o">_.</span>
</span><span id="linespan-1737"><a id="line-1737" name="line-1737"></a>    <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?</span> <span class="o">?</span> <span class="o">?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1738"><a id="line-1738" name="line-1738"></a>    <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1739"><a id="line-1739" name="line-1739"></a>      <span class="n">iDestruct</span> <span class="o">(</span><span class="n">replacement</span> <span class="k">with</span> <span class="s2">"H"</span><span class="o">)</span> <span class="k">as</span> <span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="s2">"[H Q]"</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-1740"><a id="line-1740" name="line-1740"></a>      <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-1741"><a id="line-1741" name="line-1741"></a>      <span class="n">iIntros</span> <span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1742"><a id="line-1742" name="line-1742"></a>      <span class="n">iExists</span> <span class="o">_.</span>
</span><span id="linespan-1743"><a id="line-1743" name="line-1743"></a>      <span class="c">(* Need to split "H" into value we need and rest *)</span>
</span><span id="linespan-1744"><a id="line-1744" name="line-1744"></a>      <span class="k">rewrite</span> <span class="n">big_sepM2_delete_l</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1745"><a id="line-1745" name="line-1745"></a>      <span class="k">simpl</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1746"><a id="line-1746" name="line-1746"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">x2</span> <span class="o">=</span> <span class="n">t'</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;</span> <span class="kp">by</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">lockrelG_types_same</span><span class="o">.</span>
</span><span id="linespan-1747"><a id="line-1747" name="line-1747"></a>      <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="s2">"[Hv H]"</span><span class="o">.</span>
</span><span id="linespan-1748"><a id="line-1748" name="line-1748"></a>      <span class="n">iSplitL</span> <span class="s2">"Q Hv"</span><span class="o">.</span>
</span><span id="linespan-1749"><a id="line-1749" name="line-1749"></a>      <span class="o">*</span> <span class="n">iIntros</span> <span class="s2">"H'"</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1750"><a id="line-1750" name="line-1750"></a>        <span class="n">iApply</span> <span class="s2">"Q"</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span> <span class="n">iExists</span> <span class="o">_,_.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1751"><a id="line-1751" name="line-1751"></a>        <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-1752"><a id="line-1752" name="line-1752"></a>        <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-1753"><a id="line-1753" name="line-1753"></a>        <span class="n">iPureIntro</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1754"><a id="line-1754" name="line-1754"></a>        <span class="k">rewrite</span> <span class="o">!</span><span class="n">length_delete</span> <span class="o">//.</span>
</span><span id="linespan-1755"><a id="line-1755" name="line-1755"></a>        <span class="n">f_equal</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1756"><a id="line-1756" name="line-1756"></a>      <span class="o">*</span> <span class="n">iExists</span> <span class="o">(</span><span class="n">delete</span> <span class="n">jj</span> <span class="n">ts</span><span class="o">).</span> <span class="n">iSplit</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1757"><a id="line-1757" name="line-1757"></a>        <span class="n">iPureIntro</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">lockrelG_Wait</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1758"><a id="line-1758" name="line-1758"></a>  <span class="o">-</span> <span class="c">(* ForkLock *)</span>
</span><span id="linespan-1759"><a id="line-1759" name="line-1759"></a>    <span class="k">eapply</span> <span class="o">(</span><span class="n">inv_exchange_alloc</span> <span class="n">i0</span> <span class="n">n</span> <span class="n">j</span><span class="o">);</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="o">_;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="o">_.</span>
</span><span id="linespan-1760"><a id="line-1760" name="line-1760"></a>    <span class="o">+</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1761"><a id="line-1761" name="line-1761"></a>    <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?</span> <span class="o">?</span> <span class="o">?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1762"><a id="line-1762" name="line-1762"></a>    <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-1763"><a id="line-1763" name="line-1763"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">ρf</span> <span class="o">!!</span> <span class="n">j</span> <span class="o">=</span> <span class="n">None</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;</span> <span class="kp">by</span> <span class="n">solve_map_disjoint</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1764"><a id="line-1764" name="line-1764"></a>    <span class="o">+</span> <span class="n">iIntros</span> <span class="o">(?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1765"><a id="line-1765" name="line-1765"></a>      <span class="n">iDestruct</span> <span class="o">(</span><span class="n">replacement</span> <span class="k">with</span> <span class="s2">"H"</span><span class="o">)</span> <span class="k">as</span> <span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="s2">"[H Q]"</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-1766"><a id="line-1766" name="line-1766"></a>      <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="s2">"[H1 H2]"</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H1"</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-1767"><a id="line-1767" name="line-1767"></a>      <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-1768"><a id="line-1768" name="line-1768"></a>      <span class="n">iIntros</span> <span class="o">(?)</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1769"><a id="line-1769" name="line-1769"></a>      <span class="c">(* assert (t'0 = t) as -&gt; by eauto using lockrel_same_type. *)</span>
</span><span id="linespan-1770"><a id="line-1770" name="line-1770"></a>      <span class="c">(* iExists (LockLabel l3 t),(LockLabel l2 t). *)</span>
</span><span id="linespan-1771"><a id="line-1771" name="line-1771"></a>      <span class="n">iExists</span> <span class="o">(</span><span class="n">LockLabel</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs3</span><span class="o">)),(</span><span class="n">LockLabel</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs2</span><span class="o">)).</span>
</span><span id="linespan-1772"><a id="line-1772" name="line-1772"></a>      <span class="n">edestruct</span> <span class="n">lockcaps_split_length</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1773"><a id="line-1773" name="line-1773"></a>      <span class="n">iSplitL</span> <span class="s2">"Q"</span><span class="o">.</span>
</span><span id="linespan-1774"><a id="line-1774" name="line-1774"></a>      <span class="o">{</span>
</span><span id="linespan-1775"><a id="line-1775" name="line-1775"></a>        <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span> <span class="n">iApply</span> <span class="s2">"Q"</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-1776"><a id="line-1776" name="line-1776"></a>        <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span> <span class="n">iPureIntro</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-1777"><a id="line-1777" name="line-1777"></a>      <span class="o">}</span>
</span><span id="linespan-1778"><a id="line-1778" name="line-1778"></a>      <span class="n">iSplitL</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1779"><a id="line-1779" name="line-1779"></a>      <span class="o">*</span> <span class="n">iExists</span> <span class="n">ts</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">.</span>
</span><span id="linespan-1780"><a id="line-1780" name="line-1780"></a>        <span class="o">{</span> <span class="n">iPureIntro</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">lockrelG_ForkLock</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="o">}</span> <span class="k">clear</span><span class="o">.</span>
</span><span id="linespan-1781"><a id="line-1781" name="line-1781"></a>        <span class="k">rewrite</span> <span class="o">!</span><span class="n">big_sepM2_alt</span><span class="o">.</span>
</span><span id="linespan-1782"><a id="line-1782" name="line-1782"></a>        <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="s2">"[% H2]"</span><span class="o">.</span>
</span><span id="linespan-1783"><a id="line-1783" name="line-1783"></a>        <span class="n">iSplit</span><span class="o">.</span> <span class="o">{</span> <span class="n">iPureIntro</span><span class="o">.</span> <span class="k">intro</span><span class="o">.</span> <span class="n">specialize</span> <span class="o">(</span><span class="n">H</span> <span class="n">k</span><span class="o">).</span> <span class="k">revert</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-1784"><a id="line-1784" name="line-1784"></a>                  <span class="k">rewrite</span> <span class="o">-!</span><span class="n">elem_of_dom</span> <span class="n">incr_all_refcounts_dom</span> <span class="o">//.</span> <span class="o">}</span>
</span><span id="linespan-1785"><a id="line-1785" name="line-1785"></a>        <span class="k">rewrite</span> <span class="o">!</span><span class="n">big_sepM_dom'</span><span class="o">.</span>
</span><span id="linespan-1786"><a id="line-1786" name="line-1786"></a>        <span class="k">rewrite</span> <span class="o">!</span><span class="n">dom_map_zip_with_L</span> <span class="n">incr_all_refcounts_dom</span><span class="o">.</span>
</span><span id="linespan-1787"><a id="line-1787" name="line-1787"></a>        <span class="n">iApply</span> <span class="o">(</span><span class="n">big_sepS_impl</span> <span class="k">with</span> <span class="s2">"H2"</span><span class="o">).</span>
</span><span id="linespan-1788"><a id="line-1788" name="line-1788"></a>        <span class="n">iModIntro</span><span class="o">.</span> <span class="n">iIntros</span> <span class="o">(</span><span class="n">x</span> <span class="n">HH</span><span class="o">)</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1789"><a id="line-1789" name="line-1789"></a>        <span class="k">eapply</span> <span class="n">elem_of_intersection</span> <span class="k">in</span> <span class="n">HH</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-1790"><a id="line-1790" name="line-1790"></a>        <span class="k">eapply</span> <span class="n">elem_of_dom</span> <span class="k">in</span> <span class="n">H0</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-1791"><a id="line-1791" name="line-1791"></a>        <span class="k">eapply</span> <span class="n">elem_of_dom</span> <span class="k">in</span> <span class="n">H1</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-1792"><a id="line-1792" name="line-1792"></a>        <span class="k">assert</span> <span class="o">(</span><span class="n">map_zip</span> <span class="n">xs</span> <span class="n">ts</span> <span class="o">!!</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">x0</span><span class="o">,</span><span class="n">x1</span><span class="o">))</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-1793"><a id="line-1793" name="line-1793"></a>        <span class="o">{</span> <span class="k">eapply</span> <span class="n">map_lookup_zip_Some</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-1794"><a id="line-1794" name="line-1794"></a>        <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-1795"><a id="line-1795" name="line-1795"></a>        <span class="k">assert</span> <span class="o">(</span><span class="n">is_Some</span> <span class="o">(</span><span class="n">incr_all_refcounts</span> <span class="n">xs</span> <span class="n">ls</span> <span class="o">!!</span> <span class="n">x</span><span class="o">))</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-1796"><a id="line-1796" name="line-1796"></a>        <span class="o">{</span>
</span><span id="linespan-1797"><a id="line-1797" name="line-1797"></a>          <span class="k">apply</span> <span class="n">elem_of_dom</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">incr_all_refcounts_dom</span><span class="o">.</span>
</span><span id="linespan-1798"><a id="line-1798" name="line-1798"></a>          <span class="k">apply</span> <span class="n">elem_of_dom</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1799"><a id="line-1799" name="line-1799"></a>        <span class="o">}</span>
</span><span id="linespan-1800"><a id="line-1800" name="line-1800"></a>        <span class="k">assert</span> <span class="o">(</span><span class="n">map_zip</span> <span class="o">(</span><span class="n">incr_all_refcounts</span> <span class="n">xs</span> <span class="n">ls</span><span class="o">)</span> <span class="n">ts</span> <span class="o">!!</span> <span class="n">x</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">x2</span><span class="o">,</span><span class="n">x1</span><span class="o">))</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-1801"><a id="line-1801" name="line-1801"></a>        <span class="o">{</span> <span class="k">eapply</span> <span class="n">map_lookup_zip_Some</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-1802"><a id="line-1802" name="line-1802"></a>        <span class="k">simpl</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">incr_all_refcounts_proj</span> <span class="k">in</span> <span class="n">H2</span> <span class="k">as</span> <span class="o">-&gt;;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1803"><a id="line-1803" name="line-1803"></a>      <span class="o">*</span> <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1804"><a id="line-1804" name="line-1804"></a>        <span class="n">iExists</span> <span class="o">_,_.</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-1805"><a id="line-1805" name="line-1805"></a>        <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-1806"><a id="line-1806" name="line-1806"></a>        <span class="n">iPureIntro</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-1807"><a id="line-1807" name="line-1807"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1808"><a id="line-1808" name="line-1808"></a>
</span><span id="linespan-1809"><a id="line-1809" name="line-1809"></a><span class="kn">Lemma</span> <span class="n">cfg_fresh1</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">:</span> <span class="n">cfg</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-1810"><a id="line-1810" name="line-1810"></a>  <span class="o">∃</span> <span class="n">j</span><span class="o">,</span> <span class="n">ρ</span> <span class="o">!!</span> <span class="n">j</span> <span class="o">=</span> <span class="n">None</span><span class="o">.</span>
</span><span id="linespan-1811"><a id="line-1811" name="line-1811"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1812"><a id="line-1812" name="line-1812"></a>  <span class="k">exists</span> <span class="o">(</span><span class="n">fresh</span> <span class="o">(</span><span class="n">dom</span> <span class="n">ρ</span><span class="o">)).</span>
</span><span id="linespan-1813"><a id="line-1813" name="line-1813"></a>  <span class="k">apply</span> <span class="n">not_elem_of_dom</span><span class="o">.</span>
</span><span id="linespan-1814"><a id="line-1814" name="line-1814"></a>  <span class="k">apply</span> <span class="n">is_fresh</span><span class="o">.</span>
</span><span id="linespan-1815"><a id="line-1815" name="line-1815"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1816"><a id="line-1816" name="line-1816"></a>
</span><span id="linespan-1817"><a id="line-1817" name="line-1817"></a><span class="kn">Lemma</span> <span class="n">map_fresh1</span> <span class="o">{</span><span class="n">V</span><span class="o">}</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">:</span> <span class="n">gmap</span> <span class="n">nat</span> <span class="n">V</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-1818"><a id="line-1818" name="line-1818"></a>  <span class="o">∃</span> <span class="n">j</span><span class="o">,</span> <span class="n">ρ</span> <span class="o">!!</span> <span class="n">j</span> <span class="o">=</span> <span class="n">None</span><span class="o">.</span>
</span><span id="linespan-1819"><a id="line-1819" name="line-1819"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1820"><a id="line-1820" name="line-1820"></a>  <span class="k">exists</span> <span class="o">(</span><span class="n">fresh</span> <span class="o">(</span><span class="n">dom</span> <span class="n">ρ</span><span class="o">)).</span>
</span><span id="linespan-1821"><a id="line-1821" name="line-1821"></a>  <span class="k">apply</span> <span class="n">not_elem_of_dom</span><span class="o">.</span>
</span><span id="linespan-1822"><a id="line-1822" name="line-1822"></a>  <span class="k">apply</span> <span class="n">is_fresh</span><span class="o">.</span>
</span><span id="linespan-1823"><a id="line-1823" name="line-1823"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1824"><a id="line-1824" name="line-1824"></a>
</span><span id="linespan-1825"><a id="line-1825" name="line-1825"></a><span class="kn">Lemma</span> <span class="n">fresh2</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">gset</span> <span class="n">nat</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-1826"><a id="line-1826" name="line-1826"></a>  <span class="o">∃</span> <span class="n">x</span> <span class="n">y</span><span class="o">,</span> <span class="n">x</span> <span class="bp">∉</span> <span class="n">s</span> <span class="o">∧</span> <span class="n">y</span> <span class="bp">∉</span> <span class="n">s</span> <span class="o">∧</span> <span class="n">x</span> <span class="o">≠</span> <span class="n">y</span><span class="o">.</span>
</span><span id="linespan-1827"><a id="line-1827" name="line-1827"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1828"><a id="line-1828" name="line-1828"></a>  <span class="k">exists</span> <span class="o">(</span><span class="n">fresh</span> <span class="n">s</span><span class="o">),</span> <span class="o">(</span><span class="n">fresh</span> <span class="o">(</span><span class="n">s</span> <span class="bp">∪</span> <span class="o">{[</span> <span class="n">fresh</span> <span class="n">s</span> <span class="o">]})).</span>
</span><span id="linespan-1829"><a id="line-1829" name="line-1829"></a>  <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="n">is_fresh</span><span class="o">.</span>
</span><span id="linespan-1830"><a id="line-1830" name="line-1830"></a>  <span class="k">pose</span> <span class="n">proof</span> <span class="o">(</span><span class="n">is_fresh</span> <span class="o">(</span><span class="n">s</span> <span class="bp">∪</span> <span class="o">{[</span> <span class="n">fresh</span> <span class="n">s</span> <span class="o">]})).</span>
</span><span id="linespan-1831"><a id="line-1831" name="line-1831"></a>  <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-1832"><a id="line-1832" name="line-1832"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1833"><a id="line-1833" name="line-1833"></a>
</span><span id="linespan-1834"><a id="line-1834" name="line-1834"></a><span class="kn">Lemma</span> <span class="n">cfg_fresh2</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">:</span> <span class="n">cfg</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-1835"><a id="line-1835" name="line-1835"></a>  <span class="o">∃</span> <span class="n">j1</span> <span class="n">j2</span><span class="o">,</span> <span class="n">ρ</span> <span class="o">!!</span> <span class="n">j1</span> <span class="o">=</span> <span class="n">None</span> <span class="o">∧</span> <span class="n">ρ</span> <span class="o">!!</span> <span class="n">j2</span> <span class="o">=</span> <span class="n">None</span> <span class="o">∧</span> <span class="n">j1</span> <span class="o">≠</span> <span class="n">j2</span><span class="o">.</span>
</span><span id="linespan-1836"><a id="line-1836" name="line-1836"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1837"><a id="line-1837" name="line-1837"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">fresh2</span> <span class="o">(</span><span class="n">dom</span> <span class="n">ρ</span><span class="o">))</span> <span class="k">as</span> <span class="o">(</span><span class="n">j1</span> <span class="o">&amp;</span> <span class="n">j2</span> <span class="o">&amp;</span> <span class="n">H1</span> <span class="o">&amp;</span> <span class="n">H2</span> <span class="o">&amp;</span> <span class="n">H3</span><span class="o">).</span>
</span><span id="linespan-1838"><a id="line-1838" name="line-1838"></a>  <span class="k">exists</span> <span class="n">j1</span><span class="o">,</span><span class="n">j2</span><span class="o">.</span> <span class="n">split_and</span><span class="o">!;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span>
</span><span id="linespan-1839"><a id="line-1839" name="line-1839"></a>  <span class="k">apply</span> <span class="n">not_elem_of_dom</span><span class="o">;</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1840"><a id="line-1840" name="line-1840"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1841"><a id="line-1841" name="line-1841"></a>
</span><span id="linespan-1842"><a id="line-1842" name="line-1842"></a><span class="kn">Lemma</span> <span class="n">linv_out_Some</span> <span class="n">i</span> <span class="n">j</span> <span class="n">Σ</span> <span class="n">l</span> <span class="n">ρ</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-1843"><a id="line-1843" name="line-1843"></a>  <span class="n">holds</span> <span class="o">(</span><span class="n">linv</span> <span class="n">ρ</span> <span class="n">j</span> <span class="n">x</span><span class="o">)</span> <span class="n">Σ</span> <span class="o">-&gt;</span>
</span><span id="linespan-1844"><a id="line-1844" name="line-1844"></a>  <span class="n">Σ</span> <span class="o">!!</span> <span class="n">i</span> <span class="bp">≡</span> <span class="n">Some</span> <span class="n">l</span> <span class="o">-&gt;</span>
</span><span id="linespan-1845"><a id="line-1845" name="line-1845"></a>  <span class="o">∃</span> <span class="n">e</span><span class="o">,</span> <span class="n">ρ</span> <span class="o">!!</span> <span class="n">j</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">e</span> <span class="o">∧</span> <span class="n">e</span> <span class="o">≠</span> <span class="n">Barrier</span><span class="o">.</span>
</span><span id="linespan-1846"><a id="line-1846" name="line-1846"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1847"><a id="line-1847" name="line-1847"></a>  <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span>
</span><span id="linespan-1848"><a id="line-1848" name="line-1848"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">!!</span> <span class="n">j</span><span class="o">)</span> <span class="k">as</span> <span class="o">[</span><span class="bp">[]</span><span class="o">|];</span> <span class="k">eauto</span><span class="o">;</span>
</span><span id="linespan-1849"><a id="line-1849" name="line-1849"></a>  <span class="k">rewrite</span> <span class="n">affinely_pure_holds</span><span class="o">;</span>
</span><span id="linespan-1850"><a id="line-1850" name="line-1850"></a>  <span class="k">intros</span> <span class="o">[</span><span class="n">H</span> <span class="o">?]</span> <span class="n">Q</span><span class="o">;</span> <span class="n">specialize</span> <span class="o">(</span><span class="n">H</span> <span class="n">i</span><span class="o">);</span>
</span><span id="linespan-1851"><a id="line-1851" name="line-1851"></a>  <span class="k">rewrite</span> <span class="n">H</span> <span class="n">lookup_empty</span> <span class="k">in</span> <span class="n">Q</span><span class="o">;</span> <span class="n">simplify_eq</span><span class="o">.</span>
</span><span id="linespan-1852"><a id="line-1852" name="line-1852"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1853"><a id="line-1853" name="line-1853"></a>
</span><span id="linespan-1854"><a id="line-1854" name="line-1854"></a><span class="kn">Definition</span> <span class="n">own_dom</span> <span class="n">A</span> <span class="o">:</span> <span class="n">rProp</span> <span class="o">:=</span> <span class="o">∃</span> <span class="n">Σ</span><span class="o">,</span> <span class="bp">⌜⌜</span> <span class="n">A</span> <span class="o">=</span> <span class="n">dom</span> <span class="n">Σ</span> <span class="bp">⌝⌝</span> <span class="bp">∗</span> <span class="n">own</span> <span class="n">Σ</span><span class="o">.</span>
</span><span id="linespan-1855"><a id="line-1855" name="line-1855"></a>
</span><span id="linespan-1856"><a id="line-1856" name="line-1856"></a><span class="kn">Lemma</span> <span class="n">own_dom_empty</span> <span class="o">:</span> <span class="n">own_dom</span> <span class="bp">∅</span> <span class="bp">⊣⊢</span> <span class="n">emp</span><span class="o">.</span>
</span><span id="linespan-1857"><a id="line-1857" name="line-1857"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1858"><a id="line-1858" name="line-1858"></a>  <span class="n">iSplit</span><span class="o">;</span> <span class="k">unfold</span> <span class="n">own_dom</span><span class="o">;</span> <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1859"><a id="line-1859" name="line-1859"></a>  <span class="o">-</span> <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="o">(?</span> <span class="n">H</span><span class="o">)</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1860"><a id="line-1860" name="line-1860"></a>    <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="k">apply</span> <span class="n">dom_empty_iff_L</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-1861"><a id="line-1861" name="line-1861"></a>    <span class="kp">by</span> <span class="n">iApply</span> <span class="n">own_empty</span><span class="o">.</span>
</span><span id="linespan-1862"><a id="line-1862" name="line-1862"></a>  <span class="o">-</span> <span class="n">iExists</span> <span class="bp">∅</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">own_empty</span> <span class="n">dom_empty_L</span> <span class="o">//.</span>
</span><span id="linespan-1863"><a id="line-1863" name="line-1863"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1864"><a id="line-1864" name="line-1864"></a>
</span><span id="linespan-1865"><a id="line-1865" name="line-1865"></a><span class="kn">Lemma</span> <span class="n">own_dom_singleton</span> <span class="n">k</span> <span class="n">v</span> <span class="o">:</span> <span class="n">own</span> <span class="o">{[</span> <span class="n">k</span> <span class="o">:=</span> <span class="n">v</span> <span class="o">]}</span> <span class="bp">⊢</span> <span class="n">own_dom</span> <span class="o">{[</span> <span class="n">k</span> <span class="o">]}.</span>
</span><span id="linespan-1866"><a id="line-1866" name="line-1866"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1867"><a id="line-1867" name="line-1867"></a>  <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iExists</span> <span class="o">{[</span> <span class="n">k</span> <span class="o">:=</span> <span class="n">v</span> <span class="o">]}.</span>
</span><span id="linespan-1868"><a id="line-1868" name="line-1868"></a>  <span class="k">rewrite</span> <span class="n">dom_singleton_L</span><span class="o">.</span> <span class="n">iFrame</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1869"><a id="line-1869" name="line-1869"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1870"><a id="line-1870" name="line-1870"></a>
</span><span id="linespan-1871"><a id="line-1871" name="line-1871"></a><span class="kn">Lemma</span> <span class="n">own_dom_union</span> <span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="n">own_dom</span> <span class="n">A</span> <span class="bp">∗</span> <span class="n">own_dom</span> <span class="n">B</span> <span class="bp">⊢</span> <span class="n">own_dom</span> <span class="o">(</span><span class="n">A</span> <span class="bp">∪</span> <span class="n">B</span><span class="o">).</span>
</span><span id="linespan-1872"><a id="line-1872" name="line-1872"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1873"><a id="line-1873" name="line-1873"></a>  <span class="n">iIntros</span> <span class="s2">"[H1 H2]"</span><span class="o">.</span>
</span><span id="linespan-1874"><a id="line-1874" name="line-1874"></a>  <span class="n">iDestruct</span> <span class="s2">"H1"</span> <span class="k">as</span> <span class="o">(</span><span class="n">Σ1</span> <span class="n">H1</span><span class="o">)</span> <span class="s2">"H1"</span><span class="o">.</span>
</span><span id="linespan-1875"><a id="line-1875" name="line-1875"></a>  <span class="n">iDestruct</span> <span class="s2">"H2"</span> <span class="k">as</span> <span class="o">(</span><span class="n">Σ2</span> <span class="n">H2</span><span class="o">)</span> <span class="s2">"H2"</span><span class="o">.</span> <span class="k">subst</span><span class="o">.</span>
</span><span id="linespan-1876"><a id="line-1876" name="line-1876"></a>  <span class="n">iExists</span> <span class="o">(</span><span class="n">Σ1</span> <span class="bp">∪</span> <span class="n">Σ2</span><span class="o">).</span> <span class="k">rewrite</span> <span class="n">dom_union_L</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1877"><a id="line-1877" name="line-1877"></a>  <span class="n">iApply</span> <span class="n">own_union</span><span class="o">.</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-1878"><a id="line-1878" name="line-1878"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1879"><a id="line-1879" name="line-1879"></a>
</span><span id="linespan-1880"><a id="line-1880" name="line-1880"></a><span class="kn">Lemma</span> <span class="n">own_dom_fin_gset</span> <span class="o">`{</span><span class="n">Countable</span> <span class="n">A</span><span class="o">}</span> <span class="n">n</span> <span class="o">(</span><span class="n">g</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">gset</span> <span class="n">vertex</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-1881"><a id="line-1881" name="line-1881"></a>  <span class="o">([</span><span class="bp">∗</span> <span class="k">set</span><span class="o">]</span> <span class="n">p</span> <span class="bp">∈</span> <span class="n">fin_gset</span> <span class="n">n</span> <span class="n">g</span><span class="o">,</span> <span class="n">own_dom</span> <span class="o">(</span><span class="n">f</span> <span class="n">p</span><span class="o">))</span> <span class="o">-</span><span class="bp">∗</span> <span class="n">own_dom</span> <span class="o">(</span><span class="n">big_union</span> <span class="o">(</span><span class="n">fin_gset</span> <span class="n">n</span> <span class="o">(</span><span class="n">f</span> <span class="bp">∘</span> <span class="n">g</span><span class="o">))).</span>
</span><span id="linespan-1882"><a id="line-1882" name="line-1882"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1883"><a id="line-1883" name="line-1883"></a>  <span class="k">induction</span> <span class="n">n</span><span class="o">.</span>
</span><span id="linespan-1884"><a id="line-1884" name="line-1884"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">fin_gset_0</span> <span class="n">big_union_empty</span> <span class="n">big_sepS_empty</span> <span class="n">own_dom_empty</span> <span class="o">//.</span>
</span><span id="linespan-1885"><a id="line-1885" name="line-1885"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">fin_gset_S</span> <span class="n">big_union_singleton_union</span><span class="o">.</span>
</span><span id="linespan-1886"><a id="line-1886" name="line-1886"></a>    <span class="k">destruct</span> <span class="o">(</span><span class="n">decide</span> <span class="o">(</span><span class="n">g</span> <span class="mi">0</span><span class="o">%</span><span class="n">fin</span> <span class="bp">∈</span> <span class="n">fin_gset</span> <span class="n">n</span> <span class="o">(λ</span> <span class="n">i</span> <span class="o">:</span> <span class="n">fin</span> <span class="n">n</span><span class="o">,</span> <span class="n">g</span> <span class="o">(</span><span class="n">FS</span> <span class="n">i</span><span class="o">)))).</span>
</span><span id="linespan-1887"><a id="line-1887" name="line-1887"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="n">subseteq_union_1_L</span><span class="o">;</span> <span class="kr">last</span> <span class="k">rewrite</span> <span class="n">singleton_subseteq_l</span> <span class="o">//.</span>
</span><span id="linespan-1888"><a id="line-1888" name="line-1888"></a>      <span class="k">rewrite</span> <span class="n">subseteq_union_1_L</span><span class="o">;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="n">IHn</span><span class="o">.</span>
</span><span id="linespan-1889"><a id="line-1889" name="line-1889"></a>      <span class="k">eapply</span> <span class="n">elem_of_fin_gset</span> <span class="k">in</span> <span class="n">e</span><span class="o">.</span>
</span><span id="linespan-1890"><a id="line-1890" name="line-1890"></a>      <span class="k">intros</span> <span class="o">??.</span>
</span><span id="linespan-1891"><a id="line-1891" name="line-1891"></a>      <span class="k">eapply</span> <span class="n">elem_of_big_union</span><span class="o">.</span>
</span><span id="linespan-1892"><a id="line-1892" name="line-1892"></a>      <span class="k">destruct</span> <span class="n">e</span><span class="o">.</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-1893"><a id="line-1893" name="line-1893"></a>      <span class="k">rewrite</span> <span class="o">-</span><span class="n">H1</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span>
</span><span id="linespan-1894"><a id="line-1894" name="line-1894"></a>      <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1895"><a id="line-1895" name="line-1895"></a>      <span class="k">eapply</span> <span class="n">elem_of_fin_gset</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1896"><a id="line-1896" name="line-1896"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="n">big_sepS_insert</span> <span class="o">//.</span>
</span><span id="linespan-1897"><a id="line-1897" name="line-1897"></a>      <span class="n">iIntros</span> <span class="s2">"[H1 H2]"</span><span class="o">.</span>
</span><span id="linespan-1898"><a id="line-1898" name="line-1898"></a>      <span class="n">iDestruct</span> <span class="o">(</span><span class="n">IHn</span> <span class="k">with</span> <span class="s2">"H2"</span><span class="o">)</span> <span class="k">as</span> <span class="s2">"H2"</span><span class="o">.</span>
</span><span id="linespan-1899"><a id="line-1899" name="line-1899"></a>      <span class="n">iApply</span> <span class="n">own_dom_union</span><span class="o">.</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-1900"><a id="line-1900" name="line-1900"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1901"><a id="line-1901" name="line-1901"></a>
</span><span id="linespan-1902"><a id="line-1902" name="line-1902"></a><span class="kn">Lemma</span> <span class="n">own_dom_fin_union</span> <span class="n">n</span> <span class="n">f</span> <span class="o">:</span>
</span><span id="linespan-1903"><a id="line-1903" name="line-1903"></a>  <span class="o">([</span><span class="bp">∗</span> <span class="k">set</span><span class="o">]</span> <span class="n">p</span> <span class="bp">∈</span> <span class="n">all_fin</span> <span class="n">n</span><span class="o">,</span> <span class="n">own_dom</span> <span class="o">(</span><span class="n">f</span> <span class="n">p</span><span class="o">))</span> <span class="bp">⊢</span> <span class="n">own_dom</span> <span class="o">(</span><span class="n">fin_union</span> <span class="n">n</span> <span class="n">f</span><span class="o">).</span>
</span><span id="linespan-1904"><a id="line-1904" name="line-1904"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1905"><a id="line-1905" name="line-1905"></a>  <span class="n">iApply</span> <span class="n">own_dom_fin_gset</span><span class="o">.</span>
</span><span id="linespan-1906"><a id="line-1906" name="line-1906"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1907"><a id="line-1907" name="line-1907"></a>
</span><span id="linespan-1908"><a id="line-1908" name="line-1908"></a><span class="kn">Lemma</span> <span class="n">own_dom_all</span> <span class="o">{</span><span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">gset</span> <span class="n">vertex</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-1909"><a id="line-1909" name="line-1909"></a>  <span class="o">(∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">own_dom</span> <span class="o">(</span><span class="n">f</span> <span class="n">i</span><span class="o">))</span> <span class="bp">⊢</span> <span class="bp">⌜</span> <span class="o">∀</span> <span class="n">i</span> <span class="n">j</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span> <span class="o">=</span> <span class="n">f</span> <span class="n">j</span> <span class="bp">⌝</span><span class="o">.</span>
</span><span id="linespan-1910"><a id="line-1910" name="line-1910"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1911"><a id="line-1911" name="line-1911"></a>  <span class="k">apply</span> <span class="n">entails_holds</span><span class="o">.</span>
</span><span id="linespan-1912"><a id="line-1912" name="line-1912"></a>  <span class="k">intros</span> <span class="n">Σ</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-1913"><a id="line-1913" name="line-1913"></a>  <span class="k">rewrite</span> <span class="n">pure_holds</span><span class="o">.</span> <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-1914"><a id="line-1914" name="line-1914"></a>  <span class="k">rewrite</span> <span class="o">-&gt;</span><span class="n">forall_holds</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-1915"><a id="line-1915" name="line-1915"></a>  <span class="k">assert</span> <span class="o">(∀</span> <span class="n">i</span><span class="o">,</span> <span class="n">f</span> <span class="n">i</span> <span class="o">=</span> <span class="n">dom</span> <span class="n">Σ</span><span class="o">).</span>
</span><span id="linespan-1916"><a id="line-1916" name="line-1916"></a>  <span class="o">{</span> <span class="k">intros</span> <span class="n">k</span><span class="o">.</span> <span class="n">specialize</span> <span class="o">(</span><span class="n">H</span> <span class="n">k</span><span class="o">).</span>
</span><span id="linespan-1917"><a id="line-1917" name="line-1917"></a>    <span class="k">eapply</span> <span class="n">exists_holds</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-1918"><a id="line-1918" name="line-1918"></a>    <span class="k">eapply</span> <span class="n">pure_sep_holds</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-1919"><a id="line-1919" name="line-1919"></a>    <span class="k">eapply</span> <span class="n">own_holds</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span>
</span><span id="linespan-1920"><a id="line-1920" name="line-1920"></a>    <span class="k">rewrite</span> <span class="o">-</span><span class="n">H0</span> <span class="n">H</span> <span class="o">//.</span> <span class="o">}</span>
</span><span id="linespan-1921"><a id="line-1921" name="line-1921"></a>  <span class="k">rewrite</span> <span class="o">!</span><span class="n">H0</span> <span class="o">//.</span>
</span><span id="linespan-1922"><a id="line-1922" name="line-1922"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1923"><a id="line-1923" name="line-1923"></a>
</span><span id="linespan-1924"><a id="line-1924" name="line-1924"></a><span class="kn">Lemma</span> <span class="n">own_dom_and</span> <span class="n">A</span> <span class="n">B</span> <span class="o">:</span>
</span><span id="linespan-1925"><a id="line-1925" name="line-1925"></a>  <span class="n">own_dom</span> <span class="n">A</span> <span class="o">∧</span> <span class="n">own_dom</span> <span class="n">B</span> <span class="bp">⊢</span> <span class="bp">⌜</span> <span class="n">A</span> <span class="o">=</span> <span class="n">B</span> <span class="bp">⌝</span><span class="o">.</span>
</span><span id="linespan-1926"><a id="line-1926" name="line-1926"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1927"><a id="line-1927" name="line-1927"></a>  <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1928"><a id="line-1928" name="line-1928"></a>  <span class="n">iAssert</span> <span class="o">(∀</span> <span class="n">c</span><span class="o">:</span><span class="n">bool</span><span class="o">,</span> <span class="n">own_dom</span> <span class="o">(</span><span class="k">if</span> <span class="n">c</span> <span class="k">then</span> <span class="n">A</span> <span class="k">else</span> <span class="n">B</span><span class="o">))%</span><span class="n">I</span> <span class="k">with</span> <span class="s2">"[H]"</span> <span class="k">as</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1929"><a id="line-1929" name="line-1929"></a>  <span class="o">{</span> <span class="n">iIntros</span> <span class="o">(</span><span class="bp">[]</span><span class="o">).</span>
</span><span id="linespan-1930"><a id="line-1930" name="line-1930"></a>    <span class="o">-</span> <span class="kp">by</span> <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="s2">"[H _]"</span><span class="o">.</span>
</span><span id="linespan-1931"><a id="line-1931" name="line-1931"></a>    <span class="o">-</span> <span class="kp">by</span> <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="s2">"[_ H]"</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-1932"><a id="line-1932" name="line-1932"></a>  <span class="n">iDestruct</span> <span class="o">(</span><span class="n">own_dom_all</span> <span class="k">with</span> <span class="s2">"H"</span><span class="o">)</span> <span class="k">as</span> <span class="o">%</span><span class="n">Q</span><span class="o">.</span>
</span><span id="linespan-1933"><a id="line-1933" name="line-1933"></a>  <span class="n">specialize</span> <span class="o">(</span><span class="n">Q</span> <span class="bp">true</span> <span class="bp">false</span><span class="o">).</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1934"><a id="line-1934" name="line-1934"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1935"><a id="line-1935" name="line-1935"></a>
</span><span id="linespan-1936"><a id="line-1936" name="line-1936"></a><span class="kn">Lemma</span> <span class="n">fin_union_same</span> <span class="o">`{</span><span class="n">Countable</span> <span class="n">A</span><span class="o">}</span> <span class="n">n</span> <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">gset</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-1937"><a id="line-1937" name="line-1937"></a>  <span class="n">fin_union</span> <span class="o">(</span><span class="n">S</span> <span class="n">n</span><span class="o">)</span> <span class="o">(λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">s</span><span class="o">)</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span>
</span><span id="linespan-1938"><a id="line-1938" name="line-1938"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1939"><a id="line-1939" name="line-1939"></a>  <span class="k">induction</span> <span class="n">n</span><span class="o">.</span>
</span><span id="linespan-1940"><a id="line-1940" name="line-1940"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">fin_union_S</span> <span class="n">fin_union_0</span> <span class="n">right_id_L</span> <span class="o">//.</span>
</span><span id="linespan-1941"><a id="line-1941" name="line-1941"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">fin_union_S</span> <span class="n">IHn</span> <span class="n">union_idemp_L</span> <span class="o">//.</span>
</span><span id="linespan-1942"><a id="line-1942" name="line-1942"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1943"><a id="line-1943" name="line-1943"></a>
</span><span id="linespan-1944"><a id="line-1944" name="line-1944"></a><span class="kn">Lemma</span> <span class="n">rtyped_refs</span> <span class="n">Γ</span> <span class="n">e</span> <span class="n">t</span> <span class="o">:</span>
</span><span id="linespan-1945"><a id="line-1945" name="line-1945"></a>  <span class="n">rtyped</span> <span class="n">Γ</span> <span class="n">e</span> <span class="n">t</span> <span class="bp">⊢</span> <span class="n">own_dom</span> <span class="o">(</span><span class="n">expr_refs</span> <span class="n">e</span><span class="o">)</span>
</span><span id="linespan-1946"><a id="line-1946" name="line-1946"></a><span class="k">with</span> <span class="n">val_typed_refs</span> <span class="n">v</span> <span class="n">t</span> <span class="o">:</span>
</span><span id="linespan-1947"><a id="line-1947" name="line-1947"></a>  <span class="n">vtyped</span> <span class="n">v</span> <span class="n">t</span> <span class="bp">⊢</span> <span class="n">own_dom</span> <span class="o">(</span><span class="n">val_refs</span> <span class="n">v</span><span class="o">).</span>
</span><span id="linespan-1948"><a id="line-1948" name="line-1948"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1949"><a id="line-1949" name="line-1949"></a>  <span class="o">-</span> <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">e</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="kr">repeat</span> <span class="o">(</span><span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="o">(?)</span> <span class="s2">"H"</span><span class="o">);</span> <span class="kr">try</span> <span class="k">destruct</span> <span class="n">l</span><span class="o">;</span>
</span><span id="linespan-1950"><a id="line-1950" name="line-1950"></a>    <span class="k">rewrite</span> <span class="o">?</span><span class="n">val_typed_refs</span> <span class="o">?</span><span class="n">rtyped_refs</span> <span class="o">?</span><span class="n">own_dom_empty</span> <span class="o">?</span><span class="n">own_dom_union</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-1951"><a id="line-1951" name="line-1951"></a>    <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="s2">"[H1 H]"</span><span class="o">.</span> <span class="n">iApply</span> <span class="n">own_dom_union</span><span class="o">;</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-1952"><a id="line-1952" name="line-1952"></a>    <span class="n">case_decide</span><span class="o">;</span> <span class="k">subst</span><span class="o">.</span> <span class="o">{</span> <span class="k">rewrite</span> <span class="n">fin_union_0</span> <span class="n">own_dom_empty</span> <span class="o">//.</span> <span class="o">}</span>
</span><span id="linespan-1953"><a id="line-1953" name="line-1953"></a>    <span class="k">setoid_rewrite</span> <span class="n">rtyped_refs</span><span class="o">.</span>
</span><span id="linespan-1954"><a id="line-1954" name="line-1954"></a>    <span class="n">iDestruct</span> <span class="o">(</span><span class="n">own_dom_all</span> <span class="k">with</span> <span class="s2">"H"</span><span class="o">)</span> <span class="k">as</span> <span class="o">%</span><span class="n">Q</span><span class="o">.</span>
</span><span id="linespan-1955"><a id="line-1955" name="line-1955"></a>    <span class="k">destruct</span> <span class="n">n</span><span class="o">;</span> <span class="n">simplify_eq</span><span class="o">.</span>
</span><span id="linespan-1956"><a id="line-1956" name="line-1956"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">expr_refs</span> <span class="bp">∘</span> <span class="n">e0</span> <span class="o">=</span> <span class="o">λ</span> <span class="n">i</span><span class="o">,</span> <span class="n">expr_refs</span> <span class="o">(</span><span class="n">e0</span> <span class="mi">0</span><span class="o">%</span><span class="n">fin</span><span class="o">))</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-1957"><a id="line-1957" name="line-1957"></a>    <span class="o">{</span> <span class="k">apply</span> <span class="n">functional_extensionality</span><span class="o">.</span> <span class="k">intros</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">Q</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-1958"><a id="line-1958" name="line-1958"></a>    <span class="k">rewrite</span> <span class="n">fin_union_same</span><span class="o">.</span> <span class="n">iApply</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-1959"><a id="line-1959" name="line-1959"></a>  <span class="o">-</span> <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">v</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">rewrite</span> <span class="o">?</span><span class="n">own_dom_empty</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span>
</span><span id="linespan-1960"><a id="line-1960" name="line-1960"></a>    <span class="kr">repeat</span> <span class="o">(</span><span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="o">(?)</span> <span class="s2">"H"</span><span class="o">);</span> <span class="kr">try</span> <span class="k">destruct</span> <span class="n">l</span><span class="o">;</span>
</span><span id="linespan-1961"><a id="line-1961" name="line-1961"></a>    <span class="k">rewrite</span> <span class="o">?</span><span class="n">val_typed_refs</span> <span class="o">?</span><span class="n">rtyped_refs</span> <span class="o">?</span><span class="n">own_dom_union</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span>
</span><span id="linespan-1962"><a id="line-1962" name="line-1962"></a>    <span class="kp">by</span> <span class="n">iApply</span> <span class="n">own_dom_singleton</span><span class="o">.</span>
</span><span id="linespan-1963"><a id="line-1963" name="line-1963"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1964"><a id="line-1964" name="line-1964"></a>
</span><span id="linespan-1965"><a id="line-1965" name="line-1965"></a><span class="kn">Lemma</span> <span class="n">expr_refs_linv</span> <span class="n">ρ</span> <span class="n">j</span> <span class="n">e</span> <span class="n">x</span> <span class="n">Σ</span> <span class="o">:</span>
</span><span id="linespan-1966"><a id="line-1966" name="line-1966"></a>  <span class="n">ρ</span> <span class="o">!!</span> <span class="n">j</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">Thread</span> <span class="n">e</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-1967"><a id="line-1967" name="line-1967"></a>  <span class="n">holds</span> <span class="o">(</span><span class="n">linv</span> <span class="n">ρ</span> <span class="n">j</span> <span class="n">x</span><span class="o">)</span> <span class="n">Σ</span> <span class="o">-&gt;</span>
</span><span id="linespan-1968"><a id="line-1968" name="line-1968"></a>  <span class="n">expr_refs</span> <span class="n">e</span> <span class="o">=</span> <span class="n">dom</span> <span class="n">Σ</span><span class="o">.</span>
</span><span id="linespan-1969"><a id="line-1969" name="line-1969"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1970"><a id="line-1970" name="line-1970"></a>  <span class="k">intros</span> <span class="n">H1</span> <span class="n">H2</span><span class="o">.</span>
</span><span id="linespan-1971"><a id="line-1971" name="line-1971"></a>  <span class="k">unfold</span> <span class="n">linv</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-1972"><a id="line-1972" name="line-1972"></a>  <span class="k">rewrite</span> <span class="n">H1</span> <span class="k">in</span> <span class="n">H2</span><span class="o">.</span>
</span><span id="linespan-1973"><a id="line-1973" name="line-1973"></a>  <span class="k">eapply</span> <span class="n">pure_sep_holds</span> <span class="k">in</span> <span class="n">H2</span> <span class="k">as</span> <span class="o">[_</span> <span class="n">H2</span><span class="o">].</span>
</span><span id="linespan-1974"><a id="line-1974" name="line-1974"></a>  <span class="k">rewrite</span> <span class="o">-</span><span class="n">rtyped_rtyped0</span> <span class="k">in</span> <span class="n">H2</span><span class="o">.</span>
</span><span id="linespan-1975"><a id="line-1975" name="line-1975"></a>  <span class="k">eapply</span> <span class="n">holds_entails</span> <span class="k">in</span> <span class="n">H2</span><span class="o">;</span> <span class="kr">last</span> <span class="k">eapply</span> <span class="n">rtyped_refs</span><span class="o">.</span>
</span><span id="linespan-1976"><a id="line-1976" name="line-1976"></a>  <span class="k">unfold</span> <span class="n">own_dom</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-1977"><a id="line-1977" name="line-1977"></a>  <span class="k">eapply</span> <span class="n">exists_holds</span> <span class="k">in</span> <span class="n">H2</span> <span class="k">as</span> <span class="o">[</span><span class="n">Σ'</span> <span class="n">H2</span><span class="o">].</span>
</span><span id="linespan-1978"><a id="line-1978" name="line-1978"></a>  <span class="k">eapply</span> <span class="n">pure_sep_holds</span> <span class="k">in</span> <span class="n">H2</span> <span class="k">as</span> <span class="o">[-&gt;</span> <span class="n">H2</span><span class="o">].</span>
</span><span id="linespan-1979"><a id="line-1979" name="line-1979"></a>  <span class="k">eapply</span> <span class="n">own_holds</span> <span class="k">in</span> <span class="n">H2</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">H2</span> <span class="o">//.</span>
</span><span id="linespan-1980"><a id="line-1980" name="line-1980"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1981"><a id="line-1981" name="line-1981"></a>
</span><span id="linespan-1982"><a id="line-1982" name="line-1982"></a><span class="kn">Lemma</span> <span class="n">own_dom_same</span> <span class="n">A</span> <span class="n">B</span> <span class="o">:</span>
</span><span id="linespan-1983"><a id="line-1983" name="line-1983"></a>  <span class="n">holds</span> <span class="o">(</span><span class="n">own_dom</span> <span class="n">A</span><span class="o">)</span> <span class="n">B</span> <span class="o">-&gt;</span> <span class="n">A</span> <span class="o">=</span> <span class="n">dom</span> <span class="n">B</span><span class="o">.</span>
</span><span id="linespan-1984"><a id="line-1984" name="line-1984"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1985"><a id="line-1985" name="line-1985"></a>  <span class="k">intros</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-1986"><a id="line-1986" name="line-1986"></a>  <span class="k">unfold</span> <span class="n">own_dom</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-1987"><a id="line-1987" name="line-1987"></a>  <span class="k">eapply</span> <span class="n">exists_holds</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="o">[</span><span class="n">Σ</span> <span class="n">H</span><span class="o">].</span>
</span><span id="linespan-1988"><a id="line-1988" name="line-1988"></a>  <span class="k">eapply</span> <span class="n">pure_sep_holds</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="o">[-&gt;</span> <span class="n">H</span><span class="o">].</span>
</span><span id="linespan-1989"><a id="line-1989" name="line-1989"></a>  <span class="k">eapply</span> <span class="n">own_holds</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-1990"><a id="line-1990" name="line-1990"></a>  <span class="k">rewrite</span> <span class="n">H</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-1991"><a id="line-1991" name="line-1991"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-1992"><a id="line-1992" name="line-1992"></a>
</span><span id="linespan-1993"><a id="line-1993" name="line-1993"></a><span class="kn">Lemma</span> <span class="n">big_sepM2_own_dom</span> <span class="o">`{</span><span class="n">Countable</span> <span class="n">K</span><span class="o">}</span> <span class="o">{</span><span class="n">V1</span> <span class="n">V2</span><span class="o">}</span> <span class="o">(</span><span class="n">m1</span> <span class="o">:</span> <span class="n">gmap</span> <span class="n">K</span> <span class="n">V1</span><span class="o">)</span> <span class="o">(</span><span class="n">m2</span> <span class="o">:</span> <span class="n">gmap</span> <span class="n">K</span> <span class="n">V2</span><span class="o">)</span> <span class="n">f</span> <span class="o">:</span>
</span><span id="linespan-1994"><a id="line-1994" name="line-1994"></a>  <span class="o">([</span><span class="bp">∗</span> <span class="n">map</span><span class="o">]</span> <span class="n">x</span><span class="o">;</span><span class="n">y</span> <span class="bp">∈</span> <span class="n">m1</span><span class="o">;</span><span class="n">m2</span><span class="o">,</span> <span class="n">own_dom</span> <span class="o">(</span><span class="n">f</span> <span class="n">x</span><span class="o">))</span> <span class="bp">⊢</span> <span class="n">own_dom</span> <span class="o">(</span><span class="n">gmap_union</span> <span class="n">f</span> <span class="n">m1</span><span class="o">).</span>
</span><span id="linespan-1995"><a id="line-1995" name="line-1995"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-1996"><a id="line-1996" name="line-1996"></a>  <span class="k">unfold</span> <span class="n">gmap_union</span><span class="o">.</span>
</span><span id="linespan-1997"><a id="line-1997" name="line-1997"></a>  <span class="k">revert</span> <span class="n">m2</span><span class="o">.</span>
</span><span id="linespan-1998"><a id="line-1998" name="line-1998"></a>  <span class="k">induction</span> <span class="n">m1</span> <span class="k">using</span> <span class="n">map_ind</span><span class="o">;</span> <span class="k">intros</span> <span class="n">m2</span><span class="o">.</span>
</span><span id="linespan-1999"><a id="line-1999" name="line-1999"></a>  <span class="o">{</span> <span class="k">rewrite</span> <span class="n">map_fold_empty</span><span class="o">.</span>
</span><span id="linespan-2000"><a id="line-2000" name="line-2000"></a>    <span class="k">rewrite</span> <span class="n">own_dom_empty</span><span class="o">.</span>
</span><span id="linespan-2001"><a id="line-2001" name="line-2001"></a>    <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-2002"><a id="line-2002" name="line-2002"></a>    <span class="k">destruct</span> <span class="o">(</span><span class="n">decide</span> <span class="o">(</span><span class="n">m2</span> <span class="o">=</span> <span class="bp">∅</span><span class="o">)).</span>
</span><span id="linespan-2003"><a id="line-2003" name="line-2003"></a>    <span class="o">-</span> <span class="k">subst</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">big_sepM2_empty</span> <span class="o">//.</span>
</span><span id="linespan-2004"><a id="line-2004" name="line-2004"></a>    <span class="o">-</span> <span class="n">iExFalso</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">big_sepM2_empty_r</span><span class="o">.</span> <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="o">%</span><span class="n">Q</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2005"><a id="line-2005" name="line-2005"></a>  <span class="k">rewrite</span> <span class="n">map_fold_insert</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span> <span class="kr">last</span> <span class="kr">first</span><span class="o">.</span>
</span><span id="linespan-2006"><a id="line-2006" name="line-2006"></a>  <span class="o">{</span> <span class="n">smap</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">-!</span><span class="n">assoc_L</span><span class="o">.</span> <span class="n">f_equal</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">comm_L</span> <span class="o">//.</span> <span class="o">}</span>
</span><span id="linespan-2007"><a id="line-2007" name="line-2007"></a>  <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-2008"><a id="line-2008" name="line-2008"></a>  <span class="k">rewrite</span> <span class="n">big_sepM2_delete_l</span><span class="o">;</span> <span class="kr">last</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-2009"><a id="line-2009" name="line-2009"></a>  <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="s2">"[H1 H2]"</span><span class="o">.</span>
</span><span id="linespan-2010"><a id="line-2010" name="line-2010"></a>  <span class="k">rewrite</span> <span class="n">delete_insert</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2011"><a id="line-2011" name="line-2011"></a>  <span class="k">rewrite</span> <span class="o">-</span><span class="n">own_dom_union</span><span class="o">.</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-2012"><a id="line-2012" name="line-2012"></a>  <span class="n">iApply</span> <span class="n">IHm1</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2013"><a id="line-2013" name="line-2013"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2014"><a id="line-2014" name="line-2014"></a>
</span><span id="linespan-2015"><a id="line-2015" name="line-2015"></a><span class="kn">Lemma</span> <span class="n">obj_refs_linv</span> <span class="n">ρ</span> <span class="n">i</span> <span class="n">x</span> <span class="n">Δ</span> <span class="n">Σ</span> <span class="o">:</span>
</span><span id="linespan-2016"><a id="line-2016" name="line-2016"></a>  <span class="n">ρ</span> <span class="o">!!</span> <span class="n">i</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-2017"><a id="line-2017" name="line-2017"></a>  <span class="n">holds</span> <span class="o">(</span><span class="n">linv</span> <span class="n">ρ</span> <span class="n">i</span> <span class="n">Δ</span><span class="o">)</span> <span class="n">Σ</span> <span class="o">-&gt;</span> <span class="n">obj_refs</span> <span class="n">x</span> <span class="o">=</span> <span class="n">dom</span> <span class="n">Σ</span><span class="o">.</span>
</span><span id="linespan-2018"><a id="line-2018" name="line-2018"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2019"><a id="line-2019" name="line-2019"></a>  <span class="k">intros</span> <span class="n">Hi</span> <span class="n">Hinv</span><span class="o">.</span>
</span><span id="linespan-2020"><a id="line-2020" name="line-2020"></a>  <span class="k">unfold</span> <span class="n">obj_refs</span><span class="o">.</span>
</span><span id="linespan-2021"><a id="line-2021" name="line-2021"></a>  <span class="k">unfold</span> <span class="n">linv</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-2022"><a id="line-2022" name="line-2022"></a>  <span class="k">rewrite</span> <span class="n">Hi</span> <span class="k">in</span> <span class="n">Hinv</span><span class="o">.</span> <span class="k">clear</span> <span class="n">Hi</span><span class="o">.</span>
</span><span id="linespan-2023"><a id="line-2023" name="line-2023"></a>  <span class="k">destruct</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-2024"><a id="line-2024" name="line-2024"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">pure_sep_holds</span> <span class="k">in</span> <span class="n">Hinv</span> <span class="k">as</span> <span class="o">[_</span> <span class="n">Hinv</span><span class="o">].</span>
</span><span id="linespan-2025"><a id="line-2025" name="line-2025"></a>    <span class="k">rewrite</span> <span class="o">-</span><span class="n">rtyped_rtyped0</span> <span class="k">in</span> <span class="n">Hinv</span><span class="o">.</span>
</span><span id="linespan-2026"><a id="line-2026" name="line-2026"></a>    <span class="k">eapply</span> <span class="n">holds_entails</span> <span class="k">in</span> <span class="n">Hinv</span><span class="o">;</span> <span class="kr">last</span> <span class="k">apply</span> <span class="n">rtyped_refs</span><span class="o">.</span>
</span><span id="linespan-2027"><a id="line-2027" name="line-2027"></a>    <span class="k">eapply</span> <span class="n">own_dom_same</span> <span class="k">in</span> <span class="n">Hinv</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2028"><a id="line-2028" name="line-2028"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">affinely_pure_holds</span> <span class="k">in</span> <span class="n">Hinv</span> <span class="k">as</span> <span class="o">[</span><span class="n">t1</span> <span class="n">H</span><span class="o">].</span>
</span><span id="linespan-2029"><a id="line-2029" name="line-2029"></a>    <span class="n">simp</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">dom_empty_L</span> <span class="o">//.</span>
</span><span id="linespan-2030"><a id="line-2030" name="line-2030"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">exists_holds</span> <span class="k">in</span> <span class="n">Hinv</span> <span class="k">as</span> <span class="o">[</span><span class="n">t</span> <span class="n">H</span><span class="o">].</span>
</span><span id="linespan-2031"><a id="line-2031" name="line-2031"></a>    <span class="k">eapply</span> <span class="n">pure_sep_holds</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="o">[_</span> <span class="n">H</span><span class="o">].</span>
</span><span id="linespan-2032"><a id="line-2032" name="line-2032"></a>    <span class="k">eapply</span> <span class="n">own_dom_same</span><span class="o">.</span>
</span><span id="linespan-2033"><a id="line-2033" name="line-2033"></a>    <span class="k">eapply</span> <span class="n">holds_entails</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2034"><a id="line-2034" name="line-2034"></a>    <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-2035"><a id="line-2035" name="line-2035"></a>    <span class="n">iApply</span> <span class="n">big_sepM2_own_dom</span><span class="o">.</span>
</span><span id="linespan-2036"><a id="line-2036" name="line-2036"></a>    <span class="n">iApply</span> <span class="o">(</span><span class="n">big_sepM2_impl</span> <span class="k">with</span> <span class="s2">"H"</span><span class="o">).</span>
</span><span id="linespan-2037"><a id="line-2037" name="line-2037"></a>    <span class="n">iModIntro</span><span class="o">.</span> <span class="n">iIntros</span> <span class="o">(?????)</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-2038"><a id="line-2038" name="line-2038"></a>    <span class="k">destruct</span> <span class="n">x1</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">o</span><span class="o">;</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-2039"><a id="line-2039" name="line-2039"></a>    <span class="o">+</span> <span class="n">iApply</span> <span class="n">val_typed_refs</span><span class="o">;</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2040"><a id="line-2040" name="line-2040"></a>    <span class="o">+</span> <span class="n">iApply</span> <span class="n">own_dom_empty</span><span class="o">;</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2041"><a id="line-2041" name="line-2041"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2042"><a id="line-2042" name="line-2042"></a>
</span><span id="linespan-2043"><a id="line-2043" name="line-2043"></a><span class="kn">Definition</span> <span class="n">blocked</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">:</span> <span class="n">cfg</span><span class="o">)</span> <span class="n">i</span> <span class="n">j</span> <span class="o">:=</span>
</span><span id="linespan-2044"><a id="line-2044" name="line-2044"></a>  <span class="o">∃</span> <span class="n">e</span><span class="o">,</span> <span class="n">ρ</span> <span class="o">!!</span> <span class="n">i</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">Thread</span> <span class="n">e</span><span class="o">)</span> <span class="o">∧</span> <span class="n">expr_waiting</span> <span class="n">e</span> <span class="n">j</span><span class="o">.</span>
</span><span id="linespan-2045"><a id="line-2045" name="line-2045"></a>
</span><span id="linespan-2046"><a id="line-2046" name="line-2046"></a><span class="kn">Lemma</span> <span class="n">out_edge_active</span> <span class="n">Σ</span> <span class="n">v</span> <span class="n">v'</span> <span class="n">a</span> <span class="n">ρ</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2047"><a id="line-2047" name="line-2047"></a>  <span class="n">Σ</span> <span class="o">!!</span> <span class="n">v'</span> <span class="bp">≡</span> <span class="n">Some</span> <span class="n">a</span> <span class="o">-&gt;</span>
</span><span id="linespan-2048"><a id="line-2048" name="line-2048"></a>  <span class="n">holds</span> <span class="o">(</span><span class="n">linv</span> <span class="n">ρ</span> <span class="n">v</span> <span class="n">x</span><span class="o">)</span> <span class="n">Σ</span> <span class="o">-&gt;</span>
</span><span id="linespan-2049"><a id="line-2049" name="line-2049"></a>  <span class="n">inactive</span> <span class="n">ρ</span> <span class="n">v</span> <span class="o">-&gt;</span> <span class="n">False</span><span class="o">.</span>
</span><span id="linespan-2050"><a id="line-2050" name="line-2050"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2051"><a id="line-2051" name="line-2051"></a>  <span class="k">intros</span> <span class="n">Hedge</span> <span class="n">Hinv</span> <span class="n">Hina</span><span class="o">.</span>
</span><span id="linespan-2052"><a id="line-2052" name="line-2052"></a>  <span class="k">unfold</span> <span class="n">inactive</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-2053"><a id="line-2053" name="line-2053"></a>  <span class="k">unfold</span> <span class="n">linv</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-2054"><a id="line-2054" name="line-2054"></a>  <span class="k">rewrite</span> <span class="n">Hina</span> <span class="k">in</span> <span class="n">Hinv</span><span class="o">.</span>
</span><span id="linespan-2055"><a id="line-2055" name="line-2055"></a>  <span class="k">eapply</span> <span class="n">affinely_pure_holds</span> <span class="k">in</span> <span class="n">Hinv</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-2056"><a id="line-2056" name="line-2056"></a>  <span class="k">rewrite</span> <span class="n">H</span> <span class="k">in</span> <span class="n">Hedge</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2057"><a id="line-2057" name="line-2057"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2058"><a id="line-2058" name="line-2058"></a>
</span><span id="linespan-2059"><a id="line-2059" name="line-2059"></a><span class="kn">Lemma</span> <span class="n">rewrite_with_del</span> <span class="o">`{</span><span class="n">Countable</span> <span class="n">K</span><span class="o">}</span> <span class="o">{</span><span class="n">V</span><span class="o">}</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">:</span> <span class="n">gmap</span> <span class="n">K</span> <span class="n">V</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">K</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">V</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-2060"><a id="line-2060" name="line-2060"></a>  <span class="n">ρ</span> <span class="o">!!</span> <span class="n">i</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-2061"><a id="line-2061" name="line-2061"></a>  <span class="n">ρ</span> <span class="o">=</span> <span class="o">{[</span> <span class="n">i</span> <span class="o">:=</span> <span class="n">x</span> <span class="o">]}</span> <span class="bp">∪</span> <span class="n">delete</span> <span class="n">i</span> <span class="n">ρ</span><span class="o">.</span>
</span><span id="linespan-2062"><a id="line-2062" name="line-2062"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2063"><a id="line-2063" name="line-2063"></a>  <span class="k">intros</span><span class="o">.</span> <span class="k">apply</span> <span class="n">map_eq</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-2064"><a id="line-2064" name="line-2064"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2065"><a id="line-2065" name="line-2065"></a>
</span><span id="linespan-2066"><a id="line-2066" name="line-2066"></a><span class="kn">Lemma</span> <span class="n">label_unique</span> <span class="o">`{</span><span class="n">Countable</span> <span class="n">K</span><span class="o">}</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">Σ</span> <span class="o">:</span> <span class="n">gmap</span> <span class="n">K</span> <span class="n">V</span><span class="o">)</span> <span class="n">j</span> <span class="n">l1</span> <span class="o">:</span>
</span><span id="linespan-2067"><a id="line-2067" name="line-2067"></a>  <span class="n">Σ</span> <span class="o">!!</span> <span class="n">j</span> <span class="bp">≡</span> <span class="n">Some</span> <span class="n">l1</span> <span class="o">-&gt;</span>
</span><span id="linespan-2068"><a id="line-2068" name="line-2068"></a>  <span class="n">holds</span> <span class="o">(∃</span> <span class="n">l2</span><span class="o">,</span> <span class="n">own_out</span> <span class="n">j</span> <span class="n">l2</span> <span class="bp">∗</span> <span class="bp">⌜</span> <span class="n">l1</span> <span class="bp">≢</span> <span class="n">l2</span> <span class="bp">⌝</span><span class="o">)</span> <span class="n">Σ</span> <span class="o">-&gt;</span>
</span><span id="linespan-2069"><a id="line-2069" name="line-2069"></a>  <span class="n">False</span><span class="o">.</span>
</span><span id="linespan-2070"><a id="line-2070" name="line-2070"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2071"><a id="line-2071" name="line-2071"></a>  <span class="k">intros</span> <span class="n">H1</span> <span class="n">H2</span><span class="o">.</span>
</span><span id="linespan-2072"><a id="line-2072" name="line-2072"></a>  <span class="k">eapply</span> <span class="n">exists_holds</span> <span class="k">in</span> <span class="n">H2</span> <span class="k">as</span> <span class="o">[</span><span class="n">l2</span> <span class="n">H2</span><span class="o">].</span>
</span><span id="linespan-2073"><a id="line-2073" name="line-2073"></a>  <span class="k">eapply</span> <span class="n">sep_holds</span> <span class="k">in</span> <span class="n">H2</span> <span class="k">as</span> <span class="o">(</span><span class="n">Σ1</span> <span class="o">&amp;</span> <span class="n">Σ2</span> <span class="o">&amp;</span> <span class="n">HΣ</span> <span class="o">&amp;</span> <span class="n">Hdisj</span> <span class="o">&amp;</span> <span class="n">Q1</span> <span class="o">&amp;</span> <span class="n">Q2</span><span class="o">).</span>
</span><span id="linespan-2074"><a id="line-2074" name="line-2074"></a>  <span class="k">unfold</span> <span class="n">own_out</span> <span class="k">in</span> <span class="n">Q1</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">own_holds</span> <span class="k">in</span> <span class="n">Q1</span><span class="o">.</span>
</span><span id="linespan-2075"><a id="line-2075" name="line-2075"></a>  <span class="k">rewrite</span> <span class="n">pure_holds</span> <span class="k">in</span> <span class="n">Q2</span><span class="o">.</span>
</span><span id="linespan-2076"><a id="line-2076" name="line-2076"></a>  <span class="k">eapply</span> <span class="n">Q2</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">-</span><span class="n">Q1</span> <span class="k">in</span> <span class="n">HΣ</span><span class="o">.</span>
</span><span id="linespan-2077"><a id="line-2077" name="line-2077"></a>  <span class="k">rewrite</span> <span class="n">HΣ</span> <span class="k">in</span> <span class="n">H1</span><span class="o">.</span> <span class="k">revert</span> <span class="n">H1</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="n">inv</span> <span class="n">H1</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2078"><a id="line-2078" name="line-2078"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2079"><a id="line-2079" name="line-2079"></a>
</span><span id="linespan-2080"><a id="line-2080" name="line-2080"></a><span class="kn">Lemma</span> <span class="n">label_unique'</span> <span class="o">`{</span><span class="n">Countable</span> <span class="n">K</span><span class="o">}</span> <span class="o">{</span><span class="n">V</span> <span class="o">:</span> <span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">Σ</span> <span class="o">:</span> <span class="n">gmap</span> <span class="n">K</span> <span class="n">V</span><span class="o">)</span> <span class="n">j</span> <span class="n">l1</span> <span class="o">(</span><span class="n">φ</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-2081"><a id="line-2081" name="line-2081"></a>  <span class="n">Σ</span> <span class="o">!!</span> <span class="n">j</span> <span class="bp">≡</span> <span class="n">Some</span> <span class="n">l1</span> <span class="o">-&gt;</span>
</span><span id="linespan-2082"><a id="line-2082" name="line-2082"></a>  <span class="n">holds</span> <span class="o">(∃</span> <span class="n">l2</span><span class="o">,</span> <span class="n">own_out</span> <span class="n">j</span> <span class="n">l2</span> <span class="bp">∗</span> <span class="bp">⌜</span> <span class="n">l1</span> <span class="bp">≡</span> <span class="n">l2</span> <span class="o">-&gt;</span> <span class="n">φ</span> <span class="bp">⌝</span><span class="o">)</span> <span class="n">Σ</span> <span class="o">-&gt;</span>
</span><span id="linespan-2083"><a id="line-2083" name="line-2083"></a>  <span class="n">φ</span><span class="o">.</span>
</span><span id="linespan-2084"><a id="line-2084" name="line-2084"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2085"><a id="line-2085" name="line-2085"></a>  <span class="k">intros</span> <span class="n">H1</span> <span class="n">H2</span><span class="o">.</span>
</span><span id="linespan-2086"><a id="line-2086" name="line-2086"></a>  <span class="k">eapply</span> <span class="n">exists_holds</span> <span class="k">in</span> <span class="n">H2</span> <span class="k">as</span> <span class="o">[</span><span class="n">l2</span> <span class="n">H2</span><span class="o">].</span>
</span><span id="linespan-2087"><a id="line-2087" name="line-2087"></a>  <span class="k">eapply</span> <span class="n">sep_holds</span> <span class="k">in</span> <span class="n">H2</span> <span class="k">as</span> <span class="o">(</span><span class="n">Σ1</span> <span class="o">&amp;</span> <span class="n">Σ2</span> <span class="o">&amp;</span> <span class="n">HΣ</span> <span class="o">&amp;</span> <span class="n">Hdisj</span> <span class="o">&amp;</span> <span class="n">Q1</span> <span class="o">&amp;</span> <span class="n">Q2</span><span class="o">).</span>
</span><span id="linespan-2088"><a id="line-2088" name="line-2088"></a>  <span class="k">unfold</span> <span class="n">own_out</span> <span class="k">in</span> <span class="n">Q1</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">own_holds</span> <span class="k">in</span> <span class="n">Q1</span><span class="o">.</span>
</span><span id="linespan-2089"><a id="line-2089" name="line-2089"></a>  <span class="k">rewrite</span> <span class="n">pure_holds</span> <span class="k">in</span> <span class="n">Q2</span><span class="o">.</span>
</span><span id="linespan-2090"><a id="line-2090" name="line-2090"></a>  <span class="k">eapply</span> <span class="n">Q2</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">-</span><span class="n">Q1</span> <span class="k">in</span> <span class="n">HΣ</span><span class="o">.</span>
</span><span id="linespan-2091"><a id="line-2091" name="line-2091"></a>  <span class="k">rewrite</span> <span class="n">HΣ</span> <span class="k">in</span> <span class="n">H1</span><span class="o">.</span> <span class="k">revert</span> <span class="n">H1</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="n">inv</span> <span class="n">H1</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2092"><a id="line-2092" name="line-2092"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2093"><a id="line-2093" name="line-2093"></a>
</span><span id="linespan-2094"><a id="line-2094" name="line-2094"></a><span class="kn">Fixpoint</span> <span class="n">acquire_progress</span> <span class="o">(</span><span class="n">lcks</span> <span class="o">:</span> <span class="n">locksbundle</span><span class="o">)</span> <span class="o">(</span><span class="n">ls</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">vertex</span> <span class="o">*</span> <span class="o">(</span><span class="n">lockcap</span> <span class="o">*</span> <span class="n">type</span><span class="o">)))</span> <span class="o">:=</span>
</span><span id="linespan-2095"><a id="line-2095" name="line-2095"></a>  <span class="k">match</span> <span class="n">ls</span> <span class="k">with</span>
</span><span id="linespan-2096"><a id="line-2096" name="line-2096"></a>  <span class="o">|</span> <span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="o">((</span><span class="n">lo</span><span class="o">,</span> <span class="n">Closed</span><span class="o">),</span> <span class="n">t</span><span class="o">))::</span><span class="n">ls'</span> <span class="o">=&gt;</span>
</span><span id="linespan-2097"><a id="line-2097" name="line-2097"></a>      <span class="n">acquire_progress</span> <span class="n">lcks</span> <span class="n">ls'</span> <span class="o">∧</span>
</span><span id="linespan-2098"><a id="line-2098" name="line-2098"></a>      <span class="o">∃</span> <span class="n">refcnt</span> <span class="n">v</span><span class="o">,</span> <span class="n">lcks</span> <span class="o">!!</span> <span class="n">n</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">refcnt</span><span class="o">,</span> <span class="n">Some</span> <span class="n">v</span><span class="o">)</span>
</span><span id="linespan-2099"><a id="line-2099" name="line-2099"></a>  <span class="o">|</span> <span class="o">_</span> <span class="o">=&gt;</span> <span class="n">True</span>
</span><span id="linespan-2100"><a id="line-2100" name="line-2100"></a>  <span class="k">end</span><span class="o">.</span>
</span><span id="linespan-2101"><a id="line-2101" name="line-2101"></a>
</span><span id="linespan-2102"><a id="line-2102" name="line-2102"></a><span class="kn">Lemma</span> <span class="n">acquire_progress_alt</span> <span class="o">(</span><span class="n">lcks</span> <span class="o">:</span> <span class="n">locksbundle</span><span class="o">)</span> <span class="o">(</span><span class="n">ls</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">vertex</span> <span class="o">*</span> <span class="o">(</span><span class="n">lockcap</span> <span class="o">*</span> <span class="n">type</span><span class="o">)))</span> <span class="o">:</span>
</span><span id="linespan-2103"><a id="line-2103" name="line-2103"></a>  <span class="n">acquire_progress</span> <span class="n">lcks</span> <span class="n">ls</span> <span class="o">&lt;-&gt;</span>
</span><span id="linespan-2104"><a id="line-2104" name="line-2104"></a>  <span class="o">∀</span> <span class="n">i</span><span class="o">,</span> <span class="o">(∀</span> <span class="n">j</span><span class="o">,</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="o">∃</span> <span class="n">lo</span> <span class="n">t</span> <span class="n">n</span><span class="o">,</span> <span class="n">ls</span> <span class="o">!!</span> <span class="n">j</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="o">((</span><span class="n">lo</span><span class="o">,</span> <span class="n">Closed</span><span class="o">),</span> <span class="n">t</span><span class="o">)))</span> <span class="o">-&gt;</span>
</span><span id="linespan-2105"><a id="line-2105" name="line-2105"></a>    <span class="o">∀</span> <span class="n">lo</span> <span class="n">t</span> <span class="n">n</span><span class="o">,</span> <span class="n">ls</span> <span class="o">!!</span> <span class="n">i</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="o">((</span><span class="n">lo</span><span class="o">,</span> <span class="n">Closed</span><span class="o">),</span> <span class="n">t</span><span class="o">))</span> <span class="o">-&gt;</span>
</span><span id="linespan-2106"><a id="line-2106" name="line-2106"></a>       <span class="o">∃</span> <span class="n">refcnt</span> <span class="n">v</span><span class="o">,</span> <span class="n">lcks</span> <span class="o">!!</span> <span class="n">n</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">refcnt</span><span class="o">,</span> <span class="n">Some</span> <span class="n">v</span><span class="o">).</span>
</span><span id="linespan-2107"><a id="line-2107" name="line-2107"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2108"><a id="line-2108" name="line-2108"></a>  <span class="k">split</span><span class="o">.</span>
</span><span id="linespan-2109"><a id="line-2109" name="line-2109"></a>  <span class="o">-</span> <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-2110"><a id="line-2110" name="line-2110"></a>    <span class="o">{</span> <span class="k">intros</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2111"><a id="line-2111" name="line-2111"></a>    <span class="k">intros</span> <span class="n">HH</span><span class="o">.</span>
</span><span id="linespan-2112"><a id="line-2112" name="line-2112"></a>    <span class="k">destruct</span> <span class="n">a</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">l</span><span class="o">.</span> <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-2113"><a id="line-2113" name="line-2113"></a>    <span class="k">destruct</span> <span class="n">i</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2114"><a id="line-2114" name="line-2114"></a>    <span class="k">eapply</span> <span class="n">IHls</span> <span class="k">in</span> <span class="n">H0</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2115"><a id="line-2115" name="line-2115"></a>    <span class="o">+</span> <span class="n">specialize</span> <span class="o">(</span><span class="n">H</span> <span class="mi">0</span><span class="o">).</span> <span class="k">destruct</span> <span class="n">l0</span><span class="o">.</span>
</span><span id="linespan-2116"><a id="line-2116" name="line-2116"></a>      <span class="o">*</span> <span class="n">edestruct</span> <span class="n">H</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">lia</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2117"><a id="line-2117" name="line-2117"></a>      <span class="o">*</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2118"><a id="line-2118" name="line-2118"></a>    <span class="o">+</span> <span class="k">intros</span><span class="o">.</span> <span class="n">specialize</span> <span class="o">(</span><span class="n">H</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">));</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span> <span class="k">eapply</span> <span class="n">H</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-2119"><a id="line-2119" name="line-2119"></a>  <span class="o">-</span> <span class="k">intros</span><span class="o">.</span> <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2120"><a id="line-2120" name="line-2120"></a>    <span class="k">destruct</span> <span class="n">a</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">l</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">l0</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2121"><a id="line-2121" name="line-2121"></a>    <span class="k">split</span><span class="o">.</span>
</span><span id="linespan-2122"><a id="line-2122" name="line-2122"></a>    <span class="o">+</span> <span class="k">eapply</span> <span class="n">IHls</span><span class="o">;</span> <span class="k">intros</span><span class="o">.</span> <span class="k">eapply</span> <span class="o">(</span><span class="n">H</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">));</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2123"><a id="line-2123" name="line-2123"></a>      <span class="k">destruct</span> <span class="n">j</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">H0</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-2124"><a id="line-2124" name="line-2124"></a>    <span class="o">+</span> <span class="k">eapply</span> <span class="o">(</span><span class="n">H</span> <span class="mi">0</span><span class="o">);</span> <span class="n">simp</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-2125"><a id="line-2125" name="line-2125"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2126"><a id="line-2126" name="line-2126"></a>
</span><span id="linespan-2127"><a id="line-2127" name="line-2127"></a><span class="kn">Fixpoint</span> <span class="n">wait_progress0</span> <span class="o">(</span><span class="n">lcks</span> <span class="o">:</span> <span class="n">locksbundle</span><span class="o">)</span> <span class="o">(</span><span class="n">ls</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">vertex</span> <span class="o">*</span> <span class="o">(</span><span class="n">lockcap</span> <span class="o">*</span> <span class="n">type</span><span class="o">)))</span> <span class="o">:=</span>
</span><span id="linespan-2128"><a id="line-2128" name="line-2128"></a>  <span class="k">match</span> <span class="n">ls</span> <span class="k">with</span>
</span><span id="linespan-2129"><a id="line-2129" name="line-2129"></a>  <span class="o">|</span> <span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="o">((</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Closed</span><span class="o">),</span> <span class="n">t</span><span class="o">))::</span><span class="n">ls'</span> <span class="o">=&gt;</span>
</span><span id="linespan-2130"><a id="line-2130" name="line-2130"></a>      <span class="n">wait_progress0</span> <span class="n">lcks</span> <span class="n">ls'</span> <span class="o">∧</span>
</span><span id="linespan-2131"><a id="line-2131" name="line-2131"></a>      <span class="o">∃</span> <span class="n">v</span><span class="o">,</span> <span class="n">lcks</span> <span class="o">!!</span> <span class="n">n</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">Some</span> <span class="n">v</span><span class="o">)</span>
</span><span id="linespan-2132"><a id="line-2132" name="line-2132"></a>  <span class="o">|</span> <span class="o">_</span> <span class="o">=&gt;</span> <span class="n">True</span>
</span><span id="linespan-2133"><a id="line-2133" name="line-2133"></a>  <span class="k">end</span><span class="o">.</span>
</span><span id="linespan-2134"><a id="line-2134" name="line-2134"></a>
</span><span id="linespan-2135"><a id="line-2135" name="line-2135"></a><span class="kn">Definition</span> <span class="n">wait_progress</span> <span class="n">lcks</span> <span class="n">ls</span> <span class="o">:=</span>
</span><span id="linespan-2136"><a id="line-2136" name="line-2136"></a>  <span class="o">(∀</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">ls</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="o">=</span> <span class="n">Closed</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">wait_progress0</span> <span class="n">lcks</span> <span class="n">ls</span><span class="o">.</span>
</span><span id="linespan-2137"><a id="line-2137" name="line-2137"></a>
</span><span id="linespan-2138"><a id="line-2138" name="line-2138"></a><span class="kn">Lemma</span> <span class="n">wait_progress_alt</span> <span class="o">(</span><span class="n">lcks</span> <span class="o">:</span> <span class="n">locksbundle</span><span class="o">)</span> <span class="o">(</span><span class="n">ls</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">vertex</span> <span class="o">*</span> <span class="o">(</span><span class="n">lockcap</span> <span class="o">*</span> <span class="n">type</span><span class="o">)))</span> <span class="o">:</span>
</span><span id="linespan-2139"><a id="line-2139" name="line-2139"></a>  <span class="n">wait_progress</span> <span class="n">lcks</span> <span class="n">ls</span> <span class="o">&lt;-&gt;</span>
</span><span id="linespan-2140"><a id="line-2140" name="line-2140"></a>  <span class="o">∀</span> <span class="n">i</span><span class="o">:</span><span class="n">nat</span><span class="o">,</span>
</span><span id="linespan-2141"><a id="line-2141" name="line-2141"></a>    <span class="o">(∀</span> <span class="n">j</span> <span class="n">n</span> <span class="n">lown</span> <span class="n">lstate</span> <span class="n">t</span><span class="o">,</span> <span class="n">ls</span> <span class="o">!!</span> <span class="n">j</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="o">((</span><span class="n">lown</span><span class="o">,</span> <span class="n">lstate</span><span class="o">),</span> <span class="n">t</span><span class="o">))</span> <span class="o">-&gt;</span> <span class="n">lstate</span> <span class="o">=</span> <span class="n">Closed</span> <span class="o">∧</span> <span class="o">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">lown</span> <span class="o">=</span> <span class="n">Owner</span><span class="o">))</span> <span class="o">-&gt;</span>
</span><span id="linespan-2142"><a id="line-2142" name="line-2142"></a>    <span class="o">(∀</span> <span class="o">(</span><span class="n">t</span><span class="o">:</span><span class="n">type</span><span class="o">)</span> <span class="n">n</span><span class="o">,</span> <span class="n">ls</span> <span class="o">!!</span> <span class="n">i</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="o">((</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Closed</span><span class="o">),</span> <span class="n">t</span><span class="o">))</span> <span class="o">-&gt;</span> <span class="o">∃</span> <span class="n">v</span><span class="o">,</span> <span class="n">lcks</span> <span class="o">!!</span> <span class="n">n</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">Some</span> <span class="n">v</span><span class="o">)).</span>
</span><span id="linespan-2143"><a id="line-2143" name="line-2143"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2144"><a id="line-2144" name="line-2144"></a>  <span class="k">split</span><span class="o">.</span>
</span><span id="linespan-2145"><a id="line-2145" name="line-2145"></a>  <span class="o">-</span> <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-2146"><a id="line-2146" name="line-2146"></a>    <span class="o">{</span> <span class="k">intros</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2147"><a id="line-2147" name="line-2147"></a>    <span class="k">intros</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">wait_progress</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-2148"><a id="line-2148" name="line-2148"></a>    <span class="k">destruct</span> <span class="n">a</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">l</span><span class="o">.</span>
</span><span id="linespan-2149"><a id="line-2149" name="line-2149"></a>    <span class="k">destruct</span> <span class="n">i</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2150"><a id="line-2150" name="line-2150"></a>    <span class="o">+</span> <span class="n">edestruct</span> <span class="n">H</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2151"><a id="line-2151" name="line-2151"></a>      <span class="k">intros</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">elem_of_cons</span> <span class="k">in</span> <span class="n">H1</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2152"><a id="line-2152" name="line-2152"></a>      <span class="k">eapply</span> <span class="n">elem_of_list_lookup</span> <span class="k">in</span> <span class="n">H1</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-2153"><a id="line-2153" name="line-2153"></a>      <span class="k">destruct</span> <span class="n">x</span> <span class="k">as</span> <span class="o">[?</span> <span class="o">[</span><span class="bp">[]</span> <span class="o">?]].</span>
</span><span id="linespan-2154"><a id="line-2154" name="line-2154"></a>      <span class="k">simpl</span><span class="o">.</span> <span class="n">edestruct</span> <span class="o">(</span><span class="n">H0</span> <span class="o">(</span><span class="n">S</span> <span class="n">x0</span><span class="o">));</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2155"><a id="line-2155" name="line-2155"></a>    <span class="o">+</span> <span class="k">eapply</span> <span class="n">IHls</span><span class="o">;</span><span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2156"><a id="line-2156" name="line-2156"></a>      <span class="o">*</span> <span class="k">unfold</span> <span class="n">wait_progress</span><span class="o">.</span> <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-2157"><a id="line-2157" name="line-2157"></a>        <span class="n">specialize</span> <span class="o">(</span><span class="n">H0</span> <span class="mi">0</span><span class="o">).</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span> <span class="n">edestruct</span> <span class="n">H0</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2158"><a id="line-2158" name="line-2158"></a>        <span class="n">simp</span><span class="o">.</span> <span class="k">assert</span> <span class="o">(</span><span class="n">l</span> <span class="o">=</span> <span class="n">Owner</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;;</span> <span class="k">eauto</span> <span class="k">with</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-2159"><a id="line-2159" name="line-2159"></a>        <span class="n">edestruct</span> <span class="n">H</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-2160"><a id="line-2160" name="line-2160"></a>        <span class="k">eapply</span> <span class="n">elem_of_cons</span> <span class="k">in</span> <span class="n">H3</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2161"><a id="line-2161" name="line-2161"></a>      <span class="o">*</span> <span class="k">intros</span><span class="o">.</span> <span class="n">edestruct</span> <span class="o">(</span><span class="n">H0</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">));</span> <span class="k">eauto</span> <span class="k">with</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-2162"><a id="line-2162" name="line-2162"></a>  <span class="o">-</span> <span class="k">intros</span> <span class="o">??.</span> <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2163"><a id="line-2163" name="line-2163"></a>    <span class="k">destruct</span> <span class="n">a</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">l</span><span class="o">.</span>
</span><span id="linespan-2164"><a id="line-2164" name="line-2164"></a>    <span class="k">destruct</span> <span class="n">l</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">l0</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2165"><a id="line-2165" name="line-2165"></a>    <span class="k">split</span><span class="o">.</span>
</span><span id="linespan-2166"><a id="line-2166" name="line-2166"></a>    <span class="o">+</span> <span class="k">eapply</span> <span class="n">IHls</span><span class="o">.</span>
</span><span id="linespan-2167"><a id="line-2167" name="line-2167"></a>      <span class="o">*</span> <span class="k">intros</span><span class="o">.</span> <span class="k">eapply</span> <span class="o">(</span><span class="n">H</span> <span class="o">(</span><span class="n">S</span> <span class="n">i</span><span class="o">));</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2168"><a id="line-2168" name="line-2168"></a>        <span class="k">intros</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">j</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2169"><a id="line-2169" name="line-2169"></a>        <span class="n">edestruct</span> <span class="n">H1</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">with</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-2170"><a id="line-2170" name="line-2170"></a>      <span class="o">*</span> <span class="k">intros</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">H0</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">elem_of_cons</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2171"><a id="line-2171" name="line-2171"></a>    <span class="o">+</span> <span class="k">eapply</span> <span class="o">(</span><span class="n">H</span> <span class="mi">0</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-2172"><a id="line-2172" name="line-2172"></a>      <span class="k">destruct</span> <span class="n">j</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">with</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-2173"><a id="line-2173" name="line-2173"></a>      <span class="n">edestruct</span> <span class="n">H0</span><span class="o">.</span>
</span><span id="linespan-2174"><a id="line-2174" name="line-2174"></a>      <span class="o">{</span> <span class="k">apply</span> <span class="n">elem_of_list_lookup</span><span class="o">.</span> <span class="n">eexists</span> <span class="o">(</span><span class="n">S</span> <span class="n">j</span><span class="o">).</span> <span class="k">eauto</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2175"><a id="line-2175" name="line-2175"></a>      <span class="k">simpl</span><span class="o">.</span> <span class="k">eauto</span> <span class="k">with</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-2176"><a id="line-2176" name="line-2176"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2177"><a id="line-2177" name="line-2177"></a>
</span><span id="linespan-2178"><a id="line-2178" name="line-2178"></a><span class="kn">Record</span> <span class="n">can_progress</span> <span class="o">(</span><span class="n">refcnt</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">(</span><span class="n">lcks</span> <span class="o">:</span> <span class="n">locksbundle</span><span class="o">)</span>
</span><span id="linespan-2179"><a id="line-2179" name="line-2179"></a>                    <span class="o">(</span><span class="n">ls</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">vertex</span> <span class="o">*</span> <span class="o">(</span><span class="n">lockcap</span> <span class="o">*</span> <span class="n">type</span><span class="o">)))</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span> <span class="o">{</span>
</span><span id="linespan-2180"><a id="line-2180" name="line-2180"></a>  <span class="n">cp_acquire</span> <span class="o">:</span> <span class="n">acquire_progress</span> <span class="n">lcks</span> <span class="n">ls</span><span class="o">;</span>
</span><span id="linespan-2181"><a id="line-2181" name="line-2181"></a>  <span class="n">cp_wait</span> <span class="o">:</span> <span class="n">wait_progress</span> <span class="n">lcks</span> <span class="n">ls</span><span class="o">;</span>
</span><span id="linespan-2182"><a id="line-2182" name="line-2182"></a><span class="o">}.</span>
</span><span id="linespan-2183"><a id="line-2183" name="line-2183"></a>
</span><span id="linespan-2184"><a id="line-2184" name="line-2184"></a><span class="c">(*</span>
</span><span id="linespan-2185"><a id="line-2185" name="line-2185"></a><span class="c">Case #1: all the locks are closed</span>
</span><span id="linespan-2186"><a id="line-2186" name="line-2186"></a>
</span><span id="linespan-2187"><a id="line-2187" name="line-2187"></a><span class="c">    0,   0,   0,   3,   0,   5,  ...</span>
</span><span id="linespan-2188"><a id="line-2188" name="line-2188"></a>
</span><span id="linespan-2189"><a id="line-2189" name="line-2189"></a><span class="c">                   Client</span>
</span><span id="linespan-2190"><a id="line-2190" name="line-2190"></a>
</span><span id="linespan-2191"><a id="line-2191" name="line-2191"></a><span class="c">Proof of case #1:</span>
</span><span id="linespan-2192"><a id="line-2192" name="line-2192"></a><span class="c">Acquire progress is okay.</span>
</span><span id="linespan-2193"><a id="line-2193" name="line-2193"></a><span class="c">Check if first column has a client, if so, choose that row.</span>
</span><span id="linespan-2194"><a id="line-2194" name="line-2194"></a><span class="c">If first column has only owner, use IH.</span>
</span><span id="linespan-2195"><a id="line-2195" name="line-2195"></a><span class="c">Then if IH returns same row as owner, prepend the first column.</span>
</span><span id="linespan-2196"><a id="line-2196" name="line-2196"></a><span class="c">Otherwise, we are also good.</span>
</span><span id="linespan-2197"><a id="line-2197" name="line-2197"></a>
</span><span id="linespan-2198"><a id="line-2198" name="line-2198"></a>
</span><span id="linespan-2199"><a id="line-2199" name="line-2199"></a><span class="c">Case #2: there is a lock that is opened =&gt; then we select the row with an opened</span>
</span><span id="linespan-2200"><a id="line-2200" name="line-2200"></a>
</span><span id="linespan-2201"><a id="line-2201" name="line-2201"></a><span class="c">    Some v1, Some v2, Some v3, None, None, Some v4,  ...</span>
</span><span id="linespan-2202"><a id="line-2202" name="line-2202"></a>
</span><span id="linespan-2203"><a id="line-2203" name="line-2203"></a><span class="c">                               Opened, ??</span>
</span><span id="linespan-2204"><a id="line-2204" name="line-2204"></a>
</span><span id="linespan-2205"><a id="line-2205" name="line-2205"></a><span class="c">Proof of case #2:</span>
</span><span id="linespan-2206"><a id="line-2206" name="line-2206"></a><span class="c">First, check if there is an opened in the first column, if so, we are done.</span>
</span><span id="linespan-2207"><a id="line-2207" name="line-2207"></a><span class="c">Now the first column has only closed.</span>
</span><span id="linespan-2208"><a id="line-2208" name="line-2208"></a><span class="c">Then there must be an opened in the remainder of the matrix, so IH applies.</span>
</span><span id="linespan-2209"><a id="line-2209" name="line-2209"></a><span class="c">So IH gives us a row with acquire_progress and wait_progress and an opened in the row.</span>
</span><span id="linespan-2210"><a id="line-2210" name="line-2210"></a><span class="c">Done.</span>
</span><span id="linespan-2211"><a id="line-2211" name="line-2211"></a>
</span><span id="linespan-2212"><a id="line-2212" name="line-2212"></a><span class="c">*)</span>
</span><span id="linespan-2213"><a id="line-2213" name="line-2213"></a>
</span><span id="linespan-2214"><a id="line-2214" name="line-2214"></a><span class="kn">Definition</span> <span class="n">all_closed</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">mset_forall</span> <span class="o">(λ</span> <span class="n">lab</span><span class="o">,</span>
</span><span id="linespan-2215"><a id="line-2215" name="line-2215"></a>  <span class="o">∃</span> <span class="n">ls</span><span class="o">,</span> <span class="n">lab</span> <span class="o">=</span> <span class="n">LockLabel</span> <span class="n">ls</span> <span class="o">∧</span> <span class="o">∀</span> <span class="n">x</span><span class="o">,</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">ls</span> <span class="o">-&gt;</span> <span class="n">x</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="o">=</span> <span class="n">Closed</span><span class="o">)</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-2216"><a id="line-2216" name="line-2216"></a>
</span><span id="linespan-2217"><a id="line-2217" name="line-2217"></a><span class="kn">Definition</span> <span class="n">all_closed1</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">labelO'</span><span class="o">)</span> <span class="o">:=</span> <span class="n">mset_forall</span> <span class="o">(λ</span> <span class="n">l</span><span class="o">:</span><span class="n">labelO'</span><span class="o">,</span> <span class="n">l</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="o">=</span> <span class="n">Closed</span><span class="o">)</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-2218"><a id="line-2218" name="line-2218"></a>
</span><span id="linespan-2219"><a id="line-2219" name="line-2219"></a><span class="kn">Definition</span> <span class="n">mset_fmap</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">B</span> <span class="o">:=</span>
</span><span id="linespan-2220"><a id="line-2220" name="line-2220"></a>  <span class="n">list_to_multiset</span> <span class="o">(</span><span class="n">f</span> <span class="o">&lt;$&gt;</span> <span class="n">multiset_car</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-2221"><a id="line-2221" name="line-2221"></a>
</span><span id="linespan-2222"><a id="line-2222" name="line-2222"></a><span class="kn">Global</span> <span class="kn">Instance</span> <span class="o">:</span> <span class="n">Params</span> <span class="o">(@</span><span class="n">mset_fmap</span><span class="o">)</span> <span class="mi">2</span> <span class="o">:=</span> <span class="o">{}.</span>
</span><span id="linespan-2223"><a id="line-2223" name="line-2223"></a>
</span><span id="linespan-2224"><a id="line-2224" name="line-2224"></a><span class="kn">Global</span> <span class="kn">Instance</span> <span class="n">mset_fmap_Proper</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="n">ofe</span><span class="o">}</span> <span class="o">:</span> <span class="n">Proper</span> <span class="o">(((</span><span class="bp">≡</span><span class="o">)</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="bp">≡</span><span class="o">))</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="bp">≡</span><span class="o">)</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="bp">≡</span><span class="o">))</span> <span class="o">(@</span><span class="n">mset_fmap</span> <span class="n">A</span> <span class="n">B</span><span class="o">).</span>
</span><span id="linespan-2225"><a id="line-2225" name="line-2225"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2226"><a id="line-2226" name="line-2226"></a>  <span class="k">intros</span> <span class="o">??????.</span>
</span><span id="linespan-2227"><a id="line-2227" name="line-2227"></a>  <span class="k">unfold</span> <span class="n">mset_fmap</span><span class="o">.</span>
</span><span id="linespan-2228"><a id="line-2228" name="line-2228"></a>  <span class="n">inv</span> <span class="n">H0</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2229"><a id="line-2229" name="line-2229"></a>  <span class="n">eexists</span><span class="o">;</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-2230"><a id="line-2230" name="line-2230"></a>  <span class="k">split</span><span class="o">.</span>
</span><span id="linespan-2231"><a id="line-2231" name="line-2231"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">fmap_Permutation</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2232"><a id="line-2232" name="line-2232"></a>  <span class="o">-</span> <span class="n">f_equiv</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2233"><a id="line-2233" name="line-2233"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2234"><a id="line-2234" name="line-2234"></a>
</span><span id="linespan-2235"><a id="line-2235" name="line-2235"></a><span class="kn">Lemma</span> <span class="n">list_to_multiset_app</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">x1</span> <span class="n">x2</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-2236"><a id="line-2236" name="line-2236"></a>  <span class="n">list_to_multiset</span> <span class="o">(</span><span class="n">x1</span> <span class="o">++</span> <span class="n">x2</span><span class="o">)</span> <span class="bp">≡</span> <span class="n">list_to_multiset</span> <span class="n">x1</span> <span class="bp">⋅</span> <span class="n">list_to_multiset</span> <span class="n">x2</span><span class="o">.</span>
</span><span id="linespan-2237"><a id="line-2237" name="line-2237"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2238"><a id="line-2238" name="line-2238"></a>  <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2239"><a id="line-2239" name="line-2239"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2240"><a id="line-2240" name="line-2240"></a>
</span><span id="linespan-2241"><a id="line-2241" name="line-2241"></a><span class="kn">Lemma</span> <span class="n">mset_fmap_op</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span><span class="o">:</span><span class="n">A</span><span class="o">-&gt;</span><span class="n">B</span><span class="o">)</span> <span class="n">x1</span> <span class="n">x2</span> <span class="o">:</span>
</span><span id="linespan-2242"><a id="line-2242" name="line-2242"></a>  <span class="n">mset_fmap</span> <span class="n">f</span> <span class="o">(</span><span class="n">x1</span> <span class="bp">⋅</span> <span class="n">x2</span><span class="o">)</span> <span class="bp">≡</span> <span class="n">mset_fmap</span> <span class="n">f</span> <span class="n">x1</span> <span class="bp">⋅</span> <span class="n">mset_fmap</span> <span class="n">f</span> <span class="n">x2</span><span class="o">.</span>
</span><span id="linespan-2243"><a id="line-2243" name="line-2243"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2244"><a id="line-2244" name="line-2244"></a>  <span class="k">unfold</span> <span class="n">mset_fmap</span><span class="o">.</span>
</span><span id="linespan-2245"><a id="line-2245" name="line-2245"></a>  <span class="k">rewrite</span> <span class="n">fmap_app</span> <span class="n">list_to_multiset_app</span> <span class="o">//.</span>
</span><span id="linespan-2246"><a id="line-2246" name="line-2246"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2247"><a id="line-2247" name="line-2247"></a>
</span><span id="linespan-2248"><a id="line-2248" name="line-2248"></a><span class="kn">Lemma</span> <span class="n">mset_fmap_singleton</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span><span class="o">:</span><span class="n">A</span><span class="o">-&gt;</span><span class="n">B</span><span class="o">)</span> <span class="n">a</span> <span class="o">:</span>
</span><span id="linespan-2249"><a id="line-2249" name="line-2249"></a>  <span class="n">mset_fmap</span> <span class="n">f</span> <span class="o">{[</span> <span class="n">a</span> <span class="o">]}</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="n">f</span> <span class="n">a</span> <span class="o">]}.</span>
</span><span id="linespan-2250"><a id="line-2250" name="line-2250"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2251"><a id="line-2251" name="line-2251"></a>  <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2252"><a id="line-2252" name="line-2252"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2253"><a id="line-2253" name="line-2253"></a>
</span><span id="linespan-2254"><a id="line-2254" name="line-2254"></a><span class="kn">Lemma</span> <span class="n">fmap_Permutation_inv</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">xs</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">ys</span> <span class="o">:</span> <span class="n">list</span> <span class="n">B</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-2255"><a id="line-2255" name="line-2255"></a>  <span class="n">f</span> <span class="o">&lt;$&gt;</span> <span class="n">xs</span> <span class="bp">≡</span><span class="n">ₚ</span> <span class="n">ys</span> <span class="o">-&gt;</span>
</span><span id="linespan-2256"><a id="line-2256" name="line-2256"></a>  <span class="o">∃</span> <span class="n">xs'</span><span class="o">,</span> <span class="n">xs</span> <span class="bp">≡</span><span class="n">ₚ</span> <span class="n">xs'</span> <span class="o">∧</span> <span class="n">f</span> <span class="o">&lt;$&gt;</span> <span class="n">xs'</span> <span class="o">=</span> <span class="n">ys</span><span class="o">.</span>
</span><span id="linespan-2257"><a id="line-2257" name="line-2257"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2258"><a id="line-2258" name="line-2258"></a>  <span class="k">cut</span> <span class="o">(∀</span> <span class="n">zs</span><span class="o">,</span> <span class="n">f</span> <span class="o">&lt;$&gt;</span> <span class="n">xs</span> <span class="o">=</span> <span class="n">zs</span> <span class="o">-&gt;</span> <span class="n">zs</span> <span class="bp">≡</span><span class="n">ₚ</span> <span class="n">ys</span> <span class="o">-&gt;</span> <span class="o">∃</span> <span class="n">xs'</span><span class="o">,</span> <span class="n">xs</span> <span class="bp">≡</span><span class="n">ₚ</span> <span class="n">xs'</span> <span class="o">∧</span> <span class="n">f</span> <span class="o">&lt;$&gt;</span> <span class="n">xs'</span> <span class="o">=</span> <span class="n">ys</span><span class="o">).</span>
</span><span id="linespan-2259"><a id="line-2259" name="line-2259"></a>  <span class="o">{</span> <span class="n">simp</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2260"><a id="line-2260" name="line-2260"></a>  <span class="k">intros</span><span class="o">.</span> <span class="k">revert</span> <span class="n">xs</span> <span class="n">H</span><span class="o">.</span> <span class="k">induction</span> <span class="n">H0</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2261"><a id="line-2261" name="line-2261"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">xs</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2262"><a id="line-2262" name="line-2262"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">xs</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2263"><a id="line-2263" name="line-2263"></a>    <span class="n">edestruct</span> <span class="n">IHPermutation</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2264"><a id="line-2264" name="line-2264"></a>    <span class="n">eexists</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span> <span class="n">x</span><span class="o">).</span> <span class="k">split</span><span class="o">;</span> <span class="k">constructor</span><span class="o">;</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2265"><a id="line-2265" name="line-2265"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">xs</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">xs</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2266"><a id="line-2266" name="line-2266"></a>    <span class="n">eexists</span> <span class="o">(</span><span class="n">a0</span> <span class="o">::</span> <span class="n">a</span> <span class="o">::</span> <span class="n">xs</span><span class="o">).</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2267"><a id="line-2267" name="line-2267"></a>    <span class="k">constructor</span><span class="o">.</span>
</span><span id="linespan-2268"><a id="line-2268" name="line-2268"></a>  <span class="o">-</span> <span class="n">edestruct</span> <span class="n">IHPermutation1</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2269"><a id="line-2269" name="line-2269"></a>    <span class="n">edestruct</span> <span class="n">IHPermutation2</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2270"><a id="line-2270" name="line-2270"></a>    <span class="k">exists</span> <span class="n">x0</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">etrans</span><span class="o">;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="n">H0</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2271"><a id="line-2271" name="line-2271"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2272"><a id="line-2272" name="line-2272"></a>
</span><span id="linespan-2273"><a id="line-2273" name="line-2273"></a><span class="kn">Lemma</span> <span class="n">fmap_app_inv'</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="o">→</span> <span class="n">B</span><span class="o">)</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">k1</span> <span class="n">k2</span> <span class="o">:</span> <span class="n">list</span> <span class="n">B</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-2274"><a id="line-2274" name="line-2274"></a>	<span class="n">f</span> <span class="o">&lt;$&gt;</span> <span class="n">l</span> <span class="bp">≡</span> <span class="n">k1</span> <span class="o">++</span> <span class="n">k2</span>
</span><span id="linespan-2275"><a id="line-2275" name="line-2275"></a>    <span class="o">→</span> <span class="o">∃</span> <span class="n">l1</span> <span class="n">l2</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span><span class="o">,</span> <span class="n">k1</span> <span class="bp">≡</span> <span class="n">f</span> <span class="o">&lt;$&gt;</span> <span class="n">l1</span> <span class="o">∧</span> <span class="n">k2</span> <span class="bp">≡</span> <span class="n">f</span> <span class="o">&lt;$&gt;</span> <span class="n">l2</span> <span class="o">∧</span> <span class="n">l</span> <span class="o">=</span> <span class="n">l1</span> <span class="o">++</span> <span class="n">l2</span><span class="o">.</span>
</span><span id="linespan-2276"><a id="line-2276" name="line-2276"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2277"><a id="line-2277" name="line-2277"></a>  <span class="k">revert</span> <span class="n">k1</span> <span class="n">k2</span><span class="o">.</span> <span class="k">induction</span> <span class="n">l</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2278"><a id="line-2278" name="line-2278"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">k1</span><span class="o">,</span><span class="n">k2</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2279"><a id="line-2279" name="line-2279"></a>    <span class="o">+</span> <span class="k">exists</span> <span class="bp">[]</span><span class="o">,</span><span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2280"><a id="line-2280" name="line-2280"></a>    <span class="o">+</span> <span class="n">inv</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-2281"><a id="line-2281" name="line-2281"></a>    <span class="o">+</span> <span class="n">inv</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-2282"><a id="line-2282" name="line-2282"></a>    <span class="o">+</span> <span class="n">inv</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-2283"><a id="line-2283" name="line-2283"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">k1</span><span class="o">;</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-2284"><a id="line-2284" name="line-2284"></a>    <span class="o">+</span> <span class="k">destruct</span> <span class="n">k2</span><span class="o">;</span> <span class="n">inv</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-2285"><a id="line-2285" name="line-2285"></a>      <span class="k">exists</span> <span class="bp">[]</span><span class="o">.</span> <span class="k">exists</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span> <span class="n">l</span><span class="o">).</span>
</span><span id="linespan-2286"><a id="line-2286" name="line-2286"></a>      <span class="k">simpl</span><span class="o">.</span> <span class="n">split_and</span><span class="o">!;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2287"><a id="line-2287" name="line-2287"></a>      <span class="k">constructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2288"><a id="line-2288" name="line-2288"></a>    <span class="o">+</span> <span class="n">inv</span> <span class="n">H</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">IHl</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2289"><a id="line-2289" name="line-2289"></a>      <span class="k">exists</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span> <span class="n">H</span><span class="o">).</span> <span class="k">exists</span> <span class="n">H1</span><span class="o">.</span> <span class="n">split_and</span><span class="o">!;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2290"><a id="line-2290" name="line-2290"></a>      <span class="k">constructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2291"><a id="line-2291" name="line-2291"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2292"><a id="line-2292" name="line-2292"></a>
</span><span id="linespan-2293"><a id="line-2293" name="line-2293"></a><span class="kn">Lemma</span> <span class="n">mset_fmap_op_inv</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="o">)</span> <span class="n">y1</span> <span class="n">y2</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2294"><a id="line-2294" name="line-2294"></a>  <span class="n">mset_fmap</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">≡</span> <span class="n">y1</span> <span class="bp">⋅</span> <span class="n">y2</span> <span class="o">-&gt;</span>
</span><span id="linespan-2295"><a id="line-2295" name="line-2295"></a>  <span class="o">∃</span> <span class="n">x1</span> <span class="n">x2</span><span class="o">,</span> <span class="n">x</span> <span class="bp">≡</span> <span class="n">x1</span> <span class="bp">⋅</span> <span class="n">x2</span> <span class="o">∧</span> <span class="n">y1</span> <span class="bp">≡</span> <span class="n">mset_fmap</span> <span class="n">f</span> <span class="n">x1</span> <span class="o">∧</span> <span class="n">y2</span> <span class="bp">≡</span> <span class="n">mset_fmap</span> <span class="n">f</span> <span class="n">x2</span><span class="o">.</span>
</span><span id="linespan-2296"><a id="line-2296" name="line-2296"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2297"><a id="line-2297" name="line-2297"></a>  <span class="k">unfold</span> <span class="n">mset_fmap</span><span class="o">.</span>
</span><span id="linespan-2298"><a id="line-2298" name="line-2298"></a>  <span class="k">intros</span> <span class="n">H</span><span class="o">.</span> <span class="n">inv</span> <span class="n">H</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2299"><a id="line-2299" name="line-2299"></a>  <span class="k">eapply</span> <span class="n">fmap_Permutation_inv</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2300"><a id="line-2300" name="line-2300"></a>  <span class="k">eapply</span> <span class="n">fmap_app_inv'</span> <span class="k">in</span> <span class="n">H1</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2301"><a id="line-2301" name="line-2301"></a>  <span class="k">exists</span> <span class="o">(</span><span class="n">list_to_multiset</span> <span class="n">H2</span><span class="o">).</span>
</span><span id="linespan-2302"><a id="line-2302" name="line-2302"></a>  <span class="k">exists</span> <span class="o">(</span><span class="n">list_to_multiset</span> <span class="n">H1</span><span class="o">).</span>
</span><span id="linespan-2303"><a id="line-2303" name="line-2303"></a>  <span class="n">split_and</span><span class="o">!;</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2304"><a id="line-2304" name="line-2304"></a>  <span class="o">-</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2305"><a id="line-2305" name="line-2305"></a>  <span class="o">-</span> <span class="n">eexists</span><span class="o">;</span> <span class="k">simpl</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2306"><a id="line-2306" name="line-2306"></a>  <span class="o">-</span> <span class="n">eexists</span><span class="o">;</span> <span class="k">simpl</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2307"><a id="line-2307" name="line-2307"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2308"><a id="line-2308" name="line-2308"></a>
</span><span id="linespan-2309"><a id="line-2309" name="line-2309"></a><span class="kn">Lemma</span> <span class="n">mset_fmap_singleton_inv</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="o">)</span> <span class="n">a</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2310"><a id="line-2310" name="line-2310"></a>  <span class="n">mset_fmap</span> <span class="n">f</span> <span class="n">x</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="n">a</span> <span class="o">]}</span> <span class="o">-&gt;</span>
</span><span id="linespan-2311"><a id="line-2311" name="line-2311"></a>  <span class="o">∃</span> <span class="n">b</span><span class="o">,</span> <span class="n">x</span> <span class="bp">≡</span> <span class="o">{[</span> <span class="n">b</span> <span class="o">]}</span> <span class="o">∧</span> <span class="n">a</span> <span class="bp">≡</span> <span class="n">f</span> <span class="n">b</span><span class="o">.</span>
</span><span id="linespan-2312"><a id="line-2312" name="line-2312"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2313"><a id="line-2313" name="line-2313"></a>  <span class="k">unfold</span> <span class="n">mset_fmap</span><span class="o">.</span> <span class="k">intros</span> <span class="n">H</span><span class="o">.</span> <span class="n">inv</span> <span class="n">H</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2314"><a id="line-2314" name="line-2314"></a>  <span class="n">inv</span> <span class="n">H1</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="n">inv</span> <span class="n">H5</span><span class="o">.</span>
</span><span id="linespan-2315"><a id="line-2315" name="line-2315"></a>  <span class="k">eapply</span> <span class="n">Permutation_singleton_r</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-2316"><a id="line-2316" name="line-2316"></a>  <span class="k">destruct</span> <span class="n">x</span><span class="o">.</span> <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-2317"><a id="line-2317" name="line-2317"></a>  <span class="k">destruct</span> <span class="n">multiset_car</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2318"><a id="line-2318" name="line-2318"></a>  <span class="k">destruct</span> <span class="n">multiset_car</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2319"><a id="line-2319" name="line-2319"></a>  <span class="n">eexists</span><span class="o">.</span> <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2320"><a id="line-2320" name="line-2320"></a>  <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2321"><a id="line-2321" name="line-2321"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2322"><a id="line-2322" name="line-2322"></a>
</span><span id="linespan-2323"><a id="line-2323" name="line-2323"></a><span class="kn">Lemma</span> <span class="n">melem_of_fmap</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span> <span class="o">:</span> <span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="o">)</span> <span class="n">a</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2324"><a id="line-2324" name="line-2324"></a>  <span class="n">Proper</span> <span class="o">((</span><span class="bp">≡</span><span class="o">)</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="bp">≡</span><span class="o">))</span> <span class="n">f</span> <span class="o">-&gt;</span>
</span><span id="linespan-2325"><a id="line-2325" name="line-2325"></a>  <span class="n">melem_of</span> <span class="n">a</span> <span class="o">(</span><span class="n">mset_fmap</span> <span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="o">&lt;-&gt;</span> <span class="o">(∃</span> <span class="n">b</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≡</span> <span class="n">f</span> <span class="n">b</span> <span class="o">∧</span> <span class="n">melem_of</span> <span class="n">b</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-2326"><a id="line-2326" name="line-2326"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2327"><a id="line-2327" name="line-2327"></a>  <span class="k">intros</span> <span class="n">HH</span><span class="o">.</span>
</span><span id="linespan-2328"><a id="line-2328" name="line-2328"></a>  <span class="k">split</span><span class="o">.</span>
</span><span id="linespan-2329"><a id="line-2329" name="line-2329"></a>  <span class="o">-</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-2330"><a id="line-2330" name="line-2330"></a>    <span class="k">eapply</span> <span class="n">mset_fmap_op_inv</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2331"><a id="line-2331" name="line-2331"></a>    <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H2</span><span class="o">.</span>
</span><span id="linespan-2332"><a id="line-2332" name="line-2332"></a>    <span class="k">eapply</span> <span class="n">mset_fmap_singleton_inv</span> <span class="k">in</span> <span class="n">H2</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2333"><a id="line-2333" name="line-2333"></a>    <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-2334"><a id="line-2334" name="line-2334"></a>    <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2335"><a id="line-2335" name="line-2335"></a>    <span class="k">eapply</span> <span class="n">melem_of_op_singleton</span><span class="o">.</span>
</span><span id="linespan-2336"><a id="line-2336" name="line-2336"></a>  <span class="o">-</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">H2</span><span class="o">.</span> <span class="n">eexists</span> <span class="o">(</span><span class="n">mset_fmap</span> <span class="n">f</span> <span class="n">x0</span><span class="o">).</span>
</span><span id="linespan-2337"><a id="line-2337" name="line-2337"></a>    <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-2338"><a id="line-2338" name="line-2338"></a>    <span class="k">rewrite</span> <span class="n">mset_fmap_op</span> <span class="n">mset_fmap_singleton</span> <span class="o">//.</span>
</span><span id="linespan-2339"><a id="line-2339" name="line-2339"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2340"><a id="line-2340" name="line-2340"></a>
</span><span id="linespan-2341"><a id="line-2341" name="line-2341"></a><span class="kn">Definition</span> <span class="n">delcol1</span> <span class="n">i</span> <span class="n">l</span> <span class="o">:=</span>  <span class="k">match</span> <span class="n">l</span> <span class="k">with</span>
</span><span id="linespan-2342"><a id="line-2342" name="line-2342"></a>  <span class="o">|</span> <span class="n">LockLabel</span> <span class="n">ls</span> <span class="o">=&gt;</span> <span class="n">LockLabel</span> <span class="o">(</span><span class="n">filter</span> <span class="o">(λ</span> <span class="k">'</span><span class="o">(</span><span class="n">jj</span><span class="o">,_),</span> <span class="n">jj</span> <span class="o">≠</span> <span class="n">i</span><span class="o">)</span> <span class="n">ls</span><span class="o">)</span>
</span><span id="linespan-2343"><a id="line-2343" name="line-2343"></a>  <span class="o">|</span> <span class="n">a</span> <span class="o">=&gt;</span> <span class="n">a</span>
</span><span id="linespan-2344"><a id="line-2344" name="line-2344"></a>  <span class="k">end</span><span class="o">.</span>
</span><span id="linespan-2345"><a id="line-2345" name="line-2345"></a>
</span><span id="linespan-2346"><a id="line-2346" name="line-2346"></a><span class="kn">Definition</span> <span class="n">delcol</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">labelO</span><span class="o">)</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">labelO</span> <span class="o">:=</span>
</span><span id="linespan-2347"><a id="line-2347" name="line-2347"></a>  <span class="n">mset_fmap</span> <span class="o">(</span><span class="n">delcol1</span> <span class="n">i</span><span class="o">)</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-2348"><a id="line-2348" name="line-2348"></a>
</span><span id="linespan-2349"><a id="line-2349" name="line-2349"></a><span class="kn">Global</span> <span class="kn">Instance</span> <span class="n">delcol_Proper</span> <span class="n">i</span> <span class="o">:</span> <span class="n">Proper</span> <span class="o">((</span><span class="bp">≡</span><span class="o">)</span> <span class="o">==&gt;</span> <span class="o">(</span><span class="bp">≡</span><span class="o">))</span> <span class="o">(</span><span class="n">delcol</span> <span class="n">i</span><span class="o">).</span>
</span><span id="linespan-2350"><a id="line-2350" name="line-2350"></a><span class="kn">Proof</span><span class="o">.</span> <span class="n">solve_proper</span><span class="o">.</span> <span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2351"><a id="line-2351" name="line-2351"></a>
</span><span id="linespan-2352"><a id="line-2352" name="line-2352"></a><span class="kn">Lemma</span> <span class="n">mset_empty_or_not</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span><span class="n">multiset</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-2353"><a id="line-2353" name="line-2353"></a>  <span class="n">x</span> <span class="o">=</span> <span class="n">ε</span> <span class="o">∨</span> <span class="o">∃</span> <span class="n">a</span><span class="o">,</span> <span class="n">melem_of</span> <span class="n">a</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-2354"><a id="line-2354" name="line-2354"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2355"><a id="line-2355" name="line-2355"></a>  <span class="k">destruct</span> <span class="n">x</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">multiset_car</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2356"><a id="line-2356" name="line-2356"></a>  <span class="k">right</span><span class="o">.</span> <span class="k">exists</span> <span class="n">o</span><span class="o">.</span>
</span><span id="linespan-2357"><a id="line-2357" name="line-2357"></a>  <span class="k">unfold</span> <span class="n">melem_of</span><span class="o">.</span>
</span><span id="linespan-2358"><a id="line-2358" name="line-2358"></a>  <span class="k">exists</span> <span class="o">(</span><span class="n">list_to_multiset</span> <span class="n">multiset_car</span><span class="o">).</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2359"><a id="line-2359" name="line-2359"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2360"><a id="line-2360" name="line-2360"></a>
</span><span id="linespan-2361"><a id="line-2361" name="line-2361"></a><span class="kn">Definition</span> <span class="n">mset_exists</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">P</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">A</span><span class="o">)</span> <span class="o">:=</span>
</span><span id="linespan-2362"><a id="line-2362" name="line-2362"></a>  <span class="o">∃</span> <span class="n">a</span><span class="o">,</span> <span class="n">melem_of</span> <span class="n">a</span> <span class="n">x</span> <span class="o">∧</span> <span class="n">P</span> <span class="n">a</span><span class="o">.</span>
</span><span id="linespan-2363"><a id="line-2363" name="line-2363"></a>
</span><span id="linespan-2364"><a id="line-2364" name="line-2364"></a><span class="kn">Lemma</span> <span class="n">melem_of_forall</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="n">P</span> <span class="o">(</span><span class="n">x</span><span class="o">:</span><span class="n">multiset</span> <span class="n">A</span><span class="o">)</span> <span class="n">a</span> <span class="o">:</span>
</span><span id="linespan-2365"><a id="line-2365" name="line-2365"></a>  <span class="n">mset_forall</span> <span class="n">P</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">melem_of</span> <span class="n">a</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">P</span> <span class="n">a</span><span class="o">.</span>
</span><span id="linespan-2366"><a id="line-2366" name="line-2366"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2367"><a id="line-2367" name="line-2367"></a>  <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2368"><a id="line-2368" name="line-2368"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2369"><a id="line-2369" name="line-2369"></a>
</span><span id="linespan-2370"><a id="line-2370" name="line-2370"></a><span class="kn">Lemma</span> <span class="n">lockrelG'_empty</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2371"><a id="line-2371" name="line-2371"></a>  <span class="n">lockrelG'</span> <span class="bp">[]</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">lcks</span> <span class="o">=</span> <span class="bp">∅</span><span class="o">.</span>
</span><span id="linespan-2372"><a id="line-2372" name="line-2372"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2373"><a id="line-2373" name="line-2373"></a>  <span class="k">intros</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-2374"><a id="line-2374" name="line-2374"></a>  <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-2375"><a id="line-2375" name="line-2375"></a>  <span class="k">symmetry</span> <span class="k">in</span> <span class="n">order_dom0</span><span class="o">.</span>
</span><span id="linespan-2376"><a id="line-2376" name="line-2376"></a>  <span class="k">apply</span> <span class="n">dom_empty_iff_L</span> <span class="k">in</span> <span class="n">order_dom0</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2377"><a id="line-2377" name="line-2377"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2378"><a id="line-2378" name="line-2378"></a>
</span><span id="linespan-2379"><a id="line-2379" name="line-2379"></a><span class="kn">Lemma</span> <span class="n">melem_of_list_to_multiset</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="n">a</span> <span class="o">(</span><span class="n">xs</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-2380"><a id="line-2380" name="line-2380"></a>  <span class="n">melem_of</span> <span class="n">a</span> <span class="o">(</span><span class="n">list_to_multiset</span> <span class="n">xs</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">∃</span> <span class="n">a'</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≡</span> <span class="n">a'</span> <span class="o">∧</span> <span class="n">a'</span> <span class="bp">∈</span> <span class="n">xs</span><span class="o">.</span>
</span><span id="linespan-2381"><a id="line-2381" name="line-2381"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2382"><a id="line-2382" name="line-2382"></a>  <span class="k">intros</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-2383"><a id="line-2383" name="line-2383"></a>  <span class="k">revert</span> <span class="n">x</span> <span class="n">H</span><span class="o">.</span> <span class="k">induction</span> <span class="n">xs</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2384"><a id="line-2384" name="line-2384"></a>  <span class="o">-</span> <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_empty_mult</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2385"><a id="line-2385" name="line-2385"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">list_to_multiset_cons</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-2386"><a id="line-2386" name="line-2386"></a>    <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2387"><a id="line-2387" name="line-2387"></a>    <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-2388"><a id="line-2388" name="line-2388"></a>    <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H5</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-2389"><a id="line-2389" name="line-2389"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">IHxs</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span>
</span><span id="linespan-2390"><a id="line-2390" name="line-2390"></a>      <span class="n">simp</span><span class="o">.</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">apply</span> <span class="n">elem_of_cons</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2391"><a id="line-2391" name="line-2391"></a>    <span class="o">+</span> <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2392"><a id="line-2392" name="line-2392"></a>      <span class="n">eexists</span> <span class="n">a0</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="n">H0</span><span class="o">.</span>
</span><span id="linespan-2393"><a id="line-2393" name="line-2393"></a>      <span class="k">eapply</span> <span class="n">elem_of_cons</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2394"><a id="line-2394" name="line-2394"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2395"><a id="line-2395" name="line-2395"></a>
</span><span id="linespan-2396"><a id="line-2396" name="line-2396"></a><span class="kn">Lemma</span> <span class="n">melem_of_list_to_multiset'</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="n">a</span> <span class="o">(</span><span class="n">xs</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span><span class="o">)</span> <span class="o">:</span>
</span><span id="linespan-2397"><a id="line-2397" name="line-2397"></a>  <span class="n">a</span> <span class="bp">∈</span> <span class="n">xs</span> <span class="o">-&gt;</span>
</span><span id="linespan-2398"><a id="line-2398" name="line-2398"></a>  <span class="n">melem_of</span> <span class="n">a</span> <span class="o">(</span><span class="n">list_to_multiset</span> <span class="n">xs</span><span class="o">).</span>
</span><span id="linespan-2399"><a id="line-2399" name="line-2399"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2400"><a id="line-2400" name="line-2400"></a>  <span class="k">intros</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-2401"><a id="line-2401" name="line-2401"></a>  <span class="k">apply</span> <span class="n">elem_of_list_lookup</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-2402"><a id="line-2402" name="line-2402"></a>  <span class="k">exists</span> <span class="o">(</span><span class="n">list_to_multiset</span> <span class="o">(</span><span class="n">delete</span> <span class="n">x</span> <span class="n">xs</span><span class="o">)).</span>
</span><span id="linespan-2403"><a id="line-2403" name="line-2403"></a>  <span class="k">revert</span> <span class="n">x</span> <span class="n">H</span><span class="o">.</span> <span class="k">induction</span> <span class="n">xs</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2404"><a id="line-2404" name="line-2404"></a>  <span class="k">destruct</span> <span class="n">x</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2405"><a id="line-2405" name="line-2405"></a>  <span class="k">apply</span> <span class="n">IHxs</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">list_to_multiset_cons</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-2406"><a id="line-2406" name="line-2406"></a>  <span class="k">rewrite</span> <span class="n">comm</span> <span class="o">-</span><span class="n">assoc</span><span class="o">.</span> <span class="n">f_equiv</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">comm</span> <span class="o">//.</span>
</span><span id="linespan-2407"><a id="line-2407" name="line-2407"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2408"><a id="line-2408" name="line-2408"></a>
</span><span id="linespan-2409"><a id="line-2409" name="line-2409"></a><span class="kn">Lemma</span> <span class="n">elem_of_flat_map</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">list</span> <span class="n">B</span><span class="o">)</span> <span class="n">l</span> <span class="n">y</span> <span class="o">:</span>
</span><span id="linespan-2410"><a id="line-2410" name="line-2410"></a>  <span class="n">y</span> <span class="bp">∈</span> <span class="n">flat_map</span> <span class="n">f</span> <span class="n">l</span> <span class="o">↔</span> <span class="o">∃</span> <span class="n">x</span> <span class="o">:</span> <span class="n">A</span><span class="o">,</span> <span class="n">x</span> <span class="bp">∈</span> <span class="n">l</span> <span class="o">∧</span> <span class="n">y</span> <span class="bp">∈</span> <span class="n">f</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-2411"><a id="line-2411" name="line-2411"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2412"><a id="line-2412" name="line-2412"></a>  <span class="k">setoid_rewrite</span> <span class="n">elem_of_list_In</span><span class="o">.</span>
</span><span id="linespan-2413"><a id="line-2413" name="line-2413"></a>  <span class="k">apply</span> <span class="n">in_flat_map</span><span class="o">.</span>
</span><span id="linespan-2414"><a id="line-2414" name="line-2414"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2415"><a id="line-2415" name="line-2415"></a>
</span><span id="linespan-2416"><a id="line-2416" name="line-2416"></a><span class="kn">Lemma</span> <span class="n">elem_of_multiset_car</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span><span class="o">:</span><span class="n">A</span><span class="o">)</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2417"><a id="line-2417" name="line-2417"></a>  <span class="n">a</span> <span class="bp">∈</span> <span class="n">multiset_car</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">melem_of</span> <span class="n">a</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-2418"><a id="line-2418" name="line-2418"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2419"><a id="line-2419" name="line-2419"></a>  <span class="k">intros</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-2420"><a id="line-2420" name="line-2420"></a>  <span class="k">apply</span> <span class="n">melem_of_list_to_multiset'</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2421"><a id="line-2421" name="line-2421"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2422"><a id="line-2422" name="line-2422"></a>
</span><span id="linespan-2423"><a id="line-2423" name="line-2423"></a><span class="kn">Lemma</span> <span class="n">melem_of_delcol</span> <span class="o">(</span><span class="n">a</span><span class="o">:</span><span class="n">labelO</span><span class="o">)</span> <span class="n">l</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2424"><a id="line-2424" name="line-2424"></a>  <span class="n">melem_of</span> <span class="n">a</span> <span class="o">(</span><span class="n">delcol</span> <span class="n">l</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">∃</span> <span class="n">aa</span><span class="o">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">delcol1</span> <span class="n">l</span> <span class="n">aa</span> <span class="o">∧</span> <span class="n">melem_of</span> <span class="n">aa</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-2425"><a id="line-2425" name="line-2425"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2426"><a id="line-2426" name="line-2426"></a>  <span class="k">intros</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-2427"><a id="line-2427" name="line-2427"></a>  <span class="k">eapply</span> <span class="n">melem_of_fmap</span> <span class="k">in</span> <span class="n">H</span><span class="o">;</span> <span class="kr">last</span> <span class="k">apply</span> <span class="o">_.</span>
</span><span id="linespan-2428"><a id="line-2428" name="line-2428"></a>  <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2429"><a id="line-2429" name="line-2429"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2430"><a id="line-2430" name="line-2430"></a>
</span><span id="linespan-2431"><a id="line-2431" name="line-2431"></a><span class="kn">Lemma</span> <span class="n">melem_of_extract</span> <span class="o">(</span><span class="n">a</span><span class="o">:</span><span class="n">labelO'</span><span class="o">)</span> <span class="n">l</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2432"><a id="line-2432" name="line-2432"></a>  <span class="n">melem_of</span> <span class="n">a</span> <span class="o">(</span><span class="n">extract</span> <span class="n">l</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">∃</span> <span class="n">aa</span><span class="o">,</span> <span class="n">melem_of</span> <span class="o">(</span><span class="n">LockLabel</span> <span class="n">aa</span><span class="o">)</span> <span class="n">x</span> <span class="o">∧</span> <span class="n">melem_of</span> <span class="n">a</span> <span class="o">(</span><span class="n">extract1</span> <span class="n">l</span> <span class="n">aa</span><span class="o">).</span>
</span><span id="linespan-2433"><a id="line-2433" name="line-2433"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2434"><a id="line-2434" name="line-2434"></a>  <span class="k">intros</span> <span class="n">H</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">extract</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-2435"><a id="line-2435" name="line-2435"></a>  <span class="k">apply</span> <span class="n">melem_of_list_to_multiset</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2436"><a id="line-2436" name="line-2436"></a>  <span class="k">eapply</span> <span class="n">elem_of_flat_map</span> <span class="k">in</span> <span class="n">H2</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">H</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2437"><a id="line-2437" name="line-2437"></a>  <span class="o">{</span> <span class="k">apply</span> <span class="n">elem_of_nil</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2438"><a id="line-2438" name="line-2438"></a>  <span class="k">eapply</span> <span class="n">elem_of_list_fmap</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2439"><a id="line-2439" name="line-2439"></a>  <span class="k">eapply</span> <span class="n">elem_of_list_filter</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">H</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2440"><a id="line-2440" name="line-2440"></a>  <span class="k">apply</span> <span class="n">elem_of_multiset_car</span> <span class="k">in</span> <span class="n">H2</span><span class="o">.</span>
</span><span id="linespan-2441"><a id="line-2441" name="line-2441"></a>  <span class="n">eexists</span><span class="o">;</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2442"><a id="line-2442" name="line-2442"></a>  <span class="k">unfold</span> <span class="n">extract1</span><span class="o">.</span>
</span><span id="linespan-2443"><a id="line-2443" name="line-2443"></a>  <span class="k">apply</span> <span class="n">melem_of_list_to_multiset'</span><span class="o">.</span>
</span><span id="linespan-2444"><a id="line-2444" name="line-2444"></a>  <span class="k">simpl</span><span class="o">.</span> <span class="k">apply</span> <span class="n">elem_of_list_fmap</span><span class="o">.</span> <span class="n">eexists</span><span class="o">.</span>
</span><span id="linespan-2445"><a id="line-2445" name="line-2445"></a>  <span class="k">split</span><span class="o">;</span> <span class="kr">last</span> <span class="kr">first</span><span class="o">.</span>
</span><span id="linespan-2446"><a id="line-2446" name="line-2446"></a>  <span class="o">{</span> <span class="k">apply</span> <span class="n">elem_of_list_filter</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2447"><a id="line-2447" name="line-2447"></a>  <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2448"><a id="line-2448" name="line-2448"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2449"><a id="line-2449" name="line-2449"></a>
</span><span id="linespan-2450"><a id="line-2450" name="line-2450"></a><span class="kn">Lemma</span> <span class="n">melem_of_extract1</span> <span class="n">xs</span> <span class="n">a</span> <span class="n">l</span> <span class="o">:</span>
</span><span id="linespan-2451"><a id="line-2451" name="line-2451"></a>  <span class="n">melem_of</span> <span class="n">a</span> <span class="o">(</span><span class="n">extract1</span> <span class="n">l</span> <span class="n">xs</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="n">l</span><span class="o">,</span><span class="n">a</span><span class="o">)</span> <span class="bp">∈</span> <span class="n">xs</span><span class="o">.</span>
</span><span id="linespan-2452"><a id="line-2452" name="line-2452"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2453"><a id="line-2453" name="line-2453"></a>  <span class="k">intros</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-2454"><a id="line-2454" name="line-2454"></a>  <span class="k">apply</span> <span class="n">melem_of_list_to_multiset</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2455"><a id="line-2455" name="line-2455"></a>  <span class="k">unfold</span> <span class="n">extract1</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-2456"><a id="line-2456" name="line-2456"></a>  <span class="k">simpl</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-2457"><a id="line-2457" name="line-2457"></a>  <span class="k">eapply</span> <span class="n">elem_of_list_fmap</span> <span class="k">in</span> <span class="n">H2</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2458"><a id="line-2458" name="line-2458"></a>  <span class="k">eapply</span> <span class="n">elem_of_list_filter</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2459"><a id="line-2459" name="line-2459"></a>  <span class="k">destruct</span> <span class="n">H</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2460"><a id="line-2460" name="line-2460"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2461"><a id="line-2461" name="line-2461"></a>
</span><span id="linespan-2462"><a id="line-2462" name="line-2462"></a><span class="kn">Lemma</span> <span class="n">all_closed_extract</span> <span class="n">x</span> <span class="n">l</span> <span class="o">:</span>
</span><span id="linespan-2463"><a id="line-2463" name="line-2463"></a>  <span class="n">all_closed</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">all_closed1</span> <span class="o">(</span><span class="n">extract</span> <span class="n">l</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-2464"><a id="line-2464" name="line-2464"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2465"><a id="line-2465" name="line-2465"></a>  <span class="k">unfold</span> <span class="n">all_closed</span><span class="o">,</span> <span class="n">all_closed1</span><span class="o">.</span>
</span><span id="linespan-2466"><a id="line-2466" name="line-2466"></a>  <span class="k">intros</span> <span class="n">H</span> <span class="n">a</span> <span class="n">HH</span><span class="o">.</span>
</span><span id="linespan-2467"><a id="line-2467" name="line-2467"></a>  <span class="k">eapply</span> <span class="n">melem_of_extract</span> <span class="k">in</span> <span class="n">HH</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2468"><a id="line-2468" name="line-2468"></a>  <span class="k">eapply</span> <span class="n">melem_of_forall</span> <span class="k">in</span> <span class="n">H2</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2469"><a id="line-2469" name="line-2469"></a>  <span class="k">eapply</span> <span class="n">melem_of_extract1</span> <span class="k">in</span> <span class="n">H3</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2470"><a id="line-2470" name="line-2470"></a>  <span class="n">specialize</span> <span class="o">(</span><span class="n">H5</span> <span class="o">_</span> <span class="n">H3</span><span class="o">).</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2471"><a id="line-2471" name="line-2471"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2472"><a id="line-2472" name="line-2472"></a>
</span><span id="linespan-2473"><a id="line-2473" name="line-2473"></a><span class="kn">Lemma</span> <span class="n">lockrel_all_closed1</span> <span class="n">x</span> <span class="n">n</span> <span class="n">o</span> <span class="n">t</span> <span class="o">:</span>
</span><span id="linespan-2474"><a id="line-2474" name="line-2474"></a>  <span class="n">all_closed1</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-2475"><a id="line-2475" name="line-2475"></a>  <span class="n">lockrel</span> <span class="n">n</span> <span class="n">o</span> <span class="n">t</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-2476"><a id="line-2476" name="line-2476"></a>  <span class="n">is_Some</span> <span class="n">o</span><span class="o">.</span>
</span><span id="linespan-2477"><a id="line-2477" name="line-2477"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2478"><a id="line-2478" name="line-2478"></a>  <span class="k">intros</span> <span class="n">H1</span> <span class="bp">[]</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">o</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2479"><a id="line-2479" name="line-2479"></a>  <span class="n">exfalso</span><span class="o">.</span>
</span><span id="linespan-2480"><a id="line-2480" name="line-2480"></a>  <span class="k">destruct</span> <span class="n">lr_openedclosed</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2481"><a id="line-2481" name="line-2481"></a>  <span class="o">-</span> <span class="k">unfold</span> <span class="n">all_closed1</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-2482"><a id="line-2482" name="line-2482"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">melem_of</span> <span class="o">((</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">)</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-2483"><a id="line-2483" name="line-2483"></a>    <span class="o">{</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">-</span><span class="n">assoc</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2484"><a id="line-2484" name="line-2484"></a>    <span class="k">eapply</span> <span class="n">melem_of_forall</span> <span class="k">in</span> <span class="n">H</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2485"><a id="line-2485" name="line-2485"></a>  <span class="o">-</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-2486"><a id="line-2486" name="line-2486"></a>    <span class="k">rewrite</span> <span class="n">comm</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span>
</span><span id="linespan-2487"><a id="line-2487" name="line-2487"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">melem_of</span> <span class="o">((</span><span class="n">Client</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">)</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-2488"><a id="line-2488" name="line-2488"></a>    <span class="o">{</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2489"><a id="line-2489" name="line-2489"></a>    <span class="k">eapply</span> <span class="n">melem_of_forall</span> <span class="k">in</span> <span class="n">H</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2490"><a id="line-2490" name="line-2490"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2491"><a id="line-2491" name="line-2491"></a>
</span><span id="linespan-2492"><a id="line-2492" name="line-2492"></a><span class="kn">Lemma</span> <span class="n">all_closed_acquire_progress</span> <span class="n">order</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">x</span> <span class="n">ls</span> <span class="o">:</span>
</span><span id="linespan-2493"><a id="line-2493" name="line-2493"></a>  <span class="n">all_closed</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-2494"><a id="line-2494" name="line-2494"></a>  <span class="n">lockrelG'</span> <span class="n">order</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-2495"><a id="line-2495" name="line-2495"></a>  <span class="n">melem_of</span> <span class="o">(</span><span class="n">LockLabel</span> <span class="n">ls</span><span class="o">)</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-2496"><a id="line-2496" name="line-2496"></a>  <span class="n">acquire_progress</span> <span class="n">lcks</span> <span class="n">ls</span><span class="o">.</span>
</span><span id="linespan-2497"><a id="line-2497" name="line-2497"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2498"><a id="line-2498" name="line-2498"></a>  <span class="k">intros</span> <span class="n">H1</span> <span class="n">H2</span> <span class="n">H3</span><span class="o">.</span>
</span><span id="linespan-2499"><a id="line-2499" name="line-2499"></a>  <span class="k">assert</span> <span class="o">(∀</span> <span class="n">l</span><span class="o">,</span> <span class="n">l</span> <span class="bp">∈</span> <span class="n">ls</span> <span class="o">-&gt;</span> <span class="o">∃</span> <span class="n">rc</span> <span class="n">v</span><span class="o">,</span> <span class="n">lcks</span> <span class="o">!!</span> <span class="n">l</span><span class="o">.</span><span class="mi">1</span> <span class="o">=</span> <span class="n">Some</span><span class="o">(</span><span class="n">rc</span><span class="o">,</span> <span class="n">Some</span> <span class="n">v</span><span class="o">)).</span>
</span><span id="linespan-2500"><a id="line-2500" name="line-2500"></a>  <span class="o">{</span>
</span><span id="linespan-2501"><a id="line-2501" name="line-2501"></a>    <span class="k">intros</span> <span class="n">l</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-2502"><a id="line-2502" name="line-2502"></a>    <span class="k">destruct</span> <span class="n">H2</span><span class="o">.</span>
</span><span id="linespan-2503"><a id="line-2503" name="line-2503"></a>    <span class="k">assert</span><span class="o">(</span><span class="n">is_Some</span><span class="o">(</span><span class="n">lcks</span> <span class="o">!!</span> <span class="n">l</span><span class="o">.</span><span class="mi">1</span><span class="o">))</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-2504"><a id="line-2504" name="line-2504"></a>    <span class="o">{</span>
</span><span id="linespan-2505"><a id="line-2505" name="line-2505"></a>      <span class="k">eapply</span> <span class="n">melem_of_forall</span> <span class="k">in</span> <span class="n">H3</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2506"><a id="line-2506" name="line-2506"></a>      <span class="k">destruct</span> <span class="n">l</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2507"><a id="line-2507" name="line-2507"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">n</span> <span class="bp">∈</span> <span class="n">H0</span><span class="o">.*</span><span class="mi">1</span><span class="o">).</span>
</span><span id="linespan-2508"><a id="line-2508" name="line-2508"></a>      <span class="o">{</span> <span class="k">eapply</span> <span class="n">elem_of_list_fmap</span><span class="o">.</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2509"><a id="line-2509" name="line-2509"></a>      <span class="k">eapply</span> <span class="n">sublist_elem_of</span> <span class="k">in</span> <span class="n">H4</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2510"><a id="line-2510" name="line-2510"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">n</span> <span class="bp">∈</span> <span class="o">(</span><span class="n">list_to_set</span> <span class="n">order</span> <span class="o">:</span> <span class="n">gset</span> <span class="n">nat</span><span class="o">)).</span>
</span><span id="linespan-2511"><a id="line-2511" name="line-2511"></a>      <span class="o">{</span> <span class="k">eapply</span> <span class="n">elem_of_list_to_set</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2512"><a id="line-2512" name="line-2512"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">n</span> <span class="bp">∈</span> <span class="n">dom</span> <span class="n">lcks</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2513"><a id="line-2513" name="line-2513"></a>      <span class="o">{</span> <span class="k">rewrite</span> <span class="o">-</span><span class="n">order_dom0</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2514"><a id="line-2514" name="line-2514"></a>      <span class="k">eapply</span> <span class="n">elem_of_dom</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2515"><a id="line-2515" name="line-2515"></a>    <span class="o">}</span>
</span><span id="linespan-2516"><a id="line-2516" name="line-2516"></a>    <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_lockrel0</span> <span class="n">l</span><span class="o">.</span><span class="mi">1</span><span class="o">).</span>
</span><span id="linespan-2517"><a id="line-2517" name="line-2517"></a>    <span class="k">rewrite</span> <span class="n">H0</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">x0</span><span class="o">.</span>
</span><span id="linespan-2518"><a id="line-2518" name="line-2518"></a>    <span class="k">destruct</span> <span class="o">(</span><span class="n">t</span> <span class="o">!!</span> <span class="n">l</span><span class="o">.</span><span class="mi">1</span><span class="o">);</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2519"><a id="line-2519" name="line-2519"></a>    <span class="k">destruct</span> <span class="n">o</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2520"><a id="line-2520" name="line-2520"></a>    <span class="n">exfalso</span><span class="o">.</span>
</span><span id="linespan-2521"><a id="line-2521" name="line-2521"></a>    <span class="k">eapply</span> <span class="n">lockrel_all_closed1</span> <span class="k">in</span> <span class="n">lr_lockrel0</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">all_closed_extract</span><span class="o">.</span>
</span><span id="linespan-2522"><a id="line-2522" name="line-2522"></a>    <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2523"><a id="line-2523" name="line-2523"></a>  <span class="o">}</span>
</span><span id="linespan-2524"><a id="line-2524" name="line-2524"></a>  <span class="k">clear</span> <span class="n">H3</span> <span class="n">H2</span> <span class="n">H1</span><span class="o">.</span>
</span><span id="linespan-2525"><a id="line-2525" name="line-2525"></a>  <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2526"><a id="line-2526" name="line-2526"></a>  <span class="k">destruct</span> <span class="n">a</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">l</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">l0</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2527"><a id="line-2527" name="line-2527"></a>  <span class="k">split</span><span class="o">.</span>
</span><span id="linespan-2528"><a id="line-2528" name="line-2528"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">IHls</span><span class="o">.</span> <span class="k">intros</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">H</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">elem_of_cons</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2529"><a id="line-2529" name="line-2529"></a>  <span class="o">-</span> <span class="n">edestruct</span> <span class="n">H</span><span class="o">.</span> <span class="o">{</span> <span class="k">eapply</span> <span class="n">elem_of_cons</span><span class="o">.</span> <span class="k">left</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2530"><a id="line-2530" name="line-2530"></a>    <span class="n">simp</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2531"><a id="line-2531" name="line-2531"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2532"><a id="line-2532" name="line-2532"></a>
</span><span id="linespan-2533"><a id="line-2533" name="line-2533"></a><span class="kn">Lemma</span> <span class="n">lockrel_nonempty</span> <span class="n">n</span> <span class="n">o</span> <span class="n">t</span> <span class="o">:</span>
</span><span id="linespan-2534"><a id="line-2534" name="line-2534"></a>  <span class="o">¬</span> <span class="n">lockrel</span> <span class="n">n</span> <span class="n">o</span> <span class="n">t</span> <span class="n">ε</span><span class="o">.</span>
</span><span id="linespan-2535"><a id="line-2535" name="line-2535"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2536"><a id="line-2536" name="line-2536"></a>  <span class="k">intros</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-2537"><a id="line-2537" name="line-2537"></a>  <span class="k">symmetry</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span>
</span><span id="linespan-2538"><a id="line-2538" name="line-2538"></a>  <span class="k">eapply</span> <span class="n">multiset_empty_mult</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2539"><a id="line-2539" name="line-2539"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2540"><a id="line-2540" name="line-2540"></a>
</span><span id="linespan-2541"><a id="line-2541" name="line-2541"></a><span class="kn">Lemma</span> <span class="n">lockrelG'_refcnt_0</span> <span class="n">order</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2542"><a id="line-2542" name="line-2542"></a>  <span class="n">lockrelG'</span> <span class="n">order</span> <span class="mi">0</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">order</span> <span class="o">=</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-2543"><a id="line-2543" name="line-2543"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2544"><a id="line-2544" name="line-2544"></a>  <span class="k">intros</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-2545"><a id="line-2545" name="line-2545"></a>  <span class="k">eapply</span> <span class="n">Mlen_zero_inv</span> <span class="k">in</span> <span class="n">lr_refcount0</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2546"><a id="line-2546" name="line-2546"></a>  <span class="k">destruct</span> <span class="n">order</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="n">exfalso</span><span class="o">.</span>
</span><span id="linespan-2547"><a id="line-2547" name="line-2547"></a>  <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_lockrel0</span> <span class="n">n</span><span class="o">).</span>
</span><span id="linespan-2548"><a id="line-2548" name="line-2548"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">lcks</span> <span class="o">!!</span> <span class="n">n</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">E</span><span class="o">.</span>
</span><span id="linespan-2549"><a id="line-2549" name="line-2549"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">t</span> <span class="o">!!</span> <span class="n">n</span><span class="o">);</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2550"><a id="line-2550" name="line-2550"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">extract</span> <span class="n">n</span> <span class="n">ε</span> <span class="o">=</span> <span class="n">ε</span><span class="o">)</span> <span class="kp">by</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2551"><a id="line-2551" name="line-2551"></a>    <span class="k">rewrite</span> <span class="n">H</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-2552"><a id="line-2552" name="line-2552"></a>    <span class="k">eapply</span> <span class="n">lockrel_nonempty</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2553"><a id="line-2553" name="line-2553"></a>  <span class="o">-</span> <span class="k">assert</span> <span class="o">(</span><span class="n">n</span> <span class="bp">∈</span> <span class="n">dom</span> <span class="n">lcks</span><span class="o">)</span> <span class="kp">by</span> <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-2554"><a id="line-2554" name="line-2554"></a>    <span class="k">eapply</span> <span class="n">elem_of_dom</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-2555"><a id="line-2555" name="line-2555"></a>    <span class="k">rewrite</span> <span class="n">E</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="kp">congruence</span><span class="o">.</span>
</span><span id="linespan-2556"><a id="line-2556" name="line-2556"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2557"><a id="line-2557" name="line-2557"></a>
</span><span id="linespan-2558"><a id="line-2558" name="line-2558"></a><span class="kn">Lemma</span> <span class="n">lockrelG'_empty_elem</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2559"><a id="line-2559" name="line-2559"></a>  <span class="n">lockrelG'</span> <span class="bp">[]</span> <span class="o">(</span><span class="n">S</span> <span class="n">refcnt</span><span class="o">)</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-2560"><a id="line-2560" name="line-2560"></a>  <span class="n">melem_of</span> <span class="o">(</span><span class="n">LockLabel</span> <span class="bp">[]</span><span class="o">)</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-2561"><a id="line-2561" name="line-2561"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2562"><a id="line-2562" name="line-2562"></a>  <span class="k">intros</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-2563"><a id="line-2563" name="line-2563"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">mset_empty_or_not</span> <span class="n">x</span><span class="o">);</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2564"><a id="line-2564" name="line-2564"></a>  <span class="k">destruct</span> <span class="n">H0</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2565"><a id="line-2565" name="line-2565"></a>  <span class="o">{</span> <span class="k">eapply</span> <span class="n">melem_of_forall</span> <span class="k">in</span> <span class="n">H1</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2566"><a id="line-2566" name="line-2566"></a>  <span class="k">destruct</span> <span class="n">ls</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2567"><a id="line-2567" name="line-2567"></a>  <span class="k">eapply</span> <span class="n">melem_of_forall</span> <span class="k">in</span> <span class="n">H1</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2568"><a id="line-2568" name="line-2568"></a>  <span class="n">inv</span> <span class="n">H2</span><span class="o">.</span>
</span><span id="linespan-2569"><a id="line-2569" name="line-2569"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2570"><a id="line-2570" name="line-2570"></a>
</span><span id="linespan-2571"><a id="line-2571" name="line-2571"></a><span class="kn">Lemma</span> <span class="n">mset_forall_fmap</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="o">)</span> <span class="n">P</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2572"><a id="line-2572" name="line-2572"></a>  <span class="n">Proper</span> <span class="o">(</span><span class="n">equiv</span> <span class="o">==&gt;</span> <span class="n">equiv</span><span class="o">)</span> <span class="n">f</span> <span class="o">-&gt;</span>
</span><span id="linespan-2573"><a id="line-2573" name="line-2573"></a>  <span class="n">Proper</span> <span class="o">(</span><span class="n">equiv</span> <span class="o">==&gt;</span> <span class="n">equiv</span><span class="o">)</span> <span class="n">P</span> <span class="o">-&gt;</span>
</span><span id="linespan-2574"><a id="line-2574" name="line-2574"></a>  <span class="n">mset_forall</span> <span class="o">(</span><span class="n">P</span> <span class="bp">∘</span> <span class="n">f</span><span class="o">)</span> <span class="n">x</span> <span class="o">&lt;-&gt;</span> <span class="n">mset_forall</span> <span class="n">P</span> <span class="o">(</span><span class="n">mset_fmap</span> <span class="n">f</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-2575"><a id="line-2575" name="line-2575"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2576"><a id="line-2576" name="line-2576"></a>  <span class="k">intros</span> <span class="n">HH1</span> <span class="n">HH2</span><span class="o">.</span>
</span><span id="linespan-2577"><a id="line-2577" name="line-2577"></a>  <span class="k">split</span><span class="o">;</span>
</span><span id="linespan-2578"><a id="line-2578" name="line-2578"></a>  <span class="k">intros</span> <span class="o">???.</span>
</span><span id="linespan-2579"><a id="line-2579" name="line-2579"></a>  <span class="o">-</span> <span class="k">unfold</span> <span class="n">mset_forall</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-2580"><a id="line-2580" name="line-2580"></a>    <span class="k">apply</span> <span class="n">melem_of_fmap</span> <span class="k">in</span> <span class="n">H0</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2581"><a id="line-2581" name="line-2581"></a>    <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">H</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2582"><a id="line-2582" name="line-2582"></a>  <span class="o">-</span> <span class="k">eapply</span> <span class="n">H</span><span class="o">.</span> <span class="k">apply</span> <span class="n">melem_of_fmap</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2583"><a id="line-2583" name="line-2583"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2584"><a id="line-2584" name="line-2584"></a>
</span><span id="linespan-2585"><a id="line-2585" name="line-2585"></a><span class="kn">Lemma</span> <span class="n">extract_delcol_ne</span> <span class="n">i</span> <span class="n">a</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2586"><a id="line-2586" name="line-2586"></a>  <span class="n">i</span> <span class="o">≠</span> <span class="n">a</span> <span class="o">-&gt;</span>
</span><span id="linespan-2587"><a id="line-2587" name="line-2587"></a>  <span class="n">extract</span> <span class="n">i</span> <span class="o">(</span><span class="n">delcol</span> <span class="n">a</span> <span class="n">x</span><span class="o">)</span> <span class="o">=</span> <span class="n">extract</span> <span class="n">i</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-2588"><a id="line-2588" name="line-2588"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2589"><a id="line-2589" name="line-2589"></a>  <span class="k">intros</span> <span class="n">Hneq</span><span class="o">.</span>
</span><span id="linespan-2590"><a id="line-2590" name="line-2590"></a>  <span class="k">unfold</span> <span class="n">extract</span><span class="o">.</span> <span class="n">f_equal</span><span class="o">.</span>
</span><span id="linespan-2591"><a id="line-2591" name="line-2591"></a>  <span class="k">unfold</span> <span class="n">delcol</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-2592"><a id="line-2592" name="line-2592"></a>  <span class="k">induction</span> <span class="o">(</span><span class="n">multiset_car</span> <span class="n">x</span><span class="o">);</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2593"><a id="line-2593" name="line-2593"></a>  <span class="k">rewrite</span> <span class="n">IHl</span><span class="o">.</span>
</span><span id="linespan-2594"><a id="line-2594" name="line-2594"></a>  <span class="k">destruct</span> <span class="n">a0</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">clear</span> <span class="n">IHl</span><span class="o">.</span>
</span><span id="linespan-2595"><a id="line-2595" name="line-2595"></a>  <span class="n">f_equal</span><span class="o">.</span> <span class="n">f_equal</span><span class="o">.</span>
</span><span id="linespan-2596"><a id="line-2596" name="line-2596"></a>  <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2597"><a id="line-2597" name="line-2597"></a>  <span class="k">rewrite</span> <span class="n">filter_cons</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">a0</span><span class="o">.</span>
</span><span id="linespan-2598"><a id="line-2598" name="line-2598"></a>  <span class="n">case_decide</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="k">rewrite</span> <span class="o">!</span><span class="n">filter_cons</span><span class="o">;</span>
</span><span id="linespan-2599"><a id="line-2599" name="line-2599"></a>  <span class="kr">repeat</span> <span class="n">case_decide</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="n">f_equal</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2600"><a id="line-2600" name="line-2600"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2601"><a id="line-2601" name="line-2601"></a>
</span><span id="linespan-2602"><a id="line-2602" name="line-2602"></a><span class="kn">Lemma</span> <span class="n">Mlen_fmap</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="n">B</span><span class="o">)</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2603"><a id="line-2603" name="line-2603"></a>  <span class="n">Mlen</span> <span class="o">(</span><span class="n">mset_fmap</span> <span class="n">f</span> <span class="n">x</span><span class="o">)</span> <span class="o">=</span> <span class="n">Mlen</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-2604"><a id="line-2604" name="line-2604"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2605"><a id="line-2605" name="line-2605"></a>  <span class="k">unfold</span> <span class="n">mset_fmap</span><span class="o">.</span>
</span><span id="linespan-2606"><a id="line-2606" name="line-2606"></a>  <span class="k">unfold</span> <span class="n">Mlen</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-2607"><a id="line-2607" name="line-2607"></a>  <span class="k">rewrite</span> <span class="n">fmap_length</span> <span class="o">//.</span>
</span><span id="linespan-2608"><a id="line-2608" name="line-2608"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2609"><a id="line-2609" name="line-2609"></a>
</span><span id="linespan-2610"><a id="line-2610" name="line-2610"></a><span class="kn">Lemma</span> <span class="n">filter_proj</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span><span class="o">}</span> <span class="o">(</span><span class="n">xs</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">A</span><span class="o">*</span><span class="n">B</span><span class="o">))</span> <span class="n">P</span> <span class="o">`{∀</span> <span class="n">x</span><span class="o">,</span> <span class="n">Decision</span> <span class="o">(</span><span class="n">P</span> <span class="n">x</span><span class="o">)}:</span>
</span><span id="linespan-2611"><a id="line-2611" name="line-2611"></a>  <span class="o">(</span><span class="n">filter</span> <span class="o">(λ</span> <span class="k">'</span><span class="o">(</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">),</span> <span class="n">P</span> <span class="n">a</span><span class="o">)</span> <span class="n">xs</span><span class="o">).*</span><span class="mi">1</span> <span class="o">=</span> <span class="n">filter</span> <span class="n">P</span> <span class="o">(</span><span class="n">xs</span><span class="o">.*</span><span class="mi">1</span><span class="o">).</span>
</span><span id="linespan-2612"><a id="line-2612" name="line-2612"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2613"><a id="line-2613" name="line-2613"></a>  <span class="k">induction</span> <span class="n">xs</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2614"><a id="line-2614" name="line-2614"></a>  <span class="k">rewrite</span> <span class="o">!</span><span class="n">filter_cons</span><span class="o">.</span>
</span><span id="linespan-2615"><a id="line-2615" name="line-2615"></a>  <span class="k">destruct</span> <span class="n">a</span><span class="o">.</span> <span class="kr">repeat</span> <span class="n">case_decide</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span>
</span><span id="linespan-2616"><a id="line-2616" name="line-2616"></a>  <span class="k">rewrite</span> <span class="o">?</span><span class="n">IHxs</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2617"><a id="line-2617" name="line-2617"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2618"><a id="line-2618" name="line-2618"></a>
</span><span id="linespan-2619"><a id="line-2619" name="line-2619"></a><span class="kn">Lemma</span> <span class="n">filter_sublist_mono</span> <span class="o">{</span><span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">xs</span> <span class="n">ys</span> <span class="o">:</span> <span class="n">list</span> <span class="n">A</span><span class="o">)</span> <span class="n">P</span> <span class="o">`{∀</span> <span class="n">x</span><span class="o">,</span> <span class="n">Decision</span> <span class="o">(</span><span class="n">P</span> <span class="n">x</span><span class="o">)}</span> <span class="o">:</span>
</span><span id="linespan-2620"><a id="line-2620" name="line-2620"></a>  <span class="n">xs</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">ys</span> <span class="o">-&gt;</span>
</span><span id="linespan-2621"><a id="line-2621" name="line-2621"></a>  <span class="n">filter</span> <span class="n">P</span> <span class="n">xs</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">ys</span><span class="o">.</span>
</span><span id="linespan-2622"><a id="line-2622" name="line-2622"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2623"><a id="line-2623" name="line-2623"></a>  <span class="k">induction</span> <span class="mi">1</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2624"><a id="line-2624" name="line-2624"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">filter_cons</span><span class="o">.</span> <span class="n">case_decide</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span>
</span><span id="linespan-2625"><a id="line-2625" name="line-2625"></a>    <span class="k">constructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2626"><a id="line-2626" name="line-2626"></a>  <span class="o">-</span> <span class="k">constructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2627"><a id="line-2627" name="line-2627"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2628"><a id="line-2628" name="line-2628"></a>
</span><span id="linespan-2629"><a id="line-2629" name="line-2629"></a><span class="kn">Lemma</span> <span class="n">lock_relG'_del</span> <span class="n">a</span> <span class="n">order</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2630"><a id="line-2630" name="line-2630"></a>  <span class="n">lockrelG'</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span> <span class="n">order</span><span class="o">)</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-2631"><a id="line-2631" name="line-2631"></a>  <span class="n">lockrelG'</span> <span class="n">order</span> <span class="n">refcnt</span> <span class="o">(</span><span class="n">delete</span> <span class="n">a</span> <span class="n">lcks</span><span class="o">)</span> <span class="o">(</span><span class="n">delete</span> <span class="n">a</span> <span class="n">t</span><span class="o">)</span> <span class="o">(</span><span class="n">delcol</span> <span class="n">a</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-2632"><a id="line-2632" name="line-2632"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2633"><a id="line-2633" name="line-2633"></a>  <span class="k">intros</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-2634"><a id="line-2634" name="line-2634"></a>  <span class="k">rewrite</span> <span class="n">list_to_set_cons</span> <span class="k">in</span> <span class="n">order_dom0</span><span class="o">.</span>
</span><span id="linespan-2635"><a id="line-2635" name="line-2635"></a>  <span class="k">apply</span> <span class="n">NoDup_cons</span> <span class="k">in</span> <span class="n">order_NoDup0</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2636"><a id="line-2636" name="line-2636"></a>  <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2637"><a id="line-2637" name="line-2637"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">dom_delete_L</span><span class="o">.</span> <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-2638"><a id="line-2638" name="line-2638"></a>  <span class="o">-</span> <span class="k">unfold</span> <span class="n">delcol</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">-</span><span class="n">mset_forall_fmap</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-2639"><a id="line-2639" name="line-2639"></a>    <span class="k">eapply</span> <span class="n">mset_forall_impl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2640"><a id="line-2640" name="line-2640"></a>    <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2641"><a id="line-2641" name="line-2641"></a>    <span class="n">inv</span> <span class="n">H4</span><span class="o">.</span>
</span><span id="linespan-2642"><a id="line-2642" name="line-2642"></a>    <span class="o">+</span> <span class="k">destruct</span> <span class="n">H2</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2643"><a id="line-2643" name="line-2643"></a>      <span class="k">rewrite</span> <span class="n">filter_proj</span><span class="o">.</span>
</span><span id="linespan-2644"><a id="line-2644" name="line-2644"></a>      <span class="k">rewrite</span> <span class="n">fmap_cons</span> <span class="n">filter_cons</span><span class="o">.</span>
</span><span id="linespan-2645"><a id="line-2645" name="line-2645"></a>      <span class="n">case_decide</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2646"><a id="line-2646" name="line-2646"></a>      <span class="k">apply</span> <span class="n">filter_sublist_mono</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2647"><a id="line-2647" name="line-2647"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="n">filter_proj</span><span class="o">.</span> <span class="k">apply</span> <span class="n">filter_sublist_mono</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2648"><a id="line-2648" name="line-2648"></a>  <span class="o">-</span> <span class="k">intros</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_lockrel0</span> <span class="n">i</span><span class="o">).</span>
</span><span id="linespan-2649"><a id="line-2649" name="line-2649"></a>    <span class="k">destruct</span> <span class="o">(</span><span class="n">lcks</span> <span class="o">!!</span> <span class="n">i</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">EE</span><span class="o">;</span> <span class="k">rewrite</span> <span class="n">EE</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2650"><a id="line-2650" name="line-2650"></a>    <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">t</span> <span class="o">!!</span> <span class="n">i</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">FF</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2651"><a id="line-2651" name="line-2651"></a>    <span class="k">rewrite</span> <span class="n">extract_delcol_ne</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2652"><a id="line-2652" name="line-2652"></a>  <span class="o">-</span> <span class="k">apply</span> <span class="n">fmap_length</span><span class="o">.</span>
</span><span id="linespan-2653"><a id="line-2653" name="line-2653"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2654"><a id="line-2654" name="line-2654"></a>
</span><span id="linespan-2655"><a id="line-2655" name="line-2655"></a><span class="kn">Lemma</span> <span class="n">all_closed_del</span> <span class="n">x</span> <span class="n">a</span> <span class="o">:</span>
</span><span id="linespan-2656"><a id="line-2656" name="line-2656"></a>  <span class="n">all_closed</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">all_closed</span> <span class="o">(</span><span class="n">delcol</span> <span class="n">a</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-2657"><a id="line-2657" name="line-2657"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2658"><a id="line-2658" name="line-2658"></a>  <span class="k">intros</span> <span class="n">H</span> <span class="n">l</span> <span class="n">H1</span><span class="o">.</span>
</span><span id="linespan-2659"><a id="line-2659" name="line-2659"></a>  <span class="k">unfold</span> <span class="n">all_closed</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-2660"><a id="line-2660" name="line-2660"></a>  <span class="k">eapply</span> <span class="n">melem_of_fmap</span> <span class="k">in</span> <span class="n">H1</span><span class="o">;</span> <span class="kr">last</span> <span class="k">apply</span> <span class="o">_.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2661"><a id="line-2661" name="line-2661"></a>  <span class="k">eapply</span> <span class="n">H</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="n">eexists</span><span class="o">;</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2662"><a id="line-2662" name="line-2662"></a>  <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-2663"><a id="line-2663" name="line-2663"></a>  <span class="k">eapply</span> <span class="n">elem_of_list_filter</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">x0</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2664"><a id="line-2664" name="line-2664"></a>  <span class="k">eapply</span> <span class="n">H4</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2665"><a id="line-2665" name="line-2665"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2666"><a id="line-2666" name="line-2666"></a>
</span><span id="linespan-2667"><a id="line-2667" name="line-2667"></a><span class="kn">Definition</span> <span class="n">has_open</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">multiset</span> <span class="n">labelO'</span><span class="o">)</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="o">:=</span>
</span><span id="linespan-2668"><a id="line-2668" name="line-2668"></a>  <span class="o">∃</span> <span class="n">lo</span> <span class="n">t</span><span class="o">,</span> <span class="n">melem_of</span> <span class="o">(((</span><span class="n">lo</span><span class="o">,</span> <span class="n">Opened</span><span class="o">),</span><span class="n">t</span><span class="o">):</span><span class="n">labelO'</span><span class="o">)</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-2669"><a id="line-2669" name="line-2669"></a>
</span><span id="linespan-2670"><a id="line-2670" name="line-2670"></a><span class="kn">Lemma</span> <span class="n">acquire_progress_extend</span> <span class="n">a</span> <span class="n">lcks</span> <span class="n">ls</span> <span class="n">rc</span> <span class="n">v</span> <span class="o">:</span>
</span><span id="linespan-2671"><a id="line-2671" name="line-2671"></a>  <span class="n">acquire_progress</span> <span class="o">(</span><span class="n">delete</span> <span class="n">a</span> <span class="n">lcks</span><span class="o">)</span> <span class="o">(</span><span class="n">filter</span> <span class="o">(λ</span> <span class="k">'</span><span class="o">(</span><span class="n">jj</span><span class="o">,</span> <span class="o">_),</span> <span class="n">jj</span> <span class="o">≠</span> <span class="n">a</span><span class="o">)</span> <span class="n">ls</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-2672"><a id="line-2672" name="line-2672"></a>  <span class="n">lcks</span> <span class="o">!!</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">rc</span><span class="o">,</span> <span class="n">Some</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-2673"><a id="line-2673" name="line-2673"></a>  <span class="n">acquire_progress</span> <span class="n">lcks</span> <span class="n">ls</span><span class="o">.</span>
</span><span id="linespan-2674"><a id="line-2674" name="line-2674"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2675"><a id="line-2675" name="line-2675"></a>  <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2676"><a id="line-2676" name="line-2676"></a>  <span class="k">destruct</span> <span class="n">a0</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">l</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">l0</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2677"><a id="line-2677" name="line-2677"></a>  <span class="k">rewrite</span> <span class="n">filter_cons</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="n">case_decide</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2678"><a id="line-2678" name="line-2678"></a>  <span class="o">-</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">revert</span> <span class="n">H5</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-2679"><a id="line-2679" name="line-2679"></a>  <span class="o">-</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2680"><a id="line-2680" name="line-2680"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2681"><a id="line-2681" name="line-2681"></a>
</span><span id="linespan-2682"><a id="line-2682" name="line-2682"></a><span class="kn">Lemma</span> <span class="n">lookup_zip</span> <span class="o">{</span><span class="n">A</span> <span class="n">B</span><span class="o">}</span> <span class="o">(</span><span class="n">xs</span><span class="o">:</span><span class="n">list</span> <span class="n">A</span><span class="o">)</span> <span class="o">(</span><span class="n">ys</span><span class="o">:</span><span class="n">list</span> <span class="n">B</span><span class="o">)</span> <span class="n">i</span> <span class="o">:</span>
</span><span id="linespan-2683"><a id="line-2683" name="line-2683"></a>  <span class="n">zip</span> <span class="n">xs</span> <span class="n">ys</span> <span class="o">!!</span> <span class="n">i</span> <span class="o">=</span> <span class="k">match</span> <span class="n">xs</span> <span class="o">!!</span> <span class="n">i</span><span class="o">,</span> <span class="n">ys</span> <span class="o">!!</span> <span class="n">i</span> <span class="k">with</span>
</span><span id="linespan-2684"><a id="line-2684" name="line-2684"></a>                   <span class="o">|</span> <span class="n">Some</span> <span class="n">a</span><span class="o">,</span> <span class="n">Some</span> <span class="n">b</span> <span class="o">=&gt;</span> <span class="n">Some</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span><span class="n">b</span><span class="o">)</span>
</span><span id="linespan-2685"><a id="line-2685" name="line-2685"></a>                   <span class="o">|</span> <span class="o">_,_</span> <span class="o">=&gt;</span> <span class="n">None</span>
</span><span id="linespan-2686"><a id="line-2686" name="line-2686"></a>                   <span class="k">end</span><span class="o">.</span>
</span><span id="linespan-2687"><a id="line-2687" name="line-2687"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2688"><a id="line-2688" name="line-2688"></a>  <span class="k">revert</span> <span class="n">xs</span> <span class="n">ys</span><span class="o">.</span> <span class="k">induction</span> <span class="n">i</span><span class="o">;</span> <span class="k">intros</span> <span class="bp">[]</span> <span class="bp">[]</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2689"><a id="line-2689" name="line-2689"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">l</span><span class="o">!!</span><span class="n">i</span><span class="o">);</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2690"><a id="line-2690" name="line-2690"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2691"><a id="line-2691" name="line-2691"></a>
</span><span id="linespan-2692"><a id="line-2692" name="line-2692"></a><span class="kn">Ltac</span> <span class="n">existss</span> <span class="o">:=</span> <span class="n">eexists</span><span class="o">;</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2693"><a id="line-2693" name="line-2693"></a>
</span><span id="linespan-2694"><a id="line-2694" name="line-2694"></a><span class="kn">Lemma</span> <span class="n">not_has_open_mset_forall</span> <span class="n">a</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2695"><a id="line-2695" name="line-2695"></a>  <span class="o">¬</span> <span class="n">has_open</span> <span class="o">(</span><span class="n">extract</span> <span class="n">a</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-2696"><a id="line-2696" name="line-2696"></a>  <span class="n">mset_forall</span> <span class="o">(λ</span> <span class="n">l</span><span class="o">,</span> <span class="o">∀</span> <span class="n">ls</span><span class="o">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">LockLabel</span> <span class="n">ls</span> <span class="o">-&gt;</span> <span class="o">∀</span> <span class="n">aa</span><span class="o">,</span> <span class="n">aa</span> <span class="bp">∈</span> <span class="n">ls</span> <span class="o">-&gt;</span> <span class="n">aa</span><span class="o">.</span><span class="mi">1</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-&gt;</span> <span class="n">aa</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="o">=</span> <span class="n">Closed</span><span class="o">)</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-2697"><a id="line-2697" name="line-2697"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2698"><a id="line-2698" name="line-2698"></a>  <span class="k">intros</span> <span class="o">??</span><span class="bp">[]</span><span class="o">.</span> <span class="k">intros</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2699"><a id="line-2699" name="line-2699"></a>  <span class="k">destruct</span> <span class="n">aa</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">l0</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2700"><a id="line-2700" name="line-2700"></a>  <span class="n">exfalso</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">H</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">has_open</span><span class="o">.</span>
</span><span id="linespan-2701"><a id="line-2701" name="line-2701"></a>  <span class="k">exists</span> <span class="n">l</span><span class="o">,</span> <span class="n">t</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">melem_of</span><span class="o">.</span>
</span><span id="linespan-2702"><a id="line-2702" name="line-2702"></a>  <span class="k">eapply</span> <span class="n">elem_of_list_lookup</span> <span class="k">in</span> <span class="n">H2</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2703"><a id="line-2703" name="line-2703"></a>  <span class="k">exists</span> <span class="o">(</span><span class="n">extract</span> <span class="n">n</span> <span class="n">x0</span> <span class="bp">⋅</span> <span class="n">extract1</span> <span class="n">n</span> <span class="o">(</span><span class="n">delete</span> <span class="n">H1</span> <span class="n">ls</span><span class="o">)).</span>
</span><span id="linespan-2704"><a id="line-2704" name="line-2704"></a>  <span class="k">rewrite</span> <span class="n">H0</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">extract_op</span> <span class="n">extract_singleton</span> <span class="o">//.</span>
</span><span id="linespan-2705"><a id="line-2705" name="line-2705"></a>  <span class="k">revert</span> <span class="n">H3</span><span class="o">.</span>
</span><span id="linespan-2706"><a id="line-2706" name="line-2706"></a>  <span class="k">assert</span> <span class="o">(</span><span class="n">ls</span> <span class="o">=</span> <span class="n">zip</span> <span class="o">(</span><span class="n">ls</span><span class="o">.*</span><span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="n">ls</span><span class="o">.*</span><span class="mi">2</span><span class="o">))</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-2707"><a id="line-2707" name="line-2707"></a>  <span class="o">{</span>
</span><span id="linespan-2708"><a id="line-2708" name="line-2708"></a>    <span class="k">clear</span> <span class="n">H</span> <span class="n">x0</span> <span class="n">H0</span> <span class="n">H1</span> <span class="n">l</span> <span class="n">t</span> <span class="n">n</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-2709"><a id="line-2709" name="line-2709"></a>    <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">a</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="n">f_equal</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2710"><a id="line-2710" name="line-2710"></a>  <span class="o">}</span>
</span><span id="linespan-2711"><a id="line-2711" name="line-2711"></a>  <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-2712"><a id="line-2712" name="line-2712"></a>  <span class="k">rewrite</span> <span class="n">lookup_zip</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span>
</span><span id="linespan-2713"><a id="line-2713" name="line-2713"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">ls</span><span class="o">.*</span><span class="mi">1</span> <span class="o">!!</span> <span class="n">H1</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">EE</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2714"><a id="line-2714" name="line-2714"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">ls</span><span class="o">.*</span><span class="mi">2</span> <span class="o">!!</span> <span class="n">H1</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">FF</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="kr">last</span> <span class="kr">first</span><span class="o">.</span>
</span><span id="linespan-2715"><a id="line-2715" name="line-2715"></a>  <span class="o">{</span> <span class="k">rewrite</span> <span class="n">FF</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2716"><a id="line-2716" name="line-2716"></a>  <span class="k">rewrite</span> <span class="n">FF</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2717"><a id="line-2717" name="line-2717"></a>  <span class="k">rewrite</span> <span class="n">extract1_Some</span> <span class="o">//.</span> <span class="k">rewrite</span> <span class="o">-!</span><span class="n">assoc</span><span class="o">.</span> <span class="n">f_equiv</span><span class="o">.</span>
</span><span id="linespan-2718"><a id="line-2718" name="line-2718"></a>  <span class="k">rewrite</span> <span class="n">comm</span><span class="o">.</span> <span class="n">f_equiv</span><span class="o">.</span>
</span><span id="linespan-2719"><a id="line-2719" name="line-2719"></a>  <span class="n">f_equiv</span><span class="o">.</span> <span class="k">clear</span> <span class="n">EE</span> <span class="n">FF</span> <span class="n">H0</span> <span class="n">H</span> <span class="n">x0</span><span class="o">.</span>
</span><span id="linespan-2720"><a id="line-2720" name="line-2720"></a>  <span class="k">revert</span> <span class="n">H1</span><span class="o">.</span> <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="k">intros</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2721"><a id="line-2721" name="line-2721"></a>  <span class="n">f_equal</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">IHls</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2722"><a id="line-2722" name="line-2722"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2723"><a id="line-2723" name="line-2723"></a>
</span><span id="linespan-2724"><a id="line-2724" name="line-2724"></a><span class="kn">Lemma</span> <span class="n">all_closed_has_open</span> <span class="n">x</span> <span class="n">a</span> <span class="o">:</span>
</span><span id="linespan-2725"><a id="line-2725" name="line-2725"></a>  <span class="o">¬</span> <span class="n">all_closed</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-2726"><a id="line-2726" name="line-2726"></a>  <span class="o">¬</span> <span class="n">has_open</span> <span class="o">(</span><span class="n">extract</span> <span class="n">a</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-2727"><a id="line-2727" name="line-2727"></a>  <span class="o">¬</span> <span class="n">all_closed</span> <span class="o">(</span><span class="n">delcol</span> <span class="n">a</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-2728"><a id="line-2728" name="line-2728"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2729"><a id="line-2729" name="line-2729"></a>  <span class="k">intros</span> <span class="o">???.</span>
</span><span id="linespan-2730"><a id="line-2730" name="line-2730"></a>  <span class="k">eapply</span> <span class="n">H</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">all_closed</span><span class="o">.</span>
</span><span id="linespan-2731"><a id="line-2731" name="line-2731"></a>  <span class="k">unfold</span> <span class="n">all_closed</span> <span class="k">in</span> <span class="n">H1</span><span class="o">.</span>
</span><span id="linespan-2732"><a id="line-2732" name="line-2732"></a>  <span class="k">unfold</span> <span class="n">delcol</span> <span class="k">in</span> <span class="n">H1</span><span class="o">.</span>
</span><span id="linespan-2733"><a id="line-2733" name="line-2733"></a>  <span class="k">eapply</span> <span class="n">mset_forall_fmap</span> <span class="k">in</span> <span class="n">H1</span><span class="o">;</span> <span class="kr">last</span> <span class="k">apply</span> <span class="o">_;</span> <span class="kr">last</span> <span class="k">apply</span> <span class="o">_.</span>
</span><span id="linespan-2734"><a id="line-2734" name="line-2734"></a>  <span class="k">eapply</span> <span class="n">not_has_open_mset_forall</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span>
</span><span id="linespan-2735"><a id="line-2735" name="line-2735"></a>  <span class="k">eapply</span> <span class="n">mset_forall_and</span> <span class="k">in</span> <span class="n">H0</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">clear</span> <span class="n">H1</span><span class="o">.</span>
</span><span id="linespan-2736"><a id="line-2736" name="line-2736"></a>  <span class="k">eapply</span> <span class="n">mset_forall_impl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2737"><a id="line-2737" name="line-2737"></a>  <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">a0</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2738"><a id="line-2738" name="line-2738"></a>  <span class="n">existss</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">x0</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2739"><a id="line-2739" name="line-2739"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">decide</span> <span class="o">(</span><span class="n">n</span> <span class="o">=</span> <span class="n">a</span><span class="o">));</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2740"><a id="line-2740" name="line-2740"></a>  <span class="o">-</span> <span class="n">edestruct</span> <span class="n">H3</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2741"><a id="line-2741" name="line-2741"></a>  <span class="o">-</span> <span class="k">apply</span> <span class="o">(</span><span class="n">H5</span> <span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">l0</span><span class="o">,</span> <span class="n">t</span><span class="o">))).</span>
</span><span id="linespan-2742"><a id="line-2742" name="line-2742"></a>    <span class="k">eapply</span> <span class="n">elem_of_list_filter</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2743"><a id="line-2743" name="line-2743"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2744"><a id="line-2744" name="line-2744"></a>
</span><span id="linespan-2745"><a id="line-2745" name="line-2745"></a><span class="kn">Lemma</span> <span class="n">not_has_open_lockrelG'</span> <span class="n">a</span> <span class="n">order</span> <span class="n">refcnt</span> <span class="n">t</span> <span class="n">x</span> <span class="n">lcks</span> <span class="o">:</span>
</span><span id="linespan-2746"><a id="line-2746" name="line-2746"></a>  <span class="n">lockrelG'</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span> <span class="n">order</span><span class="o">)</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-2747"><a id="line-2747" name="line-2747"></a>  <span class="o">¬</span> <span class="n">has_open</span> <span class="o">(</span><span class="n">extract</span> <span class="n">a</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-2748"><a id="line-2748" name="line-2748"></a>  <span class="o">∃</span> <span class="o">(</span><span class="n">rc</span> <span class="o">:</span> <span class="n">vertex</span><span class="o">)</span> <span class="o">(</span><span class="n">v</span> <span class="o">:</span> <span class="n">val</span><span class="o">),</span> <span class="n">lcks</span> <span class="o">!!</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">rc</span><span class="o">,</span> <span class="n">Some</span> <span class="n">v</span><span class="o">).</span>
</span><span id="linespan-2749"><a id="line-2749" name="line-2749"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2750"><a id="line-2750" name="line-2750"></a>  <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-2751"><a id="line-2751" name="line-2751"></a>  <span class="c">(* eapply not_has_open_mset_forall in H0. *)</span>
</span><span id="linespan-2752"><a id="line-2752" name="line-2752"></a>  <span class="k">destruct</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-2753"><a id="line-2753" name="line-2753"></a>  <span class="k">rewrite</span> <span class="n">list_to_set_cons</span> <span class="k">in</span> <span class="n">order_dom0</span><span class="o">.</span>
</span><span id="linespan-2754"><a id="line-2754" name="line-2754"></a>  <span class="k">assert</span> <span class="o">(</span><span class="n">a</span> <span class="bp">∈</span> <span class="n">dom</span> <span class="n">lcks</span><span class="o">)</span> <span class="kp">by</span> <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-2755"><a id="line-2755" name="line-2755"></a>  <span class="k">eapply</span> <span class="n">elem_of_dom</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-2756"><a id="line-2756" name="line-2756"></a>  <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_lockrel0</span> <span class="n">a</span><span class="o">).</span>
</span><span id="linespan-2757"><a id="line-2757" name="line-2757"></a>  <span class="k">rewrite</span> <span class="n">H</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">x0</span><span class="o">.</span>
</span><span id="linespan-2758"><a id="line-2758" name="line-2758"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">t</span> <span class="o">!!</span> <span class="n">a</span><span class="o">);</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2759"><a id="line-2759" name="line-2759"></a>  <span class="k">destruct</span> <span class="n">o</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2760"><a id="line-2760" name="line-2760"></a>  <span class="k">destruct</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-2761"><a id="line-2761" name="line-2761"></a>  <span class="n">exfalso</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">H0</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">has_open</span><span class="o">.</span>
</span><span id="linespan-2762"><a id="line-2762" name="line-2762"></a>  <span class="k">destruct</span> <span class="n">lr_openedclosed</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2763"><a id="line-2763" name="line-2763"></a>  <span class="o">-</span> <span class="kr">do</span> <span class="mi">3</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">-</span><span class="n">assoc</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2764"><a id="line-2764" name="line-2764"></a>  <span class="o">-</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">comm</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span>
</span><span id="linespan-2765"><a id="line-2765" name="line-2765"></a>    <span class="kr">do</span> <span class="mi">3</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2766"><a id="line-2766" name="line-2766"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2767"><a id="line-2767" name="line-2767"></a>
</span><span id="linespan-2768"><a id="line-2768" name="line-2768"></a><span class="kn">Lemma</span> <span class="n">lockrelG_open_progress</span> <span class="n">order</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2769"><a id="line-2769" name="line-2769"></a>  <span class="n">lockrelG'</span> <span class="n">order</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-2770"><a id="line-2770" name="line-2770"></a>  <span class="o">¬</span> <span class="n">all_closed</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-2771"><a id="line-2771" name="line-2771"></a>  <span class="n">refcnt</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">∧</span> <span class="n">lcks</span> <span class="o">=</span> <span class="bp">∅</span>
</span><span id="linespan-2772"><a id="line-2772" name="line-2772"></a>  <span class="o">∨</span> <span class="o">(∃</span> <span class="n">ls</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">vertex</span> <span class="o">*</span> <span class="o">(</span><span class="n">lockcap</span> <span class="o">*</span> <span class="n">type</span><span class="o">)),</span>
</span><span id="linespan-2773"><a id="line-2773" name="line-2773"></a>      <span class="n">melem_of</span> <span class="o">(</span><span class="n">LockLabel</span> <span class="n">ls</span><span class="o">)</span> <span class="n">x</span> <span class="o">∧</span>
</span><span id="linespan-2774"><a id="line-2774" name="line-2774"></a>      <span class="n">can_progress</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">ls</span> <span class="o">∧</span>
</span><span id="linespan-2775"><a id="line-2775" name="line-2775"></a>      <span class="o">∃</span> <span class="n">l</span><span class="o">,</span> <span class="n">l</span> <span class="bp">∈</span> <span class="n">ls</span> <span class="o">∧</span> <span class="n">l</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="o">=</span> <span class="n">Opened</span><span class="o">).</span>
</span><span id="linespan-2776"><a id="line-2776" name="line-2776"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2777"><a id="line-2777" name="line-2777"></a>  <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-2778"><a id="line-2778" name="line-2778"></a>  <span class="k">cut</span> <span class="o">(</span><span class="n">refcnt</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">∧</span> <span class="n">lcks</span> <span class="o">=</span> <span class="bp">∅</span>
</span><span id="linespan-2779"><a id="line-2779" name="line-2779"></a>      <span class="o">∨</span> <span class="o">(∃</span> <span class="n">ls</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">vertex</span> <span class="o">*</span> <span class="o">(</span><span class="n">lockcap</span> <span class="o">*</span> <span class="n">type</span><span class="o">)),</span>
</span><span id="linespan-2780"><a id="line-2780" name="line-2780"></a>          <span class="n">melem_of</span> <span class="o">(</span><span class="n">LockLabel</span> <span class="n">ls</span><span class="o">)</span> <span class="n">x</span> <span class="o">∧</span>
</span><span id="linespan-2781"><a id="line-2781" name="line-2781"></a>          <span class="n">acquire_progress</span> <span class="n">lcks</span> <span class="n">ls</span> <span class="o">∧</span>
</span><span id="linespan-2782"><a id="line-2782" name="line-2782"></a>          <span class="o">∃</span> <span class="n">l</span><span class="o">,</span> <span class="n">l</span> <span class="bp">∈</span> <span class="n">ls</span> <span class="o">∧</span> <span class="n">l</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">2</span> <span class="o">=</span> <span class="n">Opened</span><span class="o">)).</span>
</span><span id="linespan-2783"><a id="line-2783" name="line-2783"></a>  <span class="o">{</span>
</span><span id="linespan-2784"><a id="line-2784" name="line-2784"></a>    <span class="k">intros</span> <span class="bp">[]</span><span class="o">.</span> <span class="n">simp</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2785"><a id="line-2785" name="line-2785"></a>    <span class="n">simp</span><span class="o">.</span> <span class="k">right</span><span class="o">.</span> <span class="n">eexists</span><span class="o">.</span>
</span><span id="linespan-2786"><a id="line-2786" name="line-2786"></a>    <span class="n">split_and</span><span class="o">!;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2787"><a id="line-2787" name="line-2787"></a>    <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2788"><a id="line-2788" name="line-2788"></a>    <span class="k">intro</span><span class="o">.</span> <span class="n">specialize</span> <span class="o">(</span><span class="n">H6</span> <span class="n">H4</span><span class="o">).</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2789"><a id="line-2789" name="line-2789"></a>    <span class="kp">congruence</span><span class="o">.</span>
</span><span id="linespan-2790"><a id="line-2790" name="line-2790"></a>  <span class="o">}</span>
</span><span id="linespan-2791"><a id="line-2791" name="line-2791"></a>  <span class="k">revert</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">x</span> <span class="n">H</span> <span class="n">H0</span><span class="o">.</span> <span class="k">induction</span> <span class="n">order</span><span class="o">;</span> <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-2792"><a id="line-2792" name="line-2792"></a>  <span class="o">{</span>
</span><span id="linespan-2793"><a id="line-2793" name="line-2793"></a>    <span class="k">left</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">lockrelG'_empty</span><span class="o">.</span>
</span><span id="linespan-2794"><a id="line-2794" name="line-2794"></a>    <span class="k">destruct</span> <span class="n">refcnt</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">exfalso</span><span class="o">.</span>
</span><span id="linespan-2795"><a id="line-2795" name="line-2795"></a>    <span class="k">eapply</span> <span class="n">H0</span><span class="o">.</span> <span class="k">clear</span> <span class="n">H0</span><span class="o">.</span>
</span><span id="linespan-2796"><a id="line-2796" name="line-2796"></a>    <span class="k">destruct</span> <span class="n">H</span><span class="o">.</span> <span class="k">unfold</span> <span class="n">all_closed</span><span class="o">.</span>
</span><span id="linespan-2797"><a id="line-2797" name="line-2797"></a>    <span class="k">eapply</span> <span class="n">mset_forall_impl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2798"><a id="line-2798" name="line-2798"></a>    <span class="n">simp</span><span class="o">.</span> <span class="n">eexists</span><span class="o">;</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2799"><a id="line-2799" name="line-2799"></a>    <span class="k">destruct</span> <span class="n">x0</span><span class="o">.</span> <span class="k">assert</span> <span class="o">(</span><span class="n">n</span> <span class="bp">∈</span> <span class="n">H0</span><span class="o">.*</span><span class="mi">1</span><span class="o">).</span> <span class="o">{</span> <span class="k">eapply</span> <span class="n">elem_of_list_fmap</span><span class="o">.</span> <span class="n">eexists</span><span class="o">;</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2800"><a id="line-2800" name="line-2800"></a>    <span class="k">eapply</span> <span class="n">sublist_elem_of</span> <span class="k">in</span> <span class="n">H1</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2801"><a id="line-2801" name="line-2801"></a>    <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-2802"><a id="line-2802" name="line-2802"></a>  <span class="o">}</span>
</span><span id="linespan-2803"><a id="line-2803" name="line-2803"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">classic</span> <span class="o">(</span><span class="n">has_open</span> <span class="o">(</span><span class="n">extract</span> <span class="n">a</span> <span class="n">x</span><span class="o">)))</span> <span class="k">as</span> <span class="o">[</span><span class="n">HO</span><span class="o">|</span><span class="n">HNO</span><span class="o">].</span>
</span><span id="linespan-2804"><a id="line-2804" name="line-2804"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">HO</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2805"><a id="line-2805" name="line-2805"></a>    <span class="k">apply</span> <span class="n">melem_of_extract</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2806"><a id="line-2806" name="line-2806"></a>    <span class="k">assert</span> <span class="o">(∃</span> <span class="n">H1'</span><span class="o">,</span> <span class="n">H1</span> <span class="o">=</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="o">((</span><span class="n">x0</span><span class="o">,</span> <span class="n">Opened</span><span class="o">),</span> <span class="n">H2</span><span class="o">))::</span><span class="n">H1'</span><span class="o">).</span>
</span><span id="linespan-2807"><a id="line-2807" name="line-2807"></a>    <span class="o">{</span>
</span><span id="linespan-2808"><a id="line-2808" name="line-2808"></a>      <span class="k">apply</span> <span class="n">melem_of_extract1</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span>
</span><span id="linespan-2809"><a id="line-2809" name="line-2809"></a>      <span class="k">destruct</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-2810"><a id="line-2810" name="line-2810"></a>      <span class="k">eapply</span> <span class="n">order_subsequences0</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2811"><a id="line-2811" name="line-2811"></a>      <span class="k">destruct</span> <span class="n">H</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="kr">first</span> <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-2812"><a id="line-2812" name="line-2812"></a>      <span class="k">eapply</span> <span class="n">elem_of_cons</span> <span class="k">in</span> <span class="n">H5</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2813"><a id="line-2813" name="line-2813"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">a</span> <span class="bp">∈</span> <span class="n">H</span><span class="o">.*</span><span class="mi">1</span><span class="o">).</span>
</span><span id="linespan-2814"><a id="line-2814" name="line-2814"></a>      <span class="o">{</span> <span class="k">apply</span> <span class="n">elem_of_list_fmap</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2815"><a id="line-2815" name="line-2815"></a>        <span class="n">eexists</span><span class="o">;</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2816"><a id="line-2816" name="line-2816"></a>      <span class="k">eapply</span> <span class="n">NoDup_cons</span> <span class="k">in</span> <span class="n">order_NoDup0</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2817"><a id="line-2817" name="line-2817"></a>      <span class="k">assert</span><span class="o">(</span><span class="n">H</span><span class="o">.*</span><span class="mi">1</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">order</span><span class="o">).</span>
</span><span id="linespan-2818"><a id="line-2818" name="line-2818"></a>      <span class="o">{</span>
</span><span id="linespan-2819"><a id="line-2819" name="line-2819"></a>        <span class="n">inv</span> <span class="n">H6</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2820"><a id="line-2820" name="line-2820"></a>        <span class="k">eapply</span> <span class="n">sublist_cons_l</span> <span class="k">in</span> <span class="n">H9</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2821"><a id="line-2821" name="line-2821"></a>        <span class="k">eapply</span> <span class="n">sublist_inserts_l</span><span class="o">.</span>
</span><span id="linespan-2822"><a id="line-2822" name="line-2822"></a>        <span class="k">econstructor</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2823"><a id="line-2823" name="line-2823"></a>      <span class="o">}</span>
</span><span id="linespan-2824"><a id="line-2824" name="line-2824"></a>      <span class="k">eapply</span> <span class="n">sublist_elem_of</span> <span class="k">in</span> <span class="n">H7</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-2825"><a id="line-2825" name="line-2825"></a>    <span class="o">}</span>
</span><span id="linespan-2826"><a id="line-2826" name="line-2826"></a>    <span class="n">simp</span><span class="o">.</span> <span class="k">right</span><span class="o">.</span>
</span><span id="linespan-2827"><a id="line-2827" name="line-2827"></a>    <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2828"><a id="line-2828" name="line-2828"></a>    <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2829"><a id="line-2829" name="line-2829"></a>    <span class="n">eexists</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">elem_of_cons</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2830"><a id="line-2830" name="line-2830"></a>  <span class="o">-</span> <span class="k">assert</span> <span class="o">(¬</span> <span class="n">all_closed</span> <span class="o">(</span><span class="n">delcol</span> <span class="n">a</span> <span class="n">x</span><span class="o">));</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">all_closed_has_open</span><span class="o">.</span>
</span><span id="linespan-2831"><a id="line-2831" name="line-2831"></a>    <span class="k">eapply</span> <span class="n">IHorder</span> <span class="k">in</span> <span class="n">H1</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">lock_relG'_del</span><span class="o">.</span>
</span><span id="linespan-2832"><a id="line-2832" name="line-2832"></a>    <span class="k">destruct</span> <span class="n">H1</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2833"><a id="line-2833" name="line-2833"></a>    <span class="o">{</span> <span class="k">apply</span> <span class="n">lockrelG'_refcnt_0</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2834"><a id="line-2834" name="line-2834"></a>    <span class="k">eapply</span> <span class="n">melem_of_delcol</span> <span class="k">in</span> <span class="n">H1</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2835"><a id="line-2835" name="line-2835"></a>    <span class="k">right</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">H6</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2836"><a id="line-2836" name="line-2836"></a>    <span class="k">destruct</span> <span class="n">H4</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2837"><a id="line-2837" name="line-2837"></a>    <span class="k">eapply</span> <span class="n">elem_of_list_filter</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2838"><a id="line-2838" name="line-2838"></a>    <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2839"><a id="line-2839" name="line-2839"></a>    <span class="k">assert</span> <span class="o">(∃</span> <span class="n">rc</span> <span class="n">v</span><span class="o">,</span> <span class="n">lcks</span> <span class="o">!!</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Some</span><span class="o">(</span><span class="n">rc</span><span class="o">,</span> <span class="n">Some</span> <span class="n">v</span><span class="o">));</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2840"><a id="line-2840" name="line-2840"></a>    <span class="o">{</span>
</span><span id="linespan-2841"><a id="line-2841" name="line-2841"></a>      <span class="k">eauto</span> <span class="k">using</span> <span class="n">not_has_open_lockrelG'</span><span class="o">.</span>
</span><span id="linespan-2842"><a id="line-2842" name="line-2842"></a>    <span class="o">}</span>
</span><span id="linespan-2843"><a id="line-2843" name="line-2843"></a>    <span class="k">eapply</span> <span class="n">acquire_progress_extend</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2844"><a id="line-2844" name="line-2844"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2845"><a id="line-2845" name="line-2845"></a>
</span><span id="linespan-2846"><a id="line-2846" name="line-2846"></a><span class="kn">Lemma</span> <span class="n">not_mset_exists_forall</span> <span class="o">{</span><span class="n">A</span><span class="o">:</span><span class="n">ofe</span><span class="o">}</span> <span class="o">(</span><span class="n">P</span> <span class="o">:</span> <span class="n">A</span> <span class="o">-&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2847"><a id="line-2847" name="line-2847"></a>  <span class="o">(¬</span> <span class="n">mset_exists</span> <span class="n">P</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">mset_forall</span> <span class="o">(</span><span class="n">not</span> <span class="bp">∘</span> <span class="n">P</span><span class="o">)</span> <span class="n">x</span><span class="o">.</span>
</span><span id="linespan-2848"><a id="line-2848" name="line-2848"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2849"><a id="line-2849" name="line-2849"></a>  <span class="k">intros</span> <span class="o">????.</span> <span class="k">eapply</span> <span class="n">H</span><span class="o">.</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2850"><a id="line-2850" name="line-2850"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2851"><a id="line-2851" name="line-2851"></a>
</span><span id="linespan-2852"><a id="line-2852" name="line-2852"></a><span class="kn">Lemma</span> <span class="n">wait_progress_someval</span> <span class="n">a</span> <span class="n">lcks</span> <span class="n">ls</span> <span class="n">v</span> <span class="o">:</span>
</span><span id="linespan-2853"><a id="line-2853" name="line-2853"></a>  <span class="n">wait_progress0</span> <span class="o">(</span><span class="n">delete</span> <span class="n">a</span> <span class="n">lcks</span><span class="o">)</span> <span class="o">(</span><span class="n">filter</span> <span class="o">(λ</span> <span class="k">'</span><span class="o">(</span><span class="n">jj</span><span class="o">,</span> <span class="o">_),</span> <span class="n">jj</span> <span class="o">≠</span> <span class="n">a</span><span class="o">)</span> <span class="n">ls</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-2854"><a id="line-2854" name="line-2854"></a>  <span class="n">lcks</span> <span class="o">!!</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">Some</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-2855"><a id="line-2855" name="line-2855"></a>  <span class="n">wait_progress0</span> <span class="n">lcks</span> <span class="n">ls</span><span class="o">.</span>
</span><span id="linespan-2856"><a id="line-2856" name="line-2856"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2857"><a id="line-2857" name="line-2857"></a>  <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">a0</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">l</span><span class="o">.</span>
</span><span id="linespan-2858"><a id="line-2858" name="line-2858"></a>  <span class="k">destruct</span> <span class="n">l</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">l0</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2859"><a id="line-2859" name="line-2859"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">decide</span> <span class="o">(</span><span class="n">a</span> <span class="o">=</span> <span class="n">n</span><span class="o">));</span> <span class="n">simp</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2860"><a id="line-2860" name="line-2860"></a>  <span class="o">-</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">IHls</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2861"><a id="line-2861" name="line-2861"></a>    <span class="k">rewrite</span> <span class="n">filter_cons</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-2862"><a id="line-2862" name="line-2862"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">filter_cons</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="k">revert</span> <span class="n">H4</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-2863"><a id="line-2863" name="line-2863"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2864"><a id="line-2864" name="line-2864"></a>
</span><span id="linespan-2865"><a id="line-2865" name="line-2865"></a><span class="kn">Lemma</span> <span class="n">sublist_cons'</span> <span class="o">{</span><span class="n">A</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">A</span><span class="o">)</span> <span class="n">xs</span> <span class="n">b</span> <span class="n">ys</span> <span class="o">:</span>
</span><span id="linespan-2866"><a id="line-2866" name="line-2866"></a>  <span class="n">a</span> <span class="o">::</span> <span class="n">xs</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">b</span> <span class="o">::</span> <span class="n">ys</span> <span class="o">-&gt;</span> <span class="n">xs</span> <span class="o">`</span><span class="n">sublist_of</span><span class="o">`</span> <span class="n">ys</span><span class="o">.</span>
</span><span id="linespan-2867"><a id="line-2867" name="line-2867"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2868"><a id="line-2868" name="line-2868"></a>  <span class="k">intros</span> <span class="n">H</span><span class="o">.</span> <span class="n">inv</span> <span class="n">H</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2869"><a id="line-2869" name="line-2869"></a>  <span class="k">eapply</span> <span class="n">sublist_cons_l</span> <span class="k">in</span> <span class="n">H2</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2870"><a id="line-2870" name="line-2870"></a>  <span class="k">eapply</span> <span class="n">sublist_inserts_l</span><span class="o">,</span> <span class="n">sublist_cons</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2871"><a id="line-2871" name="line-2871"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2872"><a id="line-2872" name="line-2872"></a>
</span><span id="linespan-2873"><a id="line-2873" name="line-2873"></a><span class="kn">Lemma</span> <span class="n">melem_of_extract'</span> <span class="n">a</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">labelO'</span><span class="o">)</span> <span class="n">ls</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2874"><a id="line-2874" name="line-2874"></a>  <span class="n">melem_of</span> <span class="o">(</span><span class="n">LockLabel</span> <span class="o">((</span><span class="n">a</span><span class="o">,</span><span class="n">l</span><span class="o">)::</span><span class="n">ls</span><span class="o">))</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-2875"><a id="line-2875" name="line-2875"></a>  <span class="n">melem_of</span> <span class="n">l</span> <span class="o">(</span><span class="n">extract</span> <span class="n">a</span> <span class="n">x</span><span class="o">).</span>
</span><span id="linespan-2876"><a id="line-2876" name="line-2876"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2877"><a id="line-2877" name="line-2877"></a>  <span class="k">intros</span> <span class="bp">[]</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">H</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">extract_op</span> <span class="n">extract_singleton</span><span class="o">.</span>
</span><span id="linespan-2878"><a id="line-2878" name="line-2878"></a>  <span class="k">rewrite</span> <span class="n">extract1_cons</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="k">rewrite</span> <span class="o">-</span><span class="n">assoc</span><span class="o">.</span>
</span><span id="linespan-2879"><a id="line-2879" name="line-2879"></a>  <span class="k">eapply</span> <span class="n">melem_of_op_singleton</span><span class="o">.</span>
</span><span id="linespan-2880"><a id="line-2880" name="line-2880"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2881"><a id="line-2881" name="line-2881"></a>
</span><span id="linespan-2882"><a id="line-2882" name="line-2882"></a><span class="kn">Lemma</span> <span class="n">wait_progress_extend</span> <span class="n">a</span> <span class="n">order</span> <span class="n">refcnt</span> <span class="n">t</span> <span class="n">lcks</span> <span class="n">x</span> <span class="n">ls</span> <span class="o">:</span>
</span><span id="linespan-2883"><a id="line-2883" name="line-2883"></a>  <span class="n">lockrelG'</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span> <span class="n">order</span><span class="o">)</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-2884"><a id="line-2884" name="line-2884"></a>  <span class="n">can_progress</span> <span class="n">refcnt</span> <span class="o">(</span><span class="n">delete</span> <span class="n">a</span> <span class="n">lcks</span><span class="o">)</span> <span class="o">(</span><span class="n">filter</span> <span class="o">(λ</span> <span class="k">'</span><span class="o">(</span><span class="n">jj</span><span class="o">,</span> <span class="o">_),</span> <span class="n">jj</span> <span class="o">≠</span> <span class="n">a</span><span class="o">)</span> <span class="n">ls</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-2885"><a id="line-2885" name="line-2885"></a>  <span class="o">¬</span> <span class="n">mset_exists</span>
</span><span id="linespan-2886"><a id="line-2886" name="line-2886"></a>         <span class="o">(λ</span> <span class="n">l</span> <span class="o">:</span> <span class="n">labelO</span><span class="o">,</span>
</span><span id="linespan-2887"><a id="line-2887" name="line-2887"></a>            <span class="o">∃</span> <span class="o">(</span><span class="n">ls</span> <span class="o">:</span> <span class="n">list</span> <span class="o">(</span><span class="n">vertex</span> <span class="o">*</span> <span class="o">(</span><span class="n">lockcap</span> <span class="o">*</span> <span class="n">type</span><span class="o">)))</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">lockcap</span> <span class="o">*</span> <span class="n">type</span><span class="o">),</span>
</span><span id="linespan-2888"><a id="line-2888" name="line-2888"></a>              <span class="n">l</span> <span class="o">=</span> <span class="n">LockLabel</span> <span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="o">::</span> <span class="n">ls</span><span class="o">)</span> <span class="o">∧</span> <span class="n">y</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">1</span> <span class="o">=</span> <span class="n">Client</span><span class="o">)</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-2889"><a id="line-2889" name="line-2889"></a>  <span class="n">melem_of</span> <span class="o">(</span><span class="n">LockLabel</span> <span class="n">ls</span><span class="o">)</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-2890"><a id="line-2890" name="line-2890"></a>  <span class="n">wait_progress</span> <span class="n">lcks</span> <span class="n">ls</span><span class="o">.</span>
</span><span id="linespan-2891"><a id="line-2891" name="line-2891"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-2892"><a id="line-2892" name="line-2892"></a>  <span class="k">intros</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">H0</span><span class="o">.</span> <span class="k">clear</span> <span class="n">cp_acquire0</span><span class="o">.</span> <span class="k">intros</span> <span class="n">HW</span><span class="o">.</span>
</span><span id="linespan-2893"><a id="line-2893" name="line-2893"></a>  <span class="k">destruct</span> <span class="n">ls</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2894"><a id="line-2894" name="line-2894"></a>  <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">l</span><span class="o">.</span>
</span><span id="linespan-2895"><a id="line-2895" name="line-2895"></a>  <span class="k">destruct</span> <span class="n">l</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">l0</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2896"><a id="line-2896" name="line-2896"></a>  <span class="k">destruct</span> <span class="n">H</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">list_to_set_cons</span> <span class="k">in</span> <span class="n">order_dom0</span><span class="o">.</span>
</span><span id="linespan-2897"><a id="line-2897" name="line-2897"></a>  <span class="k">assert</span> <span class="o">(</span><span class="n">a</span> <span class="bp">∈</span> <span class="n">dom</span> <span class="n">lcks</span><span class="o">)</span> <span class="kp">by</span> <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-2898"><a id="line-2898" name="line-2898"></a>  <span class="k">apply</span> <span class="n">elem_of_dom</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">x0</span><span class="o">.</span>
</span><span id="linespan-2899"><a id="line-2899" name="line-2899"></a>  <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_lockrel0</span> <span class="n">a</span><span class="o">).</span>
</span><span id="linespan-2900"><a id="line-2900" name="line-2900"></a>  <span class="k">rewrite</span> <span class="n">H</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">t</span><span class="o">!!</span><span class="n">a</span><span class="o">);</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2901"><a id="line-2901" name="line-2901"></a>  <span class="k">unfold</span> <span class="n">wait_progress</span> <span class="k">in</span> <span class="o">*.</span>
</span><span id="linespan-2902"><a id="line-2902" name="line-2902"></a>  <span class="k">assert</span> <span class="o">(</span><span class="n">wait_progress0</span> <span class="o">(</span><span class="n">delete</span> <span class="n">a</span> <span class="n">lcks</span><span class="o">)</span>
</span><span id="linespan-2903"><a id="line-2903" name="line-2903"></a>    <span class="o">(</span><span class="n">filter</span> <span class="o">(λ</span> <span class="k">'</span><span class="o">(</span><span class="n">jj</span><span class="o">,</span> <span class="o">_),</span> <span class="n">jj</span> <span class="o">≠</span> <span class="n">a</span><span class="o">)</span> <span class="o">((</span><span class="n">n</span><span class="o">,</span> <span class="o">(</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t0</span><span class="o">))</span> <span class="o">::</span> <span class="n">ls</span><span class="o">))).</span>
</span><span id="linespan-2904"><a id="line-2904" name="line-2904"></a>  <span class="o">{</span>
</span><span id="linespan-2905"><a id="line-2905" name="line-2905"></a>    <span class="k">eapply</span> <span class="n">cp_wait0</span><span class="o">.</span> <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-2906"><a id="line-2906" name="line-2906"></a>    <span class="k">eapply</span> <span class="n">elem_of_list_filter</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">x0</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2907"><a id="line-2907" name="line-2907"></a>    <span class="k">eapply</span> <span class="n">elem_of_cons</span> <span class="k">in</span> <span class="n">H4</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2908"><a id="line-2908" name="line-2908"></a>    <span class="n">specialize</span> <span class="o">(</span><span class="n">HW</span> <span class="o">(</span><span class="n">n1</span><span class="o">,</span><span class="n">p</span><span class="o">)).</span>
</span><span id="linespan-2909"><a id="line-2909" name="line-2909"></a>    <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2910"><a id="line-2910" name="line-2910"></a>    <span class="k">destruct</span> <span class="n">l0</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2911"><a id="line-2911" name="line-2911"></a>    <span class="k">eapply</span> <span class="n">HW</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">elem_of_cons</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2912"><a id="line-2912" name="line-2912"></a>  <span class="o">}</span>
</span><span id="linespan-2913"><a id="line-2913" name="line-2913"></a>  <span class="k">clear</span> <span class="n">cp_wait0</span><span class="o">.</span>
</span><span id="linespan-2914"><a id="line-2914" name="line-2914"></a>  <span class="k">rewrite</span> <span class="n">filter_cons</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span> <span class="n">case_decide</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2915"><a id="line-2915" name="line-2915"></a>  <span class="o">-</span> <span class="c">(* First one is not that one *)</span>
</span><span id="linespan-2916"><a id="line-2916" name="line-2916"></a>    <span class="k">revert</span> <span class="n">H6</span><span class="o">;</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-2917"><a id="line-2917" name="line-2917"></a>    <span class="k">eapply</span> <span class="n">order_subsequences0</span> <span class="k">in</span> <span class="n">H2</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2918"><a id="line-2918" name="line-2918"></a>    <span class="n">inv</span> <span class="n">H9</span><span class="o">.</span>
</span><span id="linespan-2919"><a id="line-2919" name="line-2919"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">a</span> <span class="bp">∉</span> <span class="n">ls</span><span class="o">.*</span><span class="mi">1</span><span class="o">).</span> <span class="o">{</span>
</span><span id="linespan-2920"><a id="line-2920" name="line-2920"></a>      <span class="k">eapply</span> <span class="n">NoDup_cons</span> <span class="k">in</span> <span class="n">order_NoDup0</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2921"><a id="line-2921" name="line-2921"></a>      <span class="k">apply</span> <span class="n">sublist_cons_l</span> <span class="k">in</span> <span class="n">H8</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2922"><a id="line-2922" name="line-2922"></a>      <span class="k">intro</span><span class="o">.</span>
</span><span id="linespan-2923"><a id="line-2923" name="line-2923"></a>      <span class="k">eapply</span> <span class="n">sublist_elem_of</span> <span class="k">in</span> <span class="n">H12</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">apply</span> <span class="n">H2</span><span class="o">.</span>
</span><span id="linespan-2924"><a id="line-2924" name="line-2924"></a>      <span class="n">set_solver</span><span class="o">.</span>
</span><span id="linespan-2925"><a id="line-2925" name="line-2925"></a>    <span class="o">}</span>
</span><span id="linespan-2926"><a id="line-2926" name="line-2926"></a>    <span class="k">revert</span> <span class="n">H2</span> <span class="n">H4</span><span class="o">.</span> <span class="k">clear</span><span class="o">.</span> <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-2927"><a id="line-2927" name="line-2927"></a>    <span class="k">induction</span> <span class="n">ls</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">a0</span><span class="o">,</span><span class="n">p</span><span class="o">,</span><span class="n">l</span><span class="o">,</span><span class="n">l</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2928"><a id="line-2928" name="line-2928"></a>    <span class="k">destruct</span> <span class="n">l0</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2929"><a id="line-2929" name="line-2929"></a>    <span class="k">eapply</span> <span class="n">not_elem_of_cons</span> <span class="k">in</span> <span class="n">H2</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2930"><a id="line-2930" name="line-2930"></a>    <span class="k">rewrite</span> <span class="n">filter_cons</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-2931"><a id="line-2931" name="line-2931"></a>    <span class="k">revert</span> <span class="n">H5</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-2932"><a id="line-2932" name="line-2932"></a>  <span class="o">-</span> <span class="c">(* First one is that one *)</span>
</span><span id="linespan-2933"><a id="line-2933" name="line-2933"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">n0</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">∧</span> <span class="n">is_Some</span> <span class="n">o</span><span class="o">)</span> <span class="k">as</span> <span class="o">[-&gt;</span> <span class="o">[?</span> <span class="o">-&gt;]].</span>
</span><span id="linespan-2934"><a id="line-2934" name="line-2934"></a>    <span class="o">{</span>
</span><span id="linespan-2935"><a id="line-2935" name="line-2935"></a>      <span class="k">destruct</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-2936"><a id="line-2936" name="line-2936"></a>      <span class="k">eapply</span> <span class="n">not_mset_exists_forall</span> <span class="k">in</span> <span class="n">H1</span><span class="o">.</span>
</span><span id="linespan-2937"><a id="line-2937" name="line-2937"></a>      <span class="k">eapply</span> <span class="n">mset_forall_and</span> <span class="k">in</span> <span class="n">H1</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">exact</span> <span class="n">order_subsequences0</span><span class="o">.</span> <span class="k">clear</span> <span class="n">order_subsequences0</span><span class="o">.</span>
</span><span id="linespan-2938"><a id="line-2938" name="line-2938"></a>      <span class="k">destruct</span> <span class="n">o</span><span class="o">.</span>
</span><span id="linespan-2939"><a id="line-2939" name="line-2939"></a>      <span class="o">-</span> <span class="k">destruct</span> <span class="n">n0</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">exfalso</span><span class="o">.</span>
</span><span id="linespan-2940"><a id="line-2940" name="line-2940"></a>        <span class="n">simp</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">right_id</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span>
</span><span id="linespan-2941"><a id="line-2941" name="line-2941"></a>        <span class="k">destruct</span> <span class="o">(</span><span class="n">mset_empty_or_not</span> <span class="n">x_closed</span><span class="o">);</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2942"><a id="line-2942" name="line-2942"></a>        <span class="k">destruct</span> <span class="n">H5</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-2943"><a id="line-2943" name="line-2943"></a>        <span class="k">assert</span> <span class="o">(</span><span class="n">H4</span> <span class="o">=</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t1</span><span class="o">));</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2944"><a id="line-2944" name="line-2944"></a>        <span class="k">rewrite</span> <span class="n">comm</span> <span class="o">-</span><span class="n">assoc</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span>
</span><span id="linespan-2945"><a id="line-2945" name="line-2945"></a>        <span class="n">edestruct</span> <span class="n">melem_of_extract</span><span class="o">.</span>
</span><span id="linespan-2946"><a id="line-2946" name="line-2946"></a>        <span class="o">{</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2947"><a id="line-2947" name="line-2947"></a>        <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2948"><a id="line-2948" name="line-2948"></a>        <span class="k">eapply</span> <span class="n">melem_of_extract1</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span>
</span><span id="linespan-2949"><a id="line-2949" name="line-2949"></a>        <span class="k">eapply</span> <span class="n">H1</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2950"><a id="line-2950" name="line-2950"></a>        <span class="k">eapply</span> <span class="n">H6</span><span class="o">.</span>
</span><span id="linespan-2951"><a id="line-2951" name="line-2951"></a>        <span class="k">eapply</span> <span class="n">elem_of_list_lookup</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2952"><a id="line-2952" name="line-2952"></a>        <span class="k">destruct</span> <span class="n">H4</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2953"><a id="line-2953" name="line-2953"></a>        <span class="k">destruct</span> <span class="n">H3</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2954"><a id="line-2954" name="line-2954"></a>        <span class="k">eapply</span> <span class="n">NoDup_cons</span> <span class="k">in</span> <span class="n">order_NoDup0</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2955"><a id="line-2955" name="line-2955"></a>        <span class="n">exfalso</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">H5</span><span class="o">.</span>
</span><span id="linespan-2956"><a id="line-2956" name="line-2956"></a>        <span class="k">eapply</span> <span class="n">sublist_cons'</span> <span class="k">in</span> <span class="n">H8</span><span class="o">.</span>
</span><span id="linespan-2957"><a id="line-2957" name="line-2957"></a>        <span class="k">eapply</span> <span class="n">sublist_elem_of</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2958"><a id="line-2958" name="line-2958"></a>        <span class="k">eapply</span> <span class="n">elem_of_list_fmap</span><span class="o">.</span>
</span><span id="linespan-2959"><a id="line-2959" name="line-2959"></a>        <span class="k">eapply</span> <span class="n">elem_of_list_lookup_2</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span>
</span><span id="linespan-2960"><a id="line-2960" name="line-2960"></a>        <span class="n">eexists</span><span class="o">;</span> <span class="k">split</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2961"><a id="line-2961" name="line-2961"></a>      <span class="o">-</span> <span class="n">exfalso</span><span class="o">.</span>
</span><span id="linespan-2962"><a id="line-2962" name="line-2962"></a>        <span class="k">destruct</span> <span class="n">lr_openedclosed</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2963"><a id="line-2963" name="line-2963"></a>        <span class="o">+</span> <span class="c">(* Now we have both a closed and opened owner. *)</span>
</span><span id="linespan-2964"><a id="line-2964" name="line-2964"></a>          <span class="k">rewrite</span> <span class="n">right_id</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span>
</span><span id="linespan-2965"><a id="line-2965" name="line-2965"></a>          <span class="k">eapply</span> <span class="n">melem_of_extract'</span> <span class="k">in</span> <span class="n">H2</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-2966"><a id="line-2966" name="line-2966"></a>          <span class="k">rewrite</span> <span class="n">lr_split</span> <span class="k">in</span> <span class="n">H2</span><span class="o">.</span>
</span><span id="linespan-2967"><a id="line-2967" name="line-2967"></a>          <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">H2</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2968"><a id="line-2968" name="line-2968"></a>          <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-2969"><a id="line-2969" name="line-2969"></a>          <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H8</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-2970"><a id="line-2970" name="line-2970"></a>          <span class="o">*</span> <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H6</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-2971"><a id="line-2971" name="line-2971"></a>            <span class="k">assert</span> <span class="o">((</span><span class="n">Owner</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t0</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t1</span><span class="o">));</span> <span class="n">simp</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2972"><a id="line-2972" name="line-2972"></a>          <span class="o">*</span> <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H6</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H6</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2973"><a id="line-2973" name="line-2973"></a>        <span class="o">+</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">comm</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span>
</span><span id="linespan-2974"><a id="line-2974" name="line-2974"></a>          <span class="n">edestruct</span> <span class="n">melem_of_extract</span><span class="o">.</span>
</span><span id="linespan-2975"><a id="line-2975" name="line-2975"></a>          <span class="o">{</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-2976"><a id="line-2976" name="line-2976"></a>          <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2977"><a id="line-2977" name="line-2977"></a>          <span class="k">eapply</span> <span class="n">melem_of_extract1</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span>
</span><span id="linespan-2978"><a id="line-2978" name="line-2978"></a>          <span class="k">eapply</span> <span class="n">H1</span> <span class="k">in</span> <span class="n">H4</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2979"><a id="line-2979" name="line-2979"></a>          <span class="k">eapply</span> <span class="n">H6</span><span class="o">.</span>
</span><span id="linespan-2980"><a id="line-2980" name="line-2980"></a>          <span class="k">eapply</span> <span class="n">elem_of_list_lookup</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2981"><a id="line-2981" name="line-2981"></a>          <span class="k">destruct</span> <span class="n">H4</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2982"><a id="line-2982" name="line-2982"></a>          <span class="k">destruct</span> <span class="n">H3</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2983"><a id="line-2983" name="line-2983"></a>          <span class="k">eapply</span> <span class="n">NoDup_cons</span> <span class="k">in</span> <span class="n">order_NoDup0</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-2984"><a id="line-2984" name="line-2984"></a>          <span class="n">exfalso</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">H5</span><span class="o">.</span>
</span><span id="linespan-2985"><a id="line-2985" name="line-2985"></a>          <span class="k">eapply</span> <span class="n">sublist_cons'</span> <span class="k">in</span> <span class="n">H8</span><span class="o">.</span>
</span><span id="linespan-2986"><a id="line-2986" name="line-2986"></a>          <span class="k">eapply</span> <span class="n">sublist_elem_of</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2987"><a id="line-2987" name="line-2987"></a>          <span class="k">eapply</span> <span class="n">elem_of_list_fmap</span><span class="o">.</span>
</span><span id="linespan-2988"><a id="line-2988" name="line-2988"></a>          <span class="k">eapply</span> <span class="n">elem_of_list_lookup_2</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span>
</span><span id="linespan-2989"><a id="line-2989" name="line-2989"></a>          <span class="n">eexists</span><span class="o">;</span> <span class="k">split</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-2990"><a id="line-2990" name="line-2990"></a>    <span class="o">}</span>
</span><span id="linespan-2991"><a id="line-2991" name="line-2991"></a>    <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-2992"><a id="line-2992" name="line-2992"></a>    <span class="k">eauto</span> <span class="k">using</span> <span class="n">wait_progress_someval</span><span class="o">.</span>
</span><span id="linespan-2993"><a id="line-2993" name="line-2993"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-2994"><a id="line-2994" name="line-2994"></a>
</span><span id="linespan-2995"><a id="line-2995" name="line-2995"></a><span class="kn">Lemma</span> <span class="n">lockrelG_progress</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-2996"><a id="line-2996" name="line-2996"></a>  <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">x</span> <span class="o">-&gt;</span>
</span><span id="linespan-2997"><a id="line-2997" name="line-2997"></a>  <span class="o">(</span><span class="n">refcnt</span><span class="o">=</span><span class="mi">0</span> <span class="o">∧</span> <span class="n">lcks</span><span class="o">=</span><span class="bp">∅</span><span class="o">)</span> <span class="o">∨</span> <span class="o">∃</span> <span class="n">ls</span><span class="o">,</span>
</span><span id="linespan-2998"><a id="line-2998" name="line-2998"></a>    <span class="n">melem_of</span> <span class="o">(</span><span class="n">LockLabel</span> <span class="n">ls</span><span class="o">)</span> <span class="n">x</span> <span class="o">∧</span> <span class="n">can_progress</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">ls</span><span class="o">.</span>
</span><span id="linespan-2999"><a id="line-2999" name="line-2999"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-3000"><a id="line-3000" name="line-3000"></a>  <span class="k">intros</span> <span class="o">[</span><span class="n">order</span> <span class="n">H</span><span class="o">].</span>
</span><span id="linespan-3001"><a id="line-3001" name="line-3001"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">classic</span> <span class="o">(</span><span class="n">all_closed</span> <span class="n">x</span><span class="o">))</span> <span class="k">as</span> <span class="o">[</span><span class="n">Hx</span><span class="o">|</span><span class="n">Hx</span><span class="o">].</span>
</span><span id="linespan-3002"><a id="line-3002" name="line-3002"></a>  <span class="o">{</span>
</span><span id="linespan-3003"><a id="line-3003" name="line-3003"></a>    <span class="k">revert</span> <span class="n">Hx</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-3004"><a id="line-3004" name="line-3004"></a>    <span class="k">revert</span> <span class="n">t</span> <span class="n">x</span> <span class="n">lcks</span> <span class="n">refcnt</span><span class="o">.</span>
</span><span id="linespan-3005"><a id="line-3005" name="line-3005"></a>    <span class="k">induction</span> <span class="n">order</span><span class="o">;</span> <span class="k">intros</span><span class="o">.</span>
</span><span id="linespan-3006"><a id="line-3006" name="line-3006"></a>    <span class="o">-</span> <span class="k">assert</span> <span class="o">(</span><span class="n">lcks</span> <span class="o">=</span> <span class="bp">∅</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;</span> <span class="kp">by</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">lockrelG'_empty</span><span class="o">.</span>
</span><span id="linespan-3007"><a id="line-3007" name="line-3007"></a>      <span class="k">destruct</span> <span class="n">refcnt</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3008"><a id="line-3008" name="line-3008"></a>      <span class="k">right</span><span class="o">.</span> <span class="k">exists</span> <span class="bp">[]</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">lockrelG'_empty_elem</span><span class="o">.</span>
</span><span id="linespan-3009"><a id="line-3009" name="line-3009"></a>      <span class="k">split</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">intro</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3010"><a id="line-3010" name="line-3010"></a>    <span class="o">-</span> <span class="k">right</span><span class="o">.</span>
</span><span id="linespan-3011"><a id="line-3011" name="line-3011"></a>      <span class="c">(* Check if first column has a client, if so, choose that row. *)</span>
</span><span id="linespan-3012"><a id="line-3012" name="line-3012"></a>      <span class="k">destruct</span> <span class="o">(</span><span class="n">classic</span> <span class="o">(</span><span class="n">mset_exists</span> <span class="o">(λ</span> <span class="n">l</span><span class="o">,</span> <span class="o">∃</span> <span class="n">ls</span> <span class="n">y</span><span class="o">,</span>
</span><span id="linespan-3013"><a id="line-3013" name="line-3013"></a>        <span class="n">l</span> <span class="o">=</span> <span class="n">LockLabel</span> <span class="o">((</span><span class="n">a</span><span class="o">,</span><span class="n">y</span><span class="o">)::</span><span class="n">ls</span><span class="o">)</span> <span class="o">∧</span> <span class="n">y</span><span class="o">.</span><span class="mi">1</span><span class="o">.</span><span class="mi">1</span> <span class="o">=</span> <span class="n">Client</span><span class="o">)</span> <span class="n">x</span><span class="o">)).</span>
</span><span id="linespan-3014"><a id="line-3014" name="line-3014"></a>      <span class="o">+</span> <span class="k">destruct</span> <span class="n">H0</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3015"><a id="line-3015" name="line-3015"></a>        <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">all_closed_acquire_progress</span><span class="o">.</span>
</span><span id="linespan-3016"><a id="line-3016" name="line-3016"></a>        <span class="k">intro</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">H2</span> <span class="k">as</span> <span class="o">[</span><span class="bp">[]</span> <span class="o">?].</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3017"><a id="line-3017" name="line-3017"></a>      <span class="o">+</span> <span class="c">(* If first column has only owner, use IH. *)</span>
</span><span id="linespan-3018"><a id="line-3018" name="line-3018"></a>        <span class="n">edestruct</span> <span class="n">IHorder</span><span class="o">;</span> <span class="kr">first</span> <span class="k">apply</span> <span class="n">all_closed_del</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">lock_relG'_del</span><span class="o">.</span>
</span><span id="linespan-3019"><a id="line-3019" name="line-3019"></a>        <span class="o">{</span> <span class="n">simp</span><span class="o">.</span> <span class="k">apply</span> <span class="n">lockrelG'_refcnt_0</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3020"><a id="line-3020" name="line-3020"></a>        <span class="c">(* Then if IH returns same row as owner, prepend the first column. *)</span>
</span><span id="linespan-3021"><a id="line-3021" name="line-3021"></a>        <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3022"><a id="line-3022" name="line-3022"></a>        <span class="k">apply</span> <span class="n">melem_of_fmap</span> <span class="k">in</span> <span class="n">H1</span><span class="o">;</span> <span class="kr">last</span> <span class="k">apply</span> <span class="o">_.</span>
</span><span id="linespan-3023"><a id="line-3023" name="line-3023"></a>        <span class="n">simp</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">H3</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3024"><a id="line-3024" name="line-3024"></a>        <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3025"><a id="line-3025" name="line-3025"></a>        <span class="k">split</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">all_closed_acquire_progress</span><span class="o">,</span> <span class="n">wait_progress_extend</span><span class="o">.</span>
</span><span id="linespan-3026"><a id="line-3026" name="line-3026"></a>  <span class="o">}</span>
</span><span id="linespan-3027"><a id="line-3027" name="line-3027"></a>  <span class="o">{</span>
</span><span id="linespan-3028"><a id="line-3028" name="line-3028"></a>    <span class="k">eapply</span> <span class="n">lockrelG_open_progress</span> <span class="k">in</span> <span class="n">H</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3029"><a id="line-3029" name="line-3029"></a>    <span class="n">naive_solver</span><span class="o">.</span>
</span><span id="linespan-3030"><a id="line-3030" name="line-3030"></a>  <span class="o">}</span>
</span><span id="linespan-3031"><a id="line-3031" name="line-3031"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-3032"><a id="line-3032" name="line-3032"></a>
</span><span id="linespan-3033"><a id="line-3033" name="line-3033"></a><span class="kn">Lemma</span> <span class="n">lockrelG_refcount</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">l</span> <span class="n">x</span> <span class="o">:</span>
</span><span id="linespan-3034"><a id="line-3034" name="line-3034"></a>  <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="o">({[</span> <span class="n">l</span> <span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">refcnt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">.</span>
</span><span id="linespan-3035"><a id="line-3035" name="line-3035"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-3036"><a id="line-3036" name="line-3036"></a>  <span class="k">intros</span> <span class="o">[</span><span class="n">order</span> <span class="bp">[]</span><span class="o">].</span>
</span><span id="linespan-3037"><a id="line-3037" name="line-3037"></a>  <span class="k">rewrite</span> <span class="n">Mlen_mult</span> <span class="n">Mlen_singleton</span> <span class="k">in</span> <span class="n">lr_refcount0</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-3038"><a id="line-3038" name="line-3038"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-3039"><a id="line-3039" name="line-3039"></a>
</span><span id="linespan-3040"><a id="line-3040" name="line-3040"></a><span class="kn">Lemma</span> <span class="n">lockrel_Client</span> <span class="n">n</span> <span class="n">o</span> <span class="n">t</span> <span class="n">t'</span> <span class="n">x'</span> <span class="o">:</span>
</span><span id="linespan-3041"><a id="line-3041" name="line-3041"></a>  <span class="n">lockrel</span> <span class="n">n</span> <span class="n">o</span> <span class="n">t</span> <span class="o">({[(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t'</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x'</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">.</span>
</span><span id="linespan-3042"><a id="line-3042" name="line-3042"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-3043"><a id="line-3043" name="line-3043"></a>  <span class="k">intros</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-3044"><a id="line-3044" name="line-3044"></a>  <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3045"><a id="line-3045" name="line-3045"></a>  <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H3</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3046"><a id="line-3046" name="line-3046"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">o</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3047"><a id="line-3047" name="line-3047"></a>    <span class="o">+</span> <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_empty_mult</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3048"><a id="line-3048" name="line-3048"></a>      <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H8</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_singleton_not_unit</span> <span class="k">in</span> <span class="n">H8</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3049"><a id="line-3049" name="line-3049"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="n">H8</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span>
</span><span id="linespan-3050"><a id="line-3050" name="line-3050"></a>      <span class="k">destruct</span> <span class="n">lr_openedclosed</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3051"><a id="line-3051" name="line-3051"></a>      <span class="o">*</span> <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_empty_mult</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3052"><a id="line-3052" name="line-3052"></a>      <span class="o">*</span> <span class="k">rewrite</span> <span class="n">H10</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span> <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span>
</span><span id="linespan-3053"><a id="line-3053" name="line-3053"></a>        <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3054"><a id="line-3054" name="line-3054"></a>  <span class="o">-</span> <span class="k">rewrite</span> <span class="n">H6</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span>
</span><span id="linespan-3055"><a id="line-3055" name="line-3055"></a>    <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">H12</span><span class="o">.</span>
</span><span id="linespan-3056"><a id="line-3056" name="line-3056"></a>    <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H13</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3057"><a id="line-3057" name="line-3057"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="n">H16</span> <span class="n">Mlen_mult</span> <span class="n">Mlen_singleton</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-3058"><a id="line-3058" name="line-3058"></a>    <span class="o">+</span> <span class="k">rewrite</span> <span class="n">H14</span> <span class="k">in</span> <span class="n">H11</span><span class="o">.</span> <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H11</span><span class="o">.</span>
</span><span id="linespan-3059"><a id="line-3059" name="line-3059"></a>      <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H11</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3060"><a id="line-3060" name="line-3060"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-3061"><a id="line-3061" name="line-3061"></a>
</span><span id="linespan-3062"><a id="line-3062" name="line-3062"></a>
</span><span id="linespan-3063"><a id="line-3063" name="line-3063"></a><span class="kn">Lemma</span> <span class="n">lockrelG_refcounti</span> <span class="n">ls</span> <span class="n">i</span> <span class="n">n</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">xs</span> <span class="n">x'</span> <span class="n">t'</span> <span class="o">:</span>
</span><span id="linespan-3064"><a id="line-3064" name="line-3064"></a>  <span class="n">length</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">length</span> <span class="n">xs</span> <span class="o">-&gt;</span>
</span><span id="linespan-3065"><a id="line-3065" name="line-3065"></a>  <span class="n">xs</span> <span class="o">!!</span> <span class="n">i</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t'</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-3066"><a id="line-3066" name="line-3066"></a>  <span class="n">ls</span> <span class="o">!!</span> <span class="n">i</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">n</span> <span class="o">-&gt;</span>
</span><span id="linespan-3067"><a id="line-3067" name="line-3067"></a>  <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="o">({[</span><span class="n">LockLabel</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs</span><span class="o">)]}</span> <span class="bp">⋅</span> <span class="n">x'</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-3068"><a id="line-3068" name="line-3068"></a>  <span class="o">∃</span> <span class="n">refcnt'</span> <span class="n">o</span><span class="o">,</span> <span class="n">lcks</span> <span class="o">!!</span> <span class="n">n</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">S</span> <span class="n">refcnt'</span><span class="o">,</span><span class="n">o</span><span class="o">).</span>
</span><span id="linespan-3069"><a id="line-3069" name="line-3069"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-3070"><a id="line-3070" name="line-3070"></a>  <span class="k">intros</span> <span class="n">Hlen</span> <span class="n">Hxs</span> <span class="n">HH</span> <span class="o">[</span><span class="n">order</span> <span class="bp">[]</span><span class="o">].</span>
</span><span id="linespan-3071"><a id="line-3071" name="line-3071"></a>  <span class="k">rewrite</span> <span class="n">mset_forall_op</span> <span class="n">mset_forall_singleton</span> <span class="k">in</span> <span class="n">order_subsequences0</span><span class="o">.</span>
</span><span id="linespan-3072"><a id="line-3072" name="line-3072"></a>  <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3073"><a id="line-3073" name="line-3073"></a>  <span class="k">rewrite</span> <span class="n">fst_zip</span> <span class="k">in</span> <span class="n">H3</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-3074"><a id="line-3074" name="line-3074"></a>  <span class="k">assert</span> <span class="o">(</span><span class="n">n</span> <span class="bp">∈</span> <span class="n">dom</span> <span class="n">lcks</span><span class="o">).</span>
</span><span id="linespan-3075"><a id="line-3075" name="line-3075"></a>  <span class="o">{</span>
</span><span id="linespan-3076"><a id="line-3076" name="line-3076"></a>    <span class="k">rewrite</span> <span class="o">-</span><span class="n">order_dom0</span><span class="o">.</span>
</span><span id="linespan-3077"><a id="line-3077" name="line-3077"></a>    <span class="k">eapply</span> <span class="n">elem_of_list_to_set</span><span class="o">.</span>
</span><span id="linespan-3078"><a id="line-3078" name="line-3078"></a>    <span class="k">eapply</span> <span class="n">sublist_elem_of</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3079"><a id="line-3079" name="line-3079"></a>    <span class="k">eapply</span> <span class="n">elem_of_list_lookup</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3080"><a id="line-3080" name="line-3080"></a>  <span class="o">}</span>
</span><span id="linespan-3081"><a id="line-3081" name="line-3081"></a>  <span class="k">eapply</span> <span class="n">elem_of_dom</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="o">[</span><span class="bp">[]</span> <span class="n">H</span><span class="o">].</span>
</span><span id="linespan-3082"><a id="line-3082" name="line-3082"></a>  <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_lockrel0</span> <span class="n">n</span><span class="o">).</span>
</span><span id="linespan-3083"><a id="line-3083" name="line-3083"></a>  <span class="k">rewrite</span> <span class="n">H</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-3084"><a id="line-3084" name="line-3084"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">t</span> <span class="o">!!</span> <span class="n">n</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">E</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3085"><a id="line-3085" name="line-3085"></a>  <span class="k">rewrite</span> <span class="n">extract_op</span> <span class="n">extract_singleton</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-3086"><a id="line-3086" name="line-3086"></a>  <span class="k">rewrite</span> <span class="n">extract1_Some</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3087"><a id="line-3087" name="line-3087"></a>  <span class="k">rewrite</span> <span class="o">-</span><span class="n">assoc</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-3088"><a id="line-3088" name="line-3088"></a>  <span class="k">eapply</span> <span class="n">lockrel_Client</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">n0</span><span class="o">;</span> <span class="kr">try</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-3089"><a id="line-3089" name="line-3089"></a>  <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3090"><a id="line-3090" name="line-3090"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-3091"><a id="line-3091" name="line-3091"></a>
</span><span id="linespan-3092"><a id="line-3092" name="line-3092"></a><span class="kn">Lemma</span> <span class="n">lockrel_Opened</span> <span class="n">n</span> <span class="n">o</span> <span class="n">t</span> <span class="n">t'</span> <span class="n">x'</span> <span class="n">lo</span> <span class="o">:</span>
</span><span id="linespan-3093"><a id="line-3093" name="line-3093"></a>  <span class="n">lockrel</span> <span class="n">n</span> <span class="n">o</span> <span class="n">t</span> <span class="o">({[(</span><span class="n">lo</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t'</span><span class="o">):</span><span class="n">labelO'</span><span class="o">]}</span> <span class="bp">⋅</span> <span class="n">x'</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">o</span> <span class="o">=</span> <span class="n">None</span><span class="o">.</span>
</span><span id="linespan-3094"><a id="line-3094" name="line-3094"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-3095"><a id="line-3095" name="line-3095"></a>  <span class="k">intros</span> <span class="bp">[]</span><span class="o">.</span>
</span><span id="linespan-3096"><a id="line-3096" name="line-3096"></a>  <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">lr_split</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3097"><a id="line-3097" name="line-3097"></a>  <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H3</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3098"><a id="line-3098" name="line-3098"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">o</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3099"><a id="line-3099" name="line-3099"></a>    <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_empty_mult</span> <span class="k">in</span> <span class="n">H7</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3100"><a id="line-3100" name="line-3100"></a>    <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H8</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_singleton_not_unit</span> <span class="k">in</span> <span class="n">H8</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3101"><a id="line-3101" name="line-3101"></a>  <span class="o">-</span> <span class="k">destruct</span> <span class="n">o</span><span class="o">;</span><span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">H6</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span>
</span><span id="linespan-3102"><a id="line-3102" name="line-3102"></a>    <span class="k">eapply</span> <span class="n">mset_xsplit</span> <span class="k">in</span> <span class="n">H5</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3103"><a id="line-3103" name="line-3103"></a>    <span class="k">eapply</span> <span class="n">multiset_singleton_mult</span> <span class="k">in</span> <span class="n">H11</span> <span class="k">as</span> <span class="bp">[]</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3104"><a id="line-3104" name="line-3104"></a>    <span class="o">+</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">left_id</span> <span class="k">in</span> <span class="n">H13</span><span class="o">.</span> <span class="n">setoid_subst</span><span class="o">.</span>
</span><span id="linespan-3105"><a id="line-3105" name="line-3105"></a>      <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_closed</span> <span class="o">(</span><span class="n">lo</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t'</span><span class="o">)</span> <span class="n">H10</span><span class="o">).</span>
</span><span id="linespan-3106"><a id="line-3106" name="line-3106"></a>      <span class="k">assert</span> <span class="o">((</span><span class="n">lo</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t'</span><span class="o">)</span> <span class="o">=</span> <span class="o">(</span><span class="n">Client</span><span class="o">,</span> <span class="n">Closed</span><span class="o">,</span> <span class="n">t</span><span class="o">));</span> <span class="k">eauto</span> <span class="o">||</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3107"><a id="line-3107" name="line-3107"></a>    <span class="o">+</span> <span class="n">setoid_subst</span><span class="o">.</span> <span class="k">symmetry</span> <span class="k">in</span> <span class="n">H13</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_singleton_mult'</span> <span class="k">in</span> <span class="n">H13</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3108"><a id="line-3108" name="line-3108"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-3109"><a id="line-3109" name="line-3109"></a>
</span><span id="linespan-3110"><a id="line-3110" name="line-3110"></a><span class="kn">Lemma</span> <span class="n">lockrelG_refcounti_Opened</span> <span class="n">ls</span> <span class="n">i</span> <span class="n">n</span> <span class="n">refcnt</span> <span class="n">a</span> <span class="n">lcks</span> <span class="n">t</span> <span class="n">t'</span> <span class="n">xs</span> <span class="n">x'</span> <span class="o">:</span>
</span><span id="linespan-3111"><a id="line-3111" name="line-3111"></a>  <span class="n">length</span> <span class="n">ls</span> <span class="o">=</span> <span class="n">length</span> <span class="n">xs</span> <span class="o">-&gt;</span>
</span><span id="linespan-3112"><a id="line-3112" name="line-3112"></a>  <span class="n">ls</span> <span class="o">!!</span> <span class="n">i</span> <span class="o">=</span> <span class="n">Some</span> <span class="n">n</span> <span class="o">-&gt;</span>
</span><span id="linespan-3113"><a id="line-3113" name="line-3113"></a>  <span class="n">xs</span> <span class="o">!!</span> <span class="n">i</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">Opened</span><span class="o">,</span> <span class="n">t'</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-3114"><a id="line-3114" name="line-3114"></a>  <span class="n">lockrelG</span> <span class="n">refcnt</span> <span class="n">lcks</span> <span class="n">t</span> <span class="o">({[</span><span class="n">LockLabel</span> <span class="o">(</span><span class="n">zip</span> <span class="n">ls</span> <span class="n">xs</span><span class="o">)]}</span> <span class="bp">⋅</span> <span class="n">x'</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span id="linespan-3115"><a id="line-3115" name="line-3115"></a>  <span class="o">∃</span> <span class="n">refcnt'</span><span class="o">,</span> <span class="n">lcks</span> <span class="o">!!</span> <span class="n">n</span> <span class="o">=</span> <span class="n">Some</span> <span class="o">(</span><span class="n">refcnt'</span><span class="o">,</span><span class="n">None</span><span class="o">).</span>
</span><span id="linespan-3116"><a id="line-3116" name="line-3116"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-3117"><a id="line-3117" name="line-3117"></a>  <span class="k">intros</span> <span class="n">Hlen</span> <span class="n">Hxs</span> <span class="n">HH</span> <span class="o">[</span><span class="n">order</span> <span class="bp">[]</span><span class="o">].</span>
</span><span id="linespan-3118"><a id="line-3118" name="line-3118"></a>  <span class="k">rewrite</span> <span class="n">mset_forall_op</span> <span class="n">mset_forall_singleton</span> <span class="k">in</span> <span class="n">order_subsequences0</span><span class="o">.</span>
</span><span id="linespan-3119"><a id="line-3119" name="line-3119"></a>  <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3120"><a id="line-3120" name="line-3120"></a>  <span class="k">rewrite</span> <span class="n">fst_zip</span> <span class="k">in</span> <span class="n">H3</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-3121"><a id="line-3121" name="line-3121"></a>  <span class="k">assert</span> <span class="o">(</span><span class="n">n</span> <span class="bp">∈</span> <span class="n">dom</span> <span class="n">lcks</span><span class="o">).</span>
</span><span id="linespan-3122"><a id="line-3122" name="line-3122"></a>  <span class="o">{</span>
</span><span id="linespan-3123"><a id="line-3123" name="line-3123"></a>    <span class="k">rewrite</span> <span class="o">-</span><span class="n">order_dom0</span><span class="o">.</span>
</span><span id="linespan-3124"><a id="line-3124" name="line-3124"></a>    <span class="k">eapply</span> <span class="n">elem_of_list_to_set</span><span class="o">.</span>
</span><span id="linespan-3125"><a id="line-3125" name="line-3125"></a>    <span class="k">eapply</span> <span class="n">sublist_elem_of</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3126"><a id="line-3126" name="line-3126"></a>    <span class="k">eapply</span> <span class="n">elem_of_list_lookup</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3127"><a id="line-3127" name="line-3127"></a>  <span class="o">}</span>
</span><span id="linespan-3128"><a id="line-3128" name="line-3128"></a>  <span class="k">eapply</span> <span class="n">elem_of_dom</span> <span class="k">in</span> <span class="n">H</span> <span class="k">as</span> <span class="o">[</span><span class="bp">[]</span> <span class="n">H</span><span class="o">].</span>
</span><span id="linespan-3129"><a id="line-3129" name="line-3129"></a>  <span class="n">specialize</span> <span class="o">(</span><span class="n">lr_lockrel0</span> <span class="n">n</span><span class="o">).</span>
</span><span id="linespan-3130"><a id="line-3130" name="line-3130"></a>  <span class="k">rewrite</span> <span class="n">H</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-3131"><a id="line-3131" name="line-3131"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">t</span> <span class="o">!!</span> <span class="n">n</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">E</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3132"><a id="line-3132" name="line-3132"></a>  <span class="k">rewrite</span> <span class="n">extract_op</span> <span class="n">extract_singleton</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-3133"><a id="line-3133" name="line-3133"></a>  <span class="k">rewrite</span> <span class="n">extract1_Some</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3134"><a id="line-3134" name="line-3134"></a>  <span class="k">rewrite</span> <span class="o">-</span><span class="n">assoc</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span>
</span><span id="linespan-3135"><a id="line-3135" name="line-3135"></a>  <span class="k">eapply</span> <span class="n">lockrel_Opened</span> <span class="k">in</span> <span class="n">lr_lockrel0</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3136"><a id="line-3136" name="line-3136"></a>  <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3137"><a id="line-3137" name="line-3137"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-3138"><a id="line-3138" name="line-3138"></a>
</span><span id="linespan-3139"><a id="line-3139" name="line-3139"></a><span class="kn">Lemma</span> <span class="n">full_reachability</span> <span class="n">ρ</span> <span class="o">:</span>
</span><span id="linespan-3140"><a id="line-3140" name="line-3140"></a>  <span class="n">ginv</span> <span class="n">ρ</span> <span class="o">-&gt;</span> <span class="n">fully_reachable</span> <span class="n">ρ</span><span class="o">.</span>
</span><span id="linespan-3141"><a id="line-3141" name="line-3141"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-3142"><a id="line-3142" name="line-3142"></a>  <span class="k">intros</span> <span class="n">Hinv</span><span class="o">.</span>
</span><span id="linespan-3143"><a id="line-3143" name="line-3143"></a>  <span class="k">destruct</span> <span class="n">Hinv</span> <span class="k">as</span> <span class="o">[</span><span class="n">g</span> <span class="o">[</span><span class="n">Hwf</span> <span class="n">Hinv</span><span class="o">]].</span>
</span><span id="linespan-3144"><a id="line-3144" name="line-3144"></a>  <span class="k">unfold</span> <span class="n">fully_reachable</span><span class="o">.</span>
</span><span id="linespan-3145"><a id="line-3145" name="line-3145"></a>  <span class="k">eapply</span> <span class="o">(</span><span class="n">cgraph_ind'</span> <span class="o">(λ</span> <span class="n">a</span> <span class="n">b</span> <span class="n">l</span><span class="o">,</span> <span class="n">blocked</span> <span class="n">ρ</span> <span class="n">a</span> <span class="n">b</span><span class="o">));</span> <span class="k">eauto</span><span class="o">;</span> <span class="kr">first</span> <span class="n">solve_proper</span><span class="o">.</span>
</span><span id="linespan-3146"><a id="line-3146" name="line-3146"></a>  <span class="k">intros</span> <span class="n">i</span> <span class="n">IH1</span> <span class="n">IH2</span><span class="o">.</span>
</span><span id="linespan-3147"><a id="line-3147" name="line-3147"></a>  <span class="n">classical_right</span><span class="o">.</span>
</span><span id="linespan-3148"><a id="line-3148" name="line-3148"></a>  <span class="k">rewrite</span> <span class="o">/</span><span class="n">inactive</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-3149"><a id="line-3149" name="line-3149"></a>  <span class="k">pose</span> <span class="n">proof</span> <span class="o">(</span><span class="n">Hinv</span> <span class="n">i</span><span class="o">)</span> <span class="k">as</span> <span class="n">Q</span><span class="o">.</span>
</span><span id="linespan-3150"><a id="line-3150" name="line-3150"></a>  <span class="k">unfold</span> <span class="n">linv</span> <span class="k">in</span> <span class="n">Q</span><span class="o">.</span>
</span><span id="linespan-3151"><a id="line-3151" name="line-3151"></a>  <span class="k">destruct</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">!!</span> <span class="n">i</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">E</span><span class="o">;</span> <span class="n">simplify_eq</span><span class="o">.</span> <span class="k">clear</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-3152"><a id="line-3152" name="line-3152"></a>  <span class="k">destruct</span> <span class="n">o</span><span class="o">.</span>
</span><span id="linespan-3153"><a id="line-3153" name="line-3153"></a>  <span class="o">-</span> <span class="k">apply</span> <span class="n">pure_sep_holds</span> <span class="k">in</span> <span class="n">Q</span> <span class="k">as</span> <span class="o">[</span><span class="n">Q1</span> <span class="n">Q2</span><span class="o">].</span> <span class="k">assert</span> <span class="o">(</span><span class="n">Q2'</span> <span class="o">:=</span> <span class="n">Q2</span><span class="o">).</span>
</span><span id="linespan-3154"><a id="line-3154" name="line-3154"></a>    <span class="k">eapply</span> <span class="n">holds_entails</span> <span class="k">in</span> <span class="n">Q2</span><span class="o">;</span> <span class="kr">last</span> <span class="k">apply</span> <span class="n">pure_progress</span><span class="o">.</span>
</span><span id="linespan-3155"><a id="line-3155" name="line-3155"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">=</span> <span class="o">{[</span> <span class="n">i</span> <span class="o">:=</span> <span class="n">Thread</span> <span class="n">e</span> <span class="o">]}</span> <span class="bp">∪</span> <span class="n">delete</span> <span class="n">i</span> <span class="n">ρ</span><span class="o">)</span> <span class="k">as</span> <span class="n">HH</span><span class="o">.</span>
</span><span id="linespan-3156"><a id="line-3156" name="line-3156"></a>    <span class="o">{</span> <span class="k">apply</span> <span class="n">map_eq</span><span class="o">.</span> <span class="k">intro</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="o">}</span> <span class="k">rewrite</span> <span class="n">HH</span><span class="o">.</span>
</span><span id="linespan-3157"><a id="line-3157" name="line-3157"></a>    <span class="k">apply</span> <span class="n">pure_holds</span> <span class="k">in</span> <span class="n">Q2</span> <span class="k">as</span> <span class="o">[[</span><span class="n">v</span> <span class="o">-&gt;]|</span><span class="n">Q</span><span class="o">].</span>
</span><span id="linespan-3158"><a id="line-3158" name="line-3158"></a>    <span class="o">+</span> <span class="k">constructor</span><span class="o">.</span> <span class="k">exists</span> <span class="o">(</span><span class="bp">∅</span> <span class="bp">∪</span> <span class="n">delete</span> <span class="n">i</span> <span class="n">ρ</span><span class="o">).</span>
</span><span id="linespan-3159"><a id="line-3159" name="line-3159"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">v</span> <span class="o">=</span> <span class="n">UnitV</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-3160"><a id="line-3160" name="line-3160"></a>      <span class="o">{</span> <span class="k">eapply</span> <span class="n">pure_holds</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">holds_entails</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3161"><a id="line-3161" name="line-3161"></a>        <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">v</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span> <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3162"><a id="line-3162" name="line-3162"></a>      <span class="k">econstructor</span><span class="o">;</span> <span class="kr">last</span> <span class="k">constructor</span><span class="o">;</span> <span class="kr">last</span> <span class="n">solve_map_disjoint</span><span class="o">.</span>
</span><span id="linespan-3163"><a id="line-3163" name="line-3163"></a>      <span class="k">intro</span> <span class="n">x</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="k">destruct</span> <span class="o">(_!!</span><span class="n">x</span><span class="o">);</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3164"><a id="line-3164" name="line-3164"></a>    <span class="o">+</span> <span class="k">destruct</span> <span class="n">Q</span> <span class="k">as</span> <span class="o">(</span><span class="n">k</span> <span class="o">&amp;</span> <span class="n">e0</span> <span class="o">&amp;</span> <span class="n">Hk</span> <span class="o">&amp;</span> <span class="o">-&gt;</span> <span class="o">&amp;</span> <span class="o">[[</span><span class="n">e0'</span> <span class="n">Hpstep</span><span class="o">]|</span><span class="n">Himpure</span><span class="o">]).</span>
</span><span id="linespan-3165"><a id="line-3165" name="line-3165"></a>      <span class="o">*</span> <span class="k">constructor</span><span class="o">.</span> <span class="n">eexists</span> <span class="o">({[</span> <span class="n">i</span> <span class="o">:=</span> <span class="n">Thread</span> <span class="o">(</span><span class="n">k</span> <span class="n">e0'</span><span class="o">)</span> <span class="o">]}</span> <span class="bp">∪</span> <span class="n">delete</span> <span class="n">i</span> <span class="n">ρ</span><span class="o">).</span>
</span><span id="linespan-3166"><a id="line-3166" name="line-3166"></a>        <span class="k">constructor</span><span class="o">;</span> <span class="o">[</span><span class="k">intro</span> <span class="n">j</span><span class="o">;</span> <span class="n">smap</span><span class="o">;</span> <span class="kp">by</span> <span class="k">destruct</span> <span class="o">(_!!</span><span class="n">j</span><span class="o">)..|].</span>
</span><span id="linespan-3167"><a id="line-3167" name="line-3167"></a>        <span class="k">constructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3168"><a id="line-3168" name="line-3168"></a>      <span class="o">*</span> <span class="k">destruct</span> <span class="n">Himpure</span><span class="o">.</span>
</span><span id="linespan-3169"><a id="line-3169" name="line-3169"></a>        <span class="o">--</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">cfg_fresh2</span> <span class="n">ρ</span><span class="o">)</span> <span class="k">as</span> <span class="o">(</span><span class="n">j</span> <span class="o">&amp;</span> <span class="n">n</span> <span class="o">&amp;</span> <span class="n">Hj</span> <span class="o">&amp;</span> <span class="n">Hn</span> <span class="o">&amp;</span> <span class="n">Hjn</span><span class="o">).</span>
</span><span id="linespan-3170"><a id="line-3170" name="line-3170"></a>           <span class="k">constructor</span><span class="o">.</span> <span class="n">eexists</span><span class="o">.</span>
</span><span id="linespan-3171"><a id="line-3171" name="line-3171"></a>           <span class="k">constructor</span><span class="o">;</span> <span class="kr">last</span> <span class="k">eapply</span> <span class="n">Fork_step</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span> <span class="kr">last</span> <span class="k">apply</span> <span class="n">Hjn</span><span class="o">;</span>
</span><span id="linespan-3172"><a id="line-3172" name="line-3172"></a>           <span class="kr">try</span> <span class="k">intros</span> <span class="o">-&gt;;</span> <span class="n">simplify_eq</span><span class="o">;</span>
</span><span id="linespan-3173"><a id="line-3173" name="line-3173"></a>           <span class="k">intro</span> <span class="n">x</span><span class="o">;</span> <span class="n">smap</span><span class="o">;</span> <span class="kp">by</span> <span class="k">destruct</span> <span class="o">(_!!</span><span class="n">x</span><span class="o">).</span>
</span><span id="linespan-3174"><a id="line-3174" name="line-3174"></a>        <span class="o">--</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">cfg_fresh1</span> <span class="n">ρ</span><span class="o">)</span> <span class="k">as</span> <span class="o">(</span><span class="n">j</span> <span class="o">&amp;</span> <span class="n">Hj</span><span class="o">).</span>
</span><span id="linespan-3175"><a id="line-3175" name="line-3175"></a>           <span class="k">constructor</span><span class="o">.</span> <span class="n">eexists</span><span class="o">.</span>
</span><span id="linespan-3176"><a id="line-3176" name="line-3176"></a>           <span class="k">assert</span> <span class="o">(</span><span class="n">i</span> <span class="o">≠</span> <span class="n">j</span><span class="o">).</span> <span class="o">{</span> <span class="k">intros</span> <span class="o">-&gt;.</span> <span class="n">smap</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3177"><a id="line-3177" name="line-3177"></a>           <span class="k">constructor</span><span class="o">;</span> <span class="kr">last</span> <span class="k">eapply</span> <span class="n">NewGroup_step</span><span class="o">;</span> <span class="kr">try</span> <span class="kp">done</span><span class="o">;</span>
</span><span id="linespan-3178"><a id="line-3178" name="line-3178"></a>           <span class="k">intro</span> <span class="n">x</span><span class="o">;</span> <span class="n">smap</span><span class="o">;</span> <span class="k">destruct</span> <span class="o">(_!!</span><span class="n">x</span><span class="o">);</span> <span class="kr">try</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3179"><a id="line-3179" name="line-3179"></a>        <span class="o">--</span> <span class="k">rewrite</span> <span class="o">-</span><span class="n">HH</span><span class="o">.</span>
</span><span id="linespan-3180"><a id="line-3180" name="line-3180"></a>           <span class="k">assert</span> <span class="o">(∃</span> <span class="n">l</span><span class="o">,</span> <span class="n">out_edges</span> <span class="n">g</span> <span class="n">i</span> <span class="o">!!</span> <span class="n">i0</span> <span class="bp">≡</span> <span class="n">Some</span> <span class="n">l</span><span class="o">)</span> <span class="k">as</span> <span class="o">[</span><span class="n">l</span> <span class="n">Hl</span><span class="o">].</span>
</span><span id="linespan-3181"><a id="line-3181" name="line-3181"></a>           <span class="o">{</span>
</span><span id="linespan-3182"><a id="line-3182" name="line-3182"></a>             <span class="k">assert</span> <span class="o">(</span><span class="n">holds</span> <span class="o">((∃</span> <span class="n">l</span><span class="o">,</span> <span class="n">own_out</span> <span class="n">i0</span> <span class="n">l</span><span class="o">)</span> <span class="bp">∗</span> <span class="n">True</span><span class="o">)</span> <span class="o">(</span><span class="n">out_edges</span> <span class="n">g</span> <span class="n">i</span><span class="o">))</span> <span class="k">as</span> <span class="n">QQ</span><span class="o">.</span>
</span><span id="linespan-3183"><a id="line-3183" name="line-3183"></a>             <span class="o">{</span>
</span><span id="linespan-3184"><a id="line-3184" name="line-3184"></a>               <span class="k">eapply</span> <span class="n">holds_entails</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">exact</span> <span class="n">Q2'</span><span class="o">.</span>
</span><span id="linespan-3185"><a id="line-3185" name="line-3185"></a>               <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-3186"><a id="line-3186" name="line-3186"></a>               <span class="k">rewrite</span> <span class="n">replacement</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3187"><a id="line-3187" name="line-3187"></a>               <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="s2">"[H1 H2]"</span><span class="o">.</span>
</span><span id="linespan-3188"><a id="line-3188" name="line-3188"></a>               <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-3189"><a id="line-3189" name="line-3189"></a>               <span class="k">destruct</span> <span class="n">H</span><span class="o">;</span> <span class="k">simpl</span><span class="o">;</span> <span class="n">iDestr</span> <span class="s2">"H1"</span><span class="o">;</span>
</span><span id="linespan-3190"><a id="line-3190" name="line-3190"></a>               <span class="kr">try</span> <span class="n">iDestruct</span> <span class="s2">"H1"</span> <span class="k">as</span> <span class="s2">"[H1 H12]"</span><span class="o">;</span>
</span><span id="linespan-3191"><a id="line-3191" name="line-3191"></a>               <span class="kr">try</span> <span class="n">iDestr</span> <span class="s2">"H1"</span><span class="o">;</span> <span class="n">iSplitL</span> <span class="s2">"H1"</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">with</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-3192"><a id="line-3192" name="line-3192"></a>             <span class="o">}</span>
</span><span id="linespan-3193"><a id="line-3193" name="line-3193"></a>             <span class="k">eapply</span> <span class="n">sep_holds</span> <span class="k">in</span> <span class="n">QQ</span> <span class="k">as</span> <span class="o">(</span><span class="n">Σ1</span> <span class="o">&amp;</span> <span class="n">Σ2</span> <span class="o">&amp;</span> <span class="n">H12</span> <span class="o">&amp;</span> <span class="n">Hdisj</span> <span class="o">&amp;</span> <span class="n">Hout</span> <span class="o">&amp;</span> <span class="n">HP</span><span class="o">).</span>
</span><span id="linespan-3194"><a id="line-3194" name="line-3194"></a>             <span class="k">eapply</span> <span class="n">exists_holds</span> <span class="k">in</span> <span class="n">Hout</span> <span class="k">as</span> <span class="o">[</span><span class="n">l</span> <span class="n">Hout</span><span class="o">].</span>
</span><span id="linespan-3195"><a id="line-3195" name="line-3195"></a>             <span class="k">unfold</span> <span class="n">own_out</span> <span class="k">in</span> <span class="n">Hout</span><span class="o">.</span>
</span><span id="linespan-3196"><a id="line-3196" name="line-3196"></a>             <span class="k">eapply</span> <span class="n">own_holds</span> <span class="k">in</span> <span class="n">Hout</span><span class="o">.</span>
</span><span id="linespan-3197"><a id="line-3197" name="line-3197"></a>             <span class="k">exists</span> <span class="n">l</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">H12</span><span class="o">.</span>
</span><span id="linespan-3198"><a id="line-3198" name="line-3198"></a>             <span class="k">rewrite</span> <span class="o">-</span><span class="n">Hout</span><span class="o">.</span>
</span><span id="linespan-3199"><a id="line-3199" name="line-3199"></a>             <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-3200"><a id="line-3200" name="line-3200"></a>           <span class="o">}</span>
</span><span id="linespan-3201"><a id="line-3201" name="line-3201"></a>           <span class="k">assert</span> <span class="o">(</span><span class="n">is_Some</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">!!</span> <span class="n">i0</span><span class="o">))</span> <span class="k">as</span> <span class="o">[</span><span class="n">x</span> <span class="n">F</span><span class="o">].</span>
</span><span id="linespan-3202"><a id="line-3202" name="line-3202"></a>           <span class="o">{</span>
</span><span id="linespan-3203"><a id="line-3203" name="line-3203"></a>             <span class="k">eapply</span> <span class="n">out_edges_in_labels</span> <span class="k">in</span> <span class="n">Hl</span> <span class="k">as</span> <span class="o">[</span><span class="n">x</span> <span class="n">Hx</span><span class="o">].</span>
</span><span id="linespan-3204"><a id="line-3204" name="line-3204"></a>             <span class="n">specialize</span> <span class="o">(</span><span class="n">Hinv</span> <span class="n">i0</span><span class="o">).</span>
</span><span id="linespan-3205"><a id="line-3205" name="line-3205"></a>             <span class="k">rewrite</span> <span class="n">Hx</span> <span class="k">in</span> <span class="n">Hinv</span><span class="o">.</span>
</span><span id="linespan-3206"><a id="line-3206" name="line-3206"></a>             <span class="k">eapply</span> <span class="n">pure_holds</span><span class="o">.</span>
</span><span id="linespan-3207"><a id="line-3207" name="line-3207"></a>             <span class="k">eapply</span> <span class="n">holds_entails</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">exact</span> <span class="n">Hinv</span><span class="o">.</span>
</span><span id="linespan-3208"><a id="line-3208" name="line-3208"></a>             <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span>
</span><span id="linespan-3209"><a id="line-3209" name="line-3209"></a>             <span class="k">unfold</span> <span class="n">linv</span><span class="o">.</span>
</span><span id="linespan-3210"><a id="line-3210" name="line-3210"></a>             <span class="k">destruct</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">!!</span> <span class="n">i0</span><span class="o">)</span> <span class="k">as</span> <span class="o">[</span><span class="bp">[]</span><span class="o">|];</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3211"><a id="line-3211" name="line-3211"></a>             <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="o">%</span><span class="n">HEF</span><span class="o">.</span>
</span><span id="linespan-3212"><a id="line-3212" name="line-3212"></a>             <span class="k">eapply</span> <span class="n">multiset_empty_mult</span> <span class="k">in</span> <span class="n">HEF</span> <span class="k">as</span> <span class="o">[</span><span class="n">HEF</span> <span class="n">HEF'</span><span class="o">].</span>
</span><span id="linespan-3213"><a id="line-3213" name="line-3213"></a>             <span class="n">exfalso</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">multiset_empty_neq_singleton</span><span class="o">.</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3214"><a id="line-3214" name="line-3214"></a>           <span class="o">}</span>
</span><span id="linespan-3215"><a id="line-3215" name="line-3215"></a>           <span class="k">assert</span> <span class="o">(</span><span class="n">blocked</span> <span class="n">ρ</span> <span class="n">i</span> <span class="n">i0</span><span class="o">).</span> <span class="o">{</span>
</span><span id="linespan-3216"><a id="line-3216" name="line-3216"></a>             <span class="k">unfold</span> <span class="n">blocked</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">E</span><span class="o">.</span>
</span><span id="linespan-3217"><a id="line-3217" name="line-3217"></a>             <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3218"><a id="line-3218" name="line-3218"></a>             <span class="k">unfold</span> <span class="n">expr_waiting</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3219"><a id="line-3219" name="line-3219"></a>           <span class="o">}</span>
</span><span id="linespan-3220"><a id="line-3220" name="line-3220"></a>           <span class="k">assert</span> <span class="o">(</span><span class="n">reachable</span> <span class="n">ρ</span> <span class="n">i0</span><span class="o">).</span> <span class="o">{</span>
</span><span id="linespan-3221"><a id="line-3221" name="line-3221"></a>             <span class="n">edestruct</span> <span class="o">(</span><span class="n">IH1</span> <span class="n">i0</span><span class="o">);</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3222"><a id="line-3222" name="line-3222"></a>             <span class="k">unfold</span> <span class="n">inactive</span> <span class="k">in</span> <span class="o">*.</span> <span class="n">simplify_eq</span><span class="o">.</span>
</span><span id="linespan-3223"><a id="line-3223" name="line-3223"></a>           <span class="o">}</span>
</span><span id="linespan-3224"><a id="line-3224" name="line-3224"></a>           <span class="k">eapply</span> <span class="n">Waiting_reachable</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3225"><a id="line-3225" name="line-3225"></a>           <span class="k">unfold</span> <span class="n">waiting</span><span class="o">.</span>
</span><span id="linespan-3226"><a id="line-3226" name="line-3226"></a>           <span class="k">left</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">E</span><span class="o">.</span>
</span><span id="linespan-3227"><a id="line-3227" name="line-3227"></a>           <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3228"><a id="line-3228" name="line-3228"></a>           <span class="k">unfold</span> <span class="n">expr_waiting</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3229"><a id="line-3229" name="line-3229"></a>  <span class="o">-</span> <span class="c">(* Barrier *)</span>
</span><span id="linespan-3230"><a id="line-3230" name="line-3230"></a>    <span class="k">clear</span> <span class="n">IH1</span><span class="o">.</span>
</span><span id="linespan-3231"><a id="line-3231" name="line-3231"></a>    <span class="k">eapply</span> <span class="n">affinely_pure_holds</span> <span class="k">in</span> <span class="n">Q</span> <span class="k">as</span> <span class="o">[</span><span class="n">Q1</span> <span class="o">[</span><span class="n">t1</span> <span class="o">[</span><span class="n">t2</span> <span class="n">Q2</span><span class="o">]]].</span>
</span><span id="linespan-3232"><a id="line-3232" name="line-3232"></a>    <span class="c">(* Need to check whether both threads are trying to sync. *)</span>
</span><span id="linespan-3233"><a id="line-3233" name="line-3233"></a>    <span class="c">(* If so, then can_step *)</span>
</span><span id="linespan-3234"><a id="line-3234" name="line-3234"></a>    <span class="c">(* Otherwise, use IH *)</span>
</span><span id="linespan-3235"><a id="line-3235" name="line-3235"></a>    <span class="k">apply</span> <span class="n">in_labels_out_edges2</span> <span class="k">in</span> <span class="n">Q2</span> <span class="k">as</span> <span class="o">(</span><span class="n">j1</span> <span class="o">&amp;</span> <span class="n">j2</span> <span class="o">&amp;</span> <span class="n">Hj12</span> <span class="o">&amp;</span> <span class="n">Hj1</span> <span class="o">&amp;</span> <span class="n">Hj2</span><span class="o">).</span>
</span><span id="linespan-3236"><a id="line-3236" name="line-3236"></a>
</span><span id="linespan-3237"><a id="line-3237" name="line-3237"></a>    <span class="n">edestruct</span> <span class="o">(</span><span class="n">linv_out_Some</span> <span class="n">i</span> <span class="n">j1</span><span class="o">)</span> <span class="k">as</span> <span class="o">[</span><span class="n">e1</span> <span class="o">[</span><span class="n">He1</span> <span class="n">He1'</span><span class="o">]];</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3238"><a id="line-3238" name="line-3238"></a>    <span class="n">edestruct</span> <span class="o">(</span><span class="n">linv_out_Some</span> <span class="n">i</span> <span class="n">j2</span><span class="o">)</span> <span class="k">as</span> <span class="o">[</span><span class="n">e2</span> <span class="o">[</span><span class="n">He2</span> <span class="n">He2'</span><span class="o">]];</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3239"><a id="line-3239" name="line-3239"></a>
</span><span id="linespan-3240"><a id="line-3240" name="line-3240"></a>    <span class="k">destruct</span> <span class="o">(</span><span class="n">classic</span> <span class="o">(</span><span class="n">blocked</span> <span class="n">ρ</span> <span class="n">j1</span> <span class="n">i</span><span class="o">))</span> <span class="k">as</span> <span class="o">[</span><span class="n">HB1</span><span class="o">|</span><span class="n">HB1</span><span class="o">];</span> <span class="kr">last</span> <span class="kr">first</span><span class="o">.</span>
</span><span id="linespan-3241"><a id="line-3241" name="line-3241"></a>    <span class="o">{</span>
</span><span id="linespan-3242"><a id="line-3242" name="line-3242"></a>      <span class="k">destruct</span> <span class="o">(</span><span class="n">IH2</span> <span class="o">_</span> <span class="o">_</span> <span class="n">Hj1</span> <span class="n">HB1</span><span class="o">)</span> <span class="k">as</span> <span class="o">[</span><span class="n">H</span><span class="o">|</span><span class="n">H</span><span class="o">].</span>
</span><span id="linespan-3243"><a id="line-3243" name="line-3243"></a>      <span class="o">-</span> <span class="n">exfalso</span><span class="o">.</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">out_edge_active</span><span class="o">.</span>
</span><span id="linespan-3244"><a id="line-3244" name="line-3244"></a>      <span class="o">-</span> <span class="k">eapply</span> <span class="n">Waiting_reachable</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3245"><a id="line-3245" name="line-3245"></a>        <span class="k">unfold</span> <span class="n">waiting</span><span class="o">.</span>
</span><span id="linespan-3246"><a id="line-3246" name="line-3246"></a>        <span class="k">unfold</span> <span class="n">blocked</span> <span class="k">in</span> <span class="n">HB1</span><span class="o">.</span>
</span><span id="linespan-3247"><a id="line-3247" name="line-3247"></a>        <span class="k">right</span><span class="o">.</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3248"><a id="line-3248" name="line-3248"></a>        <span class="k">split</span><span class="o">.</span>
</span><span id="linespan-3249"><a id="line-3249" name="line-3249"></a>        <span class="o">+</span> <span class="k">erewrite</span> <span class="n">obj_refs_linv</span><span class="o">;</span> <span class="kr">last</span> <span class="k">eauto</span><span class="o">;</span> <span class="kr">last</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3250"><a id="line-3250" name="line-3250"></a>          <span class="k">eapply</span> <span class="n">elem_of_dom</span><span class="o">.</span> <span class="n">inv</span> <span class="n">Hj1</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3251"><a id="line-3251" name="line-3251"></a>        <span class="o">+</span> <span class="k">intros</span> <span class="o">???.</span> <span class="k">eapply</span> <span class="n">HB1</span><span class="o">.</span> <span class="k">subst</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3252"><a id="line-3252" name="line-3252"></a>    <span class="o">}</span>
</span><span id="linespan-3253"><a id="line-3253" name="line-3253"></a>
</span><span id="linespan-3254"><a id="line-3254" name="line-3254"></a>    <span class="k">destruct</span> <span class="o">(</span><span class="n">classic</span> <span class="o">(</span><span class="n">blocked</span> <span class="n">ρ</span> <span class="n">j2</span> <span class="n">i</span><span class="o">))</span> <span class="k">as</span> <span class="o">[</span><span class="n">HB2</span><span class="o">|</span><span class="n">HB2</span><span class="o">];</span> <span class="kr">last</span> <span class="kr">first</span><span class="o">.</span>
</span><span id="linespan-3255"><a id="line-3255" name="line-3255"></a>    <span class="o">{</span>
</span><span id="linespan-3256"><a id="line-3256" name="line-3256"></a>      <span class="k">destruct</span> <span class="o">(</span><span class="n">IH2</span> <span class="o">_</span> <span class="o">_</span> <span class="n">Hj2</span> <span class="n">HB2</span><span class="o">)</span> <span class="k">as</span> <span class="o">[</span><span class="n">H</span><span class="o">|</span><span class="n">H</span><span class="o">].</span>
</span><span id="linespan-3257"><a id="line-3257" name="line-3257"></a>      <span class="o">-</span> <span class="n">exfalso</span><span class="o">.</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">out_edge_active</span><span class="o">.</span>
</span><span id="linespan-3258"><a id="line-3258" name="line-3258"></a>      <span class="o">-</span> <span class="k">eapply</span> <span class="n">Waiting_reachable</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3259"><a id="line-3259" name="line-3259"></a>        <span class="k">unfold</span> <span class="n">waiting</span><span class="o">.</span>
</span><span id="linespan-3260"><a id="line-3260" name="line-3260"></a>        <span class="k">unfold</span> <span class="n">blocked</span> <span class="k">in</span> <span class="n">HB2</span><span class="o">.</span>
</span><span id="linespan-3261"><a id="line-3261" name="line-3261"></a>        <span class="k">right</span><span class="o">.</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3262"><a id="line-3262" name="line-3262"></a>        <span class="k">split</span><span class="o">.</span>
</span><span id="linespan-3263"><a id="line-3263" name="line-3263"></a>        <span class="o">+</span> <span class="k">erewrite</span> <span class="n">obj_refs_linv</span><span class="o">;</span> <span class="kr">last</span> <span class="k">eauto</span><span class="o">;</span> <span class="kr">last</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3264"><a id="line-3264" name="line-3264"></a>          <span class="k">eapply</span> <span class="n">elem_of_dom</span><span class="o">.</span> <span class="n">inv</span> <span class="n">Hj1</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3265"><a id="line-3265" name="line-3265"></a>        <span class="o">+</span> <span class="k">intros</span> <span class="o">???.</span> <span class="k">eapply</span> <span class="n">HB2</span><span class="o">.</span> <span class="k">subst</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3266"><a id="line-3266" name="line-3266"></a>    <span class="o">}</span>
</span><span id="linespan-3267"><a id="line-3267" name="line-3267"></a>
</span><span id="linespan-3268"><a id="line-3268" name="line-3268"></a>    <span class="k">eapply</span> <span class="n">Can_step_reachable</span><span class="o">.</span>
</span><span id="linespan-3269"><a id="line-3269" name="line-3269"></a>    <span class="k">destruct</span> <span class="n">HB1</span> <span class="k">as</span> <span class="o">(</span><span class="n">e1'</span> <span class="o">&amp;</span> <span class="n">Hρ1</span> <span class="o">&amp;</span> <span class="n">Hw1</span><span class="o">).</span>
</span><span id="linespan-3270"><a id="line-3270" name="line-3270"></a>    <span class="k">destruct</span> <span class="n">HB2</span> <span class="k">as</span> <span class="o">(</span><span class="n">e2'</span> <span class="o">&amp;</span> <span class="n">Hρ2</span> <span class="o">&amp;</span> <span class="n">Hw2</span><span class="o">).</span>
</span><span id="linespan-3271"><a id="line-3271" name="line-3271"></a>    <span class="k">clear</span> <span class="n">He1</span> <span class="n">He1'</span> <span class="n">He2</span> <span class="n">He2'</span> <span class="n">e1</span> <span class="n">e2</span><span class="o">.</span>
</span><span id="linespan-3272"><a id="line-3272" name="line-3272"></a>    <span class="k">destruct</span> <span class="n">Hw1</span> <span class="k">as</span> <span class="o">(</span><span class="n">k1</span> <span class="o">&amp;</span> <span class="n">ee1'</span> <span class="o">&amp;</span> <span class="n">Hk1</span> <span class="o">&amp;</span> <span class="o">-&gt;</span> <span class="o">&amp;</span> <span class="n">Hw1</span><span class="o">).</span>
</span><span id="linespan-3273"><a id="line-3273" name="line-3273"></a>    <span class="k">destruct</span> <span class="n">Hw2</span> <span class="k">as</span> <span class="o">(</span><span class="n">k2</span> <span class="o">&amp;</span> <span class="n">ee2'</span> <span class="o">&amp;</span> <span class="n">Hk2</span> <span class="o">&amp;</span> <span class="o">-&gt;</span> <span class="o">&amp;</span> <span class="n">Hw2</span><span class="o">).</span>
</span><span id="linespan-3274"><a id="line-3274" name="line-3274"></a>
</span><span id="linespan-3275"><a id="line-3275" name="line-3275"></a>    <span class="k">pose</span> <span class="n">proof</span> <span class="o">(</span><span class="n">Hinv</span> <span class="n">j1</span><span class="o">)</span> <span class="k">as</span> <span class="n">Hinvj1</span><span class="o">.</span>
</span><span id="linespan-3276"><a id="line-3276" name="line-3276"></a>    <span class="k">unfold</span> <span class="n">linv</span> <span class="k">in</span> <span class="n">Hinvj1</span><span class="o">.</span>
</span><span id="linespan-3277"><a id="line-3277" name="line-3277"></a>    <span class="k">rewrite</span> <span class="n">Hρ1</span> <span class="k">in</span> <span class="n">Hinvj1</span><span class="o">.</span>
</span><span id="linespan-3278"><a id="line-3278" name="line-3278"></a>    <span class="k">eapply</span> <span class="n">pure_sep_holds</span> <span class="k">in</span> <span class="n">Hinvj1</span> <span class="k">as</span> <span class="o">[_</span> <span class="n">Htyped1</span><span class="o">].</span>
</span><span id="linespan-3279"><a id="line-3279" name="line-3279"></a>
</span><span id="linespan-3280"><a id="line-3280" name="line-3280"></a>    <span class="k">destruct</span> <span class="n">Hw1</span><span class="o">;</span> <span class="kr">try</span> <span class="kp">solve</span> <span class="o">[</span>
</span><span id="linespan-3281"><a id="line-3281" name="line-3281"></a>      <span class="n">exfalso</span><span class="o">;</span>
</span><span id="linespan-3282"><a id="line-3282" name="line-3282"></a>      <span class="k">eapply</span> <span class="n">label_unique</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">exact</span> <span class="n">Hj1</span><span class="o">;</span>
</span><span id="linespan-3283"><a id="line-3283" name="line-3283"></a>      <span class="k">eapply</span> <span class="n">holds_entails</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span>
</span><span id="linespan-3284"><a id="line-3284" name="line-3284"></a>      <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">;</span> <span class="k">rewrite</span> <span class="n">replacement</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span>
</span><span id="linespan-3285"><a id="line-3285" name="line-3285"></a>      <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">;</span> <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="s2">"[H1 H2]"</span><span class="o">;</span>
</span><span id="linespan-3286"><a id="line-3286" name="line-3286"></a>      <span class="k">simpl</span><span class="o">;</span> <span class="n">iDestr</span> <span class="s2">"H1"</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">with</span> <span class="n">iFrame</span><span class="o">;</span>
</span><span id="linespan-3287"><a id="line-3287" name="line-3287"></a>      <span class="n">iDestruct</span> <span class="s2">"H1"</span> <span class="k">as</span> <span class="s2">"[Q1 Q2]"</span><span class="o">;</span>
</span><span id="linespan-3288"><a id="line-3288" name="line-3288"></a>      <span class="n">iDestr</span> <span class="s2">"Q1"</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">with</span> <span class="n">iFrame</span>
</span><span id="linespan-3289"><a id="line-3289" name="line-3289"></a>    <span class="o">].</span>
</span><span id="linespan-3290"><a id="line-3290" name="line-3290"></a>    <span class="k">clear</span> <span class="n">Htyped1</span><span class="o">.</span>
</span><span id="linespan-3291"><a id="line-3291" name="line-3291"></a>
</span><span id="linespan-3292"><a id="line-3292" name="line-3292"></a>    <span class="k">pose</span> <span class="n">proof</span> <span class="o">(</span><span class="n">Hinv</span> <span class="n">j2</span><span class="o">)</span> <span class="k">as</span> <span class="n">Hinvj2</span><span class="o">.</span>
</span><span id="linespan-3293"><a id="line-3293" name="line-3293"></a>    <span class="k">unfold</span> <span class="n">linv</span> <span class="k">in</span> <span class="n">Hinvj2</span><span class="o">.</span>
</span><span id="linespan-3294"><a id="line-3294" name="line-3294"></a>    <span class="k">rewrite</span> <span class="n">Hρ2</span> <span class="k">in</span> <span class="n">Hinvj2</span><span class="o">.</span>
</span><span id="linespan-3295"><a id="line-3295" name="line-3295"></a>    <span class="k">eapply</span> <span class="n">pure_sep_holds</span> <span class="k">in</span> <span class="n">Hinvj2</span> <span class="k">as</span> <span class="o">[_</span> <span class="n">Htyped2</span><span class="o">].</span>
</span><span id="linespan-3296"><a id="line-3296" name="line-3296"></a>
</span><span id="linespan-3297"><a id="line-3297" name="line-3297"></a>    <span class="k">destruct</span> <span class="n">Hw2</span><span class="o">;</span> <span class="kr">try</span> <span class="kp">solve</span> <span class="o">[</span>
</span><span id="linespan-3298"><a id="line-3298" name="line-3298"></a>      <span class="n">exfalso</span><span class="o">;</span>
</span><span id="linespan-3299"><a id="line-3299" name="line-3299"></a>      <span class="k">eapply</span> <span class="n">label_unique</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">exact</span> <span class="n">Hj2</span><span class="o">;</span>
</span><span id="linespan-3300"><a id="line-3300" name="line-3300"></a>      <span class="k">eapply</span> <span class="n">holds_entails</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span>
</span><span id="linespan-3301"><a id="line-3301" name="line-3301"></a>      <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">;</span> <span class="k">rewrite</span> <span class="n">replacement</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span>
</span><span id="linespan-3302"><a id="line-3302" name="line-3302"></a>      <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">;</span> <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="s2">"[H1 H2]"</span><span class="o">;</span>
</span><span id="linespan-3303"><a id="line-3303" name="line-3303"></a>      <span class="k">simpl</span><span class="o">;</span> <span class="n">iDestr</span> <span class="s2">"H1"</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">with</span> <span class="n">iFrame</span><span class="o">;</span>
</span><span id="linespan-3304"><a id="line-3304" name="line-3304"></a>      <span class="n">iDestruct</span> <span class="s2">"H1"</span> <span class="k">as</span> <span class="s2">"[Q1 Q2]"</span><span class="o">;</span>
</span><span id="linespan-3305"><a id="line-3305" name="line-3305"></a>      <span class="n">iDestr</span> <span class="s2">"Q1"</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">with</span> <span class="n">iFrame</span>
</span><span id="linespan-3306"><a id="line-3306" name="line-3306"></a>    <span class="o">].</span>
</span><span id="linespan-3307"><a id="line-3307" name="line-3307"></a>
</span><span id="linespan-3308"><a id="line-3308" name="line-3308"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">=</span> <span class="o">{[</span>
</span><span id="linespan-3309"><a id="line-3309" name="line-3309"></a>      <span class="n">j1</span> <span class="o">:=</span> <span class="n">Thread</span> <span class="o">(</span><span class="n">k1</span> <span class="o">(</span><span class="n">App</span> <span class="o">(</span><span class="n">Val</span> <span class="o">(</span><span class="n">BarrierV</span> <span class="n">j</span><span class="o">))</span> <span class="o">(</span><span class="n">Val</span> <span class="n">v</span><span class="o">)));</span>
</span><span id="linespan-3310"><a id="line-3310" name="line-3310"></a>      <span class="n">j2</span> <span class="o">:=</span> <span class="n">Thread</span> <span class="o">(</span><span class="n">k2</span> <span class="o">(</span><span class="n">App</span> <span class="o">(</span><span class="n">Val</span> <span class="o">(</span><span class="n">BarrierV</span> <span class="n">j</span><span class="o">))</span> <span class="o">(</span><span class="n">Val</span> <span class="n">v0</span><span class="o">)));</span>
</span><span id="linespan-3311"><a id="line-3311" name="line-3311"></a>      <span class="n">j</span> <span class="o">:=</span> <span class="n">Barrier</span> <span class="o">]}</span> <span class="bp">∪</span> <span class="o">(</span><span class="n">delete</span> <span class="n">j1</span> <span class="o">$</span> <span class="n">delete</span> <span class="n">j2</span> <span class="o">$</span> <span class="n">delete</span> <span class="n">j</span> <span class="n">ρ</span><span class="o">)).</span>
</span><span id="linespan-3312"><a id="line-3312" name="line-3312"></a>    <span class="o">{</span> <span class="k">apply</span> <span class="n">map_eq</span><span class="o">.</span> <span class="k">intro</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3313"><a id="line-3313" name="line-3313"></a>    <span class="k">rewrite</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-3314"><a id="line-3314" name="line-3314"></a>    <span class="k">econstructor</span><span class="o">.</span> <span class="k">econstructor</span><span class="o">;</span> <span class="kr">last</span> <span class="k">econstructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span>
</span><span id="linespan-3315"><a id="line-3315" name="line-3315"></a>    <span class="kr">try</span> <span class="k">intros</span> <span class="o">-&gt;;</span> <span class="n">smap</span><span class="o">;</span> <span class="k">intro</span><span class="o">;</span> <span class="n">smap</span><span class="o">;</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">!!</span> <span class="n">i</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">EE</span><span class="o">;</span> <span class="k">rewrite</span> <span class="n">EE</span><span class="o">;</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-3316"><a id="line-3316" name="line-3316"></a>  <span class="o">-</span> <span class="c">(* Lock group *)</span>
</span><span id="linespan-3317"><a id="line-3317" name="line-3317"></a>    <span class="k">eapply</span> <span class="n">exists_holds</span> <span class="k">in</span> <span class="n">Q</span> <span class="k">as</span> <span class="o">[</span><span class="n">t</span> <span class="n">Q</span><span class="o">].</span>
</span><span id="linespan-3318"><a id="line-3318" name="line-3318"></a>    <span class="k">eapply</span> <span class="n">pure_sep_holds</span> <span class="k">in</span> <span class="n">Q</span> <span class="k">as</span> <span class="o">[</span><span class="n">Hrel</span> <span class="n">Q</span><span class="o">].</span>
</span><span id="linespan-3319"><a id="line-3319" name="line-3319"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">HH</span> <span class="o">:=</span> <span class="n">Hrel</span><span class="o">).</span>
</span><span id="linespan-3320"><a id="line-3320" name="line-3320"></a>    <span class="k">eapply</span> <span class="n">lockrelG_progress</span> <span class="k">in</span> <span class="n">HH</span><span class="o">.</span>
</span><span id="linespan-3321"><a id="line-3321" name="line-3321"></a>    <span class="k">destruct</span> <span class="n">HH</span> <span class="k">as</span> <span class="o">[</span><span class="n">HH</span><span class="o">|</span><span class="n">HH</span><span class="o">].</span>
</span><span id="linespan-3322"><a id="line-3322" name="line-3322"></a>    <span class="o">{</span>
</span><span id="linespan-3323"><a id="line-3323" name="line-3323"></a>      <span class="c">(* Delete the group *)</span>
</span><span id="linespan-3324"><a id="line-3324" name="line-3324"></a>      <span class="n">simp</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">Can_step_reachable</span><span class="o">.</span>
</span><span id="linespan-3325"><a id="line-3325" name="line-3325"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">=</span> <span class="o">{[</span>
</span><span id="linespan-3326"><a id="line-3326" name="line-3326"></a>        <span class="n">i</span> <span class="o">:=</span> <span class="n">LockG</span> <span class="mi">0</span> <span class="bp">∅</span>
</span><span id="linespan-3327"><a id="line-3327" name="line-3327"></a>      <span class="o">]}</span> <span class="bp">∪</span> <span class="n">delete</span> <span class="n">i</span> <span class="n">ρ</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-3328"><a id="line-3328" name="line-3328"></a>      <span class="o">{</span> <span class="k">eapply</span> <span class="n">map_eq</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3329"><a id="line-3329" name="line-3329"></a>      <span class="n">eexists</span><span class="o">.</span> <span class="k">econstructor</span><span class="o">;</span> <span class="kr">last</span> <span class="k">econstructor</span><span class="o">.</span>
</span><span id="linespan-3330"><a id="line-3330" name="line-3330"></a>      <span class="o">-</span> <span class="k">intro</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="k">destruct</span> <span class="o">(_!!</span><span class="n">i0</span><span class="o">);</span> <span class="kr">try</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3331"><a id="line-3331" name="line-3331"></a>      <span class="o">-</span> <span class="n">solve_map_disjoint</span><span class="o">.</span>
</span><span id="linespan-3332"><a id="line-3332" name="line-3332"></a>    <span class="o">}</span>
</span><span id="linespan-3333"><a id="line-3333" name="line-3333"></a>    <span class="k">destruct</span> <span class="n">HH</span> <span class="k">as</span> <span class="o">(</span><span class="n">ls</span><span class="o">&amp;[</span><span class="n">x'</span> <span class="n">Hinl</span><span class="o">]&amp;</span><span class="n">Hprog</span><span class="o">).</span>
</span><span id="linespan-3334"><a id="line-3334" name="line-3334"></a>    <span class="k">assert</span> <span class="o">(</span><span class="n">Hinl'</span> <span class="o">:=</span> <span class="n">Hinl</span><span class="o">).</span>
</span><span id="linespan-3335"><a id="line-3335" name="line-3335"></a>    <span class="k">eapply</span> <span class="n">in_labels_out_edges</span> <span class="k">in</span> <span class="n">Hinl'</span> <span class="k">as</span>  <span class="o">[</span><span class="n">j</span> <span class="n">Hj</span><span class="o">].</span>
</span><span id="linespan-3336"><a id="line-3336" name="line-3336"></a>    <span class="k">destruct</span> <span class="o">(</span><span class="n">classic</span> <span class="o">(</span><span class="n">blocked</span> <span class="n">ρ</span> <span class="n">j</span> <span class="n">i</span><span class="o">))</span> <span class="k">as</span> <span class="o">[</span><span class="n">HB</span><span class="o">|</span><span class="n">HB</span><span class="o">];</span> <span class="kr">last</span> <span class="kr">first</span><span class="o">.</span>
</span><span id="linespan-3337"><a id="line-3337" name="line-3337"></a>    <span class="o">{</span>
</span><span id="linespan-3338"><a id="line-3338" name="line-3338"></a>      <span class="c">(* Not blocked, so use IH to go there *)</span>
</span><span id="linespan-3339"><a id="line-3339" name="line-3339"></a>      <span class="k">destruct</span> <span class="o">(</span><span class="n">IH2</span> <span class="o">_</span> <span class="o">_</span> <span class="n">Hj</span> <span class="n">HB</span><span class="o">)</span> <span class="k">as</span> <span class="o">[</span><span class="n">H</span><span class="o">|</span><span class="n">H</span><span class="o">].</span>
</span><span id="linespan-3340"><a id="line-3340" name="line-3340"></a>      <span class="o">-</span> <span class="n">exfalso</span><span class="o">.</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">out_edge_active</span><span class="o">.</span>
</span><span id="linespan-3341"><a id="line-3341" name="line-3341"></a>      <span class="o">-</span> <span class="k">eapply</span> <span class="n">Waiting_reachable</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3342"><a id="line-3342" name="line-3342"></a>        <span class="k">unfold</span> <span class="n">waiting</span><span class="o">.</span>
</span><span id="linespan-3343"><a id="line-3343" name="line-3343"></a>        <span class="k">unfold</span> <span class="n">blocked</span> <span class="k">in</span> <span class="n">HB</span><span class="o">.</span>
</span><span id="linespan-3344"><a id="line-3344" name="line-3344"></a>        <span class="k">right</span><span class="o">.</span>
</span><span id="linespan-3345"><a id="line-3345" name="line-3345"></a>        <span class="n">edestruct</span> <span class="o">(</span><span class="n">linv_out_Some</span> <span class="n">i</span> <span class="n">j</span><span class="o">)</span> <span class="k">as</span> <span class="o">[</span><span class="n">e1</span> <span class="o">[</span><span class="n">He1</span> <span class="n">He1'</span><span class="o">]];</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3346"><a id="line-3346" name="line-3346"></a>        <span class="n">eexists</span><span class="o">.</span> <span class="k">split</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3347"><a id="line-3347" name="line-3347"></a>        <span class="k">split</span><span class="o">.</span>
</span><span id="linespan-3348"><a id="line-3348" name="line-3348"></a>        <span class="o">+</span> <span class="k">erewrite</span> <span class="n">obj_refs_linv</span><span class="o">;</span> <span class="kr">last</span> <span class="k">eauto</span><span class="o">;</span> <span class="kr">last</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3349"><a id="line-3349" name="line-3349"></a>          <span class="k">eapply</span> <span class="n">elem_of_dom</span><span class="o">.</span> <span class="n">inv</span> <span class="n">Hj</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3350"><a id="line-3350" name="line-3350"></a>        <span class="o">+</span> <span class="k">intros</span> <span class="o">???.</span> <span class="k">eapply</span> <span class="n">HB</span><span class="o">.</span> <span class="k">subst</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3351"><a id="line-3351" name="line-3351"></a>    <span class="o">}</span>
</span><span id="linespan-3352"><a id="line-3352" name="line-3352"></a>    <span class="k">eapply</span> <span class="n">Can_step_reachable</span><span class="o">.</span>
</span><span id="linespan-3353"><a id="line-3353" name="line-3353"></a>    <span class="k">destruct</span> <span class="n">HB</span> <span class="k">as</span> <span class="o">(</span><span class="n">e</span> <span class="o">&amp;</span> <span class="n">Hρ</span> <span class="o">&amp;</span> <span class="n">Hw</span><span class="o">).</span>
</span><span id="linespan-3354"><a id="line-3354" name="line-3354"></a>    <span class="k">destruct</span> <span class="n">Hw</span> <span class="k">as</span> <span class="o">(</span><span class="n">k</span> <span class="o">&amp;</span> <span class="n">e'</span> <span class="o">&amp;</span> <span class="n">Hk</span> <span class="o">&amp;</span> <span class="o">-&gt;</span> <span class="o">&amp;</span> <span class="n">Hw</span><span class="o">).</span>
</span><span id="linespan-3355"><a id="line-3355" name="line-3355"></a>    <span class="k">pose</span> <span class="n">proof</span> <span class="o">(</span><span class="n">Hinv</span> <span class="n">j</span><span class="o">)</span> <span class="k">as</span> <span class="n">Hinvj</span><span class="o">.</span>
</span><span id="linespan-3356"><a id="line-3356" name="line-3356"></a>    <span class="k">unfold</span> <span class="n">linv</span> <span class="k">in</span> <span class="n">Hinvj</span><span class="o">.</span>
</span><span id="linespan-3357"><a id="line-3357" name="line-3357"></a>    <span class="k">rewrite</span> <span class="n">Hρ</span> <span class="k">in</span> <span class="n">Hinvj</span><span class="o">.</span>
</span><span id="linespan-3358"><a id="line-3358" name="line-3358"></a>    <span class="k">eapply</span> <span class="n">pure_sep_holds</span> <span class="k">in</span> <span class="n">Hinvj</span> <span class="k">as</span> <span class="o">[_</span> <span class="n">Htyped</span><span class="o">].</span>
</span><span id="linespan-3359"><a id="line-3359" name="line-3359"></a>    <span class="k">destruct</span> <span class="n">Hw</span><span class="o">.</span>
</span><span id="linespan-3360"><a id="line-3360" name="line-3360"></a>    <span class="o">+</span> <span class="n">exfalso</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">label_unique</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">exact</span> <span class="n">Hj</span><span class="o">.</span>
</span><span id="linespan-3361"><a id="line-3361" name="line-3361"></a>      <span class="k">eapply</span> <span class="n">holds_entails</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3362"><a id="line-3362" name="line-3362"></a>      <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">replacement</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3363"><a id="line-3363" name="line-3363"></a>      <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="s2">"[H1 H2]"</span><span class="o">.</span>
</span><span id="linespan-3364"><a id="line-3364" name="line-3364"></a>      <span class="k">simpl</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H1"</span><span class="o">.</span>
</span><span id="linespan-3365"><a id="line-3365" name="line-3365"></a>      <span class="n">iDestruct</span> <span class="s2">"H1"</span> <span class="k">as</span> <span class="s2">"[Q1 Q2]"</span><span class="o">.</span>
</span><span id="linespan-3366"><a id="line-3366" name="line-3366"></a>      <span class="n">iDestr</span> <span class="s2">"Q1"</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="k">eauto</span> <span class="k">with</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-3367"><a id="line-3367" name="line-3367"></a>    <span class="o">+</span> <span class="k">assert</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">=</span> <span class="o">{[</span>
</span><span id="linespan-3368"><a id="line-3368" name="line-3368"></a>        <span class="n">j</span> <span class="o">:=</span> <span class="n">Thread</span> <span class="o">(</span><span class="n">k</span> <span class="o">(</span><span class="n">ForkLock</span> <span class="o">(</span><span class="n">Val</span> <span class="o">(</span><span class="n">LockGV</span> <span class="n">j0</span> <span class="n">ls0</span><span class="o">))</span> <span class="o">(</span><span class="n">Val</span> <span class="n">v</span><span class="o">)));</span>
</span><span id="linespan-3369"><a id="line-3369" name="line-3369"></a>        <span class="n">j0</span> <span class="o">:=</span> <span class="n">LockG</span> <span class="n">refcnt</span> <span class="n">lcks</span>
</span><span id="linespan-3370"><a id="line-3370" name="line-3370"></a>        <span class="o">]}</span> <span class="bp">∪</span> <span class="o">(</span><span class="n">delete</span> <span class="n">j</span> <span class="o">$</span> <span class="n">delete</span> <span class="n">j0</span> <span class="n">ρ</span><span class="o">))</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-3371"><a id="line-3371" name="line-3371"></a>      <span class="o">{</span> <span class="k">apply</span> <span class="n">map_eq</span><span class="o">.</span> <span class="k">intro</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3372"><a id="line-3372" name="line-3372"></a>      <span class="k">destruct</span> <span class="o">(</span><span class="n">cfg_fresh1</span> <span class="n">ρ</span><span class="o">)</span> <span class="k">as</span> <span class="o">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="n">Hi</span><span class="o">).</span>
</span><span id="linespan-3373"><a id="line-3373" name="line-3373"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">j</span> <span class="o">≠</span> <span class="n">i</span><span class="o">).</span> <span class="o">{</span> <span class="k">intro</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3374"><a id="line-3374" name="line-3374"></a>      <span class="k">assert</span> <span class="o">(</span><span class="n">i</span> <span class="o">≠</span> <span class="n">j0</span><span class="o">).</span> <span class="o">{</span> <span class="k">intro</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3375"><a id="line-3375" name="line-3375"></a>      <span class="kr">do</span> <span class="mi">2</span> <span class="k">econstructor</span><span class="o">;</span> <span class="kr">last</span> <span class="k">econstructor</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">exact</span> <span class="n">H0</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span>
</span><span id="linespan-3376"><a id="line-3376" name="line-3376"></a>      <span class="k">intro</span><span class="o">;</span> <span class="n">smap</span><span class="o">;</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">!!</span> <span class="n">i0</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">EE</span><span class="o">;</span> <span class="k">rewrite</span> <span class="n">EE</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-3377"><a id="line-3377" name="line-3377"></a>    <span class="o">+</span> <span class="k">eapply</span> <span class="n">label_unique'</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">holds_entails</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3378"><a id="line-3378" name="line-3378"></a>      <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">replacement</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3379"><a id="line-3379" name="line-3379"></a>      <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="s2">"[H _]"</span><span class="o">.</span>
</span><span id="linespan-3380"><a id="line-3380" name="line-3380"></a>      <span class="n">iDestr</span> <span class="s2">"H"</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span> <span class="n">iPureIntro</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3381"><a id="line-3381" name="line-3381"></a>      <span class="n">eassert</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">=</span> <span class="o">{[</span>
</span><span id="linespan-3382"><a id="line-3382" name="line-3382"></a>        <span class="n">j</span> <span class="o">:=</span> <span class="n">Thread</span> <span class="o">_;</span>
</span><span id="linespan-3383"><a id="line-3383" name="line-3383"></a>        <span class="n">j0</span> <span class="o">:=</span> <span class="n">LockG</span> <span class="o">_</span> <span class="o">_</span>
</span><span id="linespan-3384"><a id="line-3384" name="line-3384"></a>        <span class="o">]}</span> <span class="bp">∪</span> <span class="o">(</span><span class="n">delete</span> <span class="n">j</span> <span class="o">$</span> <span class="n">delete</span> <span class="n">j0</span> <span class="n">ρ</span><span class="o">))</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-3385"><a id="line-3385" name="line-3385"></a>      <span class="o">{</span> <span class="k">apply</span> <span class="n">map_eq</span><span class="o">.</span> <span class="k">intro</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3386"><a id="line-3386" name="line-3386"></a>      <span class="k">destruct</span> <span class="n">Hprog</span> <span class="k">as</span> <span class="o">[</span><span class="n">Haprog</span> <span class="n">Hwprog</span><span class="o">].</span>
</span><span id="linespan-3387"><a id="line-3387" name="line-3387"></a>      <span class="k">rewrite</span> <span class="n">acquire_progress_alt</span> <span class="k">in</span> <span class="n">Haprog</span><span class="o">.</span>
</span><span id="linespan-3388"><a id="line-3388" name="line-3388"></a>      <span class="k">destruct</span> <span class="o">(</span><span class="n">ls0</span> <span class="o">!!</span> <span class="n">i</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">QQ</span><span class="o">;</span> <span class="kr">last</span> <span class="kr">first</span><span class="o">.</span>
</span><span id="linespan-3389"><a id="line-3389" name="line-3389"></a>      <span class="o">{</span>
</span><span id="linespan-3390"><a id="line-3390" name="line-3390"></a>        <span class="k">eapply</span> <span class="n">lookup_ge_None</span> <span class="k">in</span> <span class="n">QQ</span><span class="o">.</span>
</span><span id="linespan-3391"><a id="line-3391" name="line-3391"></a>        <span class="k">eapply</span> <span class="n">lookup_lt_Some</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-3392"><a id="line-3392" name="line-3392"></a>        <span class="k">rewrite</span> <span class="n">H2</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-3393"><a id="line-3393" name="line-3393"></a>      <span class="o">}</span>
</span><span id="linespan-3394"><a id="line-3394" name="line-3394"></a>      <span class="n">edestruct</span> <span class="o">(</span><span class="n">Haprog</span> <span class="n">i</span><span class="o">)</span> <span class="k">as</span> <span class="o">[</span><span class="n">refcnt'</span> <span class="o">[</span><span class="n">v</span> <span class="n">HP</span><span class="o">]].</span>
</span><span id="linespan-3395"><a id="line-3395" name="line-3395"></a>      <span class="o">{</span>
</span><span id="linespan-3396"><a id="line-3396" name="line-3396"></a>        <span class="k">intros</span><span class="o">.</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">ls0</span> <span class="o">!!</span> <span class="n">j1</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">FF</span><span class="o">.</span>
</span><span id="linespan-3397"><a id="line-3397" name="line-3397"></a>        <span class="o">-</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">xs0</span> <span class="o">!!</span> <span class="n">j1</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">EE</span><span class="o">.</span>
</span><span id="linespan-3398"><a id="line-3398" name="line-3398"></a>          <span class="o">+</span> <span class="k">destruct</span> <span class="n">p</span><span class="o">.</span> <span class="k">destruct</span> <span class="n">l</span><span class="o">.</span>
</span><span id="linespan-3399"><a id="line-3399" name="line-3399"></a>            <span class="k">assert</span> <span class="o">(</span><span class="n">l0</span> <span class="o">=</span> <span class="n">Closed</span><span class="o">)</span> <span class="k">as</span> <span class="o">-&gt;;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3400"><a id="line-3400" name="line-3400"></a>            <span class="kr">do</span> <span class="mi">3</span> <span class="n">eexists</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">lookup_zip</span> <span class="n">FF</span> <span class="n">EE</span> <span class="o">//.</span>
</span><span id="linespan-3401"><a id="line-3401" name="line-3401"></a>          <span class="o">+</span> <span class="k">eapply</span> <span class="n">lookup_ge_None</span> <span class="k">in</span> <span class="n">EE</span><span class="o">.</span>
</span><span id="linespan-3402"><a id="line-3402" name="line-3402"></a>            <span class="k">eapply</span> <span class="n">lookup_lt_Some</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-3403"><a id="line-3403" name="line-3403"></a>            <span class="k">assert</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">i</span><span class="o">);</span> <span class="kr">try</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-3404"><a id="line-3404" name="line-3404"></a>            <span class="o">{</span> <span class="k">eapply</span> <span class="n">Nat.lt_le_trans</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3405"><a id="line-3405" name="line-3405"></a>              <span class="n">etrans</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3406"><a id="line-3406" name="line-3406"></a>        <span class="o">-</span> <span class="k">eapply</span> <span class="n">lookup_ge_None</span> <span class="k">in</span> <span class="n">FF</span><span class="o">.</span>
</span><span id="linespan-3407"><a id="line-3407" name="line-3407"></a>          <span class="k">eapply</span> <span class="n">lookup_lt_Some</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-3408"><a id="line-3408" name="line-3408"></a>          <span class="k">rewrite</span> <span class="n">H2</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-3409"><a id="line-3409" name="line-3409"></a>      <span class="o">}</span>
</span><span id="linespan-3410"><a id="line-3410" name="line-3410"></a>      <span class="o">{</span>
</span><span id="linespan-3411"><a id="line-3411" name="line-3411"></a>        <span class="k">rewrite</span> <span class="n">lookup_zip</span> <span class="n">QQ</span> <span class="n">H</span> <span class="o">//.</span>
</span><span id="linespan-3412"><a id="line-3412" name="line-3412"></a>      <span class="o">}</span>
</span><span id="linespan-3413"><a id="line-3413" name="line-3413"></a>      <span class="kr">do</span> <span class="mi">2</span> <span class="k">econstructor</span><span class="o">;</span> <span class="kr">last</span> <span class="k">econstructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span>
</span><span id="linespan-3414"><a id="line-3414" name="line-3414"></a>      <span class="kr">try</span> <span class="k">intro</span><span class="o">;</span> <span class="n">smap</span><span class="o">;</span> <span class="kr">try</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">!!</span> <span class="n">i0</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">EE</span><span class="o">;</span> <span class="k">rewrite</span> <span class="o">?</span><span class="n">EE</span> <span class="o">//.</span>
</span><span id="linespan-3415"><a id="line-3415" name="line-3415"></a>    <span class="o">+</span> <span class="k">eapply</span> <span class="n">label_unique'</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">holds_entails</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3416"><a id="line-3416" name="line-3416"></a>      <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">replacement</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3417"><a id="line-3417" name="line-3417"></a>      <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="o">(</span><span class="n">tt</span><span class="o">)</span> <span class="s2">"[H1 _]"</span><span class="o">.</span>
</span><span id="linespan-3418"><a id="line-3418" name="line-3418"></a>      <span class="k">simpl</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H1"</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3419"><a id="line-3419" name="line-3419"></a>      <span class="n">iDestruct</span> <span class="s2">"H1"</span> <span class="k">as</span> <span class="s2">"[H1 H2]"</span><span class="o">.</span>
</span><span id="linespan-3420"><a id="line-3420" name="line-3420"></a>      <span class="n">iDestr</span> <span class="s2">"H1"</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="n">iExists</span> <span class="o">_.</span>
</span><span id="linespan-3421"><a id="line-3421" name="line-3421"></a>      <span class="n">iFrame</span><span class="o">.</span> <span class="n">iPureIntro</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3422"><a id="line-3422" name="line-3422"></a>      <span class="k">destruct</span> <span class="o">(</span><span class="n">ls0</span> <span class="o">!!</span> <span class="n">i</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">EE</span><span class="o">;</span> <span class="kr">last</span> <span class="kr">first</span><span class="o">.</span>
</span><span id="linespan-3423"><a id="line-3423" name="line-3423"></a>      <span class="o">{</span> <span class="k">eapply</span> <span class="n">lookup_lt_Some</span> <span class="k">in</span> <span class="n">H1</span><span class="o">.</span>
</span><span id="linespan-3424"><a id="line-3424" name="line-3424"></a>        <span class="k">eapply</span> <span class="n">lookup_ge_None</span> <span class="k">in</span> <span class="n">EE</span><span class="o">.</span>
</span><span id="linespan-3425"><a id="line-3425" name="line-3425"></a>        <span class="k">rewrite</span> <span class="o">-</span><span class="n">H2</span> <span class="k">in</span> <span class="n">EE</span><span class="o">.</span>
</span><span id="linespan-3426"><a id="line-3426" name="line-3426"></a>        <span class="k">assert</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">i</span><span class="o">).</span> <span class="k">eapply</span> <span class="n">Nat.lt_le_trans</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3427"><a id="line-3427" name="line-3427"></a>      <span class="k">rewrite</span> <span class="n">Hinl</span> <span class="k">in</span> <span class="n">Hrel</span><span class="o">.</span>
</span><span id="linespan-3428"><a id="line-3428" name="line-3428"></a>      <span class="k">eapply</span> <span class="n">lockrelG_refcounti_Opened</span> <span class="k">in</span> <span class="n">Hrel</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3429"><a id="line-3429" name="line-3429"></a>      <span class="n">eassert</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">=</span> <span class="o">{[</span>
</span><span id="linespan-3430"><a id="line-3430" name="line-3430"></a>        <span class="n">j</span> <span class="o">:=</span> <span class="n">Thread</span> <span class="o">_;</span>
</span><span id="linespan-3431"><a id="line-3431" name="line-3431"></a>        <span class="n">j0</span> <span class="o">:=</span> <span class="n">LockG</span> <span class="o">_</span> <span class="o">_</span>
</span><span id="linespan-3432"><a id="line-3432" name="line-3432"></a>        <span class="o">]}</span> <span class="bp">∪</span> <span class="o">(</span><span class="n">delete</span> <span class="n">j</span> <span class="o">$</span> <span class="n">delete</span> <span class="n">j0</span> <span class="n">ρ</span><span class="o">))</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-3433"><a id="line-3433" name="line-3433"></a>      <span class="o">{</span> <span class="k">apply</span> <span class="n">map_eq</span><span class="o">.</span> <span class="k">intro</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3434"><a id="line-3434" name="line-3434"></a>      <span class="kr">do</span> <span class="mi">2</span> <span class="k">econstructor</span><span class="o">;</span> <span class="kr">last</span> <span class="k">econstructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span>
</span><span id="linespan-3435"><a id="line-3435" name="line-3435"></a>      <span class="k">intro</span><span class="o">;</span> <span class="n">smap</span><span class="o">;</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">!!</span> <span class="n">i0</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">FF</span><span class="o">;</span> <span class="k">rewrite</span> <span class="n">FF</span> <span class="o">//.</span>
</span><span id="linespan-3436"><a id="line-3436" name="line-3436"></a>    <span class="o">+</span> <span class="k">eapply</span> <span class="n">label_unique'</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">holds_entails</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3437"><a id="line-3437" name="line-3437"></a>      <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">replacement</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3438"><a id="line-3438" name="line-3438"></a>      <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="o">(</span><span class="n">tt</span><span class="o">)</span> <span class="s2">"[H1 H2]"</span><span class="o">.</span>
</span><span id="linespan-3439"><a id="line-3439" name="line-3439"></a>      <span class="k">simpl</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H1"</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3440"><a id="line-3440" name="line-3440"></a>      <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span> <span class="n">iPureIntro</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3441"><a id="line-3441" name="line-3441"></a>      <span class="n">eassert</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">=</span> <span class="o">{[</span>
</span><span id="linespan-3442"><a id="line-3442" name="line-3442"></a>        <span class="n">j</span> <span class="o">:=</span> <span class="n">Thread</span> <span class="o">_;</span>
</span><span id="linespan-3443"><a id="line-3443" name="line-3443"></a>        <span class="n">j0</span> <span class="o">:=</span> <span class="n">LockG</span> <span class="o">_</span> <span class="o">_</span>
</span><span id="linespan-3444"><a id="line-3444" name="line-3444"></a>        <span class="o">]}</span> <span class="bp">∪</span> <span class="o">(</span><span class="n">delete</span> <span class="n">j</span> <span class="o">$</span> <span class="n">delete</span> <span class="n">j0</span> <span class="n">ρ</span><span class="o">))</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-3445"><a id="line-3445" name="line-3445"></a>      <span class="o">{</span> <span class="k">apply</span> <span class="n">map_eq</span><span class="o">.</span> <span class="k">intro</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3446"><a id="line-3446" name="line-3446"></a>      <span class="k">destruct</span> <span class="n">Hprog</span> <span class="k">as</span> <span class="o">[</span><span class="n">Haprog</span> <span class="n">Hwprog</span><span class="o">].</span>
</span><span id="linespan-3447"><a id="line-3447" name="line-3447"></a>      <span class="k">rewrite</span> <span class="n">wait_progress_alt</span> <span class="k">in</span> <span class="n">Hwprog</span><span class="o">.</span>
</span><span id="linespan-3448"><a id="line-3448" name="line-3448"></a>      <span class="k">destruct</span> <span class="o">(</span><span class="n">ls0</span> <span class="o">!!</span> <span class="n">i</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">EE</span><span class="o">;</span> <span class="kr">last</span> <span class="kr">first</span><span class="o">.</span>
</span><span id="linespan-3449"><a id="line-3449" name="line-3449"></a>      <span class="o">{</span>
</span><span id="linespan-3450"><a id="line-3450" name="line-3450"></a>        <span class="k">eapply</span> <span class="n">lookup_ge_None</span> <span class="k">in</span> <span class="n">EE</span><span class="o">.</span>
</span><span id="linespan-3451"><a id="line-3451" name="line-3451"></a>        <span class="k">eapply</span> <span class="n">lookup_lt_Some</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-3452"><a id="line-3452" name="line-3452"></a>        <span class="k">rewrite</span> <span class="n">H2</span> <span class="k">in</span> <span class="n">H</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-3453"><a id="line-3453" name="line-3453"></a>      <span class="o">}</span>
</span><span id="linespan-3454"><a id="line-3454" name="line-3454"></a>      <span class="n">edestruct</span> <span class="o">(</span><span class="n">Hwprog</span> <span class="n">i</span><span class="o">).</span>
</span><span id="linespan-3455"><a id="line-3455" name="line-3455"></a>      <span class="o">{</span> <span class="k">intros</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">lookup_zip</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span>
</span><span id="linespan-3456"><a id="line-3456" name="line-3456"></a>        <span class="k">destruct</span> <span class="o">(</span><span class="n">ls0</span> <span class="o">!!</span> <span class="n">j1</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">FF</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3457"><a id="line-3457" name="line-3457"></a>        <span class="k">destruct</span> <span class="o">(</span><span class="n">xs0</span> <span class="o">!!</span> <span class="n">j1</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">FF'</span><span class="o">;</span> <span class="n">simp</span><span class="o">;</span> <span class="kr">last</span> <span class="kr">first</span><span class="o">.</span>
</span><span id="linespan-3458"><a id="line-3458" name="line-3458"></a>        <span class="o">{</span> <span class="k">eapply</span> <span class="n">lookup_ge_None</span> <span class="k">in</span> <span class="n">FF'</span><span class="o">.</span>
</span><span id="linespan-3459"><a id="line-3459" name="line-3459"></a>          <span class="k">eapply</span> <span class="n">lookup_lt_Some</span> <span class="k">in</span> <span class="n">FF</span><span class="o">.</span>
</span><span id="linespan-3460"><a id="line-3460" name="line-3460"></a>          <span class="k">rewrite</span> <span class="n">H2</span> <span class="k">in</span> <span class="n">FF'</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3461"><a id="line-3461" name="line-3461"></a>        <span class="k">rewrite</span> <span class="n">FF'</span> <span class="k">in</span> <span class="n">H0</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3462"><a id="line-3462" name="line-3462"></a>        <span class="k">eapply</span> <span class="n">H4</span> <span class="k">in</span> <span class="n">FF'</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3463"><a id="line-3463" name="line-3463"></a>      <span class="o">{</span> <span class="k">rewrite</span> <span class="n">lookup_zip</span> <span class="n">EE</span> <span class="n">H</span> <span class="o">//.</span> <span class="o">}</span>
</span><span id="linespan-3464"><a id="line-3464" name="line-3464"></a>      <span class="kr">do</span> <span class="mi">2</span> <span class="k">econstructor</span><span class="o">;</span> <span class="kr">last</span> <span class="k">econstructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span>
</span><span id="linespan-3465"><a id="line-3465" name="line-3465"></a>      <span class="k">intro</span><span class="o">;</span> <span class="n">smap</span><span class="o">;</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">!!</span> <span class="n">i0</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">FF</span><span class="o">;</span> <span class="k">rewrite</span> <span class="n">FF</span> <span class="o">//.</span>
</span><span id="linespan-3466"><a id="line-3466" name="line-3466"></a>    <span class="o">+</span> <span class="k">assert</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">=</span> <span class="o">{[</span>
</span><span id="linespan-3467"><a id="line-3467" name="line-3467"></a>        <span class="n">j</span> <span class="o">:=</span> <span class="n">Thread</span> <span class="o">(</span><span class="n">k</span> <span class="o">(</span><span class="n">NewLock</span> <span class="n">i</span> <span class="o">(</span><span class="n">Val</span> <span class="o">(</span><span class="n">LockGV</span> <span class="n">j0</span> <span class="n">ls0</span><span class="o">))));</span>
</span><span id="linespan-3468"><a id="line-3468" name="line-3468"></a>        <span class="n">j0</span> <span class="o">:=</span> <span class="n">LockG</span> <span class="n">refcnt</span> <span class="n">lcks</span>
</span><span id="linespan-3469"><a id="line-3469" name="line-3469"></a>        <span class="o">]}</span> <span class="bp">∪</span> <span class="o">(</span><span class="n">delete</span> <span class="n">j</span> <span class="o">$</span> <span class="n">delete</span> <span class="n">j0</span> <span class="n">ρ</span><span class="o">))</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-3470"><a id="line-3470" name="line-3470"></a>      <span class="o">{</span> <span class="k">apply</span> <span class="n">map_eq</span><span class="o">.</span> <span class="k">intro</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3471"><a id="line-3471" name="line-3471"></a>      <span class="k">destruct</span> <span class="o">(</span><span class="n">map_fresh1</span> <span class="n">lcks</span><span class="o">)</span> <span class="k">as</span> <span class="o">(</span><span class="n">ii</span> <span class="o">&amp;</span> <span class="n">Hii</span><span class="o">).</span>
</span><span id="linespan-3472"><a id="line-3472" name="line-3472"></a>      <span class="kr">do</span> <span class="mi">2</span> <span class="k">econstructor</span><span class="o">;</span> <span class="kr">last</span> <span class="k">econstructor</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3473"><a id="line-3473" name="line-3473"></a>      <span class="o">*</span> <span class="k">intro</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">ρ</span><span class="o">!!</span><span class="n">i0</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">EE</span><span class="o">;</span> <span class="k">rewrite</span> <span class="n">EE</span><span class="o">;</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3474"><a id="line-3474" name="line-3474"></a>      <span class="o">*</span> <span class="k">intro</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">ρ</span><span class="o">!!</span><span class="n">i0</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">EE</span><span class="o">;</span> <span class="k">rewrite</span> <span class="n">EE</span><span class="o">;</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3475"><a id="line-3475" name="line-3475"></a>      <span class="o">*</span> <span class="k">intro</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span>
</span><span id="linespan-3476"><a id="line-3476" name="line-3476"></a>    <span class="o">+</span> <span class="k">eapply</span> <span class="n">label_unique'</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">holds_entails</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3477"><a id="line-3477" name="line-3477"></a>      <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">replacement</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3478"><a id="line-3478" name="line-3478"></a>      <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="o">(</span><span class="n">tt</span><span class="o">)</span> <span class="s2">"[H1 H2]"</span><span class="o">.</span>
</span><span id="linespan-3479"><a id="line-3479" name="line-3479"></a>      <span class="k">simpl</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H1"</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span>
</span><span id="linespan-3480"><a id="line-3480" name="line-3480"></a>      <span class="n">iPureIntro</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3481"><a id="line-3481" name="line-3481"></a>      <span class="n">eassert</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">=</span> <span class="o">{[</span>
</span><span id="linespan-3482"><a id="line-3482" name="line-3482"></a>        <span class="n">j</span> <span class="o">:=</span> <span class="n">Thread</span> <span class="o">_;</span>
</span><span id="linespan-3483"><a id="line-3483" name="line-3483"></a>        <span class="n">j0</span> <span class="o">:=</span> <span class="n">LockG</span> <span class="o">_</span> <span class="o">_</span>
</span><span id="linespan-3484"><a id="line-3484" name="line-3484"></a>        <span class="o">]}</span> <span class="bp">∪</span> <span class="o">(</span><span class="n">delete</span> <span class="n">j</span> <span class="o">$</span> <span class="n">delete</span> <span class="n">j0</span> <span class="n">ρ</span><span class="o">))</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-3485"><a id="line-3485" name="line-3485"></a>      <span class="o">{</span> <span class="k">apply</span> <span class="n">map_eq</span><span class="o">.</span> <span class="k">intro</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3486"><a id="line-3486" name="line-3486"></a>      <span class="k">destruct</span> <span class="o">(</span><span class="n">ls0</span> <span class="o">!!</span> <span class="n">i</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">EE</span><span class="o">;</span> <span class="kr">last</span> <span class="kr">first</span><span class="o">.</span>
</span><span id="linespan-3487"><a id="line-3487" name="line-3487"></a>      <span class="o">{</span> <span class="k">eapply</span> <span class="n">lookup_lt_Some</span> <span class="k">in</span> <span class="n">H3</span><span class="o">.</span>
</span><span id="linespan-3488"><a id="line-3488" name="line-3488"></a>        <span class="k">eapply</span> <span class="n">lookup_ge_None</span> <span class="k">in</span> <span class="n">EE</span><span class="o">.</span>
</span><span id="linespan-3489"><a id="line-3489" name="line-3489"></a>        <span class="k">rewrite</span> <span class="o">-</span><span class="n">H2</span> <span class="k">in</span> <span class="n">EE</span><span class="o">.</span>
</span><span id="linespan-3490"><a id="line-3490" name="line-3490"></a>        <span class="k">assert</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">i</span><span class="o">).</span> <span class="k">eapply</span> <span class="n">Nat.lt_le_trans</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="kp">lia</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3491"><a id="line-3491" name="line-3491"></a>      <span class="k">rewrite</span> <span class="n">Hinl</span> <span class="k">in</span> <span class="n">Hrel</span><span class="o">.</span>
</span><span id="linespan-3492"><a id="line-3492" name="line-3492"></a>      <span class="k">eapply</span> <span class="n">lockrelG_refcounti</span> <span class="k">in</span> <span class="n">Hrel</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3493"><a id="line-3493" name="line-3493"></a>      <span class="kr">do</span> <span class="mi">2</span> <span class="k">econstructor</span><span class="o">;</span> <span class="kr">last</span> <span class="k">econstructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span>
</span><span id="linespan-3494"><a id="line-3494" name="line-3494"></a>      <span class="k">intro</span><span class="o">;</span> <span class="n">smap</span><span class="o">;</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">!!</span> <span class="n">i0</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">FF</span><span class="o">;</span> <span class="k">rewrite</span> <span class="n">FF</span> <span class="o">//.</span>
</span><span id="linespan-3495"><a id="line-3495" name="line-3495"></a>    <span class="o">+</span> <span class="k">eapply</span> <span class="n">label_unique'</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span> <span class="k">eapply</span> <span class="n">holds_entails</span><span class="o">;</span> <span class="kr">first</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3496"><a id="line-3496" name="line-3496"></a>      <span class="n">iIntros</span> <span class="s2">"H"</span><span class="o">.</span> <span class="k">rewrite</span> <span class="n">replacement</span><span class="o">;</span> <span class="kr">last</span> <span class="kp">done</span><span class="o">.</span>
</span><span id="linespan-3497"><a id="line-3497" name="line-3497"></a>      <span class="n">iDestruct</span> <span class="s2">"H"</span> <span class="k">as</span> <span class="o">(</span><span class="n">tt</span><span class="o">)</span> <span class="s2">"[H1 H2]"</span><span class="o">.</span>
</span><span id="linespan-3498"><a id="line-3498" name="line-3498"></a>      <span class="k">simpl</span><span class="o">.</span> <span class="n">iDestr</span> <span class="s2">"H1"</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span> <span class="n">iExists</span> <span class="o">_.</span> <span class="n">iFrame</span><span class="o">.</span> <span class="n">iPureIntro</span><span class="o">.</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3499"><a id="line-3499" name="line-3499"></a>      <span class="k">destruct</span> <span class="n">ls0</span><span class="o">;</span> <span class="n">simp</span><span class="o">.</span>
</span><span id="linespan-3500"><a id="line-3500" name="line-3500"></a>      <span class="k">rewrite</span> <span class="n">Hinl</span> <span class="k">in</span> <span class="n">Hrel</span><span class="o">.</span>
</span><span id="linespan-3501"><a id="line-3501" name="line-3501"></a>      <span class="k">eapply</span> <span class="n">lockrelG_refcount</span> <span class="k">in</span> <span class="n">Hrel</span><span class="o">.</span>
</span><span id="linespan-3502"><a id="line-3502" name="line-3502"></a>      <span class="n">eassert</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">=</span> <span class="o">{[</span>
</span><span id="linespan-3503"><a id="line-3503" name="line-3503"></a>        <span class="n">j</span> <span class="o">:=</span> <span class="n">Thread</span> <span class="o">_;</span>
</span><span id="linespan-3504"><a id="line-3504" name="line-3504"></a>        <span class="n">j0</span> <span class="o">:=</span> <span class="n">LockG</span> <span class="o">_</span> <span class="o">_</span>
</span><span id="linespan-3505"><a id="line-3505" name="line-3505"></a>        <span class="o">]}</span> <span class="bp">∪</span> <span class="o">(</span><span class="n">delete</span> <span class="n">j</span> <span class="o">$</span> <span class="n">delete</span> <span class="n">j0</span> <span class="n">ρ</span><span class="o">))</span> <span class="k">as</span> <span class="o">-&gt;.</span>
</span><span id="linespan-3506"><a id="line-3506" name="line-3506"></a>      <span class="o">{</span> <span class="k">apply</span> <span class="n">map_eq</span><span class="o">.</span> <span class="k">intro</span><span class="o">.</span> <span class="n">smap</span><span class="o">.</span> <span class="o">}</span>
</span><span id="linespan-3507"><a id="line-3507" name="line-3507"></a>      <span class="k">destruct</span> <span class="n">refcnt</span><span class="o">;</span> <span class="kr">try</span> <span class="kp">lia</span><span class="o">.</span>
</span><span id="linespan-3508"><a id="line-3508" name="line-3508"></a>      <span class="kr">do</span> <span class="mi">2</span> <span class="k">econstructor</span><span class="o">;</span> <span class="kr">last</span> <span class="k">econstructor</span><span class="o">;</span> <span class="k">eauto</span><span class="o">;</span>
</span><span id="linespan-3509"><a id="line-3509" name="line-3509"></a>      <span class="k">intro</span><span class="o">;</span> <span class="n">smap</span><span class="o">;</span> <span class="k">destruct</span> <span class="o">(</span><span class="n">ρ</span> <span class="o">!!</span> <span class="n">i</span><span class="o">)</span> <span class="n">eqn</span><span class="o">:</span><span class="n">EE</span><span class="o">;</span> <span class="k">rewrite</span> <span class="n">EE</span> <span class="o">//.</span>
</span><span id="linespan-3510"><a id="line-3510" name="line-3510"></a><span class="kn">Qed</span><span class="o">.</span>
</span><span id="linespan-3511"><a id="line-3511" name="line-3511"></a>
</span><span id="linespan-3512"><a id="line-3512" name="line-3512"></a><span class="kn">Lemma</span> <span class="n">initialization</span> <span class="n">e</span> <span class="o">:</span>
</span><span id="linespan-3513"><a id="line-3513" name="line-3513"></a>  <span class="n">typed</span> <span class="bp">∅</span> <span class="n">e</span> <span class="n">UnitT</span> <span class="o">-&gt;</span> <span class="n">ginv</span> <span class="o">{[</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">Thread</span> <span class="n">e</span> <span class="o">]}.</span>
</span><span id="linespan-3514"><a id="line-3514" name="line-3514"></a><span class="kn">Proof</span><span class="o">.</span>
</span><span id="linespan-3515"><a id="line-3515" name="line-3515"></a>  <span class="k">intros</span> <span class="n">H</span><span class="o">.</span>
</span><span id="linespan-3516"><a id="line-3516" name="line-3516"></a>  <span class="k">unfold</span> <span class="n">ginv</span><span class="o">,</span> <span class="n">linv</span><span class="o">.</span>
</span><span id="linespan-3517"><a id="line-3517" name="line-3517"></a>  <span class="k">eapply</span> <span class="n">inv_impl</span><span class="o">;</span> <span class="kr">last</span> <span class="k">eauto</span> <span class="k">using</span> <span class="n">inv_init</span><span class="o">.</span>
</span><span id="linespan-3518"><a id="line-3518" name="line-3518"></a>  <span class="k">intros</span><span class="o">.</span> <span class="k">simpl</span><span class="o">.</span>
</span><span id="linespan-3519"><a id="line-3519" name="line-3519"></a>  <span class="n">iIntros</span> <span class="s2">"[% _]"</span><span class="o">.</span>
</span><span id="linespan-3520"><a id="line-3520" name="line-3520"></a>  <span class="n">smap</span><span class="o">.</span> <span class="n">iSplit</span><span class="o">;</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3521"><a id="line-3521" name="line-3521"></a>  <span class="k">rewrite</span> <span class="o">-</span><span class="n">rtyped_rtyped0</span><span class="o">.</span>
</span><span id="linespan-3522"><a id="line-3522" name="line-3522"></a>  <span class="n">iApply</span> <span class="n">typed_rtyped</span><span class="o">.</span> <span class="k">eauto</span><span class="o">.</span>
</span><span id="linespan-3523"><a id="line-3523" name="line-3523"></a><span class="kn">Qed</span><span class="o">.</span>
</span></pre></div></td></tr></table></div>
</div></div></body></html>